{
  "topic_metadata": {
    "id": 3845,
    "title": "Word wrapping works like in LaTeX?",
    "slug": "word-wrapping-works-like-in-latex",
    "posts_count": 7,
    "created_at": "2025-04-28T10:15:52.341Z",
    "last_posted_at": "2025-04-28T17:34:51.954Z",
    "views": 109,
    "like_count": 2,
    "reply_count": 4,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 3,
    "accepted_answer_username": "MAX2",
    "tags": [
      "latex-migration",
      "typography"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 944
  },
  "posts": [
    {
      "id": 11713,
      "post_number": 1,
      "username": "MAX2",
      "name": "MAX",
      "created_at": "2025-04-28T10:15:52.535Z",
      "updated_at": "2025-05-04T12:39:00.326Z",
      "cooked": "<p>I’m considering typst as a possible alternative to LaTeX, but I can’t seem to reproduce how LaTeX breaks words.</p>\n<p>I’ve experimented a bit and found that justify improves the results somewhat, but it’s still not perfect.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/7/71bc0119a9554f42c79b90079921a4e19cfec734.jpeg\" data-download-href=\"https://forum.typst.app/uploads/default/71bc0119a9554f42c79b90079921a4e19cfec734\" title=\"Screenshot_20250428_014250_Drive\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/7/71bc0119a9554f42c79b90079921a4e19cfec734_2_690x217.jpeg\" alt=\"Screenshot_20250428_014250_Drive\" data-base62-sha1=\"ge8KAO8TAC9PqZBoOP0VtwvTloo\" width=\"690\" height=\"217\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/7/71bc0119a9554f42c79b90079921a4e19cfec734_2_690x217.jpeg, https://forum.typst.app/uploads/default/optimized/2X/7/71bc0119a9554f42c79b90079921a4e19cfec734_2_1035x325.jpeg 1.5x, https://forum.typst.app/uploads/default/original/2X/7/71bc0119a9554f42c79b90079921a4e19cfec734.jpeg 2x\" data-dominant-color=\"E7E7E6\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">Screenshot_20250428_014250_Drive</span><span class=\"informations\">1172×370 116 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div><br>\nlatex</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/0/032f481ffad87592cbcfc4b0a0c0e8faced8b19b.jpeg\" data-download-href=\"https://forum.typst.app/uploads/default/032f481ffad87592cbcfc4b0a0c0e8faced8b19b\" title=\"Screenshot_20250428_124429_Drive\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/0/032f481ffad87592cbcfc4b0a0c0e8faced8b19b_2_690x238.jpeg\" alt=\"Screenshot_20250428_124429_Drive\" data-base62-sha1=\"saJrUzzEQ8sC3mhAxV0XhS2PIT\" width=\"690\" height=\"238\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/0/032f481ffad87592cbcfc4b0a0c0e8faced8b19b_2_690x238.jpeg, https://forum.typst.app/uploads/default/optimized/2X/0/032f481ffad87592cbcfc4b0a0c0e8faced8b19b_2_1035x357.jpeg 1.5x, https://forum.typst.app/uploads/default/original/2X/0/032f481ffad87592cbcfc4b0a0c0e8faced8b19b.jpeg 2x\" data-dominant-color=\"E9EAE9\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">Screenshot_20250428_124429_Drive</span><span class=\"informations\">1200×414 115 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div><br>\ntypst</p>\n<p>If possible, I’d like typst to simply fit as many characters as possible into a line and wrap what doesn’t fit, regardless of any hyphenation rules</p>\n<p>Code example</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#set page(paper: \"a4\", columns: 2, margin: (top:10mm, bottom:5mm, left:10mm, right:5mm), numbering: \"1\")\n\n#set par(first-line-indent: (\n  amount: 1em,\n  all: true,\n), justify: true)\n#set text(lang: \"uk\", font: \"New Computer Modern\", size:10pt, hyphenate: true)\n#set columns(gutter: 10pt)\n\nРозрiзняють також: 1. *Оборотнi* процеси - це такi круговi процеси, пiсля яких\nсистема повертається до початкового стану i при цьому в оточуючому середовищi\nне вiдбувається нiяких змiн. 2. Всi процеси, якi протiкають самодовiльно -\n*необоротнi*. В результатi необоротного процесу неможливо повернути до\nпочаткового стану нi систему, нi навколишнє середовище.\n</code></pre>\n<p>Also, I see that the distance between lines of text is somewhat larger than in latex, how to make them the same</p>",
      "raw": "I'm considering typst as a possible alternative to LaTeX, but I can't seem to reproduce how LaTeX breaks words.\n\nI've experimented a bit and found that justify improves the results somewhat, but it's still not perfect.\n\n![Screenshot_20250428_014250_Drive|690x217](upload://ge8KAO8TAC9PqZBoOP0VtwvTloo.jpeg)\nlatex\n\n![Screenshot_20250428_124429_Drive|690x238](upload://saJrUzzEQ8sC3mhAxV0XhS2PIT.jpeg)\ntypst\n\nIf possible, I'd like typst to simply fit as many characters as possible into a line and wrap what doesn't fit, regardless of any hyphenation rules\n\nCode example\n\n```typst\n#set page(paper: \"a4\", columns: 2, margin: (top:10mm, bottom:5mm, left:10mm, right:5mm), numbering: \"1\")\n\n#set par(first-line-indent: (\n  amount: 1em,\n  all: true,\n), justify: true)\n#set text(lang: \"uk\", font: \"New Computer Modern\", size:10pt, hyphenate: true)\n#set columns(gutter: 10pt)\n\nРозрiзняють також: 1. *Оборотнi* процеси - це такi круговi процеси, пiсля яких\nсистема повертається до початкового стану i при цьому в оточуючому середовищi\nне вiдбувається нiяких змiн. 2. Всi процеси, якi протiкають самодовiльно -\n*необоротнi*. В результатi необоротного процесу неможливо повернути до\nпочаткового стану нi систему, нi навколишнє середовище.\n```\n\nAlso, I see that the distance between lines of text is somewhat larger than in latex, how to make them the same",
      "reply_to_post_number": null,
      "reply_count": 3,
      "quote_count": 0,
      "like_count": 0,
      "reads": 40,
      "score": 162.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1521
    },
    {
      "id": 11719,
      "post_number": 2,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-28T12:13:20.432Z",
      "updated_at": "2025-04-28T12:16:30.893Z",
      "cooked": "<p>In the compared examples, the latex example has 4 consecutive lines with hyphens, that’s normally not considered good typography so doesn’t typst already kind of win this comparison?</p>\n<aside class=\"quote no-group\" data-username=\"MAX2\" data-post=\"1\" data-topic=\"3845\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/m/B9312D/48.png\" class=\"avatar\"> MAX2:</div>\n<blockquote>\n<p>If possible, I’d like typst to simply fit as many characters as possible into a line and wrap what doesn’t fit, regardless of any hyphenation rules</p>\n</blockquote>\n</aside>\n<p>Could you clarify - do you want hyphenation but without using dictionary/rules for where to break words, or you don’t want any hyphenation at all?</p>\n<p>There is this hack which probably could cause unexpected problems - intersperse every word with soft hyphens, which allows it being broken at any point. That should be a kind of maximal allowed hyphenation. <a href=\"https://github.com/typst/typst/issues/5223\">See also this issue</a></p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#show regex(\"\\b.+?\\b\"): it =&gt; it.text.clusters().join(sym.hyph.soft)\n</code></pre>\n<p>This is how the example looks with that code. It’s broken one word in a radical way, leaving a lonely я on the new line.</p>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/c/c907c39856dda88b280ee8635a92cedb0f01c1e6.png\" alt=\"bild\" data-base62-sha1=\"sGoBzfXa8gXOapOwBoeoNAdByZM\" width=\"649\" height=\"238\"></p>\n<hr>\n<p>This is what your example looks like using a development build of Typst where just the microtypal shrink/expansion is enabled (<a href=\"https://github.com/typst/typst/pull/6161\">This pull request in its current state</a>) - the result shows typst now didn’t need hyphenation for the example.</p>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/a/a9889befd1d54f2148bf88582a63305681108e4e.png\" alt=\"bild\" data-base62-sha1=\"obLnka5XnudtO6UmXwJqJhD5NO6\" width=\"652\" height=\"233\"></p>",
      "raw": "In the compared examples, the latex example has 4 consecutive lines with hyphens, that's normally not considered good typography so doesn't typst already kind of win this comparison?\n\n\n\n[quote=\"MAX2, post:1, topic:3845\"]\nIf possible, I’d like typst to simply fit as many characters as possible into a line and wrap what doesn’t fit, regardless of any hyphenation rules\n[/quote]\n\nCould you clarify - do you want hyphenation but without using dictionary/rules for where to break words, or you don't want any hyphenation at all?\n\nThere is this hack which probably could cause unexpected problems - intersperse every word with soft hyphens, which allows it being broken at any point. That should be a kind of maximal allowed hyphenation. [See also this issue](https://github.com/typst/typst/issues/5223)\n\n```typst\n#show regex(\"\\b.+?\\b\"): it => it.text.clusters().join(sym.hyph.soft)\n```\n\nThis is how the example looks with that code. It's broken one word in a radical way, leaving a lonely я on the new line.\n\n![bild|649x238](upload://sGoBzfXa8gXOapOwBoeoNAdByZM.png)\n\n\n---\n\nThis is what your example looks like using a development build of Typst where just the microtypal shrink/expansion is enabled ([This pull request in its current state](https://github.com/typst/typst/pull/6161)) - the result shows typst now didn't need hyphenation for the example.\n\n![bild|652x233](upload://obLnka5XnudtO6UmXwJqJhD5NO6.png)",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 0,
      "reads": 38,
      "score": 17.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11723,
      "post_number": 3,
      "username": "MAX2",
      "name": "MAX",
      "created_at": "2025-04-28T13:22:31.726Z",
      "updated_at": "2025-04-28T13:25:44.070Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"bluss\" data-post=\"2\" data-topic=\"3845\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/b/441A5E/48.png\" class=\"avatar\"> bluss:</div>\n<blockquote>\n<p>In the compared examples, the latex example has 4 consecutive lines with hyphens, that’s normally not considered good typography so doesn’t typst already kind of win this comparison?</p>\n</blockquote>\n</aside>\n<p>Well, I’m not really worried about typography. I’m just a student, and I use LaTeX for notes and lab protocols (we can change them, just the identity of the material is necessary), and printing these labs is quite expensive if you don’t have your own printer, so I need to compress any text as much as possible, and LaTeX performed this task quite well, but I encountered some technical limitations (especially the fact that the Cyrillic i is somehow replaced by the Latin i)</p>\n<aside class=\"quote no-group\" data-username=\"bluss\" data-post=\"2\" data-topic=\"3845\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/b/441A5E/48.png\" class=\"avatar\"> bluss:</div>\n<blockquote>\n<p>Could you clarify - do you want hyphenation but without using dictionary/rules for where to break words, or you don’t want any hyphenation at all?</p>\n</blockquote>\n</aside>\n<p>The first one variant</p>\n<p>And I also found the answer to my question.</p>\n<pre><code class=\"lang-auto\">#set text(costs: (hyphenation: 1%))\n</code></pre>\n<p>using this property makes them, if not identical, then practically the same</p>\n<p>But this question of things is not resolved for me:</p>\n<aside class=\"quote no-group\" data-username=\"MAX2\" data-post=\"1\" data-topic=\"3845\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/m/B9312D/48.png\" class=\"avatar\"> MAX2:</div>\n<blockquote>\n<p>Also, I see that the distance between lines of text is somewhat larger than in latex, how to make them the same</p>\n</blockquote>\n</aside>\n<p>I think you didn’t really understand the question. I just don’t know what this section is called between the lines of the text. It’s between<br>\n“Розрiзняють також: 1. Оборотнi процеси - це такi кру”<br>\nand<br>\n“говi процеси, пiсля яких система повертається до початко” …<br>\n(in my LaTeX example)</p>\n<p>P.s. I’m using a translator, sorry for the bad English.</p>",
      "raw": "[quote=\"bluss, post:2, topic:3845\"]\nIn the compared examples, the latex example has 4 consecutive lines with hyphens, that’s normally not considered good typography so doesn’t typst already kind of win this comparison?\n[/quote]\n\nWell, I'm not really worried about typography. I'm just a student, and I use LaTeX for notes and lab protocols (we can change them, just the identity of the material is necessary), and printing these labs is quite expensive if you don't have your own printer, so I need to compress any text as much as possible, and LaTeX performed this task quite well, but I encountered some technical limitations (especially the fact that the Cyrillic i is somehow replaced by the Latin i)\n\n[quote=\"bluss, post:2, topic:3845\"]\nCould you clarify - do you want hyphenation but without using dictionary/rules for where to break words, or you don’t want any hyphenation at all?\n[/quote]\n\nThe first one variant\n\nAnd I also found the answer to my question.\n```\n#set text(costs: (hyphenation: 1%))\n```\nusing this property makes them, if not identical, then practically the same\n\nBut this question of things is not resolved for me:\n[quote=\"MAX2, post:1, topic:3845\"]\nAlso, I see that the distance between lines of text is somewhat larger than in latex, how to make them the same\n[/quote]\n\nI think you didn't really understand the question. I just don't know what this section is called between the lines of the text. It's between\n\"Розрiзняють також: 1. Оборотнi процеси - це такi кру\"\nand\n\"говi процеси, пiсля яких система повертається до початко\" ...\n(in my LaTeX example)\n\nP.s. I'm using a translator, sorry for the bad English.",
      "reply_to_post_number": 2,
      "reply_count": 2,
      "quote_count": 2,
      "like_count": 1,
      "reads": 35,
      "score": 56.8,
      "accepted_answer": true,
      "trust_level": 1,
      "user_id": 1521
    },
    {
      "id": 11724,
      "post_number": 4,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-28T13:25:05.466Z",
      "updated_at": "2025-04-28T13:25:05.466Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"MAX2\" data-post=\"3\" data-topic=\"3845\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/m/B9312D/48.png\" class=\"avatar\"> MAX2:</div>\n<blockquote>\n<p>I think you didn’t really understand the question. I just don’t know what this section is called between the lines of the text. It’s between</p>\n</blockquote>\n</aside>\n<p>I did understand that question too, I just don’t have an answer to it. Hopefully someone on the forum has an answer.</p>",
      "raw": "[quote=\"MAX2, post:3, topic:3845\"]\nI think you didn’t really understand the question. I just don’t know what this section is called between the lines of the text. It’s between\n[/quote]\n\nI did understand that question too, I just don't have an answer to it. Hopefully someone on the forum has an answer.",
      "reply_to_post_number": 3,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 1,
      "reads": 33,
      "score": 26.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11725,
      "post_number": 5,
      "username": "MAX2",
      "name": "MAX",
      "created_at": "2025-04-28T13:28:02.804Z",
      "updated_at": "2025-04-28T13:28:02.804Z",
      "cooked": "<p>In word it is “Line and Paragraph Spacing”</p>",
      "raw": "In word it is \"Line and Paragraph Spacing\"",
      "reply_to_post_number": 4,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 11.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1521
    },
    {
      "id": 11729,
      "post_number": 6,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-28T16:38:57.539Z",
      "updated_at": "2025-04-28T16:38:57.539Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"MAX2\" data-post=\"1\" data-topic=\"3845\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/m/B9312D/48.png\" class=\"avatar\"> MAX2:</div>\n<blockquote>\n<p>Also, I see that the distance between lines of text is somewhat larger than in latex, how to make them the same</p>\n</blockquote>\n</aside>\n<p><a href=\"https://typst.app/docs/reference/model/par/#parameters-leading\"><code>par.leading</code></a></p>",
      "raw": "[quote=\"MAX2, post:1, topic:3845\"]\nAlso, I see that the distance between lines of text is somewhat larger than in latex, how to make them the same\n[/quote]\n\n[`par.leading`](https://typst.app/docs/reference/model/par/#parameters-leading)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 0,
      "reads": 30,
      "score": 5.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11737,
      "post_number": 7,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-28T17:34:51.954Z",
      "updated_at": "2025-04-28T17:35:22.729Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"MAX2\" data-post=\"3\" data-topic=\"3845\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/m/B9312D/48.png\" class=\"avatar\"> MAX2:</div>\n<blockquote>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#set text(costs: (hyphenation: 1%))\n</code></pre>\n</blockquote>\n</aside>\n<p>Great, that’s a good point, I didn’t think about the costs at all. I’m not sure if it makes the text actually shorter, though.</p>\n<p>When I compare your initial two pictures, Latex typesets the text with 6 full lines and two more words, and Typst with 6 full lines and one more word. That means that Typst is actually using less space for the same text, right? With more eager hyphenation (lower cost) typst also uses 6 full lines + two words, same as Latex… but wasn’t that actually longer, less compact?</p>\n<p>Either way, when you have all the parameters, you can experiment with them for best results.</p>",
      "raw": "[quote=\"MAX2, post:3, topic:3845\"]\n```typst\n#set text(costs: (hyphenation: 1%))\n```\n[/quote]\nGreat, that's a good point, I didn't think about the costs at all. I'm not sure if it makes the text actually shorter, though.\n\nWhen I compare your initial two pictures, Latex typesets the text with 6 full lines and two more words, and Typst with 6 full lines and one more word. That means that Typst is actually using less space for the same text, right? With more eager hyphenation (lower cost) typst also uses 6 full lines + two words, same as Latex.. but wasn't that actually longer, less compact?\n\nEither way, when you have all the parameters, you can experiment with them for best results.",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 0,
      "reads": 30,
      "score": 5.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    }
  ],
  "scraped_at": "2025-06-10T09:48:34.096174"
}
{
  "topic_metadata": {
    "id": 3848,
    "title": "Is there a way to produce a larger vertical bar meaning \"evaluated at\"?",
    "slug": "is-there-a-way-to-produce-a-larger-vertical-bar-meaning-evaluated-at",
    "posts_count": 3,
    "created_at": "2025-04-28T11:26:35.058Z",
    "last_posted_at": "2025-04-28T17:14:37.107Z",
    "views": 125,
    "like_count": 1,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "bluss",
    "tags": [
      "math"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 153
  },
  "posts": [
    {
      "id": 11717,
      "post_number": 1,
      "username": "Nico1",
      "name": "",
      "created_at": "2025-04-28T11:26:35.239Z",
      "updated_at": "2025-04-28T12:11:59.797Z",
      "cooked": "<p>Like in latex <code>\\big|</code> that produces a larger bar</p>",
      "raw": "Like in latex `\\big|` that produces a larger bar",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 355.0,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1523
    },
    {
      "id": 11718,
      "post_number": 2,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-28T11:49:57.989Z",
      "updated_at": "2025-04-28T11:49:57.989Z",
      "cooked": "<p>You can use <code>math.lr</code> to size it according to an enclosed expression, but you can also bump up the size with an argument to <code>lr</code>, like in these examples:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let evaluated(expr, size: 100%) = $lr(#expr|, size: #size)$\n$ evaluated(f(x), size: #150%)_a^b $\n$ evaluated(f(x)/g(x))_(x=0)^oo $\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/2/2441991f9de3223677705babe08bc396aeaed688.png\" data-download-href=\"https://forum.typst.app/uploads/default/2441991f9de3223677705babe08bc396aeaed688\" title=\"bild\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/2/2441991f9de3223677705babe08bc396aeaed688_2_690x194.png\" alt=\"bild\" data-base62-sha1=\"5aJJoXCyWqdn3hLbm7tpqilF9Uc\" width=\"690\" height=\"194\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/2/2441991f9de3223677705babe08bc396aeaed688_2_690x194.png, https://forum.typst.app/uploads/default/optimized/2X/2/2441991f9de3223677705babe08bc396aeaed688_2_1035x291.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/2/2441991f9de3223677705babe08bc396aeaed688_2_1380x388.png 2x\" data-dominant-color=\"FDFDFD\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">bild</span><span class=\"informations\">1500×422 29.5 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>The package physica also has a function for this called evaluated that does something similar.</p>",
      "raw": "You can use `math.lr` to size it according to an enclosed expression, but you can also bump up the size with an argument to `lr`, like in these examples:\n\n```typst\n#let evaluated(expr, size: 100%) = $lr(#expr|, size: #size)$\n$ evaluated(f(x), size: #150%)_a^b $\n$ evaluated(f(x)/g(x))_(x=0)^oo $\n```\n\n![bild|690x194](upload://5aJJoXCyWqdn3hLbm7tpqilF9Uc.png)\n\n\nThe package physica also has a function for this called evaluated that does something similar.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 25,
      "score": 25.0,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11735,
      "post_number": 3,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-28T17:14:37.107Z",
      "updated_at": "2025-04-28T17:17:12.951Z",
      "cooked": "<p>I don’t see the point in abstraction. Not only the name is much longer, is not built-in, but it also removes the vertical bar, so it makes it harder to read.</p>\n<aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://typst.app/docs/reference/math/lr#functions-lr\">\n  <header class=\"source\">\n      <img src=\"https://forum.typst.app/uploads/default/original/1X/098187a593d51c4db99324614e2baeeb1bb355cc.png\" class=\"site-icon\" data-dominant-color=\"3CA8B6\" width=\"32\" height=\"32\">\n\n      <a href=\"https://typst.app/docs/reference/math/lr#functions-lr\" target=\"_blank\" rel=\"noopener\">Typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/361;\"><img src=\"https://forum.typst.app/uploads/default/optimized/1X/db1c18ed802fe6841bee62606931f352da10ed09_2_690x362.png\" class=\"thumbnail\" data-dominant-color=\"7CC2C5\" width=\"690\" height=\"362\"></div>\n\n<h3><a href=\"https://typst.app/docs/reference/math/lr#functions-lr\" target=\"_blank\" rel=\"noopener\">Left/Right Functions – Typst Documentation</a></h3>\n\n  <p>Documentation for the lr functions.</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<p>Alternatively, you can define a few variables that will represent the vertical bar of different sizes, and use that substitution name instead, like <code>vbar1</code>, <code>vbar2</code>, etc.</p>",
      "raw": "I don't see the point in abstraction. Not only the name is much longer, is not built-in, but it also removes the vertical bar, so it makes it harder to read.\n\nhttps://typst.app/docs/reference/math/lr#functions-lr\n\nAlternatively, you can define a few variables that will represent the vertical bar of different sizes, and use that substitution name instead, like `vbar1`, `vbar2`, etc.",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 24,
      "score": 9.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:48:33.385716"
}
{
  "topic_metadata": {
    "id": 3849,
    "title": "How to write a show rule that only affects the current section?",
    "slug": "how-to-write-a-show-rule-that-only-affects-the-current-section",
    "posts_count": 6,
    "created_at": "2025-04-28T13:02:18.875Z",
    "last_posted_at": "2025-04-29T15:39:56.204Z",
    "views": 141,
    "like_count": 5,
    "reply_count": 2,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 5,
    "accepted_answer_username": "bluss",
    "tags": [
      "styling"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 1646
  },
  "posts": [
    {
      "id": 11720,
      "post_number": 1,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-28T13:02:18.995Z",
      "updated_at": "2025-04-28T23:38:18.177Z",
      "cooked": "<p>Is there a way to write a show rule that only applies to the current section (as defined by headings), without having to enclose all such sections in <code>[]</code>?</p>\n<p>Something like the following:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">= A1\n// this is a special show rule that's only valid until `A2` (exclusive)\n#show: until-next-heading.with(x =&gt; text(red, x))\n\nThis text will be red.\n\n// This is a special show rule that's only valid until `B1` (exclusive)\n// because we are currently inside a heading level 1.\n#show: until-next-heading-same-level.with(underline)\n\nAnd this text will be red and underlined.\n\n== A2\nThis text will be black and underlined.\n\n== A3\nThis text will be black and underlined\n\n= B1\nThis text will be black.\n</code></pre>\n<p>I’m not sure if this is possible in current typst. Maybe using something that minces and reprocesses content (sequence/internal typst type inspection)? But hopefully we prefer solutions that use documented typst functionality instead, if possible.</p>",
      "raw": "Is there a way to write a show rule that only applies to the current section (as defined by headings), without having to enclose all such sections in `[]`?\n\nSomething like the following:\n\n```typst\n= A1\n// this is a special show rule that's only valid until `A2` (exclusive)\n#show: until-next-heading.with(x => text(red, x))\n\nThis text will be red.\n\n// This is a special show rule that's only valid until `B1` (exclusive)\n// because we are currently inside a heading level 1.\n#show: until-next-heading-same-level.with(underline)\n\nAnd this text will be red and underlined.\n\n== A2\nThis text will be black and underlined.\n\n== A3\nThis text will be black and underlined\n\n= B1\nThis text will be black.\n```\n\nI'm not sure if this is possible in current typst. Maybe using something that minces and reprocesses content (sequence/internal typst type inspection)? But hopefully we prefer solutions that use documented typst functionality instead, if possible.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 39,
      "score": 262.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11726,
      "post_number": 2,
      "username": "janekfleper",
      "name": "Janek Fleper",
      "created_at": "2025-04-28T14:49:51.345Z",
      "updated_at": "2025-04-28T14:58:51.691Z",
      "cooked": "<p>I found a solution that allows you to specify rules that contain a function, a filter function and a stop function. Extending this to have a specific start function/condition should also be possible. Currently the show rule starts wherever it is called. The first text line in your example is therefore red and underlined (for now).</p>\n<p>The idea is to use a general show rule (as you already did in your example) where you iterate over all children of the content sequence. The iteration for each rule is “stopped” when the corresponding function returns true. The filter allows you to exclude content from the rule, e.g. the headings in your case.</p>\n<p>This solution is also compatible with other show rules as long as you call them <em>before</em> the general show rule. E.g. the following show rule to change the font color in level 2 headings will work just fine:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show heading.where(level: 2): set text(blue)\n</code></pre>\n<p>Some comments on the code:</p>\n<ul>\n<li>If the (general) body does not have the “children” key, the rules are not applied. This happened when I applied other show rules <em>after</em> the general rule. I don’t know how many other cases there are.</li>\n<li>If you don’t want to apply a filter, just set the return value of the function to <code>true</code>. There is currently no check if a rule has the “filter” key.</li>\n<li>You can target specific headings in the stop function by checking more than the level. I used the actual content here as an example. This is not very elegant yet, checking the heading label here would probably be better. But I will leave this up to you. <img src=\"https://forum.typst.app/images/emoji/apple/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></li>\n</ul>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let apply-rule(children, rule) = {\n  let i = 0\n  for child in children {\n    if rule.at(\"stop\")(child) { break }\n    if rule.at(\"filter\")(child) { (rule.at(\"func\")(child),) } else { (child,) }\n    i += 1\n  }\n  children.slice(i,)\n}\n\n#let rules = (\n  (\n    func: text.with(red),\n    filter: child =&gt; child.func() != heading,\n    stop: child =&gt; child.func() == heading and child.depth == 2 and child.body == [A2],\n  ),\n  (\n    func: underline,\n    filter: child =&gt; child.func() != heading,\n    stop: child =&gt; child.func() == heading and child.depth == 1,\n  ),\n)\n\n#show: it =&gt; {\n  let children = if it.has(\"children\") { it.children } else { return it }\n  for rule in rules { children = apply-rule(children, rule) }\n  children.join([])\n}\n</code></pre>\n<details>\n<summary>\nYour example will then look like this</summary>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/7/7a13fe8fe0ed4f8c9e1bc4d2d646bbb5a7202f3b.jpeg\" data-download-href=\"https://forum.typst.app/uploads/default/7a13fe8fe0ed4f8c9e1bc4d2d646bbb5a7202f3b\" title=\"forum_3849_show-rules-per-section\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/7/7a13fe8fe0ed4f8c9e1bc4d2d646bbb5a7202f3b_2_529x499.jpeg\" alt=\"forum_3849_show-rules-per-section\" data-base62-sha1=\"hpX5wJWHlhqGRDZY0DRLyTuONNF\" width=\"529\" height=\"499\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/7/7a13fe8fe0ed4f8c9e1bc4d2d646bbb5a7202f3b_2_529x499.jpeg, https://forum.typst.app/uploads/default/optimized/2X/7/7a13fe8fe0ed4f8c9e1bc4d2d646bbb5a7202f3b_2_793x748.jpeg 1.5x, https://forum.typst.app/uploads/default/optimized/2X/7/7a13fe8fe0ed4f8c9e1bc4d2d646bbb5a7202f3b_2_1058x998.jpeg 2x\" data-dominant-color=\"F7F4F4\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">forum_3849_show-rules-per-section</span><span class=\"informations\">1682×1588 206 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n</details>",
      "raw": "I found a solution that allows you to specify rules that contain a function, a filter function and a stop function. Extending this to have a specific start function/condition should also be possible. Currently the show rule starts wherever it is called. The first text line in your example is therefore red and underlined (for now).\n\nThe idea is to use a general show rule (as you already did in your example) where you iterate over all children of the content sequence. The iteration for each rule is \"stopped\" when the corresponding function returns true. The filter allows you to exclude content from the rule, e.g. the headings in your case.\n\nThis solution is also compatible with other show rules as long as you call them _before_ the general show rule. E.g. the following show rule to change the font color in level 2 headings will work just fine:\n```typ\n#show heading.where(level: 2): set text(blue)\n```\n\nSome comments on the code:\n- If the (general) body does not have the \"children\" key, the rules are not applied. This happened when I applied other show rules _after_ the general rule. I don't know how many other cases there are.\n- If you don't want to apply a filter, just set the return value of the function to `true`. There is currently no check if a rule has the \"filter\" key.\n- You can target specific headings in the stop function by checking more than the level. I used the actual content here as an example. This is not very elegant yet, checking the heading label here would probably be better. But I will leave this up to you. :slight_smile: \n```typ\n#let apply-rule(children, rule) = {\n  let i = 0\n  for child in children {\n    if rule.at(\"stop\")(child) { break }\n    if rule.at(\"filter\")(child) { (rule.at(\"func\")(child),) } else { (child,) }\n    i += 1\n  }\n  children.slice(i,)\n}\n\n#let rules = (\n  (\n    func: text.with(red),\n    filter: child => child.func() != heading,\n    stop: child => child.func() == heading and child.depth == 2 and child.body == [A2],\n  ),\n  (\n    func: underline,\n    filter: child => child.func() != heading,\n    stop: child => child.func() == heading and child.depth == 1,\n  ),\n)\n\n#show: it => {\n  let children = if it.has(\"children\") { it.children } else { return it }\n  for rule in rules { children = apply-rule(children, rule) }\n  children.join([])\n}\n```\n\n[details=\"Your example will then look like this\"]\n![forum_3849_show-rules-per-section|529x499, 100%](upload://hpX5wJWHlhqGRDZY0DRLyTuONNF.jpeg)\n[/details]",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 37,
      "score": 32.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 69
    },
    {
      "id": 11736,
      "post_number": 3,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-28T17:31:15.183Z",
      "updated_at": "2025-04-28T17:31:15.183Z",
      "cooked": "<p>You can make use of breakpoint-metadata or toggle-state to insert breakpoints in the document. Then either use a global show rule to iterate over content and check for breakpoints, or query the elements in the specified region, if they are queryable. Or use an element show rule and check if it is within the region where a specific styling is needed to be applied. Or the most basic thing: use <code>apply</code> and <code>unapply</code> sets of styling: just restore the initial styling after a specific point. With rule revoking, this will become much easier.</p>\n<aside class=\"onebox githubissue\" data-onebox-src=\"https://github.com/typst/typst/issues/420\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/typst/typst/issues/420\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com/typst/typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"github-row\">\n  <div class=\"github-icon-container\" title=\"Issue\" data-github-private-repo=\"false\">\n\t  <svg width=\"60\" height=\"60\" class=\"github-icon\" viewBox=\"0 0 14 16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg>\n  </div>\n\n  <div class=\"github-info-container\">\n    <h4>\n      <a href=\"https://github.com/typst/typst/issues/420\" target=\"_blank\" rel=\"noopener nofollow ugc\">Resetting `show` and `set` to its default / Revoke rules</a>\n    </h4>\n\n    <div class=\"github-info\">\n      <div class=\"date\">\n        opened <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2023-03-29\" data-time=\"09:57:11\" data-timezone=\"UTC\">09:57AM - 29 Mar 23 UTC</span>\n      </div>\n\n\n      <div class=\"user\">\n        <a href=\"https://github.com/FedericoStra\" target=\"_blank\" rel=\"noopener nofollow ugc\">\n          <img alt=\"FedericoStra\" src=\"https://forum.typst.app/uploads/default/original/2X/a/a090875a5024a5a2c9f71f1e0226f5a5d6d77a2b.jpeg\" class=\"onebox-avatar-inline\" width=\"20\" height=\"20\" data-dominant-color=\"D1D1D1\">\n          FedericoStra\n        </a>\n      </div>\n    </div>\n\n    <div class=\"labels\">\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          feature request\n        </span>\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          styling\n        </span>\n    </div>\n  </div>\n</div>\n\n  <div class=\"github-row\">\n    <p class=\"github-body-container\">I think we need a way to reset [`show` rules](https://typst.app/docs/reference/s<span class=\"show-more-container\"><a href=\"\" rel=\"noopener\" class=\"show-more\">…</a></span><span class=\"excerpt hidden\">tyling/#show-rules) to their default.\n\n```typst\n// introduce a custom style for all text objects\n#show text: box.with(stroke: .4pt + red, outset: (bottom: .3em, rest: .1em), radius: .1em)\n\nSome simple text.\nSome other text wrapped in a tight red box.\n\n// how do we turn it off?!\n#show text: it =&gt; it\n\nUgh!\n```\n\nSimilarly, after a [`set` rule](https://typst.app/docs/reference/styling/#set-rules) there is no simple way of \"unsetting\" it (reverting to the default), apart from explicitly writing the default or wrapping everything in a scope.</span></p>\n  </div>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
      "raw": "You can make use of breakpoint-metadata or toggle-state to insert breakpoints in the document. Then either use a global show rule to iterate over content and check for breakpoints, or query the elements in the specified region, if they are queryable. Or use an element show rule and check if it is within the region where a specific styling is needed to be applied. Or the most basic thing: use `apply` and `unapply` sets of styling: just restore the initial styling after a specific point. With rule revoking, this will become much easier.\n\nhttps://github.com/typst/typst/issues/420",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 33,
      "score": 26.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11740,
      "post_number": 4,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-28T17:38:57.175Z",
      "updated_at": "2025-04-28T17:38:57.175Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"janekfleper\" data-post=\"2\" data-topic=\"3849\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/j/8F38B1/48.png\" class=\"avatar\"> janekfleper:</div>\n<blockquote>\n<p>I found a solution that allows you to specify rules that contain a function</p>\n</blockquote>\n</aside>\n<p>I think that’s very nicely expressed in code. If this was used I’d like to do this but recursively, so that it interacts well with all other styling rules. Not easy, but I guess it can be done. Like you say it has a problem with show rules and other transformations that come after it.</p>\n<aside class=\"quote no-group\" data-username=\"Andrew\" data-post=\"3\" data-topic=\"3849\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/andrew/48/62_2.png\" class=\"avatar\"> Andrew:</div>\n<blockquote>\n<p>You can make use of breakpoint-metadata or toggle-state to insert breakpoints in the document.</p>\n</blockquote>\n</aside>\n<p>Thanks for the ideas - I’ll experiment and see if I understand and can realize that. I think I see what you mean with using state.</p>",
      "raw": "[quote=\"janekfleper, post:2, topic:3849\"]\nI found a solution that allows you to specify rules that contain a function\n[/quote]\n\nI think that's very nicely expressed in code. If this was used I'd like to do this but recursively, so that it interacts well with all other styling rules. Not easy, but I guess it can be done. Like you say it has a problem with show rules and other transformations that come after it.\n\n[quote=\"Andrew, post:3, topic:3849\"]\nYou can make use of breakpoint-metadata or toggle-state to insert breakpoints in the document.\n[/quote]\n\nThanks for the ideas - I'll experiment and see if I understand and can realize that. I think I see what you mean with using state.",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 2,
      "like_count": 0,
      "reads": 31,
      "score": 11.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11744,
      "post_number": 5,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-28T17:53:37.754Z",
      "updated_at": "2025-04-29T11:42:08.308Z",
      "cooked": "<p>Here’s an initial version of the state tracking and local show rules that Andrew alluded to - if I understand correctly.</p>\n<p>Idea - a state variable keeps track of the current heading.</p>\n<p>A show rule is split into pieces by being applied element by element (for example, to each <code>text</code> or each <code>par</code> or <code>list</code>.) This way we can track state updates that happen between these elements.</p>\n<details>\n<summary>Code and Output</summary>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/b/b572d9d642bec223c38f4c4b87cef5e361fda83d.png\" alt=\"bild\" data-base62-sha1=\"pTaukc4EVTcIHHSnWG1VLAPn2cl\" width=\"375\" height=\"396\"></p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let heading-tracker = state(\"heading-tracker\", none)\n\n#show heading: it =&gt; {\n  heading-tracker.update(it)\n  it\n}\n\n/// Apply show rule `rule` to the `body` inside current section\n/// The rule is applied to the given `element` similar to `show &lt;element&gt;: rule`\n#let show-this-section(rule, body, element: text, subsections: false) = context {\n  let start-heading = heading-tracker.get()\n  show element: it =&gt; context {\n    let local-heading = heading-tracker.get()\n    let allow-rule = if subsections {\n      // any higher level than start is the new ancestor\n      let levels = range(1, start-heading.level + 1)\n      let ancestor-selector = selector.or(..levels.map(l =&gt; heading.where(level: l)))\n      let ancestor-heading = query(ancestor-selector\n        .after(start-heading.location())\n        .before(local-heading.location())\n        ).last()\n      ancestor-heading == start-heading\n    } else {\n      start-heading == local-heading\n    }\n    if allow-rule {\n      rule(it)\n    } else {\n      it\n    }\n  }\n  body\n}\n\n= A1\n\n#show: show-this-section.with(text.with(red))\n\nThis text will be red.\n\n#show: show-this-section.with(underline, element: par, subsections: true)\n\nAnd this text will be red and underlined.\n\n== A2\nThis text will be black and underlined.\n\n== A3\n\n#show: show-this-section.with(text.with(blue), element: par, subsections: true)\nThis text will be blue and underlined\n\n= B1\nThis text will be black.\n\n== B2\n\nStill black\n</code></pre>\n<ul>\n<li>Version 1: just using heading name and level in state</li>\n<li>Version 2: use heading element in state and query for ancestor heading</li>\n<li>Version 3: Removed extra nesting of show rule that was not necessary</li>\n<li>Version 4: Fix bug with subsections not reset correctly</li>\n</ul>\n</details>\n<p>This is not everything I’d like to do per section, but it answers the initial question perfectly and so I can’t ask for more in this particular topic. Thanks for the help!</p>",
      "raw": "Here's an initial version of the state tracking and local show rules that Andrew alluded to - if I understand correctly.\n\nIdea - a state variable keeps track of the current heading.\n\nA show rule is split into pieces by being applied element by element (for example, to each `text` or each `par` or `list`.) This way we can track state updates that happen between these elements.\n\n<details>\n<summary>Code and Output</summary>\n\n![bild|375x396](upload://pTaukc4EVTcIHHSnWG1VLAPn2cl.png)\n\n\n```typst\n#let heading-tracker = state(\"heading-tracker\", none)\n\n#show heading: it => {\n  heading-tracker.update(it)\n  it\n}\n\n/// Apply show rule `rule` to the `body` inside current section\n/// The rule is applied to the given `element` similar to `show <element>: rule`\n#let show-this-section(rule, body, element: text, subsections: false) = context {\n  let start-heading = heading-tracker.get()\n  show element: it => context {\n    let local-heading = heading-tracker.get()\n    let allow-rule = if subsections {\n      // any higher level than start is the new ancestor\n      let levels = range(1, start-heading.level + 1)\n      let ancestor-selector = selector.or(..levels.map(l => heading.where(level: l)))\n      let ancestor-heading = query(ancestor-selector\n        .after(start-heading.location())\n        .before(local-heading.location())\n        ).last()\n      ancestor-heading == start-heading\n    } else {\n      start-heading == local-heading\n    }\n    if allow-rule {\n      rule(it)\n    } else {\n      it\n    }\n  }\n  body\n}\n\n= A1\n\n#show: show-this-section.with(text.with(red))\n\nThis text will be red.\n\n#show: show-this-section.with(underline, element: par, subsections: true)\n\nAnd this text will be red and underlined.\n\n== A2\nThis text will be black and underlined.\n\n== A3\n\n#show: show-this-section.with(text.with(blue), element: par, subsections: true)\nThis text will be blue and underlined\n\n= B1\nThis text will be black.\n\n== B2\n\nStill black\n```\n\n- Version 1: just using heading name and level in state\n- Version 2: use heading element in state and query for ancestor heading\n- Version 3: Removed extra nesting of show rule that was not necessary\n- Version 4: Fix bug with subsections not reset correctly\n\n</details>\n\nThis is not everything I'd like to do per section, but it answers the initial question perfectly and so I can't ask for more in this particular topic. Thanks for the help!",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 27,
      "score": 40.4,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11792,
      "post_number": 6,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-29T15:39:56.204Z",
      "updated_at": "2025-04-29T15:39:56.204Z",
      "cooked": "<p>I was thinking about same-element (heading), but I guess you can do this with any:</p>\n<details><summary>toggle-state solution + output</summary>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let toggle = state(\"toggle\", false)\n\n#show text: it =&gt; context {\n  if not toggle.get() { return it }\n  let style = query(selector(&lt;style&gt;).before(here()))\n  if style.len() == 0 { return it }\n  let (wrapper, style) = style.last().value\n  set text(..style)\n  if wrapper == none { it } else { wrapper(it) }\n}\n\n#let unset-text-style() = toggle.update(false)\n#let set-text-style(wrapper: none, ..style) = [\n  #metadata((wrapper: wrapper, style: style))&lt;style&gt;\n  #toggle.update(true)\n]\n\n#set-text-style(fill: red)\n\n= A1\n\nThis text will be red.\n\n#set-text-style(red, wrapper: underline)\n\nAnd this text will be red and underlined.\n\n#set-text-style(wrapper: underline)\n\n== A2\nThis text will be black and underlined.\n\n== A3\n\n#set-text-style(blue, wrapper: underline)\n\nThis text will be blue and underlined\n\n#unset-text-style()\n\n= B1\nThis text will be black.\n\n== B2\n\nStill black\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/f/ff39eacd8ba329ee75c37f4ac6c36e1532d04a33.png\" alt=\"image\" data-base62-sha1=\"ApPQcBZbp8yIXNOrZeQsOSJn0un\" width=\"318\" height=\"396\"></p>\n</details>\n<p>For the OP, since you can deduce the implicit breakpoint, you don’t need to manually unset styling.</p>\n<details><summary>OP solution + output</summary>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let text-toggle-h = state(\"text-toggle-h\", false)\n#let text-toggle-slh = state(\"text-toggle-slh\", false)\n\n#show heading: it =&gt; text-toggle-h.update(false) + it\n#show heading: it =&gt; context {\n  if not text-toggle-slh.get() { return it }\n\n  let style = query(selector(&lt;style-slh&gt;).before(here()))\n  if style.len() == 0 { return it }\n\n  let headings = query(selector(heading).before(style.last().location()))\n  if headings.len() == 0 { return it }\n\n  let level = headings.last().level\n  if it.level == level { text-toggle-slh.update(false) }\n  it\n}\n\n#show text: it =&gt; context {\n  if not text-toggle-h.get() and not text-toggle-slh.get() { return it }\n\n  show: it =&gt; {\n    if not text-toggle-h.get() { return it }\n    let style = query(selector(&lt;style-h&gt;).before(here()))\n    if style.len() == 0 { return it }\n    let (wrapper, style) = style.last().value\n    set text(..style)\n    if wrapper == none { it } else { wrapper(it) }\n  }\n\n  show: it =&gt; {\n    if not text-toggle-slh.get() { return it }\n    let style = query(selector(&lt;style-slh&gt;).before(here()))\n    if style.len() == 0 { return it }\n    let (wrapper, style) = style.last().value\n    set text(..style)\n    if wrapper == none { it } else { wrapper(it) }\n  }\n\n  it\n}\n\n#let unset-text-style() = toggle.update(false)\n#let set-text-style-until-next-heading(wrapper: none, ..style) = [\n  #metadata((wrapper: wrapper, style: style))&lt;style-h&gt;\n  #text-toggle-h.update(true)\n]\n#let set-text-style-until-next-same-level-heading(wrapper: none, ..style) = [\n  #metadata((wrapper: wrapper, style: style))&lt;style-slh&gt;\n  #text-toggle-slh.update(true)\n]\n\n= A1\n#set-text-style-until-next-heading(red)\n\nThis text will be red.\n\n#set-text-style-until-next-same-level-heading(wrapper: underline)\n\nAnd this text will be red and underlined.\n\n== A2\nThis text will be black and underlined.\n\n== A3\n\nThis text will be black and underlined\n\n= B1\nThis text will be black.\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/e/e78fe81c910df06cb192cbb1abe07e49e78bb9f7.png\" alt=\"image\" data-base62-sha1=\"x2uC5t9T62AjGN4m5qmKah1s0L5\" width=\"321\" height=\"305\"></p>\n</details>\n<p>Of course, naming and stuff can be refactored. You probably can generalize this too by providing <code>element</code> argument, instead of having per-element functions.</p>",
      "raw": "I was thinking about same-element (heading), but I guess you can do this with any:\n\n<details><summary>toggle-state solution + output</summary>\n\n```typ\n#let toggle = state(\"toggle\", false)\n\n#show text: it => context {\n  if not toggle.get() { return it }\n  let style = query(selector(<style>).before(here()))\n  if style.len() == 0 { return it }\n  let (wrapper, style) = style.last().value\n  set text(..style)\n  if wrapper == none { it } else { wrapper(it) }\n}\n\n#let unset-text-style() = toggle.update(false)\n#let set-text-style(wrapper: none, ..style) = [\n  #metadata((wrapper: wrapper, style: style))<style>\n  #toggle.update(true)\n]\n\n#set-text-style(fill: red)\n\n= A1\n\nThis text will be red.\n\n#set-text-style(red, wrapper: underline)\n\nAnd this text will be red and underlined.\n\n#set-text-style(wrapper: underline)\n\n== A2\nThis text will be black and underlined.\n\n== A3\n\n#set-text-style(blue, wrapper: underline)\n\nThis text will be blue and underlined\n\n#unset-text-style()\n\n= B1\nThis text will be black.\n\n== B2\n\nStill black\n```\n\n![image|318x396](upload://ApPQcBZbp8yIXNOrZeQsOSJn0un.png)\n\n</details>\n\nFor the OP, since you can deduce the implicit breakpoint, you don't need to manually unset styling.\n\n<details><summary>OP solution + output</summary>\n\n```typ\n#let text-toggle-h = state(\"text-toggle-h\", false)\n#let text-toggle-slh = state(\"text-toggle-slh\", false)\n\n#show heading: it => text-toggle-h.update(false) + it\n#show heading: it => context {\n  if not text-toggle-slh.get() { return it }\n\n  let style = query(selector(<style-slh>).before(here()))\n  if style.len() == 0 { return it }\n\n  let headings = query(selector(heading).before(style.last().location()))\n  if headings.len() == 0 { return it }\n\n  let level = headings.last().level\n  if it.level == level { text-toggle-slh.update(false) }\n  it\n}\n\n#show text: it => context {\n  if not text-toggle-h.get() and not text-toggle-slh.get() { return it }\n\n  show: it => {\n    if not text-toggle-h.get() { return it }\n    let style = query(selector(<style-h>).before(here()))\n    if style.len() == 0 { return it }\n    let (wrapper, style) = style.last().value\n    set text(..style)\n    if wrapper == none { it } else { wrapper(it) }\n  }\n\n  show: it => {\n    if not text-toggle-slh.get() { return it }\n    let style = query(selector(<style-slh>).before(here()))\n    if style.len() == 0 { return it }\n    let (wrapper, style) = style.last().value\n    set text(..style)\n    if wrapper == none { it } else { wrapper(it) }\n  }\n\n  it\n}\n\n#let unset-text-style() = toggle.update(false)\n#let set-text-style-until-next-heading(wrapper: none, ..style) = [\n  #metadata((wrapper: wrapper, style: style))<style-h>\n  #text-toggle-h.update(true)\n]\n#let set-text-style-until-next-same-level-heading(wrapper: none, ..style) = [\n  #metadata((wrapper: wrapper, style: style))<style-slh>\n  #text-toggle-slh.update(true)\n]\n\n= A1\n#set-text-style-until-next-heading(red)\n\nThis text will be red.\n\n#set-text-style-until-next-same-level-heading(wrapper: underline)\n\nAnd this text will be red and underlined.\n\n== A2\nThis text will be black and underlined.\n\n== A3\n\nThis text will be black and underlined\n\n= B1\nThis text will be black.\n```\n\n![image|321x305](upload://x2uC5t9T62AjGN4m5qmKah1s0L5.png)\n\n</details>\n\nOf course, naming and stuff can be refactored. You probably can generalize this too by providing `element` argument, instead of having per-element functions.",
      "reply_to_post_number": 5,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 23,
      "score": 19.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:48:32.678053"
}
{
  "topic_metadata": {
    "id": 3854,
    "title": "Why am I getting unknown font family error for multiple packages?",
    "slug": "why-am-i-getting-unknown-font-family-error-for-multiple-packages",
    "posts_count": 4,
    "created_at": "2025-04-28T17:10:19.352Z",
    "last_posted_at": "2025-04-28T17:58:55.985Z",
    "views": 200,
    "like_count": 2,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 3,
    "accepted_answer_username": "SillyFreak",
    "tags": [
      "packages",
      "fonts"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 215
  },
  "posts": [
    {
      "id": 11734,
      "post_number": 1,
      "username": "theabhirath",
      "name": "Abhirath Anand",
      "created_at": "2025-04-28T17:10:19.941Z",
      "updated_at": "2025-04-28T17:45:15.237Z",
      "cooked": "<p>Hi, I’m new to Typst, and I’ve been trying to use the <code>modern-cv</code> template for my own CV. However, when I set up the template, I am getting certain package warnings in the Typst editor which seem to be font family related – this means that the icons for font awesome for GitHub and LinkedIn for example are not rendering correctly and I’m not sure how exactly I can resolve them. Any help in this matter would be greatly appreciated!</p>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/0/0d7f2769c04de643cd72198ffe86561793b5b750.png\" alt=\"CleanShot 2025-04-28 at 13.00.50\" data-base62-sha1=\"1VoDg4pOt4fmHUeO5nXpuDfXMKQ\" width=\"238\" height=\"371\"></p>",
      "raw": "Hi, I'm new to Typst, and I've been trying to use the `modern-cv` template for my own CV. However, when I set up the template, I am getting certain package warnings in the Typst editor which seem to be font family related – this means that the icons for font awesome for GitHub and LinkedIn for example are not rendering correctly and I'm not sure how exactly I can resolve them. Any help in this matter would be greatly appreciated!\n\n![CleanShot 2025-04-28 at 13.00.50|238x371](upload://1VoDg4pOt4fmHUeO5nXpuDfXMKQ.png)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 27,
      "score": 915.4,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1524
    },
    {
      "id": 11738,
      "post_number": 2,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-28T17:36:57.953Z",
      "updated_at": "2025-04-28T17:36:57.953Z",
      "cooked": "<p>Hi. The warning about missing fonts can be fixed by adding missing font files into the project. Other package-related warnings are usually due to something being outdated, so the only fix is to use a custom patched version of the package or ask the package author to fix them and make a new version.</p>",
      "raw": "Hi. The warning about missing fonts can be fixed by adding missing font files into the project. Other package-related warnings are usually due to something being outdated, so the only fix is to use a custom patched version of the package or ask the package author to fix them and make a new version.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 27,
      "score": 55.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11743,
      "post_number": 3,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2025-04-28T17:47:46.714Z",
      "updated_at": "2025-04-28T17:47:46.714Z",
      "cooked": "<p>See the readme: <a href=\"https://typst.app/universe/package/modern-cv\" class=\"inline-onebox\">modern-cv – Typst Universe</a></p>\n<blockquote>\n<h3>Fonts</h3>\n<p>[…]</p>\n<p>To use the fontawesome icons in the web app, add a <code>fonts</code> folder to your project and upload the <code>otf</code> files from the fontawesome download to this folder like so:</p>\n</blockquote>\n<p><a href=\"https://typst.app/universe/package/fontawesome\" class=\"inline-onebox\">fontawesome – Typst Universe</a> has more info on this too.</p>",
      "raw": "See the readme: https://typst.app/universe/package/modern-cv\n\n> ### Fonts\n> \n> [...]\n> \n> To use the fontawesome icons in the web app, add a `fonts` folder to your project and upload the `otf` files from the fontawesome download to this folder like so:\n\nhttps://typst.app/universe/package/fontawesome has more info on this too.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 27,
      "score": 35.4,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 11745,
      "post_number": 4,
      "username": "theabhirath",
      "name": "Abhirath Anand",
      "created_at": "2025-04-28T17:58:55.985Z",
      "updated_at": "2025-04-28T17:58:55.985Z",
      "cooked": "<p>Thank you so much, this is incredibly helpful, I completely missed this!</p>",
      "raw": "Thank you so much, this is incredibly helpful, I completely missed this!",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 5.0,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1524
    }
  ],
  "scraped_at": "2025-06-10T09:48:31.856184"
}
{
  "topic_metadata": {
    "id": 3859,
    "title": "Is it possible to have a function in set rule that are inside a show rule?",
    "slug": "is-it-possible-to-have-a-function-in-set-rule-that-are-inside-a-show-rule",
    "posts_count": 17,
    "created_at": "2025-04-28T22:47:28.229Z",
    "last_posted_at": "2025-04-29T19:13:17.248Z",
    "views": 136,
    "like_count": 1,
    "reply_count": 11,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 7,
    "accepted_answer_username": "Andrew",
    "tags": [
      "scripting",
      "tables"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 1131
  },
  "posts": [
    {
      "id": 11758,
      "post_number": 1,
      "username": "shela",
      "name": "shela",
      "created_at": "2025-04-28T22:47:28.389Z",
      "updated_at": "2025-04-29T09:36:10.015Z",
      "cooked": "<p>I try to automatically add a horizontal line after the table header if a header is present, so I write the following code:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show table: it =&gt; {\n\tlet contains-header = it.fields().children.first().func() == table.header\n\tset table(\n\t\tstroke: (x, y) =&gt; (\n\t\t\ttop: if y == 0 or (contains-header and y == 1) { 1pt + red } else { none }\n\t\t)\n\t)\n\tit\n}\n</code></pre>\n<p>This doesn’t have any effect. It’s weird because a lot of other similar rules work:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// OK\n#show table: set table(stroke: 1pt + red)\n\n// OK\n#show table: set table(stroke: (x, y) =&gt; 1pt + red)\n\n// OK\n#show table: it =&gt; {\n\tset table(stroke: 1pt + red)\n\tit\n}\n\n// No effect\n#show table: it =&gt; {\n\tset table(stroke: (x, y) =&gt; 1pt + red)\n\tit\n}\n</code></pre>\n<p>Am I missing something?</p>",
      "raw": "I try to automatically add a horizontal line after the table header if a header is present, so I write the following code:\n\n```typ\n#show table: it => {\n\tlet contains-header = it.fields().children.first().func() == table.header\n\tset table(\n\t\tstroke: (x, y) => (\n\t\t\ttop: if y == 0 or (contains-header and y == 1) { 1pt + red } else { none }\n\t\t)\n\t)\n\tit\n}\n```\n\nThis doesn't have any effect. It's weird because a lot of other similar rules work:\n\n```typ\n// OK\n#show table: set table(stroke: 1pt + red)\n\n// OK\n#show table: set table(stroke: (x, y) => 1pt + red)\n\n// OK\n#show table: it => {\n\tset table(stroke: 1pt + red)\n\tit\n}\n\n// No effect\n#show table: it => {\n\tset table(stroke: (x, y) => 1pt + red)\n\tit\n}\n```\n\nAm I missing something?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 326.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1527
    },
    {
      "id": 11766,
      "post_number": 2,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2025-04-29T07:11:18.822Z",
      "updated_at": "2025-04-29T07:11:18.822Z",
      "cooked": "<p>Hello! Can you show us the result of your table on dummy data? I cannot reproduce your issue. The last show rule has an effect on my side.</p>",
      "raw": "Hello! Can you show us the result of your table on dummy data? I cannot reproduce your issue. The last show rule has an effect on my side.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 30,
      "score": 10.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 258
    },
    {
      "id": 11767,
      "post_number": 3,
      "username": "shela",
      "name": "shela",
      "created_at": "2025-04-29T07:49:06.935Z",
      "updated_at": "2025-04-29T07:49:06.935Z",
      "cooked": "<p>Hello,<br>\nI created a minimal reproducible example in the web app, but I get the same result with Typst CLI version 0.13.1 (ed2106e2) as well:</p>\n<p><a href=\"https://typst.app/project/rGeZxbARvWHZ7USiNCY8Sq\" class=\"onebox\" target=\"_blank\" rel=\"noopener\">https://typst.app/project/rGeZxbARvWHZ7USiNCY8Sq</a></p>",
      "raw": "Hello,\nI created a minimal reproducible example in the web app, but I get the same result with Typst CLI version 0.13.1 (ed2106e2) as well:\n\nhttps://typst.app/project/rGeZxbARvWHZ7USiNCY8Sq",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 30,
      "score": 10.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1527
    },
    {
      "id": 11769,
      "post_number": 4,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2025-04-29T08:16:26.318Z",
      "updated_at": "2025-04-29T08:20:04.763Z",
      "cooked": "<p>Thank you! Taking a look at this, it looks like using a show-set rule for table does not update the style when the stroke parameter is given a function for some reason…<br>\nEDIT: specifically when the show rule is a function itself.<br>\nI think this should be considered a bug, see for creating one at <a href=\"https://github.com/typst/typst/issues\">issues · typst/typst</a></p>",
      "raw": "Thank you! Taking a look at this, it looks like using a show-set rule for table does not update the style when the stroke parameter is given a function for some reason.... \nEDIT: specifically when the show rule is a function itself.\nI think this should be considered a bug, see for creating one at [issues · typst/typst](https://github.com/typst/typst/issues)",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 27,
      "score": 10.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 258
    },
    {
      "id": 11771,
      "post_number": 5,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-29T08:52:52.130Z",
      "updated_at": "2025-04-29T08:52:52.130Z",
      "cooked": "<p>Another puzzling one is that <code>set table(stroke: none)</code> in the show rule does not have any effect, while <code>stroke: 0pt</code> has.</p>",
      "raw": "Another puzzling one is that `set table(stroke: none)` in the show rule does not have any effect, while `stroke: 0pt` has.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 28,
      "score": 15.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11772,
      "post_number": 6,
      "username": "shela",
      "name": "shela",
      "created_at": "2025-04-29T09:02:37.224Z",
      "updated_at": "2025-04-29T09:02:37.224Z",
      "cooked": "<p>Thank you!<br>\nI created an issue: <a href=\"https://github.com/typst/typst/issues/6218\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Set rule with function inside show-it is not applied · Issue #6218 · typst/typst · GitHub</a></p>",
      "raw": "Thank you!\nI created an issue: https://github.com/typst/typst/issues/6218",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 27,
      "score": 35.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1527
    },
    {
      "id": 11776,
      "post_number": 7,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-29T11:29:21.587Z",
      "updated_at": "2025-04-29T11:30:10.422Z",
      "cooked": "<p>This is exactly why (and not only this) show-set rule is preferred over show rules. They also have different semantics, so the actual issue here is why <code>#show table: it =&gt; { set table(stroke: red); it }</code> <em>does</em> work.</p>\n<p>Basically, show-set rule is a filter-apply rule, but show rule is a filter-override/wrap rule.</p>\n<p><code>#show heading: set heading(numbering: \"1.\")</code> will apply heading rule for all headings, but <code>#show heading: it =&gt; { set heading(numbering: \"1.\"); it }</code> will wrap all headings by adding <code>set heading(numbering: \"1.\")</code> to headings, but since you are already in a show rule (where heading is/can be constructed), it will not apply, because it’s too late for adding more styling for what you already have (<code>it</code>, which is immutable).</p>\n<p>This is why you sometimes have to fiddle around with wrapping stuff in a specific way or reconstructing elements with additional behavior, dodging infinite show rule recursion.</p>\n<p>So, in general, it is not possible to have an applied element set rule inside a show rule for the same element.</p>",
      "raw": "This is exactly why (and not only this) show-set rule is preferred over show rules. They also have different semantics, so the actual issue here is why `#show table: it => { set table(stroke: red); it }` *does* work.\n\nBasically, show-set rule is a filter-apply rule, but show rule is a filter-override/wrap rule.\n\n`#show heading: set heading(numbering: \"1.\")` will apply heading rule for all headings, but `#show heading: it => { set heading(numbering: \"1.\"); it }` will wrap all headings by adding `set heading(numbering: \"1.\")` to headings, but since you are already in a show rule (where heading is/can be constructed), it will not apply, because it's too late for adding more styling for what you already have (`it`, which is immutable).\n\nThis is why you sometimes have to fiddle around with wrapping stuff in a specific way or reconstructing elements with additional behavior, dodging infinite show rule recursion.\n\nSo, in general, it is not possible to have an applied element set rule inside a show rule for the same element.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 64.6,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11782,
      "post_number": 8,
      "username": "shela",
      "name": "shela",
      "created_at": "2025-04-29T13:39:56.560Z",
      "updated_at": "2025-04-29T13:39:56.560Z",
      "cooked": "<p>Hi Andrew, that makes sense.<br>\nMy initial attempt to style the headers was meant to be a workaround until issue <a href=\"https://github.com/typst/typst/issues/3640\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Unable to style `table.header` and `table.footer` · Issue #3640 · typst/typst · GitHub</a> is resolved. So the answer that using a set rule inside a show rule isn’t valid is sufficient. Nevertheless, is there any solution how to style table headers from template without using something like <code>my-table()</code>?</p>",
      "raw": "Hi Andrew, that makes sense. \nMy initial attempt to style the headers was meant to be a workaround until issue https://github.com/typst/typst/issues/3640 is resolved. So the answer that using a set rule inside a show rule isn't valid is sufficient. Nevertheless, is there any solution how to style table headers from template without using something like `my-table()`?",
      "reply_to_post_number": 7,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 19.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1527
    },
    {
      "id": 11784,
      "post_number": 9,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-29T13:58:27.717Z",
      "updated_at": "2025-04-29T13:58:27.717Z",
      "cooked": "<p>How exactly do you need to style the table header? Have you looked at all the solutions in that issue?</p>",
      "raw": "How exactly do you need to style the table header? Have you looked at all the solutions in that issue?",
      "reply_to_post_number": 8,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 24,
      "score": 9.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11795,
      "post_number": 10,
      "username": "shela",
      "name": "shela",
      "created_at": "2025-04-29T16:16:50.442Z",
      "updated_at": "2025-04-29T16:16:50.442Z",
      "cooked": "<p>I just need to apply fill, stroke, and strong to the header cells for all tables in the document that have a header. While it’s possible to achieve this with a custom function, it would require an additional import and adjustments to all existing tables, so I was looking for a solution to avoid this. Especially if it means that I have to revert all changes once issue <span class=\"hashtag-raw\">#6218</span> is resolved.</p>",
      "raw": "I just need to apply fill, stroke, and strong to the header cells for all tables in the document that have a header. While it's possible to achieve this with a custom function, it would require an additional import and adjustments to all existing tables, so I was looking for a solution to avoid this. Especially if it means that I have to revert all changes once issue #6218 is resolved.",
      "reply_to_post_number": 9,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 21,
      "score": 14.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1527
    },
    {
      "id": 11798,
      "post_number": 11,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-29T16:45:17.899Z",
      "updated_at": "2025-04-29T16:46:07.018Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"shela\" data-post=\"10\" data-topic=\"3859\" data-full=\"true\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/s/8C2300/48.png\" class=\"avatar\"> shela:</div>\n<blockquote>\n<p>I just need to apply fill, stroke, and strong to the header cells for all tables in the document that have a header.</p>\n</blockquote>\n</aside>\n<p>Are all headers horizontal and use 1 row of cells?</p>\n<p>By using <a href=\"https://github.com/typst/typst/issues/3640#issuecomment-2379109550\" rel=\"noopener nofollow ugc\">the already available solution for <code>strong</code></a>, you can stretch it to cell fill and stroke:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show table.cell.where(y: 0): strong\n#show table.cell.where(y: 0): set block(fill: red, stroke: 2pt)\n\n#table(columns: 2, table.header[a][b], ..range(10).map(str))\n\n#table(columns: 3, table.header[a][b][c], ..range(10).map(str))\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/1/1fd2e503126dbf78db2f0c3c25161a2fe852e2b5.png\" data-download-href=\"https://forum.typst.app/uploads/default/1fd2e503126dbf78db2f0c3c25161a2fe852e2b5\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/1/1fd2e503126dbf78db2f0c3c25161a2fe852e2b5_2_69x249.png\" alt=\"image\" data-base62-sha1=\"4xwDKw6QnNqVnDPCjpZTKKFqBpj\" width=\"69\" height=\"249\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/1/1fd2e503126dbf78db2f0c3c25161a2fe852e2b5_2_69x249.png, https://forum.typst.app/uploads/default/optimized/2X/1/1fd2e503126dbf78db2f0c3c25161a2fe852e2b5_2_103x373.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/1/1fd2e503126dbf78db2f0c3c25161a2fe852e2b5_2_138x498.png 2x\" data-dominant-color=\"342524\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">153×554 11.3 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<aside class=\"onebox githubissue\" data-onebox-src=\"https://github.com/typst/typst/issues/4159\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/typst/typst/issues/4159\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com/typst/typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"github-row\">\n  <div class=\"github-icon-container\" title=\"Issue\" data-github-private-repo=\"false\">\n\t  <svg width=\"60\" height=\"60\" class=\"github-icon\" viewBox=\"0 0 14 16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg>\n  </div>\n\n  <div class=\"github-info-container\">\n    <h4>\n      <a href=\"https://github.com/typst/typst/issues/4159\" target=\"_blank\" rel=\"noopener nofollow ugc\">Show-set rules don't seem to work for `table.cell`</a>\n    </h4>\n\n    <div class=\"github-info\">\n      <div class=\"date\">\n        opened <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2024-05-16\" data-time=\"20:16:49\" data-timezone=\"UTC\">08:16PM - 16 May 24 UTC</span>\n      </div>\n\n\n      <div class=\"user\">\n        <a href=\"https://github.com/MatejKafka\" target=\"_blank\" rel=\"noopener nofollow ugc\">\n          <img alt=\"MatejKafka\" src=\"https://forum.typst.app/uploads/default/original/2X/8/8d367773a0013df8cba1380722d2eba71d55879a.png\" class=\"onebox-avatar-inline\" width=\"20\" height=\"20\" data-dominant-color=\"B7BDE6\">\n          MatejKafka\n        </a>\n      </div>\n    </div>\n\n    <div class=\"labels\">\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          bug\n        </span>\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          styling\n        </span>\n    </div>\n  </div>\n</div>\n\n  <div class=\"github-row\">\n    <p class=\"github-body-container\">### Description\n\nThe following code results in the `strong` text being red (as<span class=\"show-more-container\"><a href=\"\" rel=\"noopener\" class=\"show-more\">…</a></span><span class=\"excerpt hidden\"> expected), but the table cell fill remains unset. I'm aware I could just use a `set` rule for this, but in the actual code I'm also using a selector, which currently does not work with `set` rules.\n\n```typst\n#{\n  show table.cell: set table.cell(fill: red)\n  table(\"1\", \"2\", \"3\")\n\n  show strong: set text(fill: red)\n  strong(\"test\")\n}\n```\n\n![image](https://github.com/typst/typst/assets/6414091/a01e89ba-9a4d-48e4-9873-d3b8b9893013)\n\n\n### Reproduction URL\n\n_No response_\n\n### Operating system\n\nWeb app\n\n### Typst version\n\n- [X] I am using the latest version of Typst</span></p>\n  </div>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<aside class=\"quote no-group\" data-username=\"shela\" data-post=\"10\" data-topic=\"3859\" data-full=\"true\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/s/8C2300/48.png\" class=\"avatar\"> shela:</div>\n<blockquote>\n<p>Especially if it means that I have to revert all changes once issue <span class=\"hashtag-raw\">#6218</span> is resolved.</p>\n</blockquote>\n</aside>\n<p>It already was closed.</p>\n<aside class=\"onebox githubissue\" data-onebox-src=\"https://github.com/typst/typst/issues/6218\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/typst/typst/issues/6218\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com/typst/typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"github-row\">\n  <div class=\"github-icon-container\" title=\"Issue\" data-github-private-repo=\"false\">\n\t  <svg width=\"60\" height=\"60\" class=\"github-icon\" viewBox=\"0 0 14 16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg>\n  </div>\n\n  <div class=\"github-info-container\">\n    <h4>\n      <a href=\"https://github.com/typst/typst/issues/6218\" target=\"_blank\" rel=\"noopener nofollow ugc\">Set rule with function inside show-it is not applied</a>\n    </h4>\n\n    <div class=\"github-info\">\n      <div class=\"date\">\n        opened <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2025-04-29\" data-time=\"08:58:50\" data-timezone=\"UTC\">08:58AM - 29 Apr 25 UTC</span>\n      </div>\n\n        <div class=\"date\">\n          closed <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2025-04-29\" data-time=\"12:30:38\" data-timezone=\"UTC\">12:30PM - 29 Apr 25 UTC</span>\n        </div>\n\n      <div class=\"user\">\n        <a href=\"https://github.com/shelacek\" target=\"_blank\" rel=\"noopener nofollow ugc\">\n          <img alt=\"shelacek\" src=\"https://forum.typst.app/uploads/default/original/2X/2/20975bd29dc5a016f4de423513b01eeb0f118816.png\" class=\"onebox-avatar-inline\" width=\"20\" height=\"20\" data-dominant-color=\"7DA9D4\">\n          shelacek\n        </a>\n      </div>\n    </div>\n\n    <div class=\"labels\">\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          bug\n        </span>\n    </div>\n  </div>\n</div>\n\n  <div class=\"github-row\">\n    <p class=\"github-body-container\">### Description\n\nI need to set the table stroke using a function within the `sho<span class=\"show-more-container\"><a href=\"\" rel=\"noopener\" class=\"show-more\">…</a></span><span class=\"excerpt hidden\">w` rule with an anonymous function, but it doesn't seem to be working. The `show-set` rules, which don't take the function, and the `set` rules with a static stroke are working fine:\n\n```typ\n// OK\n#show table: set table(stroke: 1pt + red)\n\n// OK\n#show table: set table(stroke: (x, y) =&gt; 1pt + red)\n\n// OK\n#show table: it =&gt; {\n  set table(stroke: 1pt + red)\n  it\n}\n\n// No effect\n#show table: it =&gt; {\n  set table(stroke: (x, y) =&gt; 1pt + red)\n  it\n}\n```\n\n### Reproduction URL\n\nhttps://typst.app/project/rGeZxbARvWHZ7USiNCY8Sq\n\n### Operating system\n\nLinux\n\n### Typst version\n\n- [x] I am using the latest version of Typst</span></p>\n  </div>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
      "raw": "[quote=\"shela, post:10, topic:3859, full:true\"]\nI just need to apply fill, stroke, and strong to the header cells for all tables in the document that have a header.\n[/quote]\n\nAre all headers horizontal and use 1 row of cells?\n\nBy using [the already available solution for `strong`](https://github.com/typst/typst/issues/3640#issuecomment-2379109550), you can stretch it to cell fill and stroke:\n\n```typ\n#show table.cell.where(y: 0): strong\n#show table.cell.where(y: 0): set block(fill: red, stroke: 2pt)\n\n#table(columns: 2, table.header[a][b], ..range(10).map(str))\n\n#table(columns: 3, table.header[a][b][c], ..range(10).map(str))\n```\n\n![image|138x499, 50%](upload://4xwDKw6QnNqVnDPCjpZTKKFqBpj.png)\n\nhttps://github.com/typst/typst/issues/4159\n\n[quote=\"shela, post:10, topic:3859, full:true\"]\nEspecially if it means that I have to revert all changes once issue #6218 is resolved.\n[/quote]\n\nIt already was closed.\n\nhttps://github.com/typst/typst/issues/6218",
      "reply_to_post_number": 10,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 0,
      "reads": 23,
      "score": 14.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11803,
      "post_number": 12,
      "username": "shela",
      "name": "shela",
      "created_at": "2025-04-29T17:42:05.243Z",
      "updated_at": "2025-04-29T17:53:47.634Z",
      "cooked": "<p>All headers are horizontal, but some tables have multiple header rows and some tables have no header at all. That’s why I wanted the <code>it</code> in the show rule. Never mind, I just use custom <code>my-table()</code>…</p>\n<p>Outch, I mean <a href=\"https://github.com/typst/typst/issues/3640\" rel=\"noopener nofollow ugc\">#3640</a>, not <a href=\"https://github.com/typst/typst/issues/6218\" rel=\"noopener nofollow ugc\">#6218</a>. Sorry!</p>",
      "raw": "All headers are horizontal, but some tables have multiple header rows and some tables have no header at all. That's why I wanted the `it` in the show rule. Never mind, I just use custom `my-table()`...\n\nOutch, I mean [#3640](https://github.com/typst/typst/issues/3640), not [#6218](https://github.com/typst/typst/issues/6218). Sorry!",
      "reply_to_post_number": 11,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 19,
      "score": 8.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1527
    },
    {
      "id": 11804,
      "post_number": 13,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-29T17:54:59.732Z",
      "updated_at": "2025-04-29T17:54:59.732Z",
      "cooked": "<p>Why do you need a custom table function if all you need is a styled header?</p>",
      "raw": "Why do you need a custom table function if all you need is a styled header?",
      "reply_to_post_number": 12,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 19,
      "score": 8.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11805,
      "post_number": 14,
      "username": "shela",
      "name": "shela",
      "created_at": "2025-04-29T18:00:41.461Z",
      "updated_at": "2025-04-29T18:00:41.461Z",
      "cooked": "<p>Because I cannot use <code>#show table.cell.where(y: 0): set ...</code> for headers with multiple rows or for tables that don’t have a header at all.</p>",
      "raw": "Because I cannot use `#show table.cell.where(y: 0): set ...` for headers with multiple rows or for tables that don't have a header at all.",
      "reply_to_post_number": 13,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 20,
      "score": 8.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1527
    },
    {
      "id": 11807,
      "post_number": 15,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-29T18:44:44.631Z",
      "updated_at": "2025-04-29T18:44:44.631Z",
      "cooked": "<p>The show rule is created with an assumption that it’s used for a specific table or that all tables have header as the first row.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let table-header(..cells) = table.header(\n  ..cells.pos().map(strong).map(table.cell.with(fill: red, stroke: 2pt)),\n)\n\n#table(columns: 2, table-header[a][b], ..range(10).map(str))\n\n#table(columns: 3, table-header[a][b][c], ..range(10).map(str))\n</code></pre>",
      "raw": "The show rule is created with an assumption that it's used for a specific table or that all tables have header as the first row.\n\n```typ\n#let table-header(..cells) = table.header(\n  ..cells.pos().map(strong).map(table.cell.with(fill: red, stroke: 2pt)),\n)\n\n#table(columns: 2, table-header[a][b], ..range(10).map(str))\n\n#table(columns: 3, table-header[a][b][c], ..range(10).map(str))\n```",
      "reply_to_post_number": 14,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 19,
      "score": 13.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11808,
      "post_number": 16,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-29T18:58:00.511Z",
      "updated_at": "2025-04-29T18:58:10.127Z",
      "cooked": "<p>Here is a hack solution</p>\n<ul>\n<li>We can create a new <code>table</code> in the show rule, from the old table\n<ul>\n<li>If we just do this, it recurses. So we mark the new table with a label so that it’s not done again</li>\n</ul>\n</li>\n<li>You can now apply custom styles to tables with headers. But it overwrites any even manually specified styles unfortunately</li>\n</ul>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">\n#show table: it =&gt; {\n  let contains-header = it.fields().children.first().func() == table.header\n  if not contains-header or (it.has(\"label\") and it.label == &lt;table-style-done&gt;) {\n    it\n  } else {\n    let new-style = (stroke: (x, y) =&gt; (\n\t\t\ttop: if y == 0 or y == 1 { 1pt + red } else { none })\n    )\n    let fields = it.fields()\n    let chld = fields.remove(\"children\")\n    // note, this overwrites any previous stroke configuration\n    [#table(..fields, ..new-style, ..chld)&lt;table-style-done&gt;]\n  }\n}\n\n#table(columns: 2, table.header[a][b], ..range(10).map(str))\n#table(columns: 3, table.header[a][b][c], ..range(10).map(str))\n#table(columns: 3, ..range(10).map(str))\n</code></pre>\n<details>\n<summary>picture</summary>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/5/5f27a0868fed8bcfe7ef4fd57a6aedd5fd109725.png\" data-download-href=\"https://forum.typst.app/uploads/default/5f27a0868fed8bcfe7ef4fd57a6aedd5fd109725\" title=\"bild\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/5/5f27a0868fed8bcfe7ef4fd57a6aedd5fd109725_2_112x500.png\" alt=\"bild\" data-base62-sha1=\"dzMg8rTaRMIc3L8SJp7NsIQhEs5\" width=\"112\" height=\"500\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/5/5f27a0868fed8bcfe7ef4fd57a6aedd5fd109725_2_112x500.png, https://forum.typst.app/uploads/default/original/2X/5/5f27a0868fed8bcfe7ef4fd57a6aedd5fd109725.png 1.5x, https://forum.typst.app/uploads/default/original/2X/5/5f27a0868fed8bcfe7ef4fd57a6aedd5fd109725.png 2x\" data-dominant-color=\"F5F3F3\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">bild</span><span class=\"informations\">115×511 11.3 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n</details>",
      "raw": "Here is a hack solution\n\n- We can create a new `table` in the show rule, from the old table\n  - If we just do this, it recurses. So we mark the new table with a label so that it's not done again\n- You can now apply custom styles to tables with headers. But it overwrites any even manually specified styles unfortunately\n\n```typst\n\n#show table: it => {\n  let contains-header = it.fields().children.first().func() == table.header\n  if not contains-header or (it.has(\"label\") and it.label == <table-style-done>) {\n    it\n  } else {\n    let new-style = (stroke: (x, y) => (\n\t\t\ttop: if y == 0 or y == 1 { 1pt + red } else { none })\n    )\n    let fields = it.fields()\n    let chld = fields.remove(\"children\")\n    // note, this overwrites any previous stroke configuration\n    [#table(..fields, ..new-style, ..chld)<table-style-done>]\n  }\n}\n\n#table(columns: 2, table.header[a][b], ..range(10).map(str))\n#table(columns: 3, table.header[a][b][c], ..range(10).map(str))\n#table(columns: 3, ..range(10).map(str))\n```\n\n<details>\n<summary>picture</summary>\n\n![bild|112x500](upload://dzMg8rTaRMIc3L8SJp7NsIQhEs5.png)\n</details>",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 18,
      "score": 38.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11810,
      "post_number": 17,
      "username": "shela",
      "name": "shela",
      "created_at": "2025-04-29T19:13:17.248Z",
      "updated_at": "2025-04-29T19:13:17.248Z",
      "cooked": "<p>Thanks bluss,<br>\nthat’s a really nasty solution, but as workaround it’s exactly what I need.</p>",
      "raw": "Thanks bluss,\nthat's a really nasty solution, but as workaround it's exactly what I need.",
      "reply_to_post_number": 16,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 18,
      "score": 3.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1527
    }
  ],
  "scraped_at": "2025-06-10T09:48:31.126832"
}
{
  "topic_metadata": {
    "id": 3865,
    "title": "How to interpret Hayagriva data as content instead of strings?",
    "slug": "how-to-interpret-hayagriva-data-as-content-instead-of-strings",
    "posts_count": 7,
    "created_at": "2025-04-29T07:59:12.786Z",
    "last_posted_at": "2025-05-06T15:26:16.408Z",
    "views": 95,
    "like_count": 4,
    "reply_count": 3,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 3,
    "accepted_answer_username": "SillyFreak",
    "tags": [
      "hayagriva"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 681
  },
  "posts": [
    {
      "id": 11768,
      "post_number": 1,
      "username": "Mr.Selfridge",
      "name": "",
      "created_at": "2025-04-29T07:59:12.877Z",
      "updated_at": "2025-05-05T22:18:23.975Z",
      "cooked": "<p>Typst reads bibliography data - like the title - from a Hayagriva file. Is there any way I could make Typst interpret that data as content so that I could, for example, use smallcaps in the title read from the file?</p>\n<p>I’d like to be able to do something like this:</p>\n<pre><code class=\"lang-auto\">wold:\n  type: article\n  author:\n    - Doe, J.\n  title: The Title with #smallcaps[smallcaps]\n</code></pre>\n<p>Is this possible now or even remotely possible at some point?</p>",
      "raw": "Typst reads bibliography data - like the title - from a Hayagriva file. Is there any way I could make Typst interpret that data as content so that I could, for example, use smallcaps in the title read from the file?\n\nI'd like to be able to do something like this:\n\n```\nwold:\n  type: article\n  author:\n    - Doe, J.\n  title: The Title with #smallcaps[smallcaps]\n```\n\nIs this possible now or even remotely possible at some point?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 35,
      "score": 37.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 77
    },
    {
      "id": 11781,
      "post_number": 2,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-29T12:21:19.755Z",
      "updated_at": "2025-04-29T12:21:19.755Z",
      "cooked": "<p>For the code block, you should use <code>yml</code> or <code>yaml</code> code identifier to get appropriate syntax highlighting.</p>\n<hr>\n<p><a href=\"https://github.com/typst/hayagriva/blob/d6212750ffe4ffa310e03451701c0ff5aa982c9e/docs/file-format.md?plain=1#L433\" rel=\"noopener nofollow ugc\">You can use math mode inside some fields</a>:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let bib = ```yaml\nwold:\n  type: article\n  author:\n    - Doe, J.\n  title: The Title with $x^2$\n```.text\n\n#bibliography(bytes(bib), full: true)\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/5/5093f0af08fc646800a284ce8f5519ebf191aa1d.png\" alt=\"image\" data-base62-sha1=\"buP9NjsVxxt5cFgsqHDd5nPXkrb\" width=\"227\" height=\"54\"></p>\n<p>But there is no way to use code mode. You can try changing CSL file by applying same styling for specific part of entry, or create an issue about it.</p>\n<aside class=\"onebox githubissue\" data-onebox-src=\"https://github.com/typst/typst/issues/942\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/typst/typst/issues/942\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com/typst/typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"github-row\">\n  <div class=\"github-icon-container\" title=\"Issue\" data-github-private-repo=\"false\">\n\t  <svg width=\"60\" height=\"60\" class=\"github-icon\" viewBox=\"0 0 14 16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg>\n  </div>\n\n  <div class=\"github-info-container\">\n    <h4>\n      <a href=\"https://github.com/typst/typst/issues/942\" target=\"_blank\" rel=\"noopener nofollow ugc\">Bibliography customization from within Typst</a>\n    </h4>\n\n    <div class=\"github-info\">\n      <div class=\"date\">\n        opened <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2023-04-23\" data-time=\"09:36:35\" data-timezone=\"UTC\">09:36AM - 23 Apr 23 UTC</span>\n      </div>\n\n\n      <div class=\"user\">\n        <a href=\"https://github.com/YJDoc2\" target=\"_blank\" rel=\"noopener nofollow ugc\">\n          <img alt=\"YJDoc2\" src=\"https://forum.typst.app/uploads/default/original/2X/6/6e364f87ee869707dc02a6966cd84391f07d5935.png\" class=\"onebox-avatar-inline\" width=\"20\" height=\"20\" data-dominant-color=\"E9D4EC\">\n          YJDoc2\n        </a>\n      </div>\n    </div>\n\n    <div class=\"labels\">\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          feature request\n        </span>\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          bibliography\n        </span>\n    </div>\n  </div>\n</div>\n\n  <div class=\"github-row\">\n    <p class=\"github-body-container\">Current `#bibliography` function is great with three inbuilt styles, until some <span class=\"show-more-container\"><a href=\"\" rel=\"noopener\" class=\"show-more\">…</a></span><span class=\"excerpt hidden\">journal requires the bibliography to be set in their own specific style. Can we have some way to customize the format of bibliography, at least in what order various elements appear, and their style ; or a way to provide a callback function which will accept the reference number and reference data (from .bib file or other) and return `Content` .\n\nThank you!</span></p>\n  </div>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<aside class=\"onebox githubissue\" data-onebox-src=\"https://github.com/typst/typst/issues/1220\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/typst/typst/issues/1220\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com/typst/typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"github-row\">\n  <div class=\"github-icon-container\" title=\"Issue\" data-github-private-repo=\"false\">\n\t  <svg width=\"60\" height=\"60\" class=\"github-icon\" viewBox=\"0 0 14 16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg>\n  </div>\n\n  <div class=\"github-info-container\">\n    <h4>\n      <a href=\"https://github.com/typst/typst/issues/1220\" target=\"_blank\" rel=\"noopener nofollow ugc\">Add function/parameter to manipulate raw data from a bibliography entry</a>\n    </h4>\n\n    <div class=\"github-info\">\n      <div class=\"date\">\n        opened <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2023-05-16\" data-time=\"15:57:01\" data-timezone=\"UTC\">03:57PM - 16 May 23 UTC</span>\n      </div>\n\n\n      <div class=\"user\">\n        <a href=\"https://github.com/PgBiel\" target=\"_blank\" rel=\"noopener nofollow ugc\">\n          <img alt=\"PgBiel\" src=\"https://forum.typst.app/uploads/default/original/2X/4/459a78d8edc06648a0a2ca0ccd796760d981fe3e.jpeg\" class=\"onebox-avatar-inline\" width=\"20\" height=\"20\" data-dominant-color=\"93BA72\">\n          PgBiel\n        </a>\n      </div>\n    </div>\n\n    <div class=\"labels\">\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          feature request\n        </span>\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          scripting\n        </span>\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          bibliography\n        </span>\n    </div>\n  </div>\n</div>\n\n  <div class=\"github-row\">\n    <p class=\"github-body-container\">### Description\n\nSo, we have been discussing on Discord regarding bibliography<span class=\"show-more-container\"><a href=\"\" rel=\"noopener\" class=\"show-more\">…</a></span><span class=\"excerpt hidden\"> improvements (such as those mentioned in #1139), and we thought that a good first step to an overall improvement of the bibliography system would be to add a function or parameter callback that, given a bibliography entry's label, we'd obtain access to the raw data of that entry (as specified in `.bib` or `.yml`), in the form of a dict, and use that to display some content (e.g. just the 'authors' field).\n\nInitially, we thought it could be done with some separate function such as `#cite.entry(\"name\")` (we also thought about a method on `cite` objects, but that didn't sound appropriate). Then it could return a dict like (in JSON syntax) `{ \"authors\": [\"a\", \"b\"], \"year\": \"1923\", ... }`.\n\nHowever, it was shown by Laurenz to not be that simple, as bibliography data is loaded asynchronously (i.e. `#bibliography` can be anywhere in the document), so we can't expect to have `#cite` data available at any point (we'd require some callback business like `locate`).\n\nSo, instead, we thought of having custom styles with callbacks, like `#cite(style: (entry1, entry2, ...) =&gt; content, \"label1\", \"label2\", ...)`. That way, one can not only extract raw data for cites and convert it to content (in any way that is desirable), but also apply some global custom format for `cite`s if they want to (with `#set cite(style: ...)`).\n\n### Use Case\n\nSuch a feature would allow arbitrary manipulation of bibliography data (other than reading and parsing the bibliography files directly, which would be annoying), and would enable workarounds for most limitations in the current bibliography system right now (e.g. to cite just the author of a certain entry, instead of the full citation or just the `[number]`, or to make custom citation styles, which isn't currently possible).\n\nWorth saying that this approach wouldn't risk (at least directly) a breaking change in the future, as one can stay using dicts with styles forever if they want to (without issue), even once we add helper functions/syntax/etc. to extract authors and other stuff in a simpler and formatted manner.</span></p>\n  </div>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
      "raw": "For the code block, you should use `yml` or `yaml` code identifier to get appropriate syntax highlighting.\n\n---\n\n[You can use math mode inside some fields](https://github.com/typst/hayagriva/blob/d6212750ffe4ffa310e03451701c0ff5aa982c9e/docs/file-format.md?plain=1#L433):\n\n````typ\n#let bib = ```yaml\nwold:\n  type: article\n  author:\n    - Doe, J.\n  title: The Title with $x^2$\n```.text\n\n#bibliography(bytes(bib), full: true)\n````\n\n![image|227x54](upload://buP9NjsVxxt5cFgsqHDd5nPXkrb.png)\n\nBut there is no way to use code mode. You can try changing CSL file by applying same styling for specific part of entry, or create an issue about it.\n\nhttps://github.com/typst/typst/issues/942\n\nhttps://github.com/typst/typst/issues/1220",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 11.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11955,
      "post_number": 3,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2025-05-04T12:19:10.871Z",
      "updated_at": "2025-05-05T19:40:53.412Z",
      "cooked": "<p>Note that your example bibliography astually has a yaml comment instead of the text <code>#smallcaps[smallcaps]</code> in it. Your bibliography needs to at least read</p>\n<pre data-code-wrap=\"yaml\"><code class=\"lang-yaml\">wold:\n  type: article\n  author:\n    - Doe, J.\n  title: \"The Title with #smallcaps[smallcaps]\"\n</code></pre>\n<p>Now the question is: can we make Typst interpret any Typst markup in the title? The answer is: basically yes</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let bib = ```yaml\nwold:\n  type: article\n  author:\n    - Doe, J.\n  title: \"The Title with #smallcaps[smallcaps]\"\n```.text\n\n#show bibliography: it =&gt; {\n  show text: it =&gt; {\n    // we must not attempt to evaluate text that is not valid markup\n    // thankfully most text _is_, but unbalanced closing brackets don't work\n    if it.text == \"]\" { return it }\n\n    // evaluate any formatting\n    let result = eval(it.text, mode: \"markup\")\n    // if nothing was formatted, return the original content\n    // to avoid infinite recursion\n    if result.func() == text { return it }\n\n    // emit the formatted content\n    result\n  }\n  it\n}\n\n#bibliography(bytes(bib), full: true)\n</code></pre>\n<p>The show rule here uses <code>eval()</code> to format <em>any</em> text in the bibliography. <strong>This may result in false positives!</strong> It’s now necessary for you to ensure any bibliography content is valid Typst markup!</p>\n<p>Since formatted text is also text, the show rule here needs to guard against recursion. I’m doing this by checking whether the formatting result is anything other than a simple text.</p>\n<p>Hope this helps! <img src=\"https://forum.typst.app/images/emoji/apple/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Note that your example bibliography astually has a yaml comment instead of the text `#smallcaps[smallcaps]` in it. Your bibliography needs to at least read \n\n```yaml\nwold:\n  type: article\n  author:\n    - Doe, J.\n  title: \"The Title with #smallcaps[smallcaps]\"\n```\n\nNow the question is: can we make Typst interpret any Typst markup in the title? The answer is: basically yes\n\n```typ\n#let bib = ```yaml\nwold:\n  type: article\n  author:\n    - Doe, J.\n  title: \"The Title with #smallcaps[smallcaps]\"\n```.text\n\n#show bibliography: it => {\n  show text: it => {\n    // we must not attempt to evaluate text that is not valid markup\n    // thankfully most text _is_, but unbalanced closing brackets don't work\n    if it.text == \"]\" { return it }\n\n    // evaluate any formatting\n    let result = eval(it.text, mode: \"markup\")\n    // if nothing was formatted, return the original content\n    // to avoid infinite recursion\n    if result.func() == text { return it }\n\n    // emit the formatted content\n    result\n  }\n  it\n}\n\n#bibliography(bytes(bib), full: true)\n```\n\nThe show rule here uses `eval()` to format _any_ text in the bibliography. **This may result in false positives!** It's now necessary for you to ensure any bibliography content is valid Typst markup!\n\nSince formatted text is also text, the show rule here needs to guard against recursion. I'm doing this by checking whether the formatting result is anything other than a simple text.\n\nHope this helps! :slight_smile:",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 19,
      "score": 33.8,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 12007,
      "post_number": 4,
      "username": "PgBiel",
      "name": "",
      "created_at": "2025-05-05T22:24:11.086Z",
      "updated_at": "2025-05-05T22:24:11.086Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Andrew\" data-post=\"2\" data-topic=\"3865\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/andrew/48/62_2.png\" class=\"avatar\"> Andrew:</div>\n<blockquote>\n<p>But there is no way to use code mode.</p>\n</blockquote>\n</aside>\n<p>There is:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let bib = ```yaml\nwold:\n  type: article\n  author:\n    - Doe, J.\n  title: \"The Title with $#smallcaps(text(font: \\\"Libertinus Serif\\\")[SmallCaps])$\"\n```.text\n\n#bibliography(bytes(bib), full: true)\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/5/51fc26f650141935972a81aa3932c9745f68dcf0.png\" alt=\"&quot;The Title with SmallCaps&quot; with correct formatting\" data-base62-sha1=\"bHgUl1nehkz78kyXJBVXizdQ7sY\" width=\"450\" height=\"192\"></p>\n<p>It can probably be improved, but that’s a start.</p>",
      "raw": "[quote=\"Andrew, post:2, topic:3865\"]\nBut there is no way to use code mode.\n[/quote]\n\nThere is:\n\n```typ\n#let bib = ```yaml\nwold:\n  type: article\n  author:\n    - Doe, J.\n  title: \"The Title with $#smallcaps(text(font: \\\"Libertinus Serif\\\")[SmallCaps])$\"\n```.text\n\n#bibliography(bytes(bib), full: true)\n```\n![\"The Title with SmallCaps\" with correct formatting|450x192](upload://bHgUl1nehkz78kyXJBVXizdQ7sY.png)\n\nIt can probably be improved, but that's a start.",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 1,
      "reads": 17,
      "score": 53.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    },
    {
      "id": 12011,
      "post_number": 5,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-05T22:47:58.537Z",
      "updated_at": "2025-05-05T22:47:58.537Z",
      "cooked": "<p>Okay, that’s just cheating, you know what I meant. Besides, I’m not sure which stuff will behave differently when called from within math mode. Like the fact that you have to wrap text into function to get non-math font. At least that.</p>",
      "raw": "Okay, that's just cheating, you know what I meant. Besides, I'm not sure which stuff will behave differently when called from within math mode. Like the fact that you have to wrap text into function to get non-math font. At least that.",
      "reply_to_post_number": 4,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 17,
      "score": 8.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 12012,
      "post_number": 6,
      "username": "PgBiel",
      "name": "",
      "created_at": "2025-05-05T22:54:13.974Z",
      "updated_at": "2025-05-05T22:54:30.512Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Andrew\" data-post=\"5\" data-topic=\"3865\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/andrew/48/62_2.png\" class=\"avatar\"> Andrew:</div>\n<blockquote>\n<p>Okay, that’s just cheating, you know what I meant.</p>\n</blockquote>\n</aside>\n<p>It’s not “cheating”, your statement read as it being impossible to use anything from code mode in the current state, so I pointed out that it is actually possible. But I’m not claiming that you deliberately omitted this information, as you could simply not have known, which is OK. What matters is that what I provided is one possible solution - there are certainly others!</p>\n<aside class=\"quote no-group\" data-username=\"Andrew\" data-post=\"5\" data-topic=\"3865\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/andrew/48/62_2.png\" class=\"avatar\"> Andrew:</div>\n<blockquote>\n<p>Besides, I’m not sure which stuff will behave differently when called from within math mode. Like the fact that you have to wrap text into function to get non-math font.</p>\n</blockquote>\n</aside>\n<p>It’s not perfect, but it’s doing what they asked for, so <img src=\"https://forum.typst.app/images/emoji/apple/person_shrugging.png?v=12\" title=\":person_shrugging:\" class=\"emoji\" alt=\":person_shrugging:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "[quote=\"Andrew, post:5, topic:3865\"]\nOkay, that’s just cheating, you know what I meant.\n[/quote]\n\nIt's not \"cheating\", your statement read as it being impossible to use anything from code mode in the current state, so I pointed out that it is actually possible. But I'm not claiming that you deliberately omitted this information, as you could simply not have known, which is OK. What matters is that what I provided is one possible solution - there are certainly others!\n\n[quote=\"Andrew, post:5, topic:3865\"]\nBesides, I’m not sure which stuff will behave differently when called from within math mode. Like the fact that you have to wrap text into function to get non-math font.\n[/quote]\n\nIt's not perfect, but it's doing what they asked for, so :person_shrugging:",
      "reply_to_post_number": 5,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 1,
      "reads": 16,
      "score": 18.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    },
    {
      "id": 12053,
      "post_number": 7,
      "username": "Mr.Selfridge",
      "name": "",
      "created_at": "2025-05-06T15:26:16.408Z",
      "updated_at": "2025-05-06T15:26:16.408Z",
      "cooked": "<p>Great, thanks for all the solutions, these definitely help! It would be cool to natively process bibliography entries with Typst but as always, I guess it is not as trivial as I might think.</p>",
      "raw": "Great, thanks for all the solutions, these definitely help! It would be cool to natively process bibliography entries with Typst but as always, I guess it is not as trivial as I might think.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 16,
      "score": 8.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 77
    }
  ],
  "scraped_at": "2025-06-10T09:48:30.376094"
}
{
  "topic_metadata": {
    "id": 3880,
    "title": "How to start page number 1 in the chapter 1?",
    "slug": "how-to-start-page-number-1-in-the-chapter-1",
    "posts_count": 6,
    "created_at": "2025-04-30T00:14:51.295Z",
    "last_posted_at": "2025-05-04T13:09:55.208Z",
    "views": 101,
    "like_count": 7,
    "reply_count": 2,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 4,
    "accepted_answer_username": "Rafael_Bluhm",
    "tags": [
      "scripting",
      "numbering",
      "page"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 726
  },
  "posts": [
    {
      "id": 11815,
      "post_number": 1,
      "username": "Rafael_Bluhm",
      "name": "Rafael Bluhm",
      "created_at": "2025-04-30T00:14:51.404Z",
      "updated_at": "2025-05-04T12:31:20.615Z",
      "cooked": "<p>I would like to have page 1 start from chapter 1, but it seems impossible. I don’t know how to set it up given the formatting of the document I want. Everything is fine, except for that detail. Could someone explain it to me?</p>\n<p>main.typ:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set page(numbering: \"i\", number-align: center)\n#counter(page).update(1) \n\n// TOC\n#toc()\n#pagebreak()\n\n#set page(numbering: none)\n\n#document-template[\n  #include \"chapters/chapter1.typ\"\n  #include \"chapters/chapter2.typ\"\n]\n</code></pre>\n<p>and in template.typ:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let toc() = [\n  #show outline.entry: it =&gt; {\n    if it.level == 1 {\n      strong(it)\n    } else {\n      it\n    }\n  }\n  #set page(margin: 3.0cm)\n  #v(2cm)\n  #align(center)[\n    #text(size: 22pt, weight: \"bold\")[Contents]\n    #v(1cm)\n    #set text(size: 16pt)\n    #outline(\n      title: none,\n      indent: 1em,\n      depth: 3\n    )\n  ]\n]\n\n#let document-template(body) = { \n  \n  show heading: it =&gt; {\n    let font_book = 16pt\n    [\n      #if it.level == 1 {\n        pagebreak(to: \"even\", weak: false) \n        block(\n          text(size: 28pt, weight: \"bold\")[#counter(heading).display() #it.body]\n        )\n        v(0.8em)\n      } else if it.level == 2 {\n        block(\n          text(size: 20pt, weight: \"bold\")[#counter(heading).display() #it.body]\n        )\n        v(0.5em)\n      } else {\n        block(\n          text(size: font_book, weight: \"bold\")[#counter(heading).display() #it.body]\n        )\n        v(0.5em)\n      }\n    ]\n  }\n  show link: set text(fill: blue) \n  set text(font: \"Source Sans Pro\", size: 16pt, hyphenate: true)\n  set par(justify: true) \n  set figure.caption(position: bottom)\n  set page(numbering: \"1\", number-align: center)\n  counter(page).update(1)\n  // Return body\n  body\n}\n</code></pre>",
      "raw": "I would like to have page 1 start from chapter 1, but it seems impossible. I don't know how to set it up given the formatting of the document I want. Everything is fine, except for that detail. Could someone explain it to me?\n\nmain.typ:\n```typ\n#set page(numbering: \"i\", number-align: center)\n#counter(page).update(1) \n\n// TOC\n#toc()\n#pagebreak()\n\n#set page(numbering: none)\n\n#document-template[\n  #include \"chapters/chapter1.typ\"\n  #include \"chapters/chapter2.typ\"\n]\n```\n\n and in template.typ:\n\n```typ\n#let toc() = [\n  #show outline.entry: it => {\n    if it.level == 1 {\n      strong(it)\n    } else {\n      it\n    }\n  }\n  #set page(margin: 3.0cm)\n  #v(2cm)\n  #align(center)[\n    #text(size: 22pt, weight: \"bold\")[Contents]\n    #v(1cm)\n    #set text(size: 16pt)\n    #outline(\n      title: none,\n      indent: 1em,\n      depth: 3\n    )\n  ]\n]\n\n#let document-template(body) = { \n  \n  show heading: it => {\n    let font_book = 16pt\n    [\n      #if it.level == 1 {\n        pagebreak(to: \"even\", weak: false) \n        block(\n          text(size: 28pt, weight: \"bold\")[#counter(heading).display() #it.body]\n        )\n        v(0.8em)\n      } else if it.level == 2 {\n        block(\n          text(size: 20pt, weight: \"bold\")[#counter(heading).display() #it.body]\n        )\n        v(0.5em)\n      } else {\n        block(\n          text(size: font_book, weight: \"bold\")[#counter(heading).display() #it.body]\n        )\n        v(0.5em)\n      }\n    ]\n  }\n  show link: set text(fill: blue) \n  set text(font: \"Source Sans Pro\", size: 16pt, hyphenate: true)\n  set par(justify: true) \n  set figure.caption(position: bottom)\n  set page(numbering: \"1\", number-align: center)\n  counter(page).update(1)\n  // Return body\n  body\n}\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 38,
      "score": 92.6,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1538
    },
    {
      "id": 11816,
      "post_number": 2,
      "username": "gezepi",
      "name": "",
      "created_at": "2025-04-30T07:08:40.243Z",
      "updated_at": "2025-04-30T07:08:40.243Z",
      "cooked": "<p>Some meta comments about your post itself, not the problem you are facing:</p>\n<ol>\n<li>The title of a question should, itself, be a question.  See this nice guide: <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\" class=\"inline-onebox\">How to post in the Questions category</a></li>\n<li>You have included your code in code blocks which is great, but the language in this case should be <code>typ</code>:<pre><code class=\"lang-auto\">```typ\n//Your code goes here\n```\n</code></pre>\n</li>\n<li>The code you have provided does not compile.  It takes more effort to help you if each person that attempts to do so must work around missing pieces.  Your code as it has been posted has these two issues:\n<ul>\n<li><code>main.typ</code> does not import <code>template.typ</code> so the functions called don’t exist in that scope</li>\n<li>Neither of the chapters included in <code>main.typ</code> have been given.  Using <a href=\"https://typst.app/docs/reference/text/lorem/\"><code>lorem()</code></a> is handy for these kinds of <a href=\"https://en.wikipedia.org/wiki/Minimal_reproducible_example\">MWE</a>.</li>\n</ul>\n</li>\n</ol>",
      "raw": "Some meta comments about your post itself, not the problem you are facing:\n1. The title of a question should, itself, be a question.  See this nice guide: https://forum.typst.app/t/how-to-post-in-the-questions-category/11\n2. You have included your code in code blocks which is great, but the language in this case should be `typ`:\n   ````\n   ```typ\n   //Your code goes here\n   ```\n   ````\n3. The code you have provided does not compile.  It takes more effort to help you if each person that attempts to do so must work around missing pieces.  Your code as it has been posted has these two issues:\n   - `main.typ` does not import `template.typ` so the functions called don't exist in that scope\n   - Neither of the chapters included in `main.typ` have been given.  Using [`lorem()`](https://typst.app/docs/reference/text/lorem/) is handy for these kinds of [MWE](https://en.wikipedia.org/wiki/Minimal_reproducible_example).",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 37,
      "score": 67.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 326
    },
    {
      "id": 11819,
      "post_number": 3,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2025-04-30T08:27:06.749Z",
      "updated_at": "2025-04-30T08:27:06.749Z",
      "cooked": "<p>Hello <a class=\"mention\" href=\"/u/rafael_bluhm\">@Rafael_Bluhm</a>  and welcome!</p>\n<p>I think you will find your answer on this topic: <a href=\"https://forum.typst.app/t/how-can-i-continue-frontmatter-numbering-in-backmatter/2496\" class=\"inline-onebox\">How can I continue frontmatter numbering in backmatter?</a></p>",
      "raw": "Hello @Rafael_Bluhm  and welcome!\n\nI think you will find your answer on this topic: https://forum.typst.app/t/how-can-i-continue-frontmatter-numbering-in-backmatter/2496",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 35,
      "score": 22.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 258
    },
    {
      "id": 11828,
      "post_number": 4,
      "username": "Rafael_Bluhm",
      "name": "Rafael Bluhm",
      "created_at": "2025-04-30T13:31:06.271Z",
      "updated_at": "2025-05-04T12:34:50.495Z",
      "cooked": "<p>Solved by rewriting  : Put a page numbering (none) inside toc and break page after (to jump to odd).</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let toc() = [\n  #show outline.entry: it =&gt; {\n    if it.level == 1 {\n      strong(it)\n    } else {\n      it\n    }\n  }\n  #set page(margin: 3.0cm)\n  #v(2cm)\n  #align(center)[\n    #text(size: 22pt, weight: \"bold\")[Contents]\n    #v(1cm)\n    #set text(size: 16pt)\n    #outline(\n      title: none,\n      indent: 1em,\n      depth: 3\n    )\n    #set page(numbering: none)\n    #pagebreak(to: \"odd\")\n  ]\n]\n</code></pre>\n<p>Then, can’t make automatic page break inside formatting function:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let document-template(body) = { \n  show link: set text(fill: blue) \n  set text(font: \"Source Sans Pro\", size: 16pt, hyphenate: true)\n  set par(justify: true) \n  set figure.caption(position: bottom)\n  counter(page).update(1)\n  set page(numbering: \"1\")\n\n  // Ativa numeração para capítulos, seções e subseções\n  set heading(numbering: \"1.1\")\n\n  // Personaliza os headings por nível\n  show heading: it =&gt; {\n    if it.level == 1 {\n      text(size: 28pt, weight: \"bold\")[#it]\n      v(0.5cm)\n    } else if it.level == 2 {\n      text(size: 24pt, weight: \"bold\")[#it]\n      v(0.3cm)\n    } else if it.level == 3 {\n      text(size: 20pt, weight: \"bold\")[#it]\n      v(0.2cm)\n    } else {\n      // Outros níveis (se houver)\n      it\n    }\n  }\n  body\n}\n</code></pre>\n<p>The page breakers to odd pages must be manual as:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#counter(page).update(1)\n#set page(numbering: \"i\")\n\n#toc()\n\n#document-template[\n  #include \"chapters/chapter1.typ\"\n  #pagebreak(to: \"odd\")\n  #include \"chapters/chapter2.typ\"\n]\n</code></pre>\n<p>It is a less automatized version, but works.</p>",
      "raw": "Solved by rewriting  : Put a page numbering (none) inside toc and break page after (to jump to odd).\n\n```typ\n#let toc() = [\n  #show outline.entry: it => {\n    if it.level == 1 {\n      strong(it)\n    } else {\n      it\n    }\n  }\n  #set page(margin: 3.0cm)\n  #v(2cm)\n  #align(center)[\n    #text(size: 22pt, weight: \"bold\")[Contents]\n    #v(1cm)\n    #set text(size: 16pt)\n    #outline(\n      title: none,\n      indent: 1em,\n      depth: 3\n    )\n    #set page(numbering: none)\n    #pagebreak(to: \"odd\")\n  ]\n]\n```\n\nThen, can't make automatic page break inside formatting function:\n```typ\n#let document-template(body) = { \n  show link: set text(fill: blue) \n  set text(font: \"Source Sans Pro\", size: 16pt, hyphenate: true)\n  set par(justify: true) \n  set figure.caption(position: bottom)\n  counter(page).update(1)\n  set page(numbering: \"1\")\n\n  // Ativa numeração para capítulos, seções e subseções\n  set heading(numbering: \"1.1\")\n\n  // Personaliza os headings por nível\n  show heading: it => {\n    if it.level == 1 {\n      text(size: 28pt, weight: \"bold\")[#it]\n      v(0.5cm)\n    } else if it.level == 2 {\n      text(size: 24pt, weight: \"bold\")[#it]\n      v(0.3cm)\n    } else if it.level == 3 {\n      text(size: 20pt, weight: \"bold\")[#it]\n      v(0.2cm)\n    } else {\n      // Outros níveis (se houver)\n      it\n    }\n  }\n  body\n}\n```\nThe page breakers to odd pages must be manual as: \n```typ\n#counter(page).update(1)\n#set page(numbering: \"i\")\n\n#toc()\n\n#document-template[\n  #include \"chapters/chapter1.typ\"\n  #pagebreak(to: \"odd\")\n  #include \"chapters/chapter2.typ\"\n]\n```\n\nIt is a less automatized version, but works.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 30,
      "score": 41.0,
      "accepted_answer": true,
      "trust_level": 0,
      "user_id": 1538
    },
    {
      "id": 11959,
      "post_number": 5,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2025-05-04T12:34:32.324Z",
      "updated_at": "2025-05-04T12:34:32.324Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/rafael_bluhm\">@Rafael_Bluhm</a>, first of all welcome and thanks for editing your post as indicated!</p>\n<aside class=\"quote no-group\" data-username=\"Rafael_Bluhm\" data-post=\"4\" data-topic=\"3880\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/rafael_bluhm/48/2749_2.png\" class=\"avatar\"> Rafael_Bluhm:</div>\n<blockquote>\n<p>Solved by rewriting</p>\n</blockquote>\n</aside>\n<p>If you’re satisfied with your solution, be sure to give it a checkmark <img src=\"https://forum.typst.app/images/emoji/apple/ballot_box_with_check.png?v=12\" title=\":ballot_box_with_check:\" class=\"emoji\" alt=\":ballot_box_with_check:\" loading=\"lazy\" width=\"20\" height=\"20\">, this will help others find the solution in the future. If not, you can describe what you’re missing from your solution, or ask a new question focused on the remaining problem. Thanks! <img src=\"https://forum.typst.app/images/emoji/apple/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Hi @Rafael_Bluhm, first of all welcome and thanks for editing your post as indicated!\n\n[quote=\"Rafael_Bluhm, post:4, topic:3880\"]\nSolved by rewriting\n[/quote]\n\nIf you're satisfied with your solution, be sure to give it a checkmark :ballot_box_with_check:, this will help others find the solution in the future. If not, you can describe what you're missing from your solution, or ask a new question focused on the remaining problem. Thanks! :slight_smile:",
      "reply_to_post_number": 4,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 1,
      "reads": 15,
      "score": 28.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 11965,
      "post_number": 6,
      "username": "Rafael_Bluhm",
      "name": "Rafael Bluhm",
      "created_at": "2025-05-04T13:09:55.208Z",
      "updated_at": "2025-05-04T13:09:55.208Z",
      "cooked": "<p>I was waiting to see if anyone had a better solution. Thanks for remembering.</p>",
      "raw": "I was waiting to see if anyone had a better solution. Thanks for remembering.",
      "reply_to_post_number": 5,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 13,
      "score": 47.6,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1538
    }
  ],
  "scraped_at": "2025-06-10T09:48:29.625927"
}
{
  "topic_metadata": {
    "id": 3881,
    "title": "How to customize numbering for nested enum items?",
    "slug": "how-to-customize-numbering-for-nested-enum-items",
    "posts_count": 3,
    "created_at": "2025-04-30T08:22:47.296Z",
    "last_posted_at": "2025-04-30T08:38:31.169Z",
    "views": 77,
    "like_count": 2,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 3,
    "accepted_answer_username": "quachpas",
    "tags": [
      "styling",
      "lists"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 244
  },
  "posts": [
    {
      "id": 11817,
      "post_number": 1,
      "username": "myzinsky",
      "name": "Matthias Jung",
      "created_at": "2025-04-30T08:22:47.448Z",
      "updated_at": "2025-05-04T12:26:16.248Z",
      "cooked": "<p>I managed to style the numbers of the enumeration in blue:</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">  // Configure Enums:\n  set enum(\n    numbering: n =&gt; (text(fill:blue)[#n.]),\n  )\n</code></pre>\n<p>When I now have a enum like this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">+ ABC\n   + DEF\n</code></pre>\n<p>I want that the DEF is colored in gray. How to reach that? Any thoughts?</p>",
      "raw": "I managed to style the numbers of the enumeration in blue: \n\n```typc\n  // Configure Enums:\n  set enum(\n    numbering: n => (text(fill:blue)[#n.]),\n  )\n```\n\nWhen I now have a enum like this:\n\n```typ\n+ ABC\n   + DEF\n```\nI want that the DEF is colored in gray. How to reach that? Any thoughts?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 29,
      "score": 170.8,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1517
    },
    {
      "id": 11820,
      "post_number": 2,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-30T08:29:51.322Z",
      "updated_at": "2025-04-30T08:29:51.322Z",
      "cooked": "<p>Set <code>full: true</code> on the enum, then it receives all levels of numbers in the callback, then it can be customized by level (and also create multilevel type numbering like “1.b” if wanted)</p>",
      "raw": "Set `full: true` on the enum, then it receives all levels of numbers in the callback, then it can be customized by level (and also create multilevel type numbering like \"1.b\" if wanted)",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 30,
      "score": 16.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11821,
      "post_number": 3,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2025-04-30T08:38:31.169Z",
      "updated_at": "2025-04-30T08:38:37.360Z",
      "cooked": "<p>To complete <a class=\"mention\" href=\"/u/bluss\">@bluss</a>’s answer, if you set <code>full: true</code> to your enum, the numbering function will receive all numbers corresponding to the <code>enum.item</code>s. That is, the first item will send <code>(1,)</code>, the nested item will send <code>(1, 1)</code>.</p>\n<p>You can receive these arguments using <a href=\"https://typst.app/docs/reference/foundations/arguments/\"><code>arguments</code></a> as such:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let nb = (..n) =&gt; { ... }\n</code></pre>\n<p>Then, <code>n</code> will be of type <code>arguments</code>. The easiest here is to convert it directly to an array and look at its length and slice for each level. A full example below. You do need to be careful to either define a default behaviour, or not use any levels with no customization.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// Configure Enums:\n  #set enum(\n    numbering: (..n) =&gt; {\n      n = n.pos()\n      let level = n.len()\n      if level == 1 {\n        text(blue, numbering(\"1.\", ..n))\n      } else if level == 2 {\n        text(gray, numbering(\"a.\", ..n.slice(1)))\n      } else {\n        // panic(\"Enum level not set\")\n        // or\n        numbering(\"1.\", ..n)\n      }\n    },\n    full: true,\n  )\n\n+ ABC\n   + DEF\n   + DEF\n     + DEF\n</code></pre>",
      "raw": "To complete @bluss's answer, if you set `full: true` to your enum, the numbering function will receive all numbers corresponding to the `enum.item`s. That is, the first item will send `(1,)`, the nested item will send `(1, 1)`.\n\nYou can receive these arguments using [`arguments`](https://typst.app/docs/reference/foundations/arguments/) as such:\n\n```typ\n#let nb = (..n) => { ... }\n```\n\nThen, `n` will be of type `arguments`. The easiest here is to convert it directly to an array and look at its length and slice for each level. A full example below. You do need to be careful to either define a default behaviour, or not use any levels with no customization.\n```typ\n// Configure Enums:\n  #set enum(\n    numbering: (..n) => {\n      n = n.pos()\n      let level = n.len()\n      if level == 1 {\n        text(blue, numbering(\"1.\", ..n))\n      } else if level == 2 {\n        text(gray, numbering(\"a.\", ..n.slice(1)))\n      } else {\n        // panic(\"Enum level not set\")\n        // or\n        numbering(\"1.\", ..n)\n      }\n    },\n    full: true,\n  )\n\n+ ABC\n   + DEF\n   + DEF\n     + DEF\n```",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 29,
      "score": 60.8,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 258
    }
  ],
  "scraped_at": "2025-06-10T09:48:28.905727"
}
{
  "topic_metadata": {
    "id": 3883,
    "title": "How to create a chapter edge index / thumb index?",
    "slug": "how-to-create-a-chapter-edge-index-thumb-index",
    "posts_count": 8,
    "created_at": "2025-04-30T10:39:55.166Z",
    "last_posted_at": "2025-04-30T15:09:57.489Z",
    "views": 75,
    "like_count": 4,
    "reply_count": 5,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 7,
    "accepted_answer_username": "Eric",
    "tags": [
      "scripting",
      "page"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 914
  },
  "posts": [
    {
      "id": 11824,
      "post_number": 1,
      "username": "sunnytown",
      "name": "sunnytown",
      "created_at": "2025-04-30T10:39:55.288Z",
      "updated_at": "2025-05-04T12:35:59.984Z",
      "cooked": "<p>EDIT: Solution in my last reply.</p>\n<p>I’m trying to create a chapter thumb index on the right side of the page.  I want each page to display a little box on the side with the chapter number, so that the reader of the book has a visual clue where to open the book when it’s closed.</p>\n<p>How can I manage to automatically set the chapter number as well as the shift the index block downwards on the page using the dy argument? Essentially, I believe I need to query the state of the headings in their final state to obtain the total number of headings. Using this number, I should be able to calculate the vertical offset of the first chapter index so that all index markers are distributed around the vertical center of the page. Unfortunately, I haven’t found a way to implement this yet.</p>\n<p>This is the code that I have so far. However, I’m having issues retrieving the heading counter for the headings obtained from the query. Thanks for you help in advance!</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set page(\n  background: context{\n  let headings_before = query(heading.where(level: 1).before(here()))\n  let headings_after = query(heading.where(level: 1).after(here()))\n  let number = none\n  if headings_before.len() == 0 {\n    // this line doesn't work, why?\n    number = counter(headings_after.first()).get().first()\n  } else {\n    let page = here().page()\n    let page_next = headings_after.first().location().page()\n    if page_next == page {\n      // this line doesn't work, why?\n      number = counter(headings_after.first()).get().first()\n    } else {\n      // this line doesn't work, why?\n      number = counter(headings_before.first()).get().first()\n    }\n  }\n  place(\n    horizon + right,\n    block(width: 1cm, height: 1cm, fill: gray)[\n      #set align(center)\n      #text(fill: white, weight: \"bold\", size: 25pt)[#number]\n    ]\n  )\n}\n)\n</code></pre>",
      "raw": "EDIT: Solution in my last reply.\n\nI'm trying to create a chapter thumb index on the right side of the page.  I want each page to display a little box on the side with the chapter number, so that the reader of the book has a visual clue where to open the book when it's closed. \n\nHow can I manage to automatically set the chapter number as well as the shift the index block downwards on the page using the dy argument? Essentially, I believe I need to query the state of the headings in their final state to obtain the total number of headings. Using this number, I should be able to calculate the vertical offset of the first chapter index so that all index markers are distributed around the vertical center of the page. Unfortunately, I haven't found a way to implement this yet.\n\nThis is the code that I have so far. However, I'm having issues retrieving the heading counter for the headings obtained from the query. Thanks for you help in advance!\n\n```typ\n#set page(\n  background: context{\n  let headings_before = query(heading.where(level: 1).before(here()))\n  let headings_after = query(heading.where(level: 1).after(here()))\n  let number = none\n  if headings_before.len() == 0 {\n    // this line doesn't work, why?\n    number = counter(headings_after.first()).get().first()\n  } else {\n    let page = here().page()\n    let page_next = headings_after.first().location().page()\n    if page_next == page {\n      // this line doesn't work, why?\n      number = counter(headings_after.first()).get().first()\n    } else {\n      // this line doesn't work, why?\n      number = counter(headings_before.first()).get().first()\n    }\n  }\n  place(\n    horizon + right,\n    block(width: 1cm, height: 1cm, fill: gray)[\n      #set align(center)\n      #text(fill: white, weight: \"bold\", size: 25pt)[#number]\n    ]\n  )\n}\n)\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 34,
      "score": 86.6,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1539
    },
    {
      "id": 11825,
      "post_number": 2,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-30T10:50:28.598Z",
      "updated_at": "2025-04-30T10:50:28.598Z",
      "cooked": "<p>When you say “this line doesn’t work, why?”, what is the error message? What’s the expected vs actual behaviour?</p>",
      "raw": "When you say \"this line doesn't work, why?\", what is the error message? What's the expected vs actual behaviour?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 6.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11826,
      "post_number": 3,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2025-04-30T10:56:16.063Z",
      "updated_at": "2025-04-30T10:56:16.063Z",
      "cooked": "<p>The error you should have gotten is that you are passing content, but the expected type is function/label/selector/etc.</p>\n<p>tl;dr: the <a href=\"https://typst.app/docs/reference/introspection/counter/\"><code>counter</code></a> type expects a selector and will do the query. So just pass your selector instead.</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">let number = counter(heading.where(level: 1).after(here())).get().first()\n</code></pre>",
      "raw": "The error you should have gotten is that you are passing content, but the expected type is function/label/selector/etc.\n\ntl;dr: the [`counter`](https://typst.app/docs/reference/introspection/counter/) type expects a selector and will do the query. So just pass your selector instead.\n\n```typc\nlet number = counter(heading.where(level: 1).after(here())).get().first()\n```",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 11.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 258
    },
    {
      "id": 11830,
      "post_number": 4,
      "username": "sunnytown",
      "name": "sunnytown",
      "created_at": "2025-04-30T13:55:45.379Z",
      "updated_at": "2025-04-30T13:55:45.379Z",
      "cooked": "<p>Thanks, that helps! However, when I use <code>after</code>, it just gives me <code>(0, )</code>. When I use  <code>before</code> instead, it works fine.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#context{\n  counter(heading.where(level: 1).after(here())).get()\n}\n</code></pre>",
      "raw": "Thanks, that helps! However, when I use `after`, it just gives me `(0, )`. When I use  `before` instead, it works fine. \n\n\n```typ\n#context{\n  counter(heading.where(level: 1).after(here())).get()\n}\n```",
      "reply_to_post_number": 3,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 27,
      "score": 10.2,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1539
    },
    {
      "id": 11831,
      "post_number": 5,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2025-04-30T13:58:43.673Z",
      "updated_at": "2025-04-30T13:58:43.673Z",
      "cooked": "<p><code>(0,)</code> is an array, I suppose the result of <code>get()</code>, then you need to pick an item out of that array. Hence you use <code>.get().first()</code>. <code>get()</code> returns you the results of the counter.</p>",
      "raw": "`(0,)` is an array, I suppose the result of `get()`, then you need to pick an item out of that array. Hence you use `.get().first()`. `get()` returns you the results of the counter.",
      "reply_to_post_number": 4,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 9.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 258
    },
    {
      "id": 11832,
      "post_number": 6,
      "username": "sunnytown",
      "name": "sunnytown",
      "created_at": "2025-04-30T14:03:10.276Z",
      "updated_at": "2025-04-30T14:06:01.313Z",
      "cooked": "<p>I understand that it is an array and that I need to get the first element, which is supposed to be my heading number. The issue is that this number is always 0, even if there are multiple first level headings before and after the querying of the counter. On the other hand, using <code>before</code> instead of <code>after</code> for the selector will correctly return the actual number of the previous heading, not 0.</p>\n<p>Let me give a clear example of the issue:</p>\n<p>Test code:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set heading(numbering: \"1.1\")\n= Heading 1\n= Heading 2\n\nThis is the number of the previous heading: \n#context{\n  counter(selector(heading).before(here())).get().first()\n}\n\nThis is the number of the following heading (wrong):\n#context{\n  counter(selector(heading).after(here())).get().first()\n}\n\n= Heading 3\n= Heading 4\n</code></pre>\n<p>Output:<br>\n<img src=\"https://forum.typst.app/uploads/default/original/2X/7/73315fa91b18aca89d946bf2b08664afd9b06e04.png\" alt=\"grafik\" data-base62-sha1=\"gr2GSVZjfRZxIBUYSqFMHUmOlh2\" width=\"452\" height=\"271\"></p>",
      "raw": "I understand that it is an array and that I need to get the first element, which is supposed to be my heading number. The issue is that this number is always 0, even if there are multiple first level headings before and after the querying of the counter. On the other hand, using `before` instead of `after` for the selector will correctly return the actual number of the previous heading, not 0.\n\nLet me give a clear example of the issue:\n\nTest code:\n```typ\n#set heading(numbering: \"1.1\")\n= Heading 1\n= Heading 2\n\nThis is the number of the previous heading: \n#context{\n  counter(selector(heading).before(here())).get().first()\n}\n\nThis is the number of the following heading (wrong):\n#context{\n  counter(selector(heading).after(here())).get().first()\n}\n\n= Heading 3\n= Heading 4\n```\n\nOutput:\n![grafik|452x271](upload://gr2GSVZjfRZxIBUYSqFMHUmOlh2.png)",
      "reply_to_post_number": 5,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 28,
      "score": 45.4,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1539
    },
    {
      "id": 11833,
      "post_number": 7,
      "username": "Eric",
      "name": "Eric Biedert",
      "created_at": "2025-04-30T14:05:29.835Z",
      "updated_at": "2025-04-30T14:15:52.469Z",
      "cooked": "<p>The counter you want to use is probably just <code>counter(heading)</code>. <s>Using a custom selector instead just creates a completely different counter which is not stepped automatically.</s></p>\n<p>To get the number of a specific heading, you can then use the <code>at</code> method of the counter as in</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let next-heading = query(selector(...)).first()\n#let number = counter(heading).at(next-heading.location())\n</code></pre>",
      "raw": "The counter you want to use is probably just `counter(heading)`. ~~Using a custom selector instead just creates a completely different counter which is not stepped automatically.~~\n\nTo get the number of a specific heading, you can then use the `at` method of the counter as in\n```typ\n#let next-heading = query(selector(...)).first()\n#let number = counter(heading).at(next-heading.location())\n```",
      "reply_to_post_number": 6,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 25,
      "score": 44.8,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 88
    },
    {
      "id": 11835,
      "post_number": 8,
      "username": "sunnytown",
      "name": "sunnytown",
      "created_at": "2025-04-30T15:09:57.489Z",
      "updated_at": "2025-04-30T15:10:06.836Z",
      "cooked": "<aside class=\"quote no-group quote-modified\" data-username=\"Eric\" data-post=\"7\" data-topic=\"3883\" data-full=\"true\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/eric/48/87_2.png\" class=\"avatar\"> Eric:</div>\n<blockquote>\n<p>The counter you want to use is just <code>counter(heading)</code>. Using a custom selector instead just creates a completely different counter which is not stepped automatically.</p>\n</blockquote>\n</aside>\n<p>Thank you so much for your help, this solved the issue for me! Here is my full code for the thumb index implemented with your solution, in case anybody needs it in the future.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let thumb-index(height: 1cm, width: 1cm) = context{\n  let total-headings = counter(heading.where(level: 1)).final().first()\n  let previous-headings = query(selector(heading).before(here()))\n  let next-headings = query(selector(heading).after(here()))\n  let number = none\n  if previous-headings.len() == 0 and next-headings.len() == 0 {\n    // if there are no headings in the document, return none\n    return\n  }\n  if next-headings.len() == 0{\n    // if there are no more headings after, the numbering continues indefinitely\n    number = counter(heading).at(previous-headings.last().location()).first()\n  } else if previous-headings.len() == 0 {\n    // if there are no previous headings, use the first heading found\n    number = counter(heading).at(next-headings.first().location()).first()\n  } else {\n    let current-page = here().page()\n    let next-heading-page = next-headings.first().location().page()\n    if next-heading-page == current-page {\n      // if the next heading is on the current page, use the next heading's number\n      number = counter(heading).at(next-headings.first().location()).first()\n    } else {\n      // otherwise (general case) use the previous heading's number\n      number = counter(heading).at(previous-headings.last().location()).first()\n    } \n  }\n  // vertical offset for the thumb markers\n  let offset = (number - 1 - (total-headings - 1) / 2) * height\n  \n  place(\n    horizon + right,\n    dy: offset,\n    block(width: width, height: height, fill: gray)[\n      #set align(center)\n      #text(fill: white, weight: \"bold\", size: 25pt)[#number]\n    ]\n  )\n}\n\n#set page(\n  background: thumb-index(height: 3cm)\n)\n</code></pre>",
      "raw": "[quote=\"Eric, post:7, topic:3883, full:true\"]\nThe counter you want to use is just `counter(heading)`. Using a custom selector instead just creates a completely different counter which is not stepped automatically.\n[/quote]\n\nThank you so much for your help, this solved the issue for me! Here is my full code for the thumb index implemented with your solution, in case anybody needs it in the future.\n\n```typ\n#let thumb-index(height: 1cm, width: 1cm) = context{\n  let total-headings = counter(heading.where(level: 1)).final().first()\n  let previous-headings = query(selector(heading).before(here()))\n  let next-headings = query(selector(heading).after(here()))\n  let number = none\n  if previous-headings.len() == 0 and next-headings.len() == 0 {\n    // if there are no headings in the document, return none\n    return\n  }\n  if next-headings.len() == 0{\n    // if there are no more headings after, the numbering continues indefinitely\n    number = counter(heading).at(previous-headings.last().location()).first()\n  } else if previous-headings.len() == 0 {\n    // if there are no previous headings, use the first heading found\n    number = counter(heading).at(next-headings.first().location()).first()\n  } else {\n    let current-page = here().page()\n    let next-heading-page = next-headings.first().location().page()\n    if next-heading-page == current-page {\n      // if the next heading is on the current page, use the next heading's number\n      number = counter(heading).at(next-headings.first().location()).first()\n    } else {\n      // otherwise (general case) use the previous heading's number\n      number = counter(heading).at(previous-headings.last().location()).first()\n    } \n  }\n  // vertical offset for the thumb markers\n  let offset = (number - 1 - (total-headings - 1) / 2) * height\n  \n  place(\n    horizon + right,\n    dy: offset,\n    block(width: width, height: height, fill: gray)[\n      #set align(center)\n      #text(fill: white, weight: \"bold\", size: 25pt)[#number]\n    ]\n  )\n}\n\n#set page(\n  background: thumb-index(height: 3cm)\n)\n```",
      "reply_to_post_number": 7,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 1,
      "reads": 24,
      "score": 24.6,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1539
    }
  ],
  "scraped_at": "2025-06-10T09:48:28.176216"
}
{
  "topic_metadata": {
    "id": 3891,
    "title": "How do I remove automatically inserted spaces in Japanese?",
    "slug": "how-do-i-remove-automatically-inserted-spaces-in-japanese",
    "posts_count": 5,
    "created_at": "2025-05-01T06:29:30.058Z",
    "last_posted_at": "2025-05-01T15:36:20.085Z",
    "views": 65,
    "like_count": 5,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Kans",
    "tags": [
      "scripting",
      "layout"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 538
  },
  "posts": [
    {
      "id": 11844,
      "post_number": 1,
      "username": "octo8",
      "name": "",
      "created_at": "2025-05-01T06:29:30.204Z",
      "updated_at": "2025-05-01T13:32:35.531Z",
      "cooked": "<p>I use typst to create Japanese documents, but I have one problem.<br>\nIt is that line breaks in the typst file are causing unexpected output format changes – spaces are automatically inserted.<br>\nThis is not a problem when using LaTeX or perhaps when using typst to create documents in many other languages.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set text(\n  lang: \"ja\",\n  font: \"Noto Sans CJK JP\",\n  cjk-latin-spacing: auto,\n)\n\n// From the two examples below, we would like to get the same output,\n// but the automatically inserted spaces result in different output.\n// Example 1:\n吾輩は猫である。\n名前はまだ無い。\n\n//Example 2:\n吾輩は猫である。名前はまだ無い。\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/a/a9aea39afa8736f11caa8f1731ec70f7742d04f6.png\" alt=\"image\" data-base62-sha1=\"od4R0GqJZFW7yenwfiqQBZ1fRsy\" width=\"554\" height=\"132\"></p>\n<p>So, my question is this:<br>\nIs there a layout setup or scripting method that would allow me to input Example 1 and still get the same output as Example 2? In other words, is there any way to eliminate or prevent the spaces automatically inserted by line breaks?</p>",
      "raw": "I use typst to create Japanese documents, but I have one problem.\nIt is that line breaks in the typst file are causing unexpected output format changes -- spaces are automatically inserted.\nThis is not a problem when using LaTeX or perhaps when using typst to create documents in many other languages.\n\n```typ\n#set text(\n  lang: \"ja\",\n  font: \"Noto Sans CJK JP\",\n  cjk-latin-spacing: auto,\n)\n\n// From the two examples below, we would like to get the same output,\n// but the automatically inserted spaces result in different output.\n// Example 1:\n吾輩は猫である。\n名前はまだ無い。\n\n//Example 2:\n吾輩は猫である。名前はまだ無い。\n```\n![image|554x132](upload://od4R0GqJZFW7yenwfiqQBZ1fRsy.png)\n\nSo, my question is this:\nIs there a layout setup or scripting method that would allow me to input Example 1 and still get the same output as Example 2? In other words, is there any way to eliminate or prevent the spaces automatically inserted by line breaks?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 24,
      "score": 69.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1452
    },
    {
      "id": 11849,
      "post_number": 2,
      "username": "Kans",
      "name": "Kans",
      "created_at": "2025-05-01T08:50:37.344Z",
      "updated_at": "2025-05-01T08:50:37.344Z",
      "cooked": "<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#set text(\n  lang: \"ja\",\n  font: \"Noto Sans CJK JP\",\n  cjk-latin-spacing: auto,\n)\n\n#show regex(`\\s+`.text): \"\"\n\n// From the two examples below, we would like to get the same output,\n// but the automatically inserted spaces result in different output.\n// Example 1:\n吾輩は猫である。\n名前はまだ無い。\n\n//Example 2:\n吾輩は猫である。名前はまだ無い。\n</code></pre>\n<p>My opinion is that a single line should be written in one line. And a line break in source code should be translated into a soft break, it’s <strong>not</strong> a bug.</p>",
      "raw": "```typst\n#set text(\n  lang: \"ja\",\n  font: \"Noto Sans CJK JP\",\n  cjk-latin-spacing: auto,\n)\n\n#show regex(`\\s+`.text): \"\"\n\n// From the two examples below, we would like to get the same output,\n// but the automatically inserted spaces result in different output.\n// Example 1:\n吾輩は猫である。\n名前はまだ無い。\n\n//Example 2:\n吾輩は猫である。名前はまだ無い。\n```\n\nMy opinion is that a single line should be written in one line. And a line break in source code should be translated into a soft break, it's **not** a bug.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 22,
      "score": 24.4,
      "accepted_answer": true,
      "trust_level": 0,
      "user_id": 1293
    },
    {
      "id": 11856,
      "post_number": 3,
      "username": "octo8",
      "name": "",
      "created_at": "2025-05-01T13:26:23.170Z",
      "updated_at": "2025-05-01T13:27:07.411Z",
      "cooked": "<p>Thank you very much! It seems to be working as I expected.</p>\n<p>I understand that this implementation is <strong>not</strong> a bug, and I understand the argument that what I want to output as a single line should be written as a single line in the source code.<br>\nHowever, for example if a paragraph consists of more than 100 sentences, under this implementation it should be written as a single line of source code. That is sometimes very difficult to use.<br>\nI wanted to know if there is a way for the user to control the behavior of soft break.</p>\n<p>Thank you very much again for your kind instruction!</p>",
      "raw": "Thank you very much! It seems to be working as I expected.\n\nI understand that this implementation is **not** a bug, and I understand the argument that what I want to output as a single line should be written as a single line in the source code.\nHowever, for example if a paragraph consists of more than 100 sentences, under this implementation it should be written as a single line of source code. That is sometimes very difficult to use.\nI wanted to know if there is a way for the user to control the behavior of soft break.\n\nThank you very much again for your kind instruction!",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 17,
      "score": 8.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1452
    },
    {
      "id": 11857,
      "post_number": 4,
      "username": "Kans",
      "name": "Kans",
      "created_at": "2025-05-01T14:20:45.569Z",
      "updated_at": "2025-05-01T14:20:45.569Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"octo8\" data-post=\"3\" data-topic=\"3891\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/octo8/48/2495_2.png\" class=\"avatar\"> octo8:</div>\n<blockquote>\n<p>a paragraph consists of more than 100 sentences</p>\n</blockquote>\n</aside>\n<p>This makes sense, and it’s the same in Chinese typesetting. I think this is because Typst is designed for western language, in which words are separated by spaces.</p>\n<aside class=\"quote no-group\" data-username=\"octo8\" data-post=\"3\" data-topic=\"3891\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/octo8/48/2495_2.png\" class=\"avatar\"> octo8:</div>\n<blockquote>\n<p>I wanted to know if there is a way for the user to control the behavior of soft break.</p>\n</blockquote>\n</aside>\n<p>Unhopefully, <strong>not for now</strong>. But I can see the Typst community <strong>do</strong> trying to benefit CJK users, like this <a href=\"https://typst.app/docs/reference/text/text/#parameters-cjk-latin-spacing\">Text Function #cjk-latin-spacing</a>. Maybe <code>text</code> function will have a <code>cjk-soft-break</code> parameter in the future, which can eliminate unnecessary spaces between CJK characters. <img src=\"https://forum.typst.app/images/emoji/apple/smiling_face_with_three_hearts.png?v=12\" title=\":smiling_face_with_three_hearts:\" class=\"emoji\" alt=\":smiling_face_with_three_hearts:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "[quote=\"octo8, post:3, topic:3891\"]\na paragraph consists of more than 100 sentences\n[/quote]\n\nThis makes sense, and it's the same in Chinese typesetting. I think this is because Typst is designed for western language, in which words are separated by spaces.\n\n[quote=\"octo8, post:3, topic:3891\"]\nI wanted to know if there is a way for the user to control the behavior of soft break.\n[/quote]\n\nUnhopefully, **not for now**. But I can see the Typst community **do** trying to benefit CJK users, like this [Text Function #cjk-latin-spacing](https://typst.app/docs/reference/text/text/#parameters-cjk-latin-spacing). Maybe `text` function will have a `cjk-soft-break` parameter in the future, which can eliminate unnecessary spaces between CJK characters. :smiling_face_with_three_hearts:",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 0,
      "reads": 17,
      "score": 13.4,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1293
    },
    {
      "id": 11860,
      "post_number": 5,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-05-01T15:36:20.085Z",
      "updated_at": "2025-05-01T17:10:50.086Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/octo8\">@octo8</a>, your issue is - kind of - already reported as a feature request here: <a href=\"https://github.com/typst/typst/issues/792\" class=\"inline-onebox\">Ignore linebreaks between CJK characters in source code · Issue #792 · typst/typst · GitHub</a>  (and you could vote on it by adding a <img src=\"https://forum.typst.app/images/emoji/apple/+1.png?v=12\" title=\":+1:\" class=\"emoji\" alt=\":+1:\" loading=\"lazy\" width=\"20\" height=\"20\"> on the issue). I say kind of since the issue already prescribes a particular fix with comments, but I think other solutions are mentioned there too.</p>\n<p>The project wants to have a solution for the issue for typst 0.14, so that’s promising.</p>",
      "raw": "Hi @octo8, your issue is - kind of - already reported as a feature request here: https://github.com/typst/typst/issues/792  (and you could vote on it by adding a :+1: on the issue). I say kind of since the issue already prescribes a particular fix with comments, but I think other solutions are mentioned there too.\n\nThe project wants to have a solution for the issue for typst 0.14, so that's promising.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 3,
      "reads": 16,
      "score": 48.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    }
  ],
  "scraped_at": "2025-06-10T09:48:27.460671"
}
{
  "topic_metadata": {
    "id": 3893,
    "title": "Why doesn't `smallcaps` work for Libertinus Serif?",
    "slug": "why-doesnt-smallcaps-work-for-libertinus-serif",
    "posts_count": 6,
    "created_at": "2025-05-01T06:35:07.428Z",
    "last_posted_at": "2025-05-01T17:11:52.924Z",
    "views": 98,
    "like_count": 3,
    "reply_count": 2,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 3,
    "accepted_answer_username": "sijo",
    "tags": [
      "text-formatting",
      "fonts"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 345
  },
  "posts": [
    {
      "id": 11846,
      "post_number": 1,
      "username": "XIONG",
      "name": "XIONG",
      "created_at": "2025-05-01T06:35:07.541Z",
      "updated_at": "2025-05-04T12:37:11.691Z",
      "cooked": "<p>Hi, I find the <code>#smallcaps</code> function does not work on my MacBook (macOS 15.4.1 (24E263)). I’ve tried Typst 0.13.1 in the terminal and VS code Tinymist<br>\n0.13.12, and they both compiled a pdf like this:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#smallcaps[Smallcaps]\n\n#smallcaps[Libertinus Serif]\n\n#text(font: \"New Computer Modern\", features: (\"smcp\",), [New Computer Modern])\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/5/50cb9f0635422a11a5ae4cf8f18f57f801cf78e0.png\" data-download-href=\"https://forum.typst.app/uploads/default/50cb9f0635422a11a5ae4cf8f18f57f801cf78e0\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/5/50cb9f0635422a11a5ae4cf8f18f57f801cf78e0_2_690x163.png\" alt=\"image\" data-base62-sha1=\"bwKs9fJFGIPq86c6ZC7NwFjhBhC\" width=\"690\" height=\"163\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/5/50cb9f0635422a11a5ae4cf8f18f57f801cf78e0_2_690x163.png, https://forum.typst.app/uploads/default/optimized/2X/5/50cb9f0635422a11a5ae4cf8f18f57f801cf78e0_2_1035x244.png 1.5x, https://forum.typst.app/uploads/default/original/2X/5/50cb9f0635422a11a5ae4cf8f18f57f801cf78e0.png 2x\" data-dominant-color=\"F6F2E6\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">1250×296 63.4 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>I guess this may result from the font “Libertinus Serif”, but the web editor <code>typst.app</code> (compile Typst 0.13.1) works well:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/d/d4dae4432bc564b56b9670eaaf36249c2ffb8eac.png\" data-download-href=\"https://forum.typst.app/uploads/default/d4dae4432bc564b56b9670eaaf36249c2ffb8eac\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/d/d4dae4432bc564b56b9670eaaf36249c2ffb8eac_2_690x88.png\" alt=\"image\" data-base62-sha1=\"un0cd0uil7oBNeI9ZgmCv5zlT8U\" width=\"690\" height=\"88\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/d/d4dae4432bc564b56b9670eaaf36249c2ffb8eac_2_690x88.png, https://forum.typst.app/uploads/default/optimized/2X/d/d4dae4432bc564b56b9670eaaf36249c2ffb8eac_2_1035x132.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/d/d4dae4432bc564b56b9670eaaf36249c2ffb8eac_2_1380x176.png 2x\" data-dominant-color=\"F5F7F7\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">2196×282 80.4 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>What can I do to address this issue? If any addition information needed, please tell me. <img src=\"https://forum.typst.app/images/emoji/apple/blush.png?v=12\" title=\":blush:\" class=\"emoji\" alt=\":blush:\" loading=\"lazy\" width=\"20\" height=\"20\"><br>\nThanks for you help in advance! <img src=\"https://forum.typst.app/images/emoji/apple/coffee.png?v=12\" title=\":coffee:\" class=\"emoji\" alt=\":coffee:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Hi, I find the `#smallcaps` function does not work on my MacBook (macOS 15.4.1 (24E263)). I've tried Typst 0.13.1 in the terminal and VS code Tinymist \n0.13.12, and they both compiled a pdf like this:\n```typst\n#smallcaps[Smallcaps]\n\n#smallcaps[Libertinus Serif]\n\n#text(font: \"New Computer Modern\", features: (\"smcp\",), [New Computer Modern])\n```\n\n![image|690x163](upload://bwKs9fJFGIPq86c6ZC7NwFjhBhC.png)\n\nI guess this may result from the font \"Libertinus Serif\", but the web editor `typst.app` (compile Typst 0.13.1) works well:\n\n![image|690x88](upload://un0cd0uil7oBNeI9ZgmCv5zlT8U.png)\n\nWhat can I do to address this issue? If any addition information needed, please tell me. 😊\nThanks for you help in advance! ☕️",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 40,
      "score": 88.0,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1542
    },
    {
      "id": 11847,
      "post_number": 2,
      "username": "Mr.Selfridge",
      "name": "",
      "created_at": "2025-05-01T08:03:12.801Z",
      "updated_at": "2025-05-01T08:03:12.801Z",
      "cooked": "<p>Interesting. I’m on macOS 15.4.1, using VSCode + Tinymist 0.13.12 and the following input works just fine:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#smallcaps[Test]\n</code></pre>\n<p>Ie. I get smallcaps. I’d first try reinstalling Tinymist. Maybe even remove Typst installation if you also have that. Just to make sure it uses the latest version and there are no odd font conflicts. Also make sure you have not installed a font with similar name manually to Font Book.</p>\n<p>But, I’m just guessing and throwing ideas. Have not encountered this.</p>",
      "raw": "Interesting. I'm on macOS 15.4.1, using VSCode + Tinymist 0.13.12 and the following input works just fine:\n\n```typ\n#smallcaps[Test]\n```\n\nIe. I get smallcaps. I'd first try reinstalling Tinymist. Maybe even remove Typst installation if you also have that. Just to make sure it uses the latest version and there are no odd font conflicts. Also make sure you have not installed a font with similar name manually to Font Book.\n\nBut, I'm just guessing and throwing ideas. Have not encountered this.",
      "reply_to_post_number": null,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 0,
      "reads": 35,
      "score": 17.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 77
    },
    {
      "id": 11851,
      "post_number": 3,
      "username": "sijo",
      "name": "",
      "created_at": "2025-05-01T09:42:17.202Z",
      "updated_at": "2025-05-01T09:42:17.202Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/xiong\">@XIONG</a>, welcome to the Typst forum! I’ve updated your question title to follow our <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\">guidelines</a>.</p>\n<p>Maybe you have a local version of Libertinus Serif that doesn’t include the smallcaps? Can you try to compile the document with <code>typst compile  --ignore-system-fonts file.typ</code> ?</p>\n<p>See <a href=\"https://typst.app/docs/reference/text/text/#parameters-font\">here</a> for more details on Typst’s font handling.</p>",
      "raw": "Hi @XIONG, welcome to the Typst forum! I've updated your question title to follow our [guidelines](https://forum.typst.app/t/how-to-post-in-the-questions-category/11).\n\nMaybe you have a local version of Libertinus Serif that doesn't include the smallcaps? Can you try to compile the document with `typst compile  --ignore-system-fonts file.typ` ?\n\nSee [here](https://typst.app/docs/reference/text/text/#parameters-font) for more details on Typst's font handling.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 35,
      "score": 47.0,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 332
    },
    {
      "id": 11861,
      "post_number": 4,
      "username": "XIONG",
      "name": "XIONG",
      "created_at": "2025-05-01T16:15:21.375Z",
      "updated_at": "2025-05-01T16:15:21.375Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"sijo\" data-post=\"3\" data-topic=\"3893\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/s/0A3649/48.png\" class=\"avatar\"> sijo:</div>\n<blockquote>\n<p><a href=\"https://typst.app/docs/reference/text/text/#parameters-font\">here </a></p>\n</blockquote>\n</aside>\n<p>Thank you for your reply! You’re right. After I removed my local <code>Libertinus Serif</code>, <code>smallcaps()</code> works. <img src=\"https://forum.typst.app/images/emoji/apple/blush.png?v=12\" title=\":blush:\" class=\"emoji\" alt=\":blush:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "[quote=\"sijo, post:3, topic:3893\"]\n[here ](https://typst.app/docs/reference/text/text/#parameters-font)\n[/quote]\n\nThank you for your reply! You're right. After I removed my local `Libertinus Serif`, `smallcaps()` works. 😊",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 1,
      "reads": 31,
      "score": 31.2,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1542
    },
    {
      "id": 11862,
      "post_number": 5,
      "username": "XIONG",
      "name": "XIONG",
      "created_at": "2025-05-01T16:16:28.388Z",
      "updated_at": "2025-05-01T16:16:28.388Z",
      "cooked": "<p>Thank you for your reply! You’re right. <code>smallcaps()</code> works now. <img src=\"https://forum.typst.app/images/emoji/apple/blush.png?v=12\" title=\":blush:\" class=\"emoji\" alt=\":blush:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Thank you for your reply! You're right. `smallcaps()` works now. 😊",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 29,
      "score": 35.8,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1542
    },
    {
      "id": 11865,
      "post_number": 6,
      "username": "XIONG",
      "name": "XIONG",
      "created_at": "2025-05-01T17:11:52.924Z",
      "updated_at": "2025-05-01T17:12:58.757Z",
      "cooked": "<p>In addition, I find that I should install ’.otf’ file rather than ‘.ttf’. ’.otf’ local font file supports ‘smallcaps’ :)</p>",
      "raw": "In addition, I find that I should install ’.otf’ file rather than ‘.ttf’. ’.otf’ local font file supports ‘smallcaps’ :)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 27,
      "score": 15.4,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1542
    }
  ],
  "scraped_at": "2025-06-10T09:48:26.616841"
}
{
  "topic_metadata": {
    "id": 3894,
    "title": "Hide or ignore? ToC structure issue",
    "slug": "hide-or-ignore-toc-structure-issue",
    "posts_count": 5,
    "created_at": "2025-05-01T09:10:36.956Z",
    "last_posted_at": "2025-05-02T21:53:25.073Z",
    "views": 116,
    "like_count": 5,
    "reply_count": 0,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 3,
    "accepted_answer_username": "bluss",
    "tags": [
      "outline"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 387
  },
  "posts": [
    {
      "id": 11850,
      "post_number": 1,
      "username": "Maxwell",
      "name": "Maxwell",
      "created_at": "2025-05-01T09:10:37.141Z",
      "updated_at": "2025-05-01T09:10:37.141Z",
      "cooked": "<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/f/fc5503f145fa59533f83a10e81e1e30c313f062e.png\" data-download-href=\"https://forum.typst.app/uploads/default/fc5503f145fa59533f83a10e81e1e30c313f062e\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/f/fc5503f145fa59533f83a10e81e1e30c313f062e_2_685x500.png\" alt=\"image\" data-base62-sha1=\"A0esXWNUTgh2xTlcLakuYOhn1NQ\" width=\"685\" height=\"500\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/f/fc5503f145fa59533f83a10e81e1e30c313f062e_2_685x500.png, https://forum.typst.app/uploads/default/original/2X/f/fc5503f145fa59533f83a10e81e1e30c313f062e.png 1.5x, https://forum.typst.app/uploads/default/original/2X/f/fc5503f145fa59533f83a10e81e1e30c313f062e.png 2x\" data-dominant-color=\"E8E8CD\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">705×514 52.2 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>As you can see in the picture above, <a href=\"https://github.com/typst/typst/discussions/2681#discussioncomment-7621511\" rel=\"noopener nofollow ugc\">hide height to 0pt</a> is not the right way to ignore headings, and the <code>PDF bookmark</code> is <a href=\"https://github.com/typst/typst/issues/1422\" rel=\"noopener nofollow ugc\">different</a> from the <code>outline()</code>.<br>\nThe script is:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// heading_ignore(heading, level) \n#let hi(h, l) = {heading(outlined:false, bookmarked:false, level:l)[#h]}\n\n#outline()\n\n= Markdown\n\n== CommonMark\n\n#table(columns:3, align:left+horizon,\n[#hi([Heading 1], 1)], [\\# Heading 1], [Heading 1\\ \\=\\=\\=],\n[#hi([Heading 2], 2)], [\\#\\# Heading 2], [Heading 2\\ \\-\\-\\-],\n[#hi([Heading 3 (up to 6)], 3)], [\\#\\#\\# Heading 3 (up to 6)], [],)\n\n== GitHub Markup\n\n== JupyterBook MyST\n\n</code></pre>\n<p>A workaround is:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// heading_fake(heading, level)\n#let hf(h, l) = {text(1.6em-l*0.2em, weight:\"bold\")[#h]}\n</code></pre>",
      "raw": "![image|685x500](upload://A0esXWNUTgh2xTlcLakuYOhn1NQ.png)\n\nAs you can see in the picture above, [hide height to 0pt](https://github.com/typst/typst/discussions/2681#discussioncomment-7621511) is not the right way to ignore headings, and the `PDF bookmark` is [different](https://github.com/typst/typst/issues/1422) from the `outline()`. \nThe script is:\n```typ\n// heading_ignore(heading, level) \n#let hi(h, l) = {heading(outlined:false, bookmarked:false, level:l)[#h]}\n\n#outline()\n\n= Markdown\n\n== CommonMark\n\n#table(columns:3, align:left+horizon,\n[#hi([Heading 1], 1)], [\\# Heading 1], [Heading 1\\ \\=\\=\\=],\n[#hi([Heading 2], 2)], [\\#\\# Heading 2], [Heading 2\\ \\-\\-\\-],\n[#hi([Heading 3 (up to 6)], 3)], [\\#\\#\\# Heading 3 (up to 6)], [],)\n\n== GitHub Markup\n\n== JupyterBook MyST\n\n```\nA workaround is:\n```typ\n// heading_fake(heading, level)\n#let hf(h, l) = {text(1.6em-l*0.2em, weight:\"bold\")[#h]}\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 34,
      "score": 86.8,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1424
    },
    {
      "id": 11852,
      "post_number": 2,
      "username": "sijo",
      "name": "",
      "created_at": "2025-05-01T09:50:05.463Z",
      "updated_at": "2025-05-01T09:50:29.099Z",
      "cooked": "<p>The Typst output is what I would expect: you have headings such as <code>= Markdown</code> and <code>== Commonmark</code> which you don’t configure in any way so they end up in the table of contents.</p>\n<p>Could you include an image of the output you expect?</p>",
      "raw": "The Typst output is what I would expect: you have headings such as `= Markdown` and `== Commonmark` which you don't configure in any way so they end up in the table of contents.\n\nCould you include an image of the output you expect?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 32,
      "score": 31.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 332
    },
    {
      "id": 11854,
      "post_number": 3,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-05-01T11:41:39.943Z",
      "updated_at": "2025-05-01T11:41:39.943Z",
      "cooked": "<p>I think this is maybe the same bug as the one reported here? <a href=\"https://github.com/typst/typst/issues/5615\" class=\"inline-onebox\">Bookmarks are displaying at the correct depth only in the Typst app but not in other PDF readers. · Issue #5615 · typst/typst · GitHub</a></p>",
      "raw": "I think this is maybe the same bug as the one reported here? https://github.com/typst/typst/issues/5615",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 29,
      "score": 80.8,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11875,
      "post_number": 4,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-01T21:13:58.392Z",
      "updated_at": "2025-05-03T01:57:00.375Z",
      "cooked": "<p>BTW, you don’t need <code>{}</code> when defining a one-line function/variable. You can also simplify many other things:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show raw: set text(11pt)\n\n// heading-ignore(heading, level)\n#let hi(l, h) = heading(outlined: false, bookmarked: false, level: l)[#h]\n#let hi(l, h) = text(1.6em - l * 0.2em, weight: \"bold\")[#h]\n\n#outline()\n\n= Markdown\n== CommonMark\n#table(\n  columns: 3,\n  align: left + horizon,\n  hi(1)[Heading 1], `# Heading 1`, `= Heading 1`,\n  hi(2)[Heading 2], `## Heading 2`, `== Heading 2`,\n  hi(3)[Heading 3 (up to 6)], `### Heading 3 (up to 6)`, `=== Heading 3 (infinite)`,\n)\n\n== GitHub Markup\n== JupyterBook MyST\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/a/ab754123b0e791856aeb603b32ede70bebdfdc50.png\" alt=\"image\" data-base62-sha1=\"osMRz1gMzRzxKzPc4vmYwus3l0k\" width=\"577\" height=\"311\"></p>\n<p>Though specifics depend on exact guidelines.</p>\n<p>With</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show table.cell.where(x: 1): set raw(lang: \"md\")\n#show table.cell.where(x: 2): set raw(lang: \"typ\")\n</code></pre>\n<p>you can spice up the output with syntax highlighting:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/0/0a1ab3ae0d1037a42dac860ffbd021ac1dcc7e31.png\" data-download-href=\"https://forum.typst.app/uploads/default/0a1ab3ae0d1037a42dac860ffbd021ac1dcc7e31\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/0/0a1ab3ae0d1037a42dac860ffbd021ac1dcc7e31_2_517x80.png\" alt=\"image\" data-base62-sha1=\"1rnYXrJkQXz8ys6asAq69re2Dg5\" width=\"517\" height=\"80\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/0/0a1ab3ae0d1037a42dac860ffbd021ac1dcc7e31_2_517x80.png, https://forum.typst.app/uploads/default/original/2X/0/0a1ab3ae0d1037a42dac860ffbd021ac1dcc7e31.png 1.5x, https://forum.typst.app/uploads/default/original/2X/0/0a1ab3ae0d1037a42dac860ffbd021ac1dcc7e31.png 2x\" data-dominant-color=\"1F2023\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">726×113 23.6 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "BTW, you don't need `{}` when defining a one-line function/variable. You can also simplify many other things:\n\n```typ\n#show raw: set text(11pt)\n\n// heading-ignore(heading, level)\n#let hi(l, h) = heading(outlined: false, bookmarked: false, level: l)[#h]\n#let hi(l, h) = text(1.6em - l * 0.2em, weight: \"bold\")[#h]\n\n#outline()\n\n= Markdown\n== CommonMark\n#table(\n  columns: 3,\n  align: left + horizon,\n  hi(1)[Heading 1], `# Heading 1`, `= Heading 1`,\n  hi(2)[Heading 2], `## Heading 2`, `== Heading 2`,\n  hi(3)[Heading 3 (up to 6)], `### Heading 3 (up to 6)`, `=== Heading 3 (infinite)`,\n)\n\n== GitHub Markup\n== JupyterBook MyST\n```\n\n![image|577x311](upload://osMRz1gMzRzxKzPc4vmYwus3l0k.png)\n\nThough specifics depend on exact guidelines.\n\nWith\n\n```typ\n#show table.cell.where(x: 1): set raw(lang: \"md\")\n#show table.cell.where(x: 2): set raw(lang: \"typ\")\n```\n\nyou can spice up the output with syntax highlighting:\n\n![image|690x107, 75%](upload://1rnYXrJkQXz8ys6asAq69re2Dg5.png)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 25,
      "score": 20.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11912,
      "post_number": 5,
      "username": "Maxwell",
      "name": "Maxwell",
      "created_at": "2025-05-02T21:53:25.073Z",
      "updated_at": "2025-05-02T21:53:25.073Z",
      "cooked": "<p><a class=\"mention\" href=\"/u/sijo\">@sijo</a> open the pdf with Web browser Firefox (<strong>PDF.js</strong> library), the outline is broken! I marked a yellow area in picture to compare the two outlines (<code>PDF.js</code> and <code>typ outline()</code>), you could see the differences.<br>\n<a class=\"mention\" href=\"/u/andrew\">@Andrew</a> Thank you for code style addvices, help me a lot!</p>",
      "raw": "@sijo open the pdf with Web browser Firefox (**PDF.js** library), the outline is broken! I marked a yellow area in picture to compare the two outlines (`PDF.js` and ```typ outline()```), you could see the differences.\\\n@Andrew Thank you for code style addvices, help me a lot!",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 21,
      "score": 19.2,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1424
    }
  ],
  "scraped_at": "2025-06-10T09:48:25.898525"
}
{
  "topic_metadata": {
    "id": 3898,
    "title": "What is the easiest way to horizontally visually flatten nested enum list?",
    "slug": "what-is-the-easiest-way-to-horizontally-visually-flatten-nested-enum-list",
    "posts_count": 5,
    "created_at": "2025-05-01T20:18:52.295Z",
    "last_posted_at": "2025-05-02T00:31:30.142Z",
    "views": 74,
    "like_count": 2,
    "reply_count": 2,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 5,
    "accepted_answer_username": "Andrew",
    "tags": [
      "layout",
      "lists"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 1320
  },
  "posts": [
    {
      "id": 11870,
      "post_number": 1,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-01T20:18:52.430Z",
      "updated_at": "2025-05-01T20:21:11.800Z",
      "cooked": "<p>I recently needed to copy this:</p>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/6/6fcbb3461baa37e3e147bac22938209be5195d74.png\" alt=\"image\" data-base62-sha1=\"fWZqlZk9R0RS9gERqSxja9YTERm\" width=\"494\" height=\"130\"></p>\n<p>Which is semantically a nested enum list, but definitely doesn’t look nested. So I grabbed my par-like implementation mentioned in <a href=\"https://forum.typst.app/t/how-to-make-bullet-list-item-bodies-flow-like-paragraphs/3756/3\" class=\"inline-onebox\">How to make bullet list item bodies flow like paragraphs? - #3 by Andrew</a>, and massaged it a little and got this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set enum(full: true, numbering: (..n) =&gt; {\n  numbering((\"1.\", \"A.\").at(n.pos().len() - 1), n.pos().last())\n})\n\n#show enum: en =&gt; {\n  set par(spacing: 0.65em)\n  let start = if en.start == auto {\n    if en.children.first().has(\"number\") {\n      if en.reversed { en.children.first().number } else { 1 }\n    } else {\n      if en.reversed { en.children.len() } else { 1 }\n    }\n  } else {\n    en.start\n  }\n  let number = start\n  for (i, it) in en.children.enumerate() {\n    number = if it.has(\"number\") { it.number } else { number }\n    if en.reversed { number = start - i }\n    let parents = state(\"enum-parents\", ())\n    let indent = context h((parents.get().len() + 1) * en.indent)\n    let num = if en.full {\n      context numbering(en.numbering, ..parents.get(), number)\n    } else {\n      numbering(en.numbering, number)\n    }\n    let max-num = if en.full {\n      context numbering(en.numbering, ..parents.get(), en.children.len())\n    } else {\n      numbering(en.numbering, en.children.len())\n    }\n    num = context box(width: measure(max-num).width, align(right, text(\n      overhang: false,\n      num,\n    )))\n    let body = {\n      parents.update(arr =&gt; arr + (number,))\n      it.body\n      linebreak()\n      parents.update(arr =&gt; arr.slice(0, -1))\n    }\n    if not en.reversed { number += 1 }\n    context {\n      num\n      h(en.body-indent)\n      body\n    }\n  }\n}\n</code></pre>\n<p>So then I can write:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">+ What is the primary purpose of machine learning according to the text?\n  + To replace human decision-making\n  + To analyze and extract useful information from large volumes of data\n  + To create complex computer networks\n  + To develop new storage technologies\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/8/81d2b4cc5e70899f51c574adcb67f97457fc5e4d.png\" alt=\"image\" data-base62-sha1=\"iwt1Qi4NEZbUvqzEKw4NIzu3rwV\" width=\"417\" height=\"100\"></p>\n<p>But it’s 100% way too much for a simple <code>show enum.where(level: 1): pad.with(left: ...)</code>.</p>\n<p>I was able to strip it from stuff that I don’t use:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show enum: en =&gt; {\n  set par(spacing: 0.65em)\n  let parents = state(\"enum-parents\", ())\n  for (i, it) in en.children.enumerate() {\n    let number = i + 1\n    let max-num = context {\n      numbering(en.numbering, ..parents.get(), en.children.len())\n    }\n    let num = context {\n      let num = numbering(en.numbering, ..parents.get(), number)\n      num = align(right, text(overhang: false, num))\n      box(width: measure(max-num).width, num)\n    }\n    let body = {\n      parents.update(arr =&gt; arr + (number,))\n      it.body\n      linebreak()\n      parents.update(arr =&gt; arr.slice(0, -1))\n    }\n    context num + h(en.body-indent) + body\n  }\n}\n</code></pre>\n<p>But it is still a re-implementation of the full show rule, though not even a full implementation.</p>\n<p>I wonder if there is a magic one-liner for this, or maybe we really need to add <code>level</code> to <code>enum.where</code> or <code>enum.item.where</code> (for <code>show enum.where(level: 1): pad.with(left: ...)</code>), though the problem is that shifting only known from max numbering width + <code>body-indent</code>.</p>\n<p>I’ve also noticed that both levels are not aligned, not sure if it will look better if they are aligned. But it’s not critical.</p>",
      "raw": "I recently needed to copy this:\n\n![image|494x130](upload://fWZqlZk9R0RS9gERqSxja9YTERm.png)\n\nWhich is semantically a nested enum list, but definitely doesn't look nested. So I grabbed my par-like implementation mentioned in https://forum.typst.app/t/how-to-make-bullet-list-item-bodies-flow-like-paragraphs/3756/3, and massaged it a little and got this:\n\n```typ\n#set enum(full: true, numbering: (..n) => {\n  numbering((\"1.\", \"A.\").at(n.pos().len() - 1), n.pos().last())\n})\n\n#show enum: en => {\n  set par(spacing: 0.65em)\n  let start = if en.start == auto {\n    if en.children.first().has(\"number\") {\n      if en.reversed { en.children.first().number } else { 1 }\n    } else {\n      if en.reversed { en.children.len() } else { 1 }\n    }\n  } else {\n    en.start\n  }\n  let number = start\n  for (i, it) in en.children.enumerate() {\n    number = if it.has(\"number\") { it.number } else { number }\n    if en.reversed { number = start - i }\n    let parents = state(\"enum-parents\", ())\n    let indent = context h((parents.get().len() + 1) * en.indent)\n    let num = if en.full {\n      context numbering(en.numbering, ..parents.get(), number)\n    } else {\n      numbering(en.numbering, number)\n    }\n    let max-num = if en.full {\n      context numbering(en.numbering, ..parents.get(), en.children.len())\n    } else {\n      numbering(en.numbering, en.children.len())\n    }\n    num = context box(width: measure(max-num).width, align(right, text(\n      overhang: false,\n      num,\n    )))\n    let body = {\n      parents.update(arr => arr + (number,))\n      it.body\n      linebreak()\n      parents.update(arr => arr.slice(0, -1))\n    }\n    if not en.reversed { number += 1 }\n    context {\n      num\n      h(en.body-indent)\n      body\n    }\n  }\n}\n```\n\nSo then I can write:\n\n```typ\n+ What is the primary purpose of machine learning according to the text?\n  + To replace human decision-making\n  + To analyze and extract useful information from large volumes of data\n  + To create complex computer networks\n  + To develop new storage technologies\n```\n\n![image|417x100](upload://iwt1Qi4NEZbUvqzEKw4NIzu3rwV.png)\n\nBut it's 100% way too much for a simple `show enum.where(level: 1): pad.with(left: ...)`.\n\nI was able to strip it from stuff that I don't use:\n\n```typ\n#show enum: en => {\n  set par(spacing: 0.65em)\n  let parents = state(\"enum-parents\", ())\n  for (i, it) in en.children.enumerate() {\n    let number = i + 1\n    let max-num = context {\n      numbering(en.numbering, ..parents.get(), en.children.len())\n    }\n    let num = context {\n      let num = numbering(en.numbering, ..parents.get(), number)\n      num = align(right, text(overhang: false, num))\n      box(width: measure(max-num).width, num)\n    }\n    let body = {\n      parents.update(arr => arr + (number,))\n      it.body\n      linebreak()\n      parents.update(arr => arr.slice(0, -1))\n    }\n    context num + h(en.body-indent) + body\n  }\n}\n```\n\nBut it is still a re-implementation of the full show rule, though not even a full implementation.\n\nI wonder if there is a magic one-liner for this, or maybe we really need to add `level` to `enum.where` or `enum.item.where` (for `show enum.where(level: 1): pad.with(left: ...)`), though the problem is that shifting only known from max numbering width + `body-indent`.\n\nI've also noticed that both levels are not aligned, not sure if it will look better if they are aligned. But it's not critical.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 29,
      "score": 45.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11872,
      "post_number": 2,
      "username": "aarnent",
      "name": "",
      "created_at": "2025-05-01T20:48:08.262Z",
      "updated_at": "2025-05-01T20:48:08.262Z",
      "cooked": "<p>Am I missing something obvious? Why not just do</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#set enum(indent: -1.2em)\n</code></pre>",
      "raw": "Am I missing something obvious? Why not just do\n\n```typst\n#set enum(indent: -1.2em)\n```",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 28,
      "score": 10.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 501
    },
    {
      "id": 11874,
      "post_number": 3,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-05-01T21:08:43.514Z",
      "updated_at": "2025-05-01T22:17:17.244Z",
      "cooked": "<p>If we accept the indent, maybe it can be done like this, with measure to always get the right size. It seems to produce the right spacing - it seems to be correct, but I’m not sure if it always is.</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#import \"@preview/numbly:0.1.0\": numbly\n#set enum(full: true, numbering: numbly(\n  \"{1:1}.\",\n  \"{2:A}.\",\n))\n\n#show enum: it =&gt; {\n  context {\n    let size = measure((it.numbering)(1))\n    set enum(indent: -size.width - it.body-indent)\n    it\n  }\n}\n\n+ What is the primary purpose of machine learning according to the text?\n  + To replace human decision-making\n  + To analyze and extract useful information from large volumes of data\n  + To create complex computer networks\n  + To develop new storage technologies\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/d/dd89dca71d3ebee10aeb076a1b76b4049df0bfa1.png\" alt=\"bild\" data-base62-sha1=\"vBOT6tsluZ9X4fQ8oHW7UoCLNqF\" width=\"425\" height=\"96\"></p>\n<p>(<s>And also - the question if it’s a bug when that <code>set enum</code> thing works - that came up recently</s>)</p>",
      "raw": "If we accept the indent, maybe it can be done like this, with measure to always get the right size. It seems to produce the right spacing - it seems to be correct, but I'm not sure if it always is.\n\n```typst\n#import \"@preview/numbly:0.1.0\": numbly\n#set enum(full: true, numbering: numbly(\n  \"{1:1}.\",\n  \"{2:A}.\",\n))\n\n#show enum: it => {\n  context {\n    let size = measure((it.numbering)(1))\n    set enum(indent: -size.width - it.body-indent)\n    it\n  }\n}\n\n+ What is the primary purpose of machine learning according to the text?\n  + To replace human decision-making\n  + To analyze and extract useful information from large volumes of data\n  + To create complex computer networks\n  + To develop new storage technologies\n```\n\n![bild|425x96](upload://vBOT6tsluZ9X4fQ8oHW7UoCLNqF.png)\n\n(~~And also - the question if it's a bug when that `set enum` thing works - that came up recently~~)",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 29,
      "score": 30.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11878,
      "post_number": 4,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-01T21:51:05.279Z",
      "updated_at": "2025-05-01T21:51:05.279Z",
      "cooked": "<p>Because it shifts the first level too. Also, I don’t see where <code>-1.2em</code> comes from.</p>",
      "raw": "Because it shifts the first level too. Also, I don't see where `-1.2em` comes from.",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 28,
      "score": 5.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11880,
      "post_number": 5,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-02T00:31:30.142Z",
      "updated_at": "2025-05-02T00:41:11.084Z",
      "cooked": "<p>Ohh, you are taking advantage of the fact that set rule can’t be applied to the outer enum, nice.</p>\n<details><summary>Although, if you apply a bunch of different numberings and more levels, then you will still have the shift appear.</summary>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/numbly:0.1.0\": numbly\n#set enum(full: true, numbering: numbly(\"{1:1}.\", \"{2:あ}.\", \"{3:A}.\", \"{4:A}.\"))\n#show enum: it =&gt; context {\n  let size = measure((it.numbering)(1))\n  set enum(indent: -size.width - it.body-indent)\n  it\n}\n\n#lorem(10)\n+ #lorem(10)\n  + #lorem(10)\n  + #lorem(10)\n  + #lorem(10)\n  + #lorem(10)\n    + #lorem(10)\n    + #lorem(10)\n    + #lorem(10)\n    + #lorem(10)\n    + #lorem(10)\n    + #lorem(10)\n      + #lorem(10)\n      + #lorem(10)\n      + #lorem(10)\n+ #lorem(10)\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/a/a77a9937d5a62c3ac23112d151508cd1ad448ae9.png\" alt=\"image\" data-base62-sha1=\"nTAp1ES2O3KPzsWJ2ER0Kwho8oF\" width=\"479\" height=\"360\"></p>\n</details>\n<p>So, the missing part is that you need to provide the “actual” numbers:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show enum: it =&gt; {\n  let c = state(\"enum level\", 1)\n  c.update(n =&gt; n + 1)\n  context {\n    // For level 2+.\n    let size = measure((it.numbering)(..range(c.get()).map(_ =&gt; 1)))\n    set enum(indent: -size.width - it.body-indent)\n    it\n  }\n  c.update(n =&gt; n - 1)\n}\n</code></pre>\n<details><summary>Output</summary>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/1/1f275f0eece89c19d2bd7e07bd7ea8dc8963ffd5.png\" alt=\"image\" data-base62-sha1=\"4rB9yWnqrIKD3d5uDh7ujdPZgpv\" width=\"465\" height=\"360\"></p>\n</details>\n<p>And even <em>then</em> you have some issues left. The obvious one is that this ignores margins that are supposed to be unreachable. But this feels like something that you have to choose on a case by case situation: is perfect vertical alignment is more important than going over the page margins.</p>\n<details><summary>This can be fixed by replacing 1 with 0.</summary>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/numbly:0.1.0\": numbly\n#set enum(full: true, numbering: numbly(\"{1:1}.\", \"{2:A}.\"))\n#show enum: it =&gt; {\n  let c = state(\"enum level\", 0)\n  c.update(n =&gt; n + 1)\n  context {\n    // For level 2+.\n    let size = measure((it.numbering)(..range(c.get()).map(_ =&gt; 1)))\n    set enum(indent: -size.width - it.body-indent)\n    it\n  }\n  c.update(n =&gt; n - 1)\n}\n\n#lorem(10)\n+ #lorem(10)\n  + #lorem(10)\n  + #lorem(10)\n    + #lorem(10)\n    + #lorem(10)\n+ #lorem(10)\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/2/2a418fc6b4c89f0532744df136fc6cc5a9b94555.png\" alt=\"image\" data-base62-sha1=\"61OwaD1IjWcmtb6DnhoQr9QobNH\" width=\"485\" height=\"152\"></p>\n</details>\n<p>The other problem is that it’s not the <em>actual actual</em> numbers (<a href=\"https://github.com/typst/typst/issues/6230\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Get final counter value for a specific \"parent\" counter state · Issue #6230 · typst/typst · GitHub</a>):</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set enum(full: true, numbering: numbly(\"{1:1}.\", \"{2:あ}.\", \"{3:A}.\", \"{4:I}.\"))\n</code></pre>\n<details><summary>Output</summary>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/d/d127c4995656950a96d20f34668c07d88f52fc3b.png\" alt=\"image\" data-base62-sha1=\"tQgZC9g9pCO3HGFsO1QLEjsXfgn\" width=\"483\" height=\"366\"></p>\n</details>\n<p>If <a href=\"https://github.com/typst/typst/issues/6230\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Get final counter value for a specific \"parent\" counter state · Issue #6230 · typst/typst · GitHub</a> was a thing, then the reimplementation can be skipped, while effectively still having access to the enum numbers, though <code>reverse</code> and <code>start</code> should also be considered:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let el = state(\"enum level\", 1)\n#let ec = counter(\"enum counter\")\n#show enum.item: it =&gt; context ec.step(level: el.get()) + it\n#show enum: it =&gt; {\n  el.update(n =&gt; n + 1)\n  context {\n    // For level 2+.\n    let final = ec.final(for: ec.get().slice(0, -1))\n    let size = measure((it.numbering)(..final))\n    set enum(indent: -size.width - it.body-indent)\n    it\n  }\n  el.update(n =&gt; n - 1)\n}\n</code></pre>\n<p>Although, if first and final display counter is not the widest, then you would have to use <code>calc.max(..range(final.last()).map(measure...))</code>.</p>\n<p>I’m not yet sure if it will be implemented, so without it, my initial solution looks like the only proper way. And this one gets bigger and bigger, so sacrificing a little bit of lines for a less robust solution is questionable. But a 10-line solution is perfect for where thinnest and widest numbering are very close in width (which is most of common ones).</p>\n<p>For 2 levels, it can be stripped down to your solution + <code>, 1</code>:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show enum: it =&gt; context {\n  let size = measure((it.numbering)(1, 1))\n  set enum(indent: -size.width - it.body-indent)\n  it\n}\n</code></pre>\n<p>But again, this can go over page margins. Ideally, I think, a solution would move all levels to the same point, so that they are vertically aligned, but don’t go over margin. And this… will probably require doing the full implementation all over again.</p>",
      "raw": "Ohh, you are taking advantage of the fact that set rule can't be applied to the outer enum, nice.\n\n<details><summary>Although, if you apply a bunch of different numberings and more levels, then you will still have the shift appear.</summary>\n\n```typ\n#import \"@preview/numbly:0.1.0\": numbly\n#set enum(full: true, numbering: numbly(\"{1:1}.\", \"{2:あ}.\", \"{3:A}.\", \"{4:A}.\"))\n#show enum: it => context {\n  let size = measure((it.numbering)(1))\n  set enum(indent: -size.width - it.body-indent)\n  it\n}\n\n#lorem(10)\n+ #lorem(10)\n  + #lorem(10)\n  + #lorem(10)\n  + #lorem(10)\n  + #lorem(10)\n    + #lorem(10)\n    + #lorem(10)\n    + #lorem(10)\n    + #lorem(10)\n    + #lorem(10)\n    + #lorem(10)\n      + #lorem(10)\n      + #lorem(10)\n      + #lorem(10)\n+ #lorem(10)\n```\n\n![image|639x481, 75%](upload://nTAp1ES2O3KPzsWJ2ER0Kwho8oF.png)\n\n</details>\n\nSo, the missing part is that you need to provide the \"actual\" numbers:\n\n```typ\n#show enum: it => {\n  let c = state(\"enum level\", 1)\n  c.update(n => n + 1)\n  context {\n    // For level 2+.\n    let size = measure((it.numbering)(..range(c.get()).map(_ => 1)))\n    set enum(indent: -size.width - it.body-indent)\n    it\n  }\n  c.update(n => n - 1)\n}\n```\n\n<details><summary>Output</summary>\n\n![image|621x480, 75%](upload://4rB9yWnqrIKD3d5uDh7ujdPZgpv.png)\n\n</details>\n\nAnd even _then_ you have some issues left. The obvious one is that this ignores margins that are supposed to be unreachable. But this feels like something that you have to choose on a case by case situation: is perfect vertical alignment is more important than going over the page margins.\n\n<details><summary>This can be fixed by replacing 1 with 0.</summary>\n\n```typ\n#import \"@preview/numbly:0.1.0\": numbly\n#set enum(full: true, numbering: numbly(\"{1:1}.\", \"{2:A}.\"))\n#show enum: it => {\n  let c = state(\"enum level\", 0)\n  c.update(n => n + 1)\n  context {\n    // For level 2+.\n    let size = measure((it.numbering)(..range(c.get()).map(_ => 1)))\n    set enum(indent: -size.width - it.body-indent)\n    it\n  }\n  c.update(n => n - 1)\n}\n\n#lorem(10)\n+ #lorem(10)\n  + #lorem(10)\n  + #lorem(10)\n    + #lorem(10)\n    + #lorem(10)\n+ #lorem(10)\n```\n\n![image|647x203, 75%](upload://61OwaD1IjWcmtb6DnhoQr9QobNH.png)\n\n</details>\n\n\nThe other problem is that it's not the *actual actual* numbers (https://github.com/typst/typst/issues/6230):\n\n```typ\n#set enum(full: true, numbering: numbly(\"{1:1}.\", \"{2:あ}.\", \"{3:A}.\", \"{4:I}.\"))\n```\n\n<details><summary>Output</summary>\n\n![image|644x488, 75%](upload://tQgZC9g9pCO3HGFsO1QLEjsXfgn.png)\n\n</details>\n\nIf https://github.com/typst/typst/issues/6230 was a thing, then the reimplementation can be skipped, while effectively still having access to the enum numbers, though `reverse` and `start` should also be considered:\n\n```typ\n#let el = state(\"enum level\", 1)\n#let ec = counter(\"enum counter\")\n#show enum.item: it => context ec.step(level: el.get()) + it\n#show enum: it => {\n  el.update(n => n + 1)\n  context {\n    // For level 2+.\n    let final = ec.final(for: ec.get().slice(0, -1))\n    let size = measure((it.numbering)(..final))\n    set enum(indent: -size.width - it.body-indent)\n    it\n  }\n  el.update(n => n - 1)\n}\n```\n\nAlthough, if first and final display counter is not the widest, then you would have to use `calc.max(..range(final.last()).map(measure...))`.\n\nI'm not yet sure if it will be implemented, so without it, my initial solution looks like the only proper way. And this one gets bigger and bigger, so sacrificing a little bit of lines for a less robust solution is questionable. But a 10-line solution is perfect for where thinnest and widest numbering are very close in width (which is most of common ones).\n\nFor 2 levels, it can be stripped down to your solution + `, 1`:\n\n```typ\n#show enum: it => context {\n  let size = measure((it.numbering)(1, 1))\n  set enum(indent: -size.width - it.body-indent)\n  it\n}\n```\n\nBut again, this can go over page margins. Ideally, I think, a solution would move all levels to the same point, so that they are vertically aligned, but don't go over margin. And this... will probably require doing the full implementation all over again.",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 28,
      "score": 55.6,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:48:25.195879"
}
{
  "topic_metadata": {
    "id": 3902,
    "title": "How to typeset direct and inverse limits and control how subscripts are attached?",
    "slug": "how-to-typeset-direct-and-inverse-limits-and-control-how-subscripts-are-attached",
    "posts_count": 2,
    "created_at": "2025-05-02T07:47:26.743Z",
    "last_posted_at": "2025-05-02T08:17:46.903Z",
    "views": 42,
    "like_count": 1,
    "reply_count": 0,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "bluss",
    "tags": [
      "math"
    ],
    "category_id": 5,
    "participant_count": 2,
    "word_count": 147
  },
  "posts": [
    {
      "id": 11884,
      "post_number": 1,
      "username": "AprilGrimoire",
      "name": "AprilGrimoire",
      "created_at": "2025-05-02T07:47:26.904Z",
      "updated_at": "2025-05-02T08:44:47.949Z",
      "cooked": "<p>Hello!</p>\n<p>I want to typeset direct and inverse limits, as shown in the following image:</p>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/7/757dc3341987e818b400e2e4517a005de327c440.png\" alt=\"image\" data-base62-sha1=\"gLnj9JU6uhEVgxRFXsczl17PoPe\" width=\"254\" height=\"68\"></p>\n<p>I also want to know how can I control the way subscripts are attached. Normally subscripts are attached to the bottom-right, but this behavior is changed for some special symbols like <code>lim</code> and such. How can I mimic this behavior on custom symbols?</p>",
      "raw": "Hello!\n\nI want to typeset direct and inverse limits, as shown in the following image:\n\n![image|254x68](upload://gLnj9JU6uhEVgxRFXsczl17PoPe.png)\n\nI also want to know how can I control the way subscripts are attached. Normally subscripts are attached to the bottom-right, but this behavior is changed for some special symbols like `lim` and such. How can I mimic this behavior on custom symbols?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 59.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1309
    },
    {
      "id": 11886,
      "post_number": 2,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-05-02T08:17:46.903Z",
      "updated_at": "2025-05-02T08:18:20.548Z",
      "cooked": "<p>Use <code>math.op</code> to define things the same way predefined <code>lim</code> and <code>sin</code> for example are defined. It takes an argument to set limits.</p>\n<p>Also note that you can force it directly using the <code>limits</code> function (<code>scripts</code> is the opposite). And in inline equations even <code>lim</code> has subscripts instead of limits, but it can be forced with <code>limits</code> again as shown below…</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let opA = math.op(\"opA\", limits: true)\n$ opA_x $\n$ limits(\"opB\")_x $\n\n$lim_x$\n$limits(lim)_x$\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/5/5367a51a34e70838954e7cd7499ac817b40b0f76.png\" alt=\"bild\" data-base62-sha1=\"bTPGFMkdRG2VQMkOQ8nyQWc6xDM\" width=\"158\" height=\"188\"></p>",
      "raw": "Use `math.op` to define things the same way predefined `lim` and `sin` for example are defined. It takes an argument to set limits.\n\nAlso note that you can force it directly using the `limits` function (`scripts` is the opposite). And in inline equations even `lim` has subscripts instead of limits, but it can be forced with `limits` again as shown below..\n\n```typst\n#let opA = math.op(\"opA\", limits: true)\n$ opA_x $\n$ limits(\"opB\")_x $\n\n$lim_x$\n$limits(lim)_x$\n```\n\n\n\n![bild|158x188](upload://bTPGFMkdRG2VQMkOQ8nyQWc6xDM.png)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 21,
      "score": 19.2,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 1272
    }
  ],
  "scraped_at": "2025-06-10T09:48:24.469608"
}
{
  "topic_metadata": {
    "id": 3903,
    "title": "Why are line breaks suppressed in content blocks inside aligned equations?",
    "slug": "why-are-line-breaks-suppressed-in-content-blocks-inside-aligned-equations",
    "posts_count": 3,
    "created_at": "2025-05-02T07:58:15.473Z",
    "last_posted_at": "2025-05-05T22:38:49.731Z",
    "views": 72,
    "like_count": 2,
    "reply_count": 0,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Andrew",
    "tags": [
      "layout",
      "math"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 422
  },
  "posts": [
    {
      "id": 11885,
      "post_number": 1,
      "username": "AprilGrimoire",
      "name": "AprilGrimoire",
      "created_at": "2025-05-02T07:58:15.642Z",
      "updated_at": "2025-05-13T16:56:21.814Z",
      "cooked": "<p>Hi. I want to add some comments to a multi-line calculation:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">$\n  &amp;1 + 1 \\\n\n  =&amp;2 \\\n  &amp; #[\n      Hello \\\n  \n      World\n    ]\n$\n</code></pre>\n<p>I expected that the contents inside <code>#[]</code> would be treated as a block. However, line-breaks inside <code>#[]</code> are suppressed, and if I manually force a line-break with <code>\\</code>, it breaks the alignment.</p>\n<p>Why? Thank you.</p>",
      "raw": "Hi. I want to add some comments to a multi-line calculation:\n\n```typ\n$\n  &1 + 1 \\\n\n  =&2 \\\n  & #[\n      Hello \\\n  \n      World\n    ]\n$\n```\n\nI expected that the contents inside `#[]` would be treated as a block. However, line-breaks inside `#[]` are suppressed, and if I manually force a line-break with `\\`, it breaks the alignment.\n\nWhy? Thank you.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 24,
      "score": 34.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1309
    },
    {
      "id": 11906,
      "post_number": 2,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-02T20:37:08.076Z",
      "updated_at": "2025-05-02T20:37:08.076Z",
      "cooked": "<p>Hi. When you write a code block, you should use the appropriate language identifier to get correct syntax highlighting.</p>\n<aside class=\"quote no-group quote-modified\" data-username=\"reknih\" data-post=\"1\" data-topic=\"11\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/reknih/48/3_2.png\" class=\"avatar\"><a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11/1\">How to post in the Questions category</a></div>\n<blockquote>\n<p>If your question pertains to a bit of Typst markup you have problems with, put it in the question body! You can syntax-highlight Typst code by wrapping it in ` ```typ … ````. It will then look like this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set font(size: 12pt)\n\nHello from *Typst* at $ pi.var + 1 $ o'clock!\n</code></pre>\n<p>If you need to highlight a code or math mode snippet instead, the language tags <code>typc</code> and <code>typm</code> do that, respectively.</p>\n<p>It would be great if you could post the <strong>smallest possible code samples</strong> that allow people to see what your problem is.</p>\n</blockquote>\n</aside>\n<hr>\n<p>You can use <a href=\"https://typst.app/docs/reference/layout/place/\"><code>place()</code></a> to insert a block that will not interfere with anything:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#lorem(10)\n$\n    &amp; 1 + 1   \\\n  = &amp; 2       \\\n    &amp; #place[\n        Hello\n\n        World\n      ]\n$\n#lorem(10)\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/1/1f7c67202ce04b535758ebaf4460528ac5f9e395.png\" alt=\"image\" data-base62-sha1=\"4uxkFHeQISdOkjKPGWkxaVRwyMZ\" width=\"400\" height=\"117\"></p>\n<p>But if there is text below, then it will overlap it, so instead you can try using <code>block</code>:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#lorem(10)\n$\n    &amp; 1 + 1   \\\n  = &amp; 2       \\\n    &amp; #align(start, block[\n        Hello \\\n        World\n      ])\n$\n#lorem(10)\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/1/1d2fc3041bb765ead457bcb0678ed8bca742f532.png\" alt=\"image\" data-base62-sha1=\"4acaTJ9OyjGAhS6D3623Akx5xUS\" width=\"380\" height=\"143\"></p>\n<p>For easier use:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#lorem(10)\n#let in-math(body) = align(start, block(body))\n$\n    &amp; 1 + 1   \\\n  = &amp; 2       \\\n    &amp; #in-math[\n        Hello \\\n        World\n      ]\n$\n#lorem(10)\n</code></pre>\n<aside class=\"quote no-group\" data-username=\"AprilGrimoire\" data-post=\"1\" data-topic=\"3903\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/aprilgrimoire/48/2108_2.png\" class=\"avatar\"> AprilGrimoire:</div>\n<blockquote>\n<p>I expected that the contents inside <code>#[]</code> would be treated as a block.</p>\n</blockquote>\n</aside>\n<p>You are just entering code mode and then markup mode, since you can add this inline, it is like <code>box</code>, but not actually a box, nor it’s a block. It will add inner content directly, so how it will be laid out is up to the compiler.</p>",
      "raw": "Hi. When you write a code block, you should use the appropriate language identifier to get correct syntax highlighting.\n\n[quote=\"reknih, post:1, topic:11\"]\nIf your question pertains to a bit of Typst markup you have problems with, put it in the question body! You can syntax-highlight Typst code by wrapping it in ` ```typ ... ````. It will then look like this:\n\n```typ\n#set font(size: 12pt)\n\nHello from *Typst* at $ pi.var + 1 $ o'clock!\n```\n\nIf you need to highlight a code or math mode snippet instead, the language tags `typc` and `typm` do that, respectively.\n\nIt would be great if you could post the **smallest possible code samples** that allow people to see what your problem is.\n[/quote]\n\n---\n\nYou can use [`place()`](https://typst.app/docs/reference/layout/place/) to insert a block that will not interfere with anything:\n\n```typ\n#lorem(10)\n$\n    & 1 + 1   \\\n  = & 2       \\\n    & #place[\n        Hello\n\n        World\n      ]\n$\n#lorem(10)\n```\n\n![image|400x117](upload://4uxkFHeQISdOkjKPGWkxaVRwyMZ.png)\n\nBut if there is text below, then it will overlap it, so instead you can try using `block`:\n\n```typ\n#lorem(10)\n$\n    & 1 + 1   \\\n  = & 2       \\\n    & #align(start, block[\n        Hello \\\n        World\n      ])\n$\n#lorem(10)\n```\n\n![image|380x143](upload://4acaTJ9OyjGAhS6D3623Akx5xUS.png)\n\nFor easier use:\n\n```typ\n#lorem(10)\n#let in-math(body) = align(start, block(body))\n$\n    & 1 + 1   \\\n  = & 2       \\\n    & #in-math[\n        Hello \\\n        World\n      ]\n$\n#lorem(10)\n```\n\n[quote=\"AprilGrimoire, post:1, topic:3903\"]\nI expected that the contents inside `#[]` would be treated as a block.\n[/quote]\n\nYou are just entering code mode and then markup mode, since you can add this inline, it is like `box`, but not actually a box, nor it's a block. It will add inner content directly, so how it will be laid out is up to the compiler.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 1,
      "reads": 21,
      "score": 19.2,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 12010,
      "post_number": 3,
      "username": "PgBiel",
      "name": "",
      "created_at": "2025-05-05T22:38:49.731Z",
      "updated_at": "2025-05-05T22:39:41.122Z",
      "cooked": "<p>Hey <a class=\"mention\" href=\"/u/aprilgrimoire\">@AprilGrimoire</a>, welcome to the forum! I’ve changed your question post’s title to better fit our guidelines: <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\" class=\"inline-onebox\">How to post in the Questions category</a></p>\n<p>Make sure your title is a question you’d ask to a friend about Typst. (Note how the title is much clearer now!) <img src=\"https://forum.typst.app/images/emoji/apple/wink.png?v=12\" title=\":wink:\" class=\"emoji\" alt=\":wink:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<p>Also, make sure to mark Andrew’s answer as a solution with the <img src=\"https://forum.typst.app/images/emoji/apple/white_check_mark.png?v=12\" title=\":white_check_mark:\" class=\"emoji\" alt=\":white_check_mark:\" loading=\"lazy\" width=\"20\" height=\"20\"> button if it has solved your problem. Otherwise, let us know what you still need help with.</p>",
      "raw": "Hey @AprilGrimoire, welcome to the forum! I’ve changed your question post’s title to better fit our guidelines: https://forum.typst.app/t/how-to-post-in-the-questions-category/11\n\nMake sure your title is a question you’d ask to a friend about Typst. (Note how the title is much clearer now!) :wink:\n\nAlso, make sure to mark Andrew's answer as a solution with the :white_check_mark: button if it has solved your problem. Otherwise, let us know what you still need help with.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 14,
      "score": 17.8,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    }
  ],
  "scraped_at": "2025-06-10T09:48:23.745936"
}
{
  "topic_metadata": {
    "id": 3904,
    "title": "Which show rule takes precedence?",
    "slug": "which-show-rule-takes-precedence",
    "posts_count": 14,
    "created_at": "2025-05-02T08:35:07.559Z",
    "last_posted_at": "2025-05-09T14:00:06.330Z",
    "views": 196,
    "like_count": 17,
    "reply_count": 9,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 5,
    "accepted_answer_username": "sijo",
    "tags": [
      "scripting",
      "styling"
    ],
    "category_id": 5,
    "participant_count": 6,
    "word_count": 1627
  },
  "posts": [
    {
      "id": 11887,
      "post_number": 1,
      "username": "Y.D.X",
      "name": "Y.D.X.",
      "created_at": "2025-05-02T08:35:07.665Z",
      "updated_at": "2025-05-02T08:35:07.665Z",
      "cooked": "<p>I am applying show rules after another show rule. I thought all headings would be green according to the second rule.<br>\nHowever, headings after the show-function rule are not. Why?</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#[\n  #show heading: it =&gt; { set text(purple); it }\n  #[\n    #show heading: set text(green)  \n    = purple\n  ]\n  #[\n    #show heading: it =&gt; { set text(green); it }\n    = purple\n  ]\n]\n#[\n  #show heading: set text(purple)\n  #[\n    #show heading: set text(green)  \n    = green\n  ]\n  #[\n    #show heading: it =&gt; { set text(green); it }\n    = green\n  ]\n]\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/2/2894e66f20b3b64f3e0ea8bf59d5d51afeda72d3.png\" data-download-href=\"https://forum.typst.app/uploads/default/2894e66f20b3b64f3e0ea8bf59d5d51afeda72d3\" title=\"图片\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/2/2894e66f20b3b64f3e0ea8bf59d5d51afeda72d3_2_690x305.png\" alt=\"图片\" data-base62-sha1=\"5N07brVl9GEb27vyV40ZGtWTVM7\" width=\"690\" height=\"305\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/2/2894e66f20b3b64f3e0ea8bf59d5d51afeda72d3_2_690x305.png, https://forum.typst.app/uploads/default/optimized/2X/2/2894e66f20b3b64f3e0ea8bf59d5d51afeda72d3_2_1035x457.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/2/2894e66f20b3b64f3e0ea8bf59d5d51afeda72d3_2_1380x610.png 2x\" data-dominant-color=\"F3F2F4\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">图片</span><span class=\"informations\">1505×666 121 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<h2><a name=\"p-11887-my-attempt-1\" class=\"anchor\" href=\"#p-11887-my-attempt-1\"></a>My attempt</h2>\n<p>I can confirm that the selectors do match the heading, because replacing <code>it</code> with <code>it.body</code> will work. (except that the numbering and spaces are lost.)</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/0/08277496e20b5ec2605b7b6735eea087685cd6a3.png\" data-download-href=\"https://forum.typst.app/uploads/default/08277496e20b5ec2605b7b6735eea087685cd6a3\" title=\"图片\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/0/08277496e20b5ec2605b7b6735eea087685cd6a3_2_690x270.png\" alt=\"图片\" data-base62-sha1=\"1a8lRuOEreHYCSd2VXr60bx6D2b\" width=\"690\" height=\"270\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/0/08277496e20b5ec2605b7b6735eea087685cd6a3_2_690x270.png, https://forum.typst.app/uploads/default/optimized/2X/0/08277496e20b5ec2605b7b6735eea087685cd6a3_2_1035x405.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/0/08277496e20b5ec2605b7b6735eea087685cd6a3_2_1380x540.png 2x\" data-dominant-color=\"F2F2F4\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">图片</span><span class=\"informations\">1563×613 109 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>In addition, if I inspect by <code>repr</code>, they will turn green.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/6/662a3918003ddb559db4bd9572a5d68f24663cf1.png\" data-download-href=\"https://forum.typst.app/uploads/default/662a3918003ddb559db4bd9572a5d68f24663cf1\" title=\"图片\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/6/662a3918003ddb559db4bd9572a5d68f24663cf1_2_690x345.png\" alt=\"图片\" data-base62-sha1=\"ezNabVKEAlyDdmsP4kzOQmprUWd\" width=\"690\" height=\"345\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/6/662a3918003ddb559db4bd9572a5d68f24663cf1_2_690x345.png, https://forum.typst.app/uploads/default/optimized/2X/6/662a3918003ddb559db4bd9572a5d68f24663cf1_2_1035x517.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/6/662a3918003ddb559db4bd9572a5d68f24663cf1_2_1380x690.png 2x\" data-dominant-color=\"F1F3F3\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">图片</span><span class=\"informations\">1513×758 199 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<h2><a name=\"p-11887-further-information-2\" class=\"anchor\" href=\"#p-11887-further-information-2\"></a>Further information</h2>\n<p>Background: <a href=\"https://github.com/Ri-Nai/BIT-Typst-Template/issues/11\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">minor revision on page layout · Issue #11 · Ri-Nai/BIT-Typst-Template · GitHub</a> (in Chinese)</p>",
      "raw": "I am applying show rules after another show rule. I thought all headings would be green according to the second rule.\nHowever, headings after the show-function rule are not. Why?\n\n```typst\n#[\n  #show heading: it => { set text(purple); it }\n  #[\n    #show heading: set text(green)  \n    = purple\n  ]\n  #[\n    #show heading: it => { set text(green); it }\n    = purple\n  ]\n]\n#[\n  #show heading: set text(purple)\n  #[\n    #show heading: set text(green)  \n    = green\n  ]\n  #[\n    #show heading: it => { set text(green); it }\n    = green\n  ]\n]\n```\n\n![图片|690x305](upload://5N07brVl9GEb27vyV40ZGtWTVM7.png)\n\n## My attempt\n\nI can confirm that the selectors do match the heading, because replacing `it` with `it.body` will work. (except that the numbering and spaces are lost.)\n\n![图片|690x270](upload://1a8lRuOEreHYCSd2VXr60bx6D2b.png)\n\n\nIn addition, if I inspect by `repr`, they will turn green.\n\n![图片|690x345](upload://ezNabVKEAlyDdmsP4kzOQmprUWd.png)\n\n\n## Further information\n\nBackground: https://github.com/Ri-Nai/BIT-Typst-Template/issues/11 (in Chinese)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 47,
      "score": 239.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 292
    },
    {
      "id": 11888,
      "post_number": 2,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-05-02T08:49:11.171Z",
      "updated_at": "2025-05-02T08:55:18.874Z",
      "cooked": "<p>Which “order” do the show rules apply? We can try with this example:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#show heading: it =&gt; { set text(green); [A(] + box(it) + [)a] }\n#show heading: it =&gt; { set text(red); [B(] + box(it) + [)b] }\n#show heading: it =&gt; { set text(blue); [C(] + box(it) + [)c] }\n\n= My Heading\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/d/ded138f1caab43e61468622b8f859dab05679e91.png\" alt=\"bild\" data-base62-sha1=\"vN8fPWCja2lE9Kf7OTdhcHW7iw1\" width=\"314\" height=\"45\"></p>\n<p>The rule A is first in the source and is closest to the heading in the produced document.</p>\n<hr>\n<p>But rule C is applied first, which we can confirm like this, if we use <code>it.body</code> there, it stops:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#show heading: it =&gt; { set text(green); [A(] + box(it) + [)a] }\n#show heading: it =&gt; { set text(red); [B(] + box(it) + [)b] }\n#show heading: it =&gt; { set text(blue); [C(] + box(it.body) + [)c] }\n\n= My Heading\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/2/2fc56dc27eeef654782a34bb383e8713c1bef91b.png\" alt=\"bild\" data-base62-sha1=\"6OBqFTPASt8fF7bgy1J5fcI0PnZ\" width=\"215\" height=\"39\"></p>\n<hr>\n<p>So the conclusion is that the rules are applied with C first, then B, then A. But they are applied with nesting</p>\n<ul>\n<li>Apply C, which produces style and a heading</li>\n<li>Apply B style to the heading inside what C produced</li>\n<li>Apply A style to the heading inside what B produced</li>\n</ul>\n<p>So this is an <em>unfortunate</em> or <em>interesting</em> thing with <em>show rules with functions</em>, they sort of apply inside out. The rule that runs last places its <code>set</code> directives closest to the actual heading.</p>",
      "raw": "Which \"order\" do the show rules apply? We can try with this example:\n\n```typst\n#show heading: it => { set text(green); [A(] + box(it) + [)a] }\n#show heading: it => { set text(red); [B(] + box(it) + [)b] }\n#show heading: it => { set text(blue); [C(] + box(it) + [)c] }\n\n= My Heading\n```\n\n![bild|314x45](upload://vN8fPWCja2lE9Kf7OTdhcHW7iw1.png)\n\nThe rule A is first in the source and is closest to the heading in the produced document.\n\n---\n\nBut rule C is applied first, which we can confirm like this, if we use `it.body` there, it stops:\n\n```typst\n#show heading: it => { set text(green); [A(] + box(it) + [)a] }\n#show heading: it => { set text(red); [B(] + box(it) + [)b] }\n#show heading: it => { set text(blue); [C(] + box(it.body) + [)c] }\n\n= My Heading\n```\n\n![bild|215x39](upload://6OBqFTPASt8fF7bgy1J5fcI0PnZ.png)\n\n---\n\nSo the conclusion is that the rules are applied with C first, then B, then A. But they are applied with nesting\n\n- Apply C, which produces style and a heading\n- Apply B style to the heading inside what C produced\n- Apply A style to the heading inside what B produced\n\nSo this is an *unfortunate* or *interesting* thing with *show rules with functions*, they sort of apply inside out. The rule that runs last places its `set` directives closest to the actual heading.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 3,
      "reads": 46,
      "score": 69.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11889,
      "post_number": 3,
      "username": "Y.D.X",
      "name": "Y.D.X.",
      "created_at": "2025-05-02T08:59:47.441Z",
      "updated_at": "2025-05-02T08:59:47.441Z",
      "cooked": "<p>Thanks! So show-function rules are applied to the content of <code>heading</code>s, rather than the whole <code>heading</code> elements?</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let a(it) = { set text(green); [A(] + box(it) + [)a] }\n#let b(it) = { set text(red); [B(] + box(it) + [)b] }\n#let c(it) = { set text(blue); [C(] + box(it) + [)c] }\n#let c-body(it) = { set text(blue); [C(] + box(it.body) + [)c] }\n\n#let example = [= example]\n\n#[\n  #show heading: a\n  #show heading: b\n  #show heading: c\n  #example\n]\n\n#c(b(a(example)))\n\n#[\n  #show heading: a\n  #show heading: b\n  #show heading: c-body\n  = heading\n]\n\n#c-body(b(a(example)))\n// 💥 Styled does not have field \"body\"\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/5/5a8e04e138879a4e2e66d58f73cafc0446a449ae.png\" data-download-href=\"https://forum.typst.app/uploads/default/5a8e04e138879a4e2e66d58f73cafc0446a449ae\" title=\"图片\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/5/5a8e04e138879a4e2e66d58f73cafc0446a449ae_2_690x338.png\" alt=\"图片\" data-base62-sha1=\"cV5fiBLM5XURQI1oHdMyiF0QC1o\" width=\"690\" height=\"338\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/5/5a8e04e138879a4e2e66d58f73cafc0446a449ae_2_690x338.png, https://forum.typst.app/uploads/default/optimized/2X/5/5a8e04e138879a4e2e66d58f73cafc0446a449ae_2_1035x507.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/5/5a8e04e138879a4e2e66d58f73cafc0446a449ae_2_1380x676.png 2x\" data-dominant-color=\"F0F1F3\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">图片</span><span class=\"informations\">1703×836 190 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "Thanks! So show-function rules are applied to the content of `heading`s, rather than the whole `heading` elements?\n\n```typst\n#let a(it) = { set text(green); [A(] + box(it) + [)a] }\n#let b(it) = { set text(red); [B(] + box(it) + [)b] }\n#let c(it) = { set text(blue); [C(] + box(it) + [)c] }\n#let c-body(it) = { set text(blue); [C(] + box(it.body) + [)c] }\n\n#let example = [= example]\n\n#[\n  #show heading: a\n  #show heading: b\n  #show heading: c\n  #example\n]\n\n#c(b(a(example)))\n\n#[\n  #show heading: a\n  #show heading: b\n  #show heading: c-body\n  = heading\n]\n\n#c-body(b(a(example)))\n// 💥 Styled does not have field \"body\"\n```\n\n![图片|690x338](upload://cV5fiBLM5XURQI1oHdMyiF0QC1o.png)",
      "reply_to_post_number": null,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 0,
      "reads": 42,
      "score": 23.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 292
    },
    {
      "id": 11891,
      "post_number": 4,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-05-02T09:13:18.379Z",
      "updated_at": "2025-05-02T09:13:18.379Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Y.D.X\" data-post=\"3\" data-topic=\"3904\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/y.d.x/48/252_2.png\" class=\"avatar\"> Y.D.X:</div>\n<blockquote>\n<p>So show-function rules are applied to the content of <code>heading</code>s, rather than the whole <code>heading</code> elements?</p>\n</blockquote>\n</aside>\n<p>It think it looks like it’s still applied to the heading elements, <code>it</code> is always the heading when the rules are applied. But the content that rule C produced around the heading is outside (wrapping) <code>it</code> when rule B is running.</p>",
      "raw": "[quote=\"Y.D.X, post:3, topic:3904\"]\nSo show-function rules are applied to the content of `heading`s, rather than the whole `heading` elements?\n[/quote]\n\nIt think it looks like it's still applied to the heading elements, `it` is always the heading when the rules are applied. But the content that rule C produced around the heading is outside (wrapping) `it` when rule B is running.",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 1,
      "reads": 41,
      "score": 33.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11892,
      "post_number": 5,
      "username": "sijo",
      "name": "",
      "created_at": "2025-05-02T09:26:51.340Z",
      "updated_at": "2025-05-03T07:57:37.159Z",
      "cooked": "<p>Here is how rules are applied for a particular element according to my understanding (copy-pasted from <a href=\"https://forum.typst.app/t/how-can-i-modify-the-reference-format-of-equations/1118/8\">another</a> thread but it better belongs here I guess):</p>\n<ol>\n<li>\n<p>All applicable show-set rules are gathered, with later rules overwriting previous ones so</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show ref: set text(red, weight: \"bold\")\n#show ref: set text(blue)\n</code></pre>\n<p>will show refs in blue and bold.</p>\n</li>\n<li>\n<p>The element is materialized in accordance with these show-set rules. For example after</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show ref: set ref(supplement: [X])\n</code></pre>\n<p>all ref elements with unspecified supplement will be materialized with supplement <code>[X]</code>.</p>\n</li>\n<li>\n<p>Normal show rules (i.e. functions, not show-set) are applied starting with the most local one. The rule functions are called with the materialized element as argument. Each rule is applied recursively to its own output, until the output contains nothing new that matches the show rule. For example</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set math.equation(numbering: \"(1)\")\n#set ref(supplement: [0])\n#show ref: it =&gt; {\n  let i = int(it.supplement.text)\n  if i &lt; 3 {\n    let new = ref(it.target, supplement: [#(i + 1)])\n    return [{it: #it, new: #new}]\n  }\n  [{final: #it}]\n}\n\n$ x = y $ &lt;eq&gt;\nSee @eq.\n</code></pre>\n<p>produces<br>\n<img src=\"https://forum.typst.app/uploads/default/original/2X/c/c55425aff45f3c80d382cf1cd5f5439e255e7f4b.png\" alt=\"image\" data-base62-sha1=\"s9Elt0Rc7FAPMSRImsvnDwiP7ib\" width=\"360\" height=\"69\"></p>\n<p>Indeed the first time the show rule is applied, it returns the content <code>{it: #it, new: #new}</code>. The rule is then applied again on the new ref, but not on <code>#it</code> as that has already been processed. This is repeated until the new ref has supplement <code>[3]</code>: then the show rule simply returns <code>{final: #it}</code>. This output contains nothing new matching the show rule, so Typst moves on to the next (more outer) show rule.</p>\n</li>\n</ol>\n<p>Remarks:</p>\n<ul>\n<li>\n<p>Default values are used at the point where the element is materialized. If you change them afterwards it’s too late:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// Works for future heading elements (they are not yet materialized)\n#show heading: set heading(outlined: false)\n\n// Doesn't work: the `it` heading is already materialized\n#show heading: it =&gt; { set heading(outlined: false); it }\n\n// Works: the content of the heading is not yet materialized\n#show heading: it =&gt; { set text(purple); it }\n</code></pre>\n</li>\n<li>\n<p>As explained by <a class=\"mention\" href=\"/u/bluss\">@bluss</a>, a show rule applies to the element, but it can return something else than “just the element”. For example</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show heading: it =&gt; { set text(green); [A(] + box(it) + [)a] }\n</code></pre>\n<p>puts a style wrapper and box around every heading.</p>\n</li>\n<li>\n<p>A show rule can replace the element with a new element of the same type:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// Replace every level-1 heading with a level-2 heading\n#show heading.where(level: 1): it =&gt; heading(level: 2, it.body)\n</code></pre>\n<p>The show rule can also replace the element with something completely different:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// Replace headings with text `x`\n#show heading: [x]\n</code></pre>\n<p>Note that a query will also find discarded elements. So in the first case above, <code>query(heading)</code> will return both the level-1 and level-2 headings. And in the second case it will return the heading that was replaced with <code>[x]</code>.</p>\n</li>\n</ul>",
      "raw": "Here is how rules are applied for a particular element according to my understanding (copy-pasted from [another](https://forum.typst.app/t/how-can-i-modify-the-reference-format-of-equations/1118/8) thread but it better belongs here I guess):\n\n1. All applicable show-set rules are gathered, with later rules overwriting previous ones so\n\n   ```typ\n   #show ref: set text(red, weight: \"bold\")\n   #show ref: set text(blue)\n   ```\n\n   will show refs in blue and bold.\n\n2. The element is materialized in accordance with these show-set rules. For example after\n\n   ```typ\n   #show ref: set ref(supplement: [X])\n   ```\n\n   all ref elements with unspecified supplement will be materialized with supplement `[X]`.\n\n3. Normal show rules (i.e. functions, not show-set) are applied starting with the most local one. The rule functions are called with the materialized element as argument. Each rule is applied recursively to its own output, until the output contains nothing new that matches the show rule. For example\n\n   ```typ\n   #set math.equation(numbering: \"(1)\")\n   #set ref(supplement: [0])\n   #show ref: it => {\n     let i = int(it.supplement.text)\n     if i < 3 {\n       let new = ref(it.target, supplement: [#(i + 1)])\n       return [{it: #it, new: #new}]\n     }\n     [{final: #it}]\n   }\n   \n   $ x = y $ <eq>\n   See @eq.\n   ```\n\n   produces\n   ![image|360x69](upload://s9Elt0Rc7FAPMSRImsvnDwiP7ib)\n\n   Indeed the first time the show rule is applied, it returns the content `{it: #it, new: #new}`. The rule is then applied again on the new ref, but not on `#it` as that has already been processed. This is repeated until the new ref has supplement `[3]`: then the show rule simply returns `{final: #it}`. This output contains nothing new matching the show rule, so Typst moves on to the next (more outer) show rule.\n\nRemarks:\n\n* Default values are used at the point where the element is materialized. If you change them afterwards it's too late:\n   \n   ```typ\n   // Works for future heading elements (they are not yet materialized)\n   #show heading: set heading(outlined: false)\n\n   // Doesn't work: the `it` heading is already materialized\n   #show heading: it => { set heading(outlined: false); it }\n\n   // Works: the content of the heading is not yet materialized\n   #show heading: it => { set text(purple); it }\n   ```\n   \n* As explained by @bluss, a show rule applies to the element, but it can return something else than \"just the element\". For example\n   \n   ```typ\n   #show heading: it => { set text(green); [A(] + box(it) + [)a] }\n   ```\n   \n   puts a style wrapper and box around every heading.\n\n* A show rule can replace the element with a new element of the same type:\n   \n   ```typ\n   // Replace every level-1 heading with a level-2 heading\n   #show heading.where(level: 1): it => heading(level: 2, it.body)\n   ```\n   \n   The show rule can also replace the element with something completely different:\n\n   ```typ\n   // Replace headings with text `x`\n   #show heading: [x]\n   ```\n\n   Note that a query will also find discarded elements. So in the first case above, `query(heading)` will return both the level-1 and level-2 headings. And in the second case it will return the heading that was replaced with `[x]`.",
      "reply_to_post_number": 3,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 6,
      "reads": 40,
      "score": 168.0,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 332
    },
    {
      "id": 11893,
      "post_number": 6,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-05-02T09:37:20.152Z",
      "updated_at": "2025-05-02T09:39:33.441Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"sijo\" data-post=\"5\" data-topic=\"3904\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/s/0A3649/48.png\" class=\"avatar\"> sijo:</div>\n<blockquote>\n<p>The rule functions are called with the materialized element as argument. Each rule is applied recursively to its own output, until the output contains nothing new that matches the show rule.</p>\n</blockquote>\n</aside>\n<p>Thanks for the excellent post.</p>",
      "raw": "[quote=\"sijo, post:5, topic:3904\"]\nThe rule functions are called with the materialized element as argument. Each rule is applied recursively to its own output, until the output contains nothing new that matches the show rule.\n[/quote]\n\nThanks for the excellent post.",
      "reply_to_post_number": 5,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 1,
      "reads": 33,
      "score": 21.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11894,
      "post_number": 7,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2025-05-02T10:05:06.561Z",
      "updated_at": "2025-05-02T10:51:02.481Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"sijo\" data-post=\"5\" data-topic=\"3904\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/s/0A3649/48.png\" class=\"avatar\"> sijo:</div>\n<blockquote>\n<p>Each rule is applied recursively to its own output, until the output contains nothing new that matches the show rule.</p>\n</blockquote>\n</aside>\n<p>As a side comment, this is the reason why probably packages/templates should return the original <code>it</code> instead of content when possible, so that template rules can compose with user rules. A (coincidentally?) good example is in the <a href=\"https://typst.app/docs/reference/model/ref/#:~:text=Chapter%5D.-,Customization,-If%20you%20write\">reference docs</a>.</p>\n<p>EDIT: below an example from glossarium README</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show: make-glossary\n\n#show ref: it =&gt; {\n  let el = it.element\n  if el != none and el.func() == figure and el.kind == \"glossarium_entry\" {\n    // Make the glossarium entry references dark blue\n    text(fill: blue.darken(60%), it)\n  } else {\n    // Other references as usual.\n    it\n  }\n}\n</code></pre>",
      "raw": "[quote=\"sijo, post:5, topic:3904\"]\nEach rule is applied recursively to its own output, until the output contains nothing new that matches the show rule.\n[/quote]\n\nAs a side comment, this is the reason why probably packages/templates should return the original `it` instead of content when possible, so that template rules can compose with user rules. A (coincidentally?) good example is in the [reference docs](https://typst.app/docs/reference/model/ref/#:~:text=Chapter%5D.-,Customization,-If%20you%20write).\n\nEDIT: below an example from glossarium README\n\n```typ\n#show: make-glossary\n\n#show ref: it => {\n  let el = it.element\n  if el != none and el.func() == figure and el.kind == \"glossarium_entry\" {\n    // Make the glossarium entry references dark blue\n    text(fill: blue.darken(60%), it)\n  } else {\n    // Other references as usual.\n    it\n  }\n}\n```",
      "reply_to_post_number": 5,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 2,
      "reads": 31,
      "score": 46.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 258
    },
    {
      "id": 11896,
      "post_number": 8,
      "username": "sijo",
      "name": "",
      "created_at": "2025-05-02T11:10:30.722Z",
      "updated_at": "2025-05-02T11:10:30.722Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"quachpas\" data-post=\"7\" data-topic=\"3904\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/q/662200/48.png\" class=\"avatar\"> quachpas:</div>\n<blockquote>\n<p>probably packages/templates should return the original <code>it</code> instead of content when possible, so that template rules can compose with user rules</p>\n</blockquote>\n</aside>\n<p>the original <code>it</code>, or a new element of the same type (with a trick to avoid recursion) so the user rules still work…</p>",
      "raw": "[quote=\"quachpas, post:7, topic:3904\"]\nprobably packages/templates should return the original `it` instead of content when possible, so that template rules can compose with user rules\n[/quote]\n\nthe original `it`, or a new element of the same type (with a trick to avoid recursion) so the user rules still work...",
      "reply_to_post_number": 7,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 1,
      "reads": 29,
      "score": 25.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 332
    },
    {
      "id": 11908,
      "post_number": 9,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-02T20:51:10.519Z",
      "updated_at": "2025-05-06T15:11:59.959Z",
      "cooked": "<p>The short answer is that show rules are wrappers, that can introduce styling issues later down the road (if you need to style the element further). Which is what you see. Therefore, you should always avoid using show rules and instead use set/show-set/set-if/show-set-if rules, i.e., try something else before making show rule. Usually, when you have a single template, it doesn’t matter, since you style everything once, and you know exactly how to style everything.</p>\n<p>And yes, the show rule closure is applied to the content of the heading and not to the element in the show rule selector. See <a href=\"https://github.com/typst/typst/issues/6219\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Set rule inside show rule (closure) for the same element gets applied for table/grid · Issue #6219 · typst/typst · GitHub</a>. If you know this, you can take advantage of it, like <a href=\"https://forum.typst.app/t/what-is-the-easiest-way-to-horizontally-visually-flatten-nested-enum-list/3898/3\">here</a>.</p>",
      "raw": "The short answer is that show rules are wrappers, that can introduce styling issues later down the road (if you need to style the element further). Which is what you see. Therefore, you should always avoid using show rules and instead use set/show-set/set-if/show-set-if rules, i.e., try something else before making show rule. Usually, when you have a single template, it doesn't matter, since you style everything once, and you know exactly how to style everything.\n\nAnd yes, the show rule closure is applied to the content of the heading and not to the element in the show rule selector. See https://github.com/typst/typst/issues/6219. If you know this, you can take advantage of it, like [here](https://forum.typst.app/t/what-is-the-easiest-way-to-horizontally-visually-flatten-nested-enum-list/3898/3?u=andrew).",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 28,
      "score": 55.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 12014,
      "post_number": 10,
      "username": "Y.D.X",
      "name": "Y.D.X.",
      "created_at": "2025-05-06T02:08:16.602Z",
      "updated_at": "2025-05-06T02:08:16.602Z",
      "cooked": "<p>I finally have time and got to read through all these helpful explanations. Thank you all!</p>\n<h2><a name=\"p-12014-conclusions-1\" class=\"anchor\" href=\"#p-12014-conclusions-1\"></a>Conclusions</h2>\n<ul>\n<li>Use simple rules (set, show-set, set-if) if possible.</li>\n<li>Show-function rules are applied from top to bottom. However, each function is applied to the element, which may or may not be the output of the last function.</li>\n</ul>",
      "raw": "I finally have time and got to read through all these helpful explanations. Thank you all!\n\n## Conclusions\n\n- Use simple rules (set, show-set, set-if) if possible.\n- Show-function rules are applied from top to bottom. However, each function is applied to the element, which may or may not be the output of the last function.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 25,
      "score": 20.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 292
    },
    {
      "id": 12164,
      "post_number": 11,
      "username": "HuangMI",
      "name": "HuangMI",
      "created_at": "2025-05-09T06:37:22.869Z",
      "updated_at": "2025-05-09T06:37:22.869Z",
      "cooked": "<pre><code class=\"lang-auto\">#{\n  set text(blue); [C(] + { set text(red); [B(] + { set text(green); [A(] + box(heading([My Heading])) + [)a] } + [)b] } + [)c]\n}\n\n\n#show heading: it =&gt; { set text(green); [A(] + box(it) + [)a] }\n#show heading: it =&gt; { set text(red); [B(] + box(it) + [)b] }\n#show heading: it =&gt; { set text(blue); [C(] + box(it) + [)c] }\n\n= My Heading\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/1/182f2265e20622ec3d19f62a3b75bd2c01058374.png\" data-download-href=\"https://forum.typst.app/uploads/default/182f2265e20622ec3d19f62a3b75bd2c01058374\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/1/182f2265e20622ec3d19f62a3b75bd2c01058374_2_690x288.png\" alt=\"image\" data-base62-sha1=\"3rWrxwRzhpoRx6NN62OA6gFFzpi\" width=\"690\" height=\"288\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/1/182f2265e20622ec3d19f62a3b75bd2c01058374_2_690x288.png, https://forum.typst.app/uploads/default/original/2X/1/182f2265e20622ec3d19f62a3b75bd2c01058374.png 1.5x, https://forum.typst.app/uploads/default/original/2X/1/182f2265e20622ec3d19f62a3b75bd2c01058374.png 2x\" data-dominant-color=\"F1F9F2\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">886×371 25.1 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "```\n#{\n  set text(blue); [C(] + { set text(red); [B(] + { set text(green); [A(] + box(heading([My Heading])) + [)a] } + [)b] } + [)c]\n}\n\n\n#show heading: it => { set text(green); [A(] + box(it) + [)a] }\n#show heading: it => { set text(red); [B(] + box(it) + [)b] }\n#show heading: it => { set text(blue); [C(] + box(it) + [)c] }\n\n= My Heading\n```\n\n![image|690x288](upload://3rWrxwRzhpoRx6NN62OA6gFFzpi.png)",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 23,
      "score": 9.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1479
    },
    {
      "id": 12165,
      "post_number": 12,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-05-09T08:30:37.237Z",
      "updated_at": "2025-05-09T09:12:16.881Z",
      "cooked": "<p>Is there a question here? I think the question is why they are different. We notice bold face is applied differently.</p>\n<p>The reason why is that inherent or existing set rules for heading apply first. When we enter the first rule (C) we already have the default rules for headings, that set bold text weight. These rules apply to everything that matches the <code>show heading</code> rule, so it includes our extra text “C(” and so on.  (These are rules 1. and 2. in sijo’s overview above)</p>",
      "raw": "Is there a question here? I think the question is why they are different. We notice bold face is applied differently.\n\nThe reason why is that inherent or existing set rules for heading apply first. When we enter the first rule (C) we already have the default rules for headings, that set bold text weight. These rules apply to everything that matches the `show heading` rule, so it includes our extra text \"C(\" and so on.  (These are rules 1. and 2. in sijo's overview above)",
      "reply_to_post_number": 11,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 23,
      "score": 9.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 12185,
      "post_number": 13,
      "username": "HuangMI",
      "name": "HuangMI",
      "created_at": "2025-05-09T12:50:21.488Z",
      "updated_at": "2025-05-09T12:50:21.488Z",
      "cooked": "<p>No question.I want to express that the down code is actually equivalent to the up code</p>",
      "raw": "No question.I want to express that the down code is actually equivalent to the up code",
      "reply_to_post_number": 12,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 9.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1479
    },
    {
      "id": 12186,
      "post_number": 14,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-05-09T14:00:06.330Z",
      "updated_at": "2025-05-09T14:00:06.330Z",
      "cooked": "<p>But visually the result is not equal, so they are different.</p>",
      "raw": "But visually the result is not equal, so they are different.",
      "reply_to_post_number": 13,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 20,
      "score": 4.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    }
  ],
  "scraped_at": "2025-06-10T09:48:23.017117"
}
{
  "topic_metadata": {
    "id": 3908,
    "title": "How to get diagnostic/warning if content has been clipped?",
    "slug": "how-to-get-diagnostic-warning-if-content-has-been-clipped",
    "posts_count": 9,
    "created_at": "2025-05-02T14:47:43.308Z",
    "last_posted_at": "2025-05-06T08:55:19.889Z",
    "views": 97,
    "like_count": 2,
    "reply_count": 4,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 9,
    "accepted_answer_username": "Jacob",
    "tags": [
      "scripting"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 1035
  },
  "posts": [
    {
      "id": 11899,
      "post_number": 1,
      "username": "Jacob",
      "name": "Jacob Kochems",
      "created_at": "2025-05-02T14:47:43.481Z",
      "updated_at": "2025-05-02T14:54:07.121Z",
      "cooked": "<p>Hello typst users,</p>\n<p>I’m considering typst for the follwing use case:<br>\nGiven a dataset in the form of a csv file I’d like to produce a PDF with one page per record. Each field of a record is placed at a specific location on the page inside a container (box or block) element with a predefined size.<br>\nThere are edge cases where the input data is long enough to overflow the container. Since the produced PDF can contain about a thousand pages, I’d like to automate the detection of overfull containers so that I don’t have to scan visually the PDF, by manually scrolling through it.<br>\nIf typst could warn me about those cases I could intercept the diagnostics and tell the user on which page the problem occurs.</p>\n<p>I’ve tried this but got no warning:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set page(width: 10cm, height: auto)\n#block(width: 10pt, height: 10pt, fill: gray, \"Hello World\")\n</code></pre>\n<p>Any idea if this is possible?</p>",
      "raw": "Hello typst users,\n\nI'm considering typst for the follwing use case:\nGiven a dataset in the form of a csv file I'd like to produce a PDF with one page per record. Each field of a record is placed at a specific location on the page inside a container (box or block) element with a predefined size.\nThere are edge cases where the input data is long enough to overflow the container. Since the produced PDF can contain about a thousand pages, I'd like to automate the detection of overfull containers so that I don't have to scan visually the PDF, by manually scrolling through it.\nIf typst could warn me about those cases I could intercept the diagnostics and tell the user on which page the problem occurs.\n\nI've tried this but got no warning:\n```typ\n#set page(width: 10cm, height: auto)\n#block(width: 10pt, height: 10pt, fill: gray, \"Hello World\")\n```\n\nAny idea if this is possible?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 56.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1546
    },
    {
      "id": 11910,
      "post_number": 2,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-02T21:12:40.275Z",
      "updated_at": "2025-05-02T21:15:30.310Z",
      "cooked": "<p>Hello. Your description sounds like you want to do</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let file = ```csv\nrecord1,field1,field2,field3\nrecord2,field1,field2,field3\n```.text\n\n#let data = csv(bytes(file))\n\n#for record in data {\n  place(block(width: 5cm, height: 5cm, record.at(0)))\n  place(dx: 5cm, dy: 5cm, block(\n    width: 2.3em,\n    height: 0.7em,\n    stroke: 1pt,\n    record.at(1),\n  ))\n  place(dx: 2cm, dy: 9cm, box(\n    width: 2.3em,\n    height: 0.7em,\n    fill: green,\n    record.at(2),\n  ))\n  place(bottom + right, dx: -2cm, dy: -2cm, block(\n    width: 2cm,\n    height: 2cm,\n    stroke: 2pt,\n    record.at(3),\n  ))\n  pagebreak(weak: true)\n}\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/4/42ae3ca8f87784d7f523014ac2224cabc85547c5.png\" data-download-href=\"https://forum.typst.app/uploads/default/42ae3ca8f87784d7f523014ac2224cabc85547c5\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/4/42ae3ca8f87784d7f523014ac2224cabc85547c5_2_352x500.png\" alt=\"image\" data-base62-sha1=\"9vSOt15x03pYtayYeHjial7mWtT\" width=\"352\" height=\"500\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/4/42ae3ca8f87784d7f523014ac2224cabc85547c5_2_352x500.png, https://forum.typst.app/uploads/default/optimized/2X/4/42ae3ca8f87784d7f523014ac2224cabc85547c5_2_528x750.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/4/42ae3ca8f87784d7f523014ac2224cabc85547c5_2_704x1000.png 2x\" data-dominant-color=\"0D0D0D\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">729×1034 7.77 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>This is a somewhat strange use case without proper context.</p>\n<p>Where does “predefined size” come from? Can you just not specify the size? It will not overflow in that case.</p>\n<p>The only diagnostic you can make is <a href=\"https://typst.app/docs/reference/foundations/panic/\"><code>panic()</code></a>.</p>\n<aside class=\"onebox githubissue\" data-onebox-src=\"https://github.com/typst/typst/issues/1322\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/typst/typst/issues/1322\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com/typst/typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"github-row\">\n  <div class=\"github-icon-container\" title=\"Issue\" data-github-private-repo=\"false\">\n\t  <svg width=\"60\" height=\"60\" class=\"github-icon\" viewBox=\"0 0 14 16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg>\n  </div>\n\n  <div class=\"github-info-container\">\n    <h4>\n      <a href=\"https://github.com/typst/typst/issues/1322\" target=\"_blank\" rel=\"noopener nofollow ugc\">Support for emitting custom warnings</a>\n    </h4>\n\n    <div class=\"github-info\">\n      <div class=\"date\">\n        opened <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2023-05-25\" data-time=\"09:19:30\" data-timezone=\"UTC\">09:19AM - 25 May 23 UTC</span>\n      </div>\n\n\n      <div class=\"user\">\n        <a href=\"https://github.com/ondohotola\" target=\"_blank\" rel=\"noopener nofollow ugc\">\n          <img alt=\"ondohotola\" src=\"https://forum.typst.app/uploads/default/original/2X/6/6500fd579a03004d594631b07387531141568c56.jpeg\" class=\"onebox-avatar-inline\" width=\"20\" height=\"20\" data-dominant-color=\"6D6361\">\n          ondohotola\n        </a>\n      </div>\n    </div>\n\n    <div class=\"labels\">\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          feature request\n        </span>\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          diagnostics\n        </span>\n    </div>\n  </div>\n</div>\n\n  <div class=\"github-row\">\n    <p class=\"github-body-container\">### Description\n\nIn issue #1276 @Enivex proposed a **very** helpful solution for<span class=\"show-more-container\"><a href=\"\" rel=\"noopener\" class=\"show-more\">…</a></span><span class=\"excerpt hidden\"> missing references. \n\nHowever, I noticed that that will happily generate **`(?)`** (which I have adapted to **`??`** without reporting this, which means you may end up with orphan references.\n\nI have not been able to find a way to make typst squeal so I can adapt the `#show raw` rule's missing condition.\n\n\n### Use Case\n\nThere should be other conditions where a `warning` type message triggered programatically might be helpful.</span></p>\n  </div>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
      "raw": "Hello. Your description sounds like you want to do\n\n````typ\n#let file = ```csv\nrecord1,field1,field2,field3\nrecord2,field1,field2,field3\n```.text\n\n#let data = csv(bytes(file))\n\n#for record in data {\n  place(block(width: 5cm, height: 5cm, record.at(0)))\n  place(dx: 5cm, dy: 5cm, block(\n    width: 2.3em,\n    height: 0.7em,\n    stroke: 1pt,\n    record.at(1),\n  ))\n  place(dx: 2cm, dy: 9cm, box(\n    width: 2.3em,\n    height: 0.7em,\n    fill: green,\n    record.at(2),\n  ))\n  place(bottom + right, dx: -2cm, dy: -2cm, block(\n    width: 2cm,\n    height: 2cm,\n    stroke: 2pt,\n    record.at(3),\n  ))\n  pagebreak(weak: true)\n}\n````\n\n![image|352x500](upload://9vSOt15x03pYtayYeHjial7mWtT.png)\n\nThis is a somewhat strange use case without proper context.\n\nWhere does \"predefined size\" come from? Can you just not specify the size? It will not overflow in that case.\n\nThe only diagnostic you can make is [`panic()`](https://typst.app/docs/reference/foundations/panic/).\n\nhttps://github.com/typst/typst/issues/1322",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 26,
      "score": 25.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11911,
      "post_number": 3,
      "username": "Jacob",
      "name": "Jacob Kochems",
      "created_at": "2025-05-02T21:39:37.123Z",
      "updated_at": "2025-05-02T21:44:28.885Z",
      "cooked": "<p>First of all, thank you very much for your reply.</p>\n<aside class=\"quote no-group\" data-username=\"Andrew\" data-post=\"2\" data-topic=\"3908\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/andrew/48/62_2.png\" class=\"avatar\"> Andrew:</div>\n<blockquote>\n<p>This is a somewhat strange use case without proper context.</p>\n<p>Where does “predefined size” come from? Can you just not specify the size? It will not overflow in that case.</p>\n</blockquote>\n</aside>\n<p>There is nothing strange about it. Let me elaborate a bit more:<br>\nImagine you want to print a lot of badges and you have a set of A4 template sheet papers to print on. You have to print onto a certain area of the A4 paper, where you pull off the self-adhesive part and then fold it. There is a design of said badge which defines things like:</p>\n<p>“The <strong>name</strong> goes exactly here and the <strong>affiliation</strong> goes exactly there.”</p>\n<p>Each of those fields have a per-design specified position and <strong>maximum size</strong>. This means if the content is to large we simply run out of room to print on. This happens e.g. when people provide a very long affiliation information which then necessitates manual abbreviation.<br>\nThe data loading and iterative page build is something I omitted here, because I already know that this is easily possible with typst.</p>",
      "raw": "First of all, thank you very much for your reply.\n\n[quote=\"Andrew, post:2, topic:3908\"]\nThis is a somewhat strange use case without proper context.\n\nWhere does “predefined size” come from? Can you just not specify the size? It will not overflow in that case.\n[/quote]\n\nThere is nothing strange about it. Let me elaborate a bit more:\nImagine you want to print a lot of badges and you have a set of A4 template sheet papers to print on. You have to print onto a certain area of the A4 paper, where you pull off the self-adhesive part and then fold it. There is a design of said badge which defines things like:\n\n\"The **name** goes exactly here and the **affiliation** goes exactly there.\"\n\nEach of those fields have a per-design specified position and **maximum size**. This means if the content is to large we simply run out of room to print on. This happens e.g. when people provide a very long affiliation information which then necessitates manual abbreviation.\nThe data loading and iterative page build is something I omitted here, because I already know that this is easily possible with typst.",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 0,
      "reads": 25,
      "score": 10.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1546
    },
    {
      "id": 11917,
      "post_number": 4,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-03T01:55:13.895Z",
      "updated_at": "2025-05-03T01:55:13.895Z",
      "cooked": "<p>Well, I guess then <code>panic()</code> will do a great job preventing you from badly laid out badges.</p>\n<p>You can also check out <a href=\"https://forum.typst.app/t/using-typst-for-event-badges/128\" class=\"inline-onebox\">Using Typst for event badges</a> and <a href=\"https://typst.app/universe/package/etykett\" class=\"inline-onebox\">etykett – Typst Universe</a>.</p>",
      "raw": "Well, I guess then `panic()` will do a great job preventing you from badly laid out badges.\n\nYou can also check out https://forum.typst.app/t/using-typst-for-event-badges/128 and https://typst.app/universe/package/etykett.",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 23,
      "score": 4.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11920,
      "post_number": 5,
      "username": "Jacob",
      "name": "Jacob Kochems",
      "created_at": "2025-05-03T03:40:14.005Z",
      "updated_at": "2025-05-03T03:40:14.005Z",
      "cooked": "<p>Thank you for your time. These are some interesting examples but my key problem is not addressed there.<br>\nWith regards to the use of <code>panic()</code> I first have to figure out a way to detect the overfull condition in the first place. Maybe with <code>measure()</code> somehow.</p>",
      "raw": "Thank you for your time. These are some interesting examples but my key problem is not addressed there.\nWith regards to the use of `panic()` I first have to figure out a way to detect the overfull condition in the first place. Maybe with `measure()` somehow.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 14.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1546
    },
    {
      "id": 11921,
      "post_number": 6,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-03T04:02:15.223Z",
      "updated_at": "2025-05-03T04:02:15.223Z",
      "cooked": "<p>You can try unsetting <code>height</code> and then do <code>#context measure(block(width: 4cm, lorem(13)))</code>. Seems to work.</p>",
      "raw": "You can try unsetting `height` and then do `#context measure(block(width: 4cm, lorem(13)))`. Seems to work.",
      "reply_to_post_number": 5,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 14.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11924,
      "post_number": 7,
      "username": "vmartel08",
      "name": "Vincent Martel",
      "created_at": "2025-05-03T08:06:16.519Z",
      "updated_at": "2025-05-03T08:06:16.519Z",
      "cooked": "<p>Have you looked at <a href=\"https://typst.app/universe/package/one-liner\" class=\"inline-onebox\">one-liner – Typst Universe</a> ? Could be giving ideas on how to deal with the problem rather than give an error ?</p>",
      "raw": "Have you looked at https://typst.app/universe/package/one-liner ? Could be giving ideas on how to deal with the problem rather than give an error ?",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 20,
      "score": 29.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 936
    },
    {
      "id": 12024,
      "post_number": 8,
      "username": "Jacob",
      "name": "Jacob Kochems",
      "created_at": "2025-05-06T08:41:01.530Z",
      "updated_at": "2025-05-06T08:41:01.530Z",
      "cooked": "<p>Thanks for the suggestion but I’m dialing with line-wrapping boxes which have a height limit.</p>",
      "raw": "Thanks for the suggestion but I'm dialing with line-wrapping boxes which have a height limit.",
      "reply_to_post_number": 7,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 16,
      "score": 3.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1546
    },
    {
      "id": 12025,
      "post_number": 9,
      "username": "Jacob",
      "name": "Jacob Kochems",
      "created_at": "2025-05-06T08:55:19.889Z",
      "updated_at": "2025-05-06T16:01:35.234Z",
      "cooked": "<p>Ok, I found some solutions which solve my original question in three different ways. I combined them all into one example so anyone can pick and choose what fits best for them:</p>\n<ol>\n<li>In-Document-Warning (Summary): use a <a href=\"https://typst.app/docs/reference/introspection/state/\">state</a> to collect and typeset a warning summary</li>\n<li>In-Document-Warning (Outline): use <a href=\"https://forum.typst.app/t/how-to-add-an-invisible-heading-to-an-outline/685/2\">invisible headings</a> to record the warnings into the outline</li>\n<li><a href=\"https://typst.app/docs/reference/introspection/metadata/\">Metadata</a>: put the warning into a metadata label which can then be queried from the CLI</li>\n</ol>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">// file: overfull.typ\n// --- page setup ---\n#set page(width: 10cm, height: 6cm)\n\n// --- example dataset ---\n#let records = (\n  (firstname: \"Alice\", lastname: \"Anderson\", affiliation: \"ACME\"),\n  (firstname: \"Bob\", lastname: \"Baker\", affiliation: \"A Company that Manufactures Everything\\ - Sales Department -\"),\n)\n \n// In-Document-Warning (Summary): create a state\n#let overfull_box_on_pages = state(\"overfull\", ())\n\n// --- overfull aware box (vertical limit detection) ---\n#let box_vlim(body, width: auto, height: auto, highlight: red, ..box_args) = layout(\nparent_size =&gt; {\n  let width = width\n  if width == auto {\n    width = parent_size.width\n  }\n  let boxed = box(body, width: width, ..box_args)\n  let size = measure(boxed)\n  if type(height) == length and size.height.mm() &gt; height.to-absolute().mm() {\n    boxed = box(body, width: width, height: height, fill: highlight, ..box_args)\n    // Metadata: this can be queried from the CLI with:\n    // `typst query overfull.typ \"&lt;overfull&gt;\" --field value`\n    [#metadata(here().page())&lt;overfull&gt;]\n\n    // In-Document-Warning (Summary): collect page information into state\n    let pages = overfull_box_on_pages.get()\n    pages.push(here().page())\n    overfull_box_on_pages.update(pages)\n\n    // In-Document-Warning (Outline): create an invisible heading which shows up in the outline\n    // https://forum.typst.app/t/how-to-add-an-invisible-heading-to-an-outline/685/2?u=jacob\n    {\n      show heading: none\n      heading(numbering: none)[Overfull Box]\n    }\n  }\n  boxed\n})\n\n// interpret dataset fields as markup\n#let typeset(src) = {\n  eval(src, mode: \"markup\")\n}\n\n// construct document page by page\n#for i in range(records.len()) {\n  box_vlim(height: 2em)[\n    #typeset(records.at(i).firstname)\\\n    #typeset(records.at(i).lastname)\n  ]+\"\\n\"\n  box_vlim(height: 1em)[\n    #typeset(records.at(i).affiliation)\n  ]\n  if i &lt; (records.len() - 1) {\n    pagebreak()\n  }\n}\n\n// In-Document-Warning (Outline, Summary): show outline and summary\n#context {\n  let pages = overfull_box_on_pages.final()\n  if pages != () {\n    pagebreak()\n    outline(title: \"Warnings\")\n    pagebreak()\n    [= Warnings Summary]\n    [overfull box on pages: #pages]\n  }\n}\n</code></pre>",
      "raw": "Ok, I found some solutions which solve my original question in three different ways. I combined them all into one example so anyone can pick and choose what fits best for them:\n\n1. In-Document-Warning (Summary): use a [state](https://typst.app/docs/reference/introspection/state/) to collect and typeset a warning summary\n2. In-Document-Warning (Outline): use [invisible headings](https://forum.typst.app/t/how-to-add-an-invisible-heading-to-an-outline/685/2?u=jacob) to record the warnings into the outline\n3. [Metadata](https://typst.app/docs/reference/introspection/metadata/): put the warning into a metadata label which can then be queried from the CLI\n\n```typst\n// file: overfull.typ\n// --- page setup ---\n#set page(width: 10cm, height: 6cm)\n\n// --- example dataset ---\n#let records = (\n  (firstname: \"Alice\", lastname: \"Anderson\", affiliation: \"ACME\"),\n  (firstname: \"Bob\", lastname: \"Baker\", affiliation: \"A Company that Manufactures Everything\\ - Sales Department -\"),\n)\n \n// In-Document-Warning (Summary): create a state\n#let overfull_box_on_pages = state(\"overfull\", ())\n\n// --- overfull aware box (vertical limit detection) ---\n#let box_vlim(body, width: auto, height: auto, highlight: red, ..box_args) = layout(\nparent_size => {\n  let width = width\n  if width == auto {\n    width = parent_size.width\n  }\n  let boxed = box(body, width: width, ..box_args)\n  let size = measure(boxed)\n  if type(height) == length and size.height.mm() > height.to-absolute().mm() {\n    boxed = box(body, width: width, height: height, fill: highlight, ..box_args)\n    // Metadata: this can be queried from the CLI with:\n    // `typst query overfull.typ \"<overfull>\" --field value`\n    [#metadata(here().page())<overfull>]\n\n    // In-Document-Warning (Summary): collect page information into state\n    let pages = overfull_box_on_pages.get()\n    pages.push(here().page())\n    overfull_box_on_pages.update(pages)\n\n    // In-Document-Warning (Outline): create an invisible heading which shows up in the outline\n    // https://forum.typst.app/t/how-to-add-an-invisible-heading-to-an-outline/685/2?u=jacob\n    {\n      show heading: none\n      heading(numbering: none)[Overfull Box]\n    }\n  }\n  boxed\n})\n\n// interpret dataset fields as markup\n#let typeset(src) = {\n  eval(src, mode: \"markup\")\n}\n\n// construct document page by page\n#for i in range(records.len()) {\n  box_vlim(height: 2em)[\n    #typeset(records.at(i).firstname)\\\n    #typeset(records.at(i).lastname)\n  ]+\"\\n\"\n  box_vlim(height: 1em)[\n    #typeset(records.at(i).affiliation)\n  ]\n  if i < (records.len() - 1) {\n    pagebreak()\n  }\n}\n\n// In-Document-Warning (Outline, Summary): show outline and summary\n#context {\n  let pages = overfull_box_on_pages.final()\n  if pages != () {\n    pagebreak()\n    outline(title: \"Warnings\")\n    pagebreak()\n    [= Warnings Summary]\n    [overfull box on pages: #pages]\n  }\n}\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 16,
      "score": 23.2,
      "accepted_answer": true,
      "trust_level": 1,
      "user_id": 1546
    }
  ],
  "scraped_at": "2025-06-10T09:48:22.246260"
}
{
  "topic_metadata": {
    "id": 3910,
    "title": "Help drawing a soil profile diagram with inclined backfill in Typst",
    "slug": "help-drawing-a-soil-profile-diagram-with-inclined-backfill-in-typst",
    "posts_count": 5,
    "created_at": "2025-05-02T19:58:46.886Z",
    "last_posted_at": "2025-05-04T12:46:39.740Z",
    "views": 87,
    "like_count": 2,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 3,
    "accepted_answer_username": "Andrew",
    "tags": [
      "graphics",
      "cetz"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 1034
  },
  "posts": [
    {
      "id": 11903,
      "post_number": 1,
      "username": "TlidYou",
      "name": "TlidYou",
      "created_at": "2025-05-02T19:58:47.000Z",
      "updated_at": "2025-05-04T12:45:35.793Z",
      "cooked": "<p>Hi everyone,</p>\n<p>I’m trying to reproduce the attached figure in Typst. It’s a soil profile showing two layers (gravel and sand) with inclined backfill (β = 20°), and I’d appreciate any help or example code.<br>\n<img src=\"https://forum.typst.app/uploads/default/original/2X/1/11149815ade87cf223a079896b64bb155bf7c3af.png\" alt=\"Capture\" data-base62-sha1=\"2r6eR4jdNNdOBHYAs9sDVOc7BNR\" width=\"268\" height=\"266\"></p>\n<p>Here are the details I’d like to include:</p>\n<ul>\n<li>Two soil layers:\n<ul>\n<li><strong>Bottom layer (Gravier)</strong>: γ = 21 kN/m³, φ’ = 40°, K<sub>ra2</sub> = 0.266</li>\n<li><strong>Top layer (Sable)</strong>: γ = 18 kN/m³, φ’ = 30°, K<sub>ra1</sub> = 0.441</li>\n</ul>\n</li>\n<li>Inclined backfill with slope β = 20°</li>\n<li>Layer thicknesses: z₂ = 2 m (Gravier), z₁ = 4 m (Sable), total H = 6 m</li>\n<li>Labeled points: A (bottom), B (interface), and C (top)</li>\n<li>Sloped lines for the soil surface and interface</li>\n<li>Shaded color areas for the two layers (different colors)</li>\n<li>Vertical dimension lines and labels for z₁, z₂, and H</li>\n</ul>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/cetz:0.3.4\"\n#set page(width: auto, height: auto, margin: .5cm)\n\n#cetz.canvas(length: 3cm, {\n  import cetz.draw: *\n\n  // Define slope\n  let slope = calc.tan(20deg)\n\n  // Line 1 from (0,0) to (3, 3*slope)\n  line((0, 0), (1, 2 * slope), stroke: (paint: blue))\n\n  // Line 2: parallel, offset in y by -1\n  line((0, -1), (1,  2* slope - 1), stroke: (paint: red))\n   set-style(stroke: (thickness: 1.2pt))\n  line((0, 0), (0, -1.5), stroke: (paint: black))\n})\n</code></pre>\n<p>Any help writing the Typst code to generate this would be greatly appreciated!</p>\n<p>Thanks in advance!</p>",
      "raw": "Hi everyone,\n\nI'm trying to reproduce the attached figure in Typst. It's a soil profile showing two layers (gravel and sand) with inclined backfill (β = 20°), and I'd appreciate any help or example code.\n![Capture|268x266](upload://2r6eR4jdNNdOBHYAs9sDVOc7BNR.png)\n\nHere are the details I'd like to include:\n\n* Two soil layers:\n  * **Bottom layer (Gravier)**: γ = 21 kN/m³, φ' = 40°, K<sub>ra2</sub> = 0.266\n  * **Top layer (Sable)**: γ = 18 kN/m³, φ' = 30°, K<sub>ra1</sub> = 0.441\n* Inclined backfill with slope β = 20°\n* Layer thicknesses: z₂ = 2 m (Gravier), z₁ = 4 m (Sable), total H = 6 m\n* Labeled points: A (bottom), B (interface), and C (top)\n* Sloped lines for the soil surface and interface\n* Shaded color areas for the two layers (different colors)\n* Vertical dimension lines and labels for z₁, z₂, and H\n\n```typ\n#import \"@preview/cetz:0.3.4\"\n#set page(width: auto, height: auto, margin: .5cm)\n\n#cetz.canvas(length: 3cm, {\n  import cetz.draw: *\n\n  // Define slope\n  let slope = calc.tan(20deg)\n\n  // Line 1 from (0,0) to (3, 3*slope)\n  line((0, 0), (1, 2 * slope), stroke: (paint: blue))\n\n  // Line 2: parallel, offset in y by -1\n  line((0, -1), (1,  2* slope - 1), stroke: (paint: red))\n   set-style(stroke: (thickness: 1.2pt))\n  line((0, 0), (0, -1.5), stroke: (paint: black))\n})\n```\n\n\nAny help writing the Typst code to generate this would be greatly appreciated!\n\nThanks in advance!",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 33,
      "score": 86.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1467
    },
    {
      "id": 11915,
      "post_number": 2,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-03T01:28:12.922Z",
      "updated_at": "2025-05-03T01:41:42.408Z",
      "cooked": "<p>Hi. Please read the <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\" class=\"inline-onebox\">How to post in the Questions category</a>. The category should be <a class=\"hashtag-cooked\" href=\"/c/questions/5\" data-type=\"category\" data-slug=\"questions\" data-id=\"5\"><span class=\"hashtag-icon-placeholder\"><svg class=\"fa d-icon d-icon-square-full svg-icon svg-node\"><use href=\"#square-full\"></use></svg></span><span>Questions</span></a>.</p>\n<aside class=\"quote no-group quote-modified\" data-username=\"reknih\" data-post=\"1\" data-topic=\"11\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/reknih/48/3_2.png\" class=\"avatar\"><a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11/1\">How to post in the Questions category</a></div>\n<blockquote>\n<p>If your question pertains to a bit of Typst markup you have problems with, put it in the question body! You can syntax-highlight Typst code by wrapping it in ` ```typ … ````. It will then look like this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set font(size: 12pt)\n\nHello from *Typst* at $ pi.var + 1 $ o'clock!\n</code></pre>\n<p>If you need to highlight a code or math mode snippet instead, the language tags <code>typc</code> and <code>typm</code> do that, respectively.</p>\n</blockquote>\n</aside>",
      "raw": "Hi. Please read the https://forum.typst.app/t/how-to-post-in-the-questions-category/11. The category should be #questions.\n\n[quote=\"reknih, post:1, topic:11\"]\nIf your question pertains to a bit of Typst markup you have problems with, put it in the question body! You can syntax-highlight Typst code by wrapping it in ` ```typ ... ````. It will then look like this:\n\n```typ\n#set font(size: 12pt)\n\nHello from *Typst* at $ pi.var + 1 $ o'clock!\n```\n\nIf you need to highlight a code or math mode snippet instead, the language tags `typc` and `typm` do that, respectively.\n[/quote]",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 29,
      "score": 10.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11916,
      "post_number": 3,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-03T01:37:16.091Z",
      "updated_at": "2025-05-03T01:38:24.927Z",
      "cooked": "<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/cetz:0.3.4\"\n#set page(width: auto, height: auto, margin: .5cm)\n\n#set text(8pt)\n#cetz.canvas(length: 1cm, {\n  let olive = rgb(\"#a5a552\")\n\n  let pattern(degree, width: 10cm, dx: 0pt) = tiling(size: (width, 10cm), {\n    let rect = rect(width: 8pt, stroke: olive)\n    let rail = tiling(size: (11pt, 4pt), place(dx: 0.5pt, rect))\n    rotate(degree, move(dx: dx, block(width: width, height: 10cm, fill: rail)))\n  })\n\n  import cetz.draw: *\n\n  let draw-slope(pos, deg) = {\n    line(pos, (rel: (1.5, 0)), name: \"l\")\n    let label = $beta = #calc.round(deg.deg()) degree$\n    content((rel: (0.3, -0.2), to: \"l.mid\"), text(0.8em, label))\n    let mark = (symbol: \"&gt;\", width: 4pt, scale: 0.4)\n    arc(\"l.end\", radius: 1.5, start: 0deg, stop: deg, mark: mark)\n  }\n\n  let draw-pattern(from, to, height: 0.3, pattern) = line(\n    (rel: (0, -height), to: from),\n    (rel: (0, height)),\n    to,\n    (rel: (0, -height)),\n    close: true,\n    stroke: none,\n    fill: pattern,\n  )\n\n  let soil-info(name, body) = content(name, {\n    set align(center)\n    set par(spacing: 0.5em)\n    set par(leading: 0.3em)\n    underline(emph(name))\n    parbreak()\n    body\n  })\n\n  let height = 6\n  let gravier-height = 2\n  let beta = 20deg\n  let slope = (beta, 5)\n\n  // Sable background\n  line(\n    (0, gravier-height),\n    (0, height),\n    (rel: slope),\n    (rel: (0, -(height - gravier-height))),\n    fill: rgb(\"#ece9c0\"),\n    stroke: none,\n    close: true,\n    name: \"Sable\",\n  )\n\n  draw-slope(\"Sable.32%\", beta)\n  draw-pattern(\"Sable.25%\", \"Sable.31%\", pattern(5deg, dx: -12mm))\n  draw-pattern(\"Sable.42%\", \"Sable.49%\", pattern(5deg, dx: -12mm))\n\n  soil-info(\"Sable\")[\n    $\n          gamma &amp; = 18 [k N\\/m^3] \\\n           phi' &amp; = 30 degree     \\\n      K_(r a_1) &amp; = 0.441         \\\n    $\n  ]\n\n  // Gravier background\n  line(\n    (0, 0),\n    (0, gravier-height),\n    (rel: slope),\n    ((), \"|-\", (0, 0)),\n    fill: rgb(\"#c7e6c7\"),\n    stroke: none,\n    close: true,\n    name: \"Gravier\",\n  )\n\n  draw-slope(\"Gravier.28%\", beta)\n\n  soil-info(\"Gravier\")[\n    $\n          gamma &amp; = 21 [k N\\/m^3] \\\n           phi' &amp; = 40 degree     \\\n      K_(r a_2) &amp; = 0.266         \\\n    $\n  ]\n\n  // Right-side lines\n  line((0, height), (rel: slope), stroke: olive)\n  line((0, gravier-height), (rel: slope), stroke: red)\n\n  // Left-side lines\n  let right-length = 3\n  line((0, 0), (rel: (-right-length, 0)), name: \"l\", stroke: olive)\n  draw-pattern(\"l.12%\", \"l.90%\", pattern(30deg, width: 25.8mm, dx: -28.8mm))\n  line((0, height), (rel: (-right-length, 0)))\n\n  let dimention-text(at, body) = {\n    content(at, box(fill: white, inset: 0.1em, body))\n  }\n  let dimention-line(..args) = {\n    let s = (symbol: \"&gt;\", fill: black, stroke: (miter-limit: 100), width: 0.5mm)\n    line(mark: s, ..args)\n  }\n\n  let x = -right-length + 0.2\n  dimention-line((x, 0), (x, height), name: \"H\")\n  dimention-text(\"H.mid\")[$\"H\" = height thin \"m\"$]\n\n  let x = -right-length / 2\n\n  anchor(\"C\", (rel: (-0.1, -0.1), to: (0, height)))\n  content(\"C\", anchor: \"north-east\")[$C$]\n\n  dimention-line((x, gravier-height), (x, height), name: \"z1\")\n  let pos = (rel: (-0.3, 0), to: \"z1.mid\")\n  dimention-text(pos)[$z_1 = #(height - gravier-height) thin \"m\"$]\n\n  line((0, gravier-height), (rel: (x - 0.1, 0)))\n\n  anchor(\"B\", (rel: (-0.1, -0.1), to: (0, gravier-height)))\n  content(\"B\", anchor: \"north-east\")[$B$]\n\n  dimention-line((x, 0), (x, gravier-height), name: \"z2\")\n  let pos = (rel: (-0.3, 0), to: \"z2.mid\")\n  dimention-text(pos)[$z_2 = #gravier-height thin \"m\"$]\n\n  anchor(\"A\", (rel: (-0.1, -0.1), to: (0, 0)))\n  content(\"A\", anchor: \"north-east\")[$A$]\n\n  line((0, 0), (0, height), stroke: 1.5pt)\n})\n</code></pre>\n<details><summary>Output</summary>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/f/f24d426c71c9139eaeacf1804c6e8189c64fa86a.png\" data-download-href=\"https://forum.typst.app/uploads/default/f24d426c71c9139eaeacf1804c6e8189c64fa86a\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/f/f24d426c71c9139eaeacf1804c6e8189c64fa86a_2_367x375.png\" alt=\"image\" data-base62-sha1=\"yzv4GchSJSE4g1GxgClfyTknB0K\" width=\"367\" height=\"375\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/f/f24d426c71c9139eaeacf1804c6e8189c64fa86a_2_367x375.png, https://forum.typst.app/uploads/default/optimized/2X/f/f24d426c71c9139eaeacf1804c6e8189c64fa86a_2_550x562.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/f/f24d426c71c9139eaeacf1804c6e8189c64fa86a_2_734x750.png 2x\" data-dominant-color=\"E7EBD8\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">919×936 57.9 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n</details>\n<p>You can change these variables and pretty much everything will automatically adapt to new values:</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">  let height = 6\n  let gravier-height = 2\n  let beta = 20deg\n  let slope = (beta, 5)\n  let right-length = 3\n</code></pre>\n<p>The only thing that doesn’t work great is the pattern. It is pretty complex in terms of transformation, so I don’t know how to make it more adaptable. I also tried to copy the start/end look from the original image.</p>\n<p>You can play with global <code>length</code> and font size to get better scaling of things.</p>",
      "raw": "```typ\n#import \"@preview/cetz:0.3.4\"\n#set page(width: auto, height: auto, margin: .5cm)\n\n#set text(8pt)\n#cetz.canvas(length: 1cm, {\n  let olive = rgb(\"#a5a552\")\n\n  let pattern(degree, width: 10cm, dx: 0pt) = tiling(size: (width, 10cm), {\n    let rect = rect(width: 8pt, stroke: olive)\n    let rail = tiling(size: (11pt, 4pt), place(dx: 0.5pt, rect))\n    rotate(degree, move(dx: dx, block(width: width, height: 10cm, fill: rail)))\n  })\n\n  import cetz.draw: *\n\n  let draw-slope(pos, deg) = {\n    line(pos, (rel: (1.5, 0)), name: \"l\")\n    let label = $beta = #calc.round(deg.deg()) degree$\n    content((rel: (0.3, -0.2), to: \"l.mid\"), text(0.8em, label))\n    let mark = (symbol: \">\", width: 4pt, scale: 0.4)\n    arc(\"l.end\", radius: 1.5, start: 0deg, stop: deg, mark: mark)\n  }\n\n  let draw-pattern(from, to, height: 0.3, pattern) = line(\n    (rel: (0, -height), to: from),\n    (rel: (0, height)),\n    to,\n    (rel: (0, -height)),\n    close: true,\n    stroke: none,\n    fill: pattern,\n  )\n\n  let soil-info(name, body) = content(name, {\n    set align(center)\n    set par(spacing: 0.5em)\n    set par(leading: 0.3em)\n    underline(emph(name))\n    parbreak()\n    body\n  })\n\n  let height = 6\n  let gravier-height = 2\n  let beta = 20deg\n  let slope = (beta, 5)\n\n  // Sable background\n  line(\n    (0, gravier-height),\n    (0, height),\n    (rel: slope),\n    (rel: (0, -(height - gravier-height))),\n    fill: rgb(\"#ece9c0\"),\n    stroke: none,\n    close: true,\n    name: \"Sable\",\n  )\n\n  draw-slope(\"Sable.32%\", beta)\n  draw-pattern(\"Sable.25%\", \"Sable.31%\", pattern(5deg, dx: -12mm))\n  draw-pattern(\"Sable.42%\", \"Sable.49%\", pattern(5deg, dx: -12mm))\n\n  soil-info(\"Sable\")[\n    $\n          gamma & = 18 [k N\\/m^3] \\\n           phi' & = 30 degree     \\\n      K_(r a_1) & = 0.441         \\\n    $\n  ]\n\n  // Gravier background\n  line(\n    (0, 0),\n    (0, gravier-height),\n    (rel: slope),\n    ((), \"|-\", (0, 0)),\n    fill: rgb(\"#c7e6c7\"),\n    stroke: none,\n    close: true,\n    name: \"Gravier\",\n  )\n\n  draw-slope(\"Gravier.28%\", beta)\n\n  soil-info(\"Gravier\")[\n    $\n          gamma & = 21 [k N\\/m^3] \\\n           phi' & = 40 degree     \\\n      K_(r a_2) & = 0.266         \\\n    $\n  ]\n\n  // Right-side lines\n  line((0, height), (rel: slope), stroke: olive)\n  line((0, gravier-height), (rel: slope), stroke: red)\n\n  // Left-side lines\n  let right-length = 3\n  line((0, 0), (rel: (-right-length, 0)), name: \"l\", stroke: olive)\n  draw-pattern(\"l.12%\", \"l.90%\", pattern(30deg, width: 25.8mm, dx: -28.8mm))\n  line((0, height), (rel: (-right-length, 0)))\n\n  let dimention-text(at, body) = {\n    content(at, box(fill: white, inset: 0.1em, body))\n  }\n  let dimention-line(..args) = {\n    let s = (symbol: \">\", fill: black, stroke: (miter-limit: 100), width: 0.5mm)\n    line(mark: s, ..args)\n  }\n\n  let x = -right-length + 0.2\n  dimention-line((x, 0), (x, height), name: \"H\")\n  dimention-text(\"H.mid\")[$\"H\" = height thin \"m\"$]\n\n  let x = -right-length / 2\n\n  anchor(\"C\", (rel: (-0.1, -0.1), to: (0, height)))\n  content(\"C\", anchor: \"north-east\")[$C$]\n\n  dimention-line((x, gravier-height), (x, height), name: \"z1\")\n  let pos = (rel: (-0.3, 0), to: \"z1.mid\")\n  dimention-text(pos)[$z_1 = #(height - gravier-height) thin \"m\"$]\n\n  line((0, gravier-height), (rel: (x - 0.1, 0)))\n\n  anchor(\"B\", (rel: (-0.1, -0.1), to: (0, gravier-height)))\n  content(\"B\", anchor: \"north-east\")[$B$]\n\n  dimention-line((x, 0), (x, gravier-height), name: \"z2\")\n  let pos = (rel: (-0.3, 0), to: \"z2.mid\")\n  dimention-text(pos)[$z_2 = #gravier-height thin \"m\"$]\n\n  anchor(\"A\", (rel: (-0.1, -0.1), to: (0, 0)))\n  content(\"A\", anchor: \"north-east\")[$A$]\n\n  line((0, 0), (0, height), stroke: 1.5pt)\n})\n```\n\n<details><summary>Output</summary>\n\n![image|490x500, 75%](upload://yzv4GchSJSE4g1GxgClfyTknB0K.png)\n\n</details>\n\nYou can change these variables and pretty much everything will automatically adapt to new values:\n\n```typc\n  let height = 6\n  let gravier-height = 2\n  let beta = 20deg\n  let slope = (beta, 5)\n  let right-length = 3\n```\n\nThe only thing that doesn't work great is the pattern. It is pretty complex in terms of transformation, so I don't know how to make it more adaptable. I also tried to copy the start/end look from the original image.\n\nYou can play with global `length` and font size to get better scaling of things.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 31,
      "score": 21.2,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11922,
      "post_number": 4,
      "username": "TlidYou",
      "name": "TlidYou",
      "created_at": "2025-05-03T04:18:06.092Z",
      "updated_at": "2025-05-03T04:18:06.092Z",
      "cooked": "<p>Thank you for your time.</p>",
      "raw": "Thank you for your time.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 31,
      "score": 11.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1467
    },
    {
      "id": 11962,
      "post_number": 5,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2025-05-04T12:46:39.740Z",
      "updated_at": "2025-05-04T12:46:39.740Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/tlidyou\">@TlidYou</a>, thanks for your question! If you feel the response you got has sufficiently answered your question, be sure to give it a checkmark <img src=\"https://forum.typst.app/images/emoji/apple/ballot_box_with_check.png?v=12\" title=\":ballot_box_with_check:\" class=\"emoji\" alt=\":ballot_box_with_check:\" loading=\"lazy\" width=\"20\" height=\"20\">. This will help others find the solution in the future. If something is missing, please let us know what so we can resolve your issue. Thanks!</p>",
      "raw": "Hi @TlidYou, thanks for your question! If you feel the response you got has sufficiently answered your question, be sure to give it a checkmark :ballot_box_with_check:. This will help others find the solution in the future. If something is missing, please let us know what so we can resolve your issue. Thanks!",
      "reply_to_post_number": 4,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 21,
      "score": 4.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    }
  ],
  "scraped_at": "2025-06-10T09:48:21.482611"
}
{
  "topic_metadata": {
    "id": 3927,
    "title": "[Redundant] How to remove the extra space after a label reference?",
    "slug": "redundant-how-to-remove-the-extra-space-after-a-label-reference",
    "posts_count": 3,
    "created_at": "2025-05-04T12:53:26.924Z",
    "last_posted_at": "2025-05-04T14:07:15.275Z",
    "views": 43,
    "like_count": 0,
    "reply_count": 0,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Andrew",
    "tags": [],
    "category_id": 5,
    "participant_count": 2,
    "word_count": 131
  },
  "posts": [
    {
      "id": 11963,
      "post_number": 1,
      "username": "bowentan",
      "name": "Bowen",
      "created_at": "2025-05-04T12:53:27.060Z",
      "updated_at": "2025-05-04T14:07:58.100Z",
      "cooked": "<p>When I have inserted a figure or equation and reference it in texts:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#figure(\n  ...\n)&lt;fig1&gt;\n\nHere texts @fig1.\n</code></pre>\n<p>But the rendered texts are:</p>\n<pre data-code-wrap=\"txt\"><code class=\"lang-txt\">Here texts Figure 1 .\n</code></pre>\n<p>Note that there is a space after the reference. I want to remove the space. Is there any way to do that?</p>",
      "raw": "When I have inserted a figure or equation and reference it in texts:\n```typst\n#figure(\n  ...\n)<fig1>\n\nHere texts @fig1.\n```\nBut the rendered texts are:\n```txt\nHere texts Figure 1 .\n```\nNote that there is a space after the reference. I want to remove the space. Is there any way to do that?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 29,
      "score": 40.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1554
    },
    {
      "id": 11968,
      "post_number": 2,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-04T13:21:27.697Z",
      "updated_at": "2025-05-04T13:21:27.697Z",
      "cooked": "<p>Hello. Can you change your post category <a class=\"hashtag-cooked\" href=\"/c/questions/5\" data-type=\"category\" data-slug=\"questions\" data-id=\"5\"><span class=\"hashtag-icon-placeholder\"><svg class=\"fa d-icon d-icon-square-full svg-icon svg-node\"><use href=\"#square-full\"></use></svg></span><span>Questions</span></a>?</p>\n<p>You didn’t provide a minimal reproducible example, as it doesn’t even compile (<a href=\"https://sscce.org/\" rel=\"noopener nofollow ugc\">https://sscce.org/</a>). By default, there is no space after figure numbering.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#figure[] &lt;fig1&gt;\n\nHere texts @fig1.\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/a/a19470ad991d1dc4c310d8e84f4dce073d01ce1c.png\" alt=\"image\" data-base62-sha1=\"n3oU46Ij4BPa9WYBgsGd8o0lZCs\" width=\"209\" height=\"54\"></p>\n<p>Also, for plain text you can use <code>txt</code>/<code>text</code>/<code>plain</code>/<code>plaintext</code> language identifier to prevent any default syntax highlighting.</p>",
      "raw": "Hello. Can you change your post category #questions?\n\nYou didn't provide a minimal reproducible example, as it doesn't even compile (https://sscce.org/). By default, there is no space after figure numbering.\n\n```typ\n#figure[] <fig1>\n\nHere texts @fig1.\n```\n\n![image|209x54](upload://n3oU46Ij4BPa9WYBgsGd8o0lZCs.png)\n\nAlso, for plain text you can use `txt`/`text`/`plain`/`plaintext` language identifier to prevent any default syntax highlighting.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 29,
      "score": 5.6,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11971,
      "post_number": 3,
      "username": "bowentan",
      "name": "Bowen",
      "created_at": "2025-05-04T14:07:15.275Z",
      "updated_at": "2025-05-04T14:07:15.275Z",
      "cooked": "<p>I found it was my figure setting that caused the issue. Sorry for this redundant topic.</p>",
      "raw": "I found it was my figure setting that caused the issue. Sorry for this redundant topic.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 27,
      "score": 5.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1554
    }
  ],
  "scraped_at": "2025-06-10T09:48:20.305111"
}
{
  "topic_metadata": {
    "id": 3929,
    "title": "How do I create a blank line above a \"Gentle Clues\" tip?",
    "slug": "how-do-i-create-a-blank-line-above-a-gentle-clues-tip",
    "posts_count": 4,
    "created_at": "2025-05-04T16:27:16.179Z",
    "last_posted_at": "2025-05-04T18:33:31.683Z",
    "views": 45,
    "like_count": 1,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Andrew",
    "tags": [
      "scripting",
      "layout",
      "packages"
    ],
    "category_id": 5,
    "participant_count": 2,
    "word_count": 611
  },
  "posts": [
    {
      "id": 11974,
      "post_number": 1,
      "username": "Mark_Hilton",
      "name": "Mark Hilton",
      "created_at": "2025-05-04T16:27:16.355Z",
      "updated_at": "2025-05-04T16:29:53.796Z",
      "cooked": "<p>Based on this code (thank you <a class=\"mention\" href=\"/u/bluss\">@bluss</a>), I get the tip style that I want:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/gentle-clues:1.2.0\" as gentle-clues-pkg: *\n#let tip(..args, body) = gentle-clues-pkg.tip(..args, {\n  set par(first-line-indent: 0pt,\n  spacing: 1em,\n )\n  body\n})\n\n#set par(\n  first-line-indent: 1em,\n  spacing: 0.65em,\n  justify: true,\n)\n\n#lorem(20)\n\n#lorem(20)\n\n#tip(title: \"my tips\", icon: none)[#lorem(20)\n\n#lorem(20)] \n</code></pre>\n<p>However, the “tip” follows immediately on from the preceding paragraph using the spacing set for the document:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/1/15690c0e5a213fcfe7b3bfcedefa0c0ac4202c7a.png\" data-download-href=\"https://forum.typst.app/uploads/default/15690c0e5a213fcfe7b3bfcedefa0c0ac4202c7a\" title=\"SCR-20250504-phde\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/1/15690c0e5a213fcfe7b3bfcedefa0c0ac4202c7a_2_690x233.png\" alt=\"SCR-20250504-phde\" data-base62-sha1=\"33p5x2tdV2tkQNjgIa5vk0dKmGm\" width=\"690\" height=\"233\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/1/15690c0e5a213fcfe7b3bfcedefa0c0ac4202c7a_2_690x233.png, https://forum.typst.app/uploads/default/optimized/2X/1/15690c0e5a213fcfe7b3bfcedefa0c0ac4202c7a_2_1035x349.png 1.5x, https://forum.typst.app/uploads/default/original/2X/1/15690c0e5a213fcfe7b3bfcedefa0c0ac4202c7a.png 2x\" data-dominant-color=\"ECEFEF\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">SCR-20250504-phde</span><span class=\"informations\">1286×436 152 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>How can I create a 1em blank line between the main text and the tip?</p>\n<p><img src=\"https://forum.typst.app/images/emoji/apple/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji only-emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"><br>\nMark</p>",
      "raw": "Based on this code (thank you @bluss), I get the tip style that I want:\n\n```typ\n#import \"@preview/gentle-clues:1.2.0\" as gentle-clues-pkg: *\n#let tip(..args, body) = gentle-clues-pkg.tip(..args, {\n  set par(first-line-indent: 0pt,\n  spacing: 1em,\n )\n  body\n})\n\n#set par(\n  first-line-indent: 1em,\n  spacing: 0.65em,\n  justify: true,\n)\n\n#lorem(20)\n\n#lorem(20)\n\n#tip(title: \"my tips\", icon: none)[#lorem(20)\n\n#lorem(20)] \n```\n\nHowever, the \"tip\" follows immediately on from the preceding paragraph using the spacing set for the document:\n\n![SCR-20250504-phde|690x233](upload://33p5x2tdV2tkQNjgIa5vk0dKmGm.png)\n\nHow can I create a 1em blank line between the main text and the tip?\n\n:slight_smile: \n Mark",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 24,
      "score": 29.8,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 1276
    },
    {
      "id": 11976,
      "post_number": 2,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-04T16:55:45.227Z",
      "updated_at": "2025-05-04T16:57:18.394Z",
      "cooked": "<p>Since <code>content-block</code>’s <code>block.above</code> is explicitly set to <code>0pt</code>, I think it is safe to use block set rule:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/gentle-clues:1.2.0\" as gentle-clues-pkg: *\n\n#let tip(..args, body) = {\n  set block(above: 1em)\n  gentle-clues-pkg.tip(..args, {\n    set par(first-line-indent: 0pt, spacing: 1em)\n    body\n  })\n}\n\n#set par(first-line-indent: 1em, spacing: 0.65em, justify: true)\n\n#lorem(20)\n\n#lorem(20)\n\n#tip(title: \"my tips\", icon: none)[\n  #lorem(20)\n\n  #lorem(20)\n]\n</code></pre>\n<p>Since <code>header-block</code> is the first element inside the outer block, changing its <code>block.above</code> won’t change anything.</p>\n<hr>\n<p>But at this point you can just write</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let tip(..args) = {\n  set block(above: 1em)\n  set par(first-line-indent: 0pt, spacing: 1em)\n  gentle-clues-pkg.tip(..args)\n}\n</code></pre>",
      "raw": "Since `content-block`'s `block.above` is explicitly set to `0pt`, I think it is safe to use block set rule:\n\n```typ\n#import \"@preview/gentle-clues:1.2.0\" as gentle-clues-pkg: *\n\n#let tip(..args, body) = {\n  set block(above: 1em)\n  gentle-clues-pkg.tip(..args, {\n    set par(first-line-indent: 0pt, spacing: 1em)\n    body\n  })\n}\n\n#set par(first-line-indent: 1em, spacing: 0.65em, justify: true)\n\n#lorem(20)\n\n#lorem(20)\n\n#tip(title: \"my tips\", icon: none)[\n  #lorem(20)\n\n  #lorem(20)\n]\n```\n\nSince `header-block` is the first element inside the outer block, changing its `block.above` won't change anything.\n\n---\n\nBut at this point you can just write\n\n```typ\n#let tip(..args) = {\n  set block(above: 1em)\n  set par(first-line-indent: 0pt, spacing: 1em)\n  gentle-clues-pkg.tip(..args)\n}\n```",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 21,
      "score": 9.2,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11977,
      "post_number": 3,
      "username": "Mark_Hilton",
      "name": "Mark Hilton",
      "created_at": "2025-05-04T18:06:33.369Z",
      "updated_at": "2025-05-04T18:06:33.369Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Andrew\" data-post=\"2\" data-topic=\"3929\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/andrew/48/62_2.png\" class=\"avatar\"> Andrew:</div>\n<blockquote>\n<p><code>#set par(first-line-indent: 1em, spacing: 0.65em, justify: true)</code></p>\n</blockquote>\n</aside>\n<p>Works beautifully, thank you, though visually it turns out that 1.35em looks better.</p>\n<p>I’m such a novice coder that I don’t know where to start for such things, and so have no idea about where or how <code>content-block’s block.above</code> is defined, for instance. In general, the documentation assumes more understanding than I have.</p>\n<p>When you say, “But at this point you can just write…”, is this as a result of the launch of Typstyle 0.13.4?</p>\n<p><img src=\"https://forum.typst.app/images/emoji/apple/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji only-emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"><br>\nMark</p>",
      "raw": "[quote=\"Andrew, post:2, topic:3929\"]\n`#set par(first-line-indent: 1em, spacing: 0.65em, justify: true)`\n[/quote]\nWorks beautifully, thank you, though visually it turns out that 1.35em looks better. \n\nI'm such a novice coder that I don't know where to start for such things, and so have no idea about where or how `content-block’s block.above` is defined, for instance. In general, the documentation assumes more understanding than I have.\n\nWhen you say, \"But at this point you can just write…\", is this as a result of the launch of Typstyle 0.13.4?\n\n:slight_smile: \n Mark",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 1,
      "reads": 16,
      "score": 23.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 1276
    },
    {
      "id": 11978,
      "post_number": 4,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-04T18:33:31.683Z",
      "updated_at": "2025-05-04T18:33:31.683Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Mark_Hilton\" data-post=\"3\" data-topic=\"3929\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/m/1F0115/48.png\" class=\"avatar\"> Mark_Hilton:</div>\n<blockquote>\n<p>where or how <code>content-block’s block.above</code> is defined, for instance.</p>\n</blockquote>\n</aside>\n<p>Go to <a href=\"https://typst.app/universe/search?kind=packages\" class=\"inline-onebox\">Search — Typst: Universe</a>, find <a href=\"https://typst.app/universe/package/gentle-clues\">the package</a>, in the “About” section go to the linked repository and look at the code. Or locally, open <a href=\"https://github.com/typst/packages?tab=readme-ov-file#downloads\" rel=\"noopener nofollow ugc\">cache dir</a> and find the package. Or find it directly in <a href=\"https://github.com/typst/packages/tree/main/packages/preview\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">packages/packages/preview at main · typst/packages · GitHub</a>. Then navigate to what you use. I just hit <code>gd</code> under the <code>tip</code> function call in Neovim when Tinymist is running and after a few indirections I found the <code>clue()</code> function that has the described internal parts.</p>\n<aside class=\"quote no-group\" data-username=\"Mark_Hilton\" data-post=\"3\" data-topic=\"3929\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/m/1F0115/48.png\" class=\"avatar\"> Mark_Hilton:</div>\n<blockquote>\n<p>When you say, “But at this point you can just write…”, is this as a result of the launch of Typstyle 0.13.4?</p>\n</blockquote>\n</aside>\n<p>No, Typstyle can’t modify your code. There is no difference if set rules are inside the code block for <code>tip()</code> or outside of it, so you can move them together and by that time <code>body</code> just a part of <code>..args</code> sink, so might as well remove it, it will still be passed as a part of <code>..args</code> spread. It is probably something that comes with experience, and I definitely have plenty of it by now. I don’t even code that much in other languages as much as I use Typst. The more you see other people’s code, the more chances you will find something new, that you can use to simplify some code.</p>",
      "raw": "[quote=\"Mark_Hilton, post:3, topic:3929\"]\nwhere or how `content-block’s block.above` is defined, for instance.\n[/quote]\n\nGo to https://typst.app/universe/search?kind=packages, find [the package](https://typst.app/universe/package/gentle-clues), in the \"About\" section go to the linked repository and look at the code. Or locally, open [cache dir](https://github.com/typst/packages?tab=readme-ov-file#downloads) and find the package. Or find it directly in https://github.com/typst/packages/tree/main/packages/preview. Then navigate to what you use. I just hit `gd` under the `tip` function call in Neovim when Tinymist is running and after a few indirections I found the `clue()` function that has the described internal parts.\n\n[quote=\"Mark_Hilton, post:3, topic:3929\"]\nWhen you say, “But at this point you can just write…”, is this as a result of the launch of Typstyle 0.13.4?\n[/quote]\n\nNo, Typstyle can't modify your code. There is no difference if set rules are inside the code block for `tip()` or outside of it, so you can move them together and by that time `body` just a part of `..args` sink, so might as well remove it, it will still be passed as a part of `..args` spread. It is probably something that comes with experience, and I definitely have plenty of it by now. I don't even code that much in other languages as much as I use Typst. The more you see other people's code, the more chances you will find something new, that you can use to simplify some code.",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 0,
      "reads": 19,
      "score": 3.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:48:19.605570"
}
{
  "topic_metadata": {
    "id": 3933,
    "title": "How to change the spacing between elements?",
    "slug": "how-to-change-the-spacing-between-elements",
    "posts_count": 2,
    "created_at": "2025-05-04T22:11:01.783Z",
    "last_posted_at": "2025-05-04T22:29:00.323Z",
    "views": 65,
    "like_count": 0,
    "reply_count": 0,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Andrew",
    "tags": [
      "layout"
    ],
    "category_id": 5,
    "participant_count": 2,
    "word_count": 158
  },
  "posts": [
    {
      "id": 11985,
      "post_number": 1,
      "username": "Hasan",
      "name": "Hasan",
      "created_at": "2025-05-04T22:11:01.894Z",
      "updated_at": "2025-05-04T22:11:01.894Z",
      "cooked": "<p>Hi<br>\nIs there a general way to change how much do elements in Typst take space either by shrinking or widening the space it takes?</p>\n<p>For instance, let’s take two lines:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set page(height: 5cm, width: 10cm)\n\n#line(length: 100%)\n#line(length: 100%, stroke: 1pt + blue)\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/7/7608b966b023209e79d4e3f2e6bf9c9f05f8cb3f.png\" data-download-href=\"https://forum.typst.app/uploads/default/7608b966b023209e79d4e3f2e6bf9c9f05f8cb3f\" title=\"hh\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/7/7608b966b023209e79d4e3f2e6bf9c9f05f8cb3f_2_689x345.png\" alt=\"hh\" data-base62-sha1=\"gQb238FqakjfYxCnF1Sszhd1xdJ\" width=\"689\" height=\"345\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/7/7608b966b023209e79d4e3f2e6bf9c9f05f8cb3f_2_689x345.png, https://forum.typst.app/uploads/default/optimized/2X/7/7608b966b023209e79d4e3f2e6bf9c9f05f8cb3f_2_1033x517.png 1.5x, https://forum.typst.app/uploads/default/original/2X/7/7608b966b023209e79d4e3f2e6bf9c9f05f8cb3f.png 2x\" data-dominant-color=\"FCFDFD\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">hh</span><span class=\"informations\">1181×591 16.5 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div><br>\nWhat would be the best way to control the space between the black line and the blue line and make them closer? Are <code>move()</code> and <code>place()</code> functions my best options?</p>",
      "raw": "Hi\nIs there a general way to change how much do elements in Typst take space either by shrinking or widening the space it takes?\n\nFor instance, let's take two lines:\n\n```typ\n#set page(height: 5cm, width: 10cm)\n\n#line(length: 100%)\n#line(length: 100%, stroke: 1pt + blue)\n```\n ![hh|689x345](upload://gQb238FqakjfYxCnF1Sszhd1xdJ.png)\nWhat would be the best way to control the space between the black line and the blue line and make them closer? Are `move()` and `place()` functions my best options?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 29,
      "score": 60.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 766
    },
    {
      "id": 11986,
      "post_number": 2,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-04T22:29:00.323Z",
      "updated_at": "2025-05-04T22:29:24.029Z",
      "cooked": "<p>Hi. Depends on your end goal, but block-level elements can be changed by <a href=\"https://typst.app/docs/reference/layout/block/#parameters-spacing\"><code>block</code></a> set rule, and also sometimes by <a href=\"https://typst.app/docs/reference/model/par/#parameters-spacing\"><code>par.spacing</code></a>, so either one works here:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set page(height: 5cm, width: 10cm)\n\n#{\n  // set block(spacing: 2pt)\n  set par(spacing: 2pt)\n\n  line(length: 100%)\n  line(length: 100%, stroke: 1pt + blue)\n}\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/8/8cd96cd7c22e1dee96b9c9f2937a0999fbdba0d8.png\" data-download-href=\"https://forum.typst.app/uploads/default/8cd96cd7c22e1dee96b9c9f2937a0999fbdba0d8\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/original/2X/8/8cd96cd7c22e1dee96b9c9f2937a0999fbdba0d8.png\" alt=\"image\" data-base62-sha1=\"k60FYUhHH8mZ9lyDmwx5xcRXPdK\" width=\"690\" height=\"36\" data-dominant-color=\"2A3338\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">876×46 456 Bytes</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "Hi. Depends on your end goal, but block-level elements can be changed by [`block`](https://typst.app/docs/reference/layout/block/#parameters-spacing) set rule, and also sometimes by [`par.spacing`](https://typst.app/docs/reference/model/par/#parameters-spacing), so either one works here:\n\n```typ\n#set page(height: 5cm, width: 10cm)\n\n#{\n  // set block(spacing: 2pt)\n  set par(spacing: 2pt)\n\n  line(length: 100%)\n  line(length: 100%, stroke: 1pt + blue)\n}\n```\n\n![image|690x36](upload://k60FYUhHH8mZ9lyDmwx5xcRXPdK.png)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 27,
      "score": 20.4,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:48:18.775429"
}
{
  "topic_metadata": {
    "id": 3940,
    "title": "Why does my header code no longer work in Typst 0.13?",
    "slug": "why-does-my-header-code-no-longer-work-in-typst-0-13",
    "posts_count": 5,
    "created_at": "2025-05-05T15:51:09.137Z",
    "last_posted_at": "2025-05-06T14:43:32.270Z",
    "views": 92,
    "like_count": 3,
    "reply_count": 2,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Andrew",
    "tags": [
      "scripting",
      "layout"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 456
  },
  "posts": [
    {
      "id": 11997,
      "post_number": 1,
      "username": "Suizii",
      "name": "",
      "created_at": "2025-05-05T15:51:09.638Z",
      "updated_at": "2025-05-05T22:26:10.457Z",
      "cooked": "<h2><a name=\"p-11997-the-following-code-is-used-to-indicate-the-title-of-the-chapter-at-the-top-of-a-presentation-this-no-longer-works-in-013-can-anyone-solve-this-function-thank-you-for-your-reply-1\" class=\"anchor\" href=\"#p-11997-the-following-code-is-used-to-indicate-the-title-of-the-chapter-at-the-top-of-a-presentation-this-no-longer-works-in-013-can-anyone-solve-this-function-thank-you-for-your-reply-1\"></a>The following code is used to indicate the title of the chapter at the top of a presentation.<br>\nThis no longer works in 0.13.<br>\nCan anyone solve this function?<br>\nThank you for your reply.</h2>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let current-chapter-title() = locate(loc =&gt; {\n  let headings = query(selector(heading.where(level:1)).before(loc))\n  if headings != () {\n    headings.last().body\n  } else {\n    \"Aucun titre trouvé\"\n  }\n})\n</code></pre>\n<hr>\n<h2><a name=\"p-11997-example-1-2\" class=\"anchor\" href=\"#p-11997-example-1-2\"></a>Example 1</h2>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">In this chapter (#current-chapter-title())...\n</code></pre>\n<h2><a name=\"p-11997-example-2-3\" class=\"anchor\" href=\"#p-11997-example-2-3\"></a>Example 2</h2>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set page(columns: 1,height: 1080pt, width: 1920pt, margin: (top: 55mm, right: 30mm, bottom: 30mm, left: 35mm), \nbackground: [#image(\"2.jpg\", width: 101%)], \nheader: [#place(dx: 1mm, dy: 9mm, left, text([#context counter(heading).display() - #current-chapter-title() | page #context counter(page).display()]\n,stroke: 0pt, size: 40pt, font: \"DejaVu Serif\"))]\n)\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/6/6f736eccc67ac803ead914ff445cffb75c4a1384.jpeg\" data-download-href=\"https://forum.typst.app/uploads/default/6f736eccc67ac803ead914ff445cffb75c4a1384\" title=\"SmartSelect_20250505_172610_Chrome\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/6/6f736eccc67ac803ead914ff445cffb75c4a1384_2_690x255.jpeg\" alt=\"SmartSelect_20250505_172610_Chrome\" data-base62-sha1=\"fTWjoHSut4IRzaMerYFTGM29w8Y\" width=\"690\" height=\"255\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/6/6f736eccc67ac803ead914ff445cffb75c4a1384_2_690x255.jpeg, https://forum.typst.app/uploads/default/optimized/2X/6/6f736eccc67ac803ead914ff445cffb75c4a1384_2_1035x382.jpeg 1.5x, https://forum.typst.app/uploads/default/optimized/2X/6/6f736eccc67ac803ead914ff445cffb75c4a1384_2_1380x510.jpeg 2x\" data-dominant-color=\"151515\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">SmartSelect_20250505_172610_Chrome</span><span class=\"informations\">1920×710 86.2 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "The following code is used to indicate the title of the chapter at the top of a presentation.\nThis no longer works in 0.13.\nCan anyone solve this function?\nThank you for your reply.\n---\n```typ \n#let current-chapter-title() = locate(loc => {\n  let headings = query(selector(heading.where(level:1)).before(loc))\n  if headings != () {\n    headings.last().body\n  } else {\n    \"Aucun titre trouvé\"\n  }\n})\n```\n---\n## Example 1\n```typ\nIn this chapter (#current-chapter-title())...\n```\n## Example 2\n```typ\n#set page(columns: 1,height: 1080pt, width: 1920pt, margin: (top: 55mm, right: 30mm, bottom: 30mm, left: 35mm), \nbackground: [#image(\"2.jpg\", width: 101%)], \nheader: [#place(dx: 1mm, dy: 9mm, left, text([#context counter(heading).display() - #current-chapter-title() | page #context counter(page).display()]\n,stroke: 0pt, size: 40pt, font: \"DejaVu Serif\"))]\n)\n```\n![SmartSelect_20250505_172610_Chrome|690x255, 100%](upload://fTWjoHSut4IRzaMerYFTGM29w8Y.jpeg)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 34,
      "score": 46.8,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1558
    },
    {
      "id": 12004,
      "post_number": 2,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-05T17:44:19.844Z",
      "updated_at": "2025-05-05T17:44:19.844Z",
      "cooked": "<p>Hey. This is a breaking change. You should look at any breaking changes in the new version before switching to it.</p>\n<aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://github.com/typst/typst/releases/tag/v0.13.0#:~:text=Removed%20compatibility%20behavior%20of%20locate%20(Breaking%20change)\">\n  <header class=\"source\">\n      <img src=\"https://forum.typst.app/uploads/default/original/2X/b/bad3e5f9ad67c1ddf145107ce7032ac1d7b22563.svg\" class=\"site-icon\" data-dominant-color=\"\" width=\"32\" height=\"32\">\n\n      <a href=\"https://github.com/typst/typst/releases/tag/v0.13.0#:~:text=Removed%20compatibility%20behavior%20of%20locate%20(Breaking%20change)\" target=\"_blank\" rel=\"noopener nofollow ugc\">GitHub</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/344;\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/e/e437cb90407d3c54d4bea959997febc68e9ab63c_2_690x345.png\" class=\"thumbnail\" data-dominant-color=\"ECF1F1\" width=\"690\" height=\"345\"></div>\n\n<h3><a href=\"https://github.com/typst/typst/releases/tag/v0.13.0#:~:text=Removed%20compatibility%20behavior%20of%20locate%20(Breaking%20change)\" target=\"_blank\" rel=\"noopener nofollow ugc\">Release Version 0.13.0 (February 19, 2025) · typst/typst</a></h3>\n\n  <p>Read the announcement blog post\nView changelog with links into the documentation on typst.app/docs\nHighlights\n\nThere is now a distinction between proper paragraphs and just inline-level content. Th...</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://typst.app/docs/reference/introspection/locate/\">\n  <header class=\"source\">\n      <img src=\"https://forum.typst.app/uploads/default/original/1X/098187a593d51c4db99324614e2baeeb1bb355cc.png\" class=\"site-icon\" data-dominant-color=\"3CA8B6\" width=\"32\" height=\"32\">\n\n      <a href=\"https://typst.app/docs/reference/introspection/locate/\" target=\"_blank\" rel=\"noopener\">Typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/361;\"><img src=\"https://forum.typst.app/uploads/default/optimized/1X/db1c18ed802fe6841bee62606931f352da10ed09_2_690x362.png\" class=\"thumbnail\" data-dominant-color=\"7CC2C5\" width=\"690\" height=\"362\"></div>\n\n<h3><a href=\"https://typst.app/docs/reference/introspection/locate/\" target=\"_blank\" rel=\"noopener\">Locate Function – Typst Documentation</a></h3>\n\n  <p>Documentation for the `locate` function.</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://typst.app/docs/reference/introspection/here/\">\n  <header class=\"source\">\n      <img src=\"https://forum.typst.app/uploads/default/original/1X/098187a593d51c4db99324614e2baeeb1bb355cc.png\" class=\"site-icon\" data-dominant-color=\"3CA8B6\" width=\"32\" height=\"32\">\n\n      <a href=\"https://typst.app/docs/reference/introspection/here/\" target=\"_blank\" rel=\"noopener\">Typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/361;\"><img src=\"https://forum.typst.app/uploads/default/optimized/1X/db1c18ed802fe6841bee62606931f352da10ed09_2_690x362.png\" class=\"thumbnail\" data-dominant-color=\"7CC2C5\" width=\"690\" height=\"362\"></div>\n\n<h3><a href=\"https://typst.app/docs/reference/introspection/here/\" target=\"_blank\" rel=\"noopener\">Here Function – Typst Documentation</a></h3>\n\n  <p>Documentation for the `here` function.</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let current-chapter-title() = context {\n  let headings = query(heading.where(level: 1).before(here()))\n  if headings == () { panic(\"Aucun titre trouvé\") }\n  headings.last().body\n}\n\n= Heading\n\n#current-chapter-title()\n</code></pre>",
      "raw": "Hey. This is a breaking change. You should look at any breaking changes in the new version before switching to it.\n\nhttps://github.com/typst/typst/releases/tag/v0.13.0#:~:text=Removed%20compatibility%20behavior%20of%20locate%20(Breaking%20change)\n\nhttps://typst.app/docs/reference/introspection/locate/\n\nhttps://typst.app/docs/reference/introspection/here/\n\n```typ\n#let current-chapter-title() = context {\n  let headings = query(heading.where(level: 1).before(here()))\n  if headings == () { panic(\"Aucun titre trouvé\") }\n  headings.last().body\n}\n\n= Heading\n\n#current-chapter-title()\n```",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 28,
      "score": 40.6,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 12008,
      "post_number": 3,
      "username": "PgBiel",
      "name": "",
      "created_at": "2025-05-05T22:27:12.691Z",
      "updated_at": "2025-05-05T22:27:12.691Z",
      "cooked": "<p>Hey <a class=\"mention\" href=\"/u/suizii\">@Suizii</a>, welcome to the forum! I’ve changed your question post’s title to better fit our guidelines: <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\" class=\"inline-onebox\">How to post in the Questions category</a></p>\n<p>Make sure your title is a question you’d ask to a friend about Typst. <img src=\"https://forum.typst.app/images/emoji/apple/wink.png?v=12\" title=\":wink:\" class=\"emoji\" alt=\":wink:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Hey @Suizii, welcome to the forum! I’ve changed your question post’s title to better fit our guidelines: https://forum.typst.app/t/how-to-post-in-the-questions-category/11\n\nMake sure your title is a question you’d ask to a friend about Typst. :wink:",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 5.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    },
    {
      "id": 12009,
      "post_number": 4,
      "username": "PgBiel",
      "name": "",
      "created_at": "2025-05-05T22:31:27.011Z",
      "updated_at": "2025-05-05T22:33:36.551Z",
      "cooked": "<p>To further clarify Andrew’s answer: the original functionality of the <code>locate</code> function was removed in Typst 0.13 (after being deprecated since Typst 0.11), and should be replaced with <code>context { ... }</code>. To get <code>loc</code> again, you can use <code>let loc = here()</code>, but that’s usually no longer necessary, as most operations which previously required a <code>loc</code> no longer do. Some examples:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// Before Typst 0.11:\n#locate(loc =&gt; {\n  let header-numbers = counter(heading).at(loc)\n  let all-headings = query(heading, loc)\n  let last-value-of-my-state = state(\"key\", 3).final(loc)\n  let headings-before-here = query(selector(heading).before(loc))\n  let current-page = loc.page()\n\n  // ...\n})\n\n// After Typst 0.11:\n#context {\n  let header-numbers = counter(heading).get()\n  let all-headings = query(heading)\n  let last-value-of-my-state = state(\"key\", 3).final()\n\n  // These still need the current location\n  // It can be retrieved with `here()`\n  let headings-before-here = query(selector(heading).before(here()))\n  let current-page = here().page()\n\n  // ...\n})\n</code></pre>\n<p>Note that the function named <code>locate</code> now has a new purpose: <code>locate(&lt;abc&gt;)</code> in a <code>context</code> will now return the location object of something with that label.</p>",
      "raw": "To further clarify Andrew's answer: the original functionality of the `locate` function was removed in Typst 0.13 (after being deprecated since Typst 0.11), and should be replaced with `context { ... }`. To get `loc` again, you can use `let loc = here()`, but that's usually no longer necessary, as most operations which previously required a `loc` no longer do. Some examples:\n\n```typ\n// Before Typst 0.11:\n#locate(loc => {\n  let header-numbers = counter(heading).at(loc)\n  let all-headings = query(heading, loc)\n  let last-value-of-my-state = state(\"key\", 3).final(loc)\n  let headings-before-here = query(selector(heading).before(loc))\n  let current-page = loc.page()\n\n  // ...\n})\n\n// After Typst 0.11:\n#context {\n  let header-numbers = counter(heading).get()\n  let all-headings = query(heading)\n  let last-value-of-my-state = state(\"key\", 3).final()\n\n  // These still need the current location\n  // It can be retrieved with `here()`\n  let headings-before-here = query(selector(heading).before(here()))\n  let current-page = here().page()\n\n  // ...\n})\n```\n\nNote that the function named `locate` now has a new purpose: `locate(<abc>)` in a `context` will now return the location object of something with that label.",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 24,
      "score": 39.8,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    },
    {
      "id": 12050,
      "post_number": 5,
      "username": "Suizii",
      "name": "",
      "created_at": "2025-05-06T14:43:32.270Z",
      "updated_at": "2025-05-06T14:43:32.270Z",
      "cooked": "<p>thank you for taking the time to explain this to me</p>",
      "raw": "thank you for taking the time to explain this to me",
      "reply_to_post_number": 4,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 4.4,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1558
    }
  ],
  "scraped_at": "2025-06-10T09:48:17.948834"
}
