{
  "topic_metadata": {
    "id": 3575,
    "title": "How to draw in absolute page coordinates in CeTZ?",
    "slug": "how-to-draw-in-absolute-page-coordinates-in-cetz",
    "posts_count": 5,
    "created_at": "2025-04-09T03:44:35.126Z",
    "last_posted_at": "2025-04-18T15:44:30.109Z",
    "views": 127,
    "like_count": 5,
    "reply_count": 2,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Mathemensch",
    "tags": [
      "cetz"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 599
  },
  "posts": [
    {
      "id": 10825,
      "post_number": 1,
      "username": "thornoar",
      "name": "Roman Maksimovich",
      "created_at": "2025-04-09T03:44:35.258Z",
      "updated_at": "2025-04-09T03:46:47.732Z",
      "cooked": "<p>Hi everyone! I’m writing an article about astronomy, and I’d like a page-wide schematic picture of the solar system on my title page. This is my code so far:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/cetz:0.3.4\" as cz\n#set page(margin: 0pt)\n#cz.canvas(\n  length: 2cm,\n  {\n    import cz.draw: *\n    let sunpos = (3,-7)\n    let sunrad = .8\n    let fontsize = 30pt\n\n    // Drawing the Sun\n    circle(name: \"sun\", sunpos, radius: sunrad, fill: black)\n    content(\"sun\", text(\"S\", size: fontsize, fill: white, stroke: white))\n\n    // Drawing the orbits\n    circle(sunpos, radius: 2, name: \"orbit-mercury\")\n    circle(sunpos, radius: 3, name: \"orbit-venus\")\n    circle(sunpos, radius: 4, name: \"orbit-earth\")\n    circle(sunpos, radius: 5, name: \"orbit-mars\")\n  }\n)\n#pagebreak()\n</code></pre>\n<p>This yields the following PDF page:<br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/2/296cdb04dd32901b6f6baae4682ba3bb3b50b7f4.png\" data-download-href=\"https://forum.typst.app/uploads/default/296cdb04dd32901b6f6baae4682ba3bb3b50b7f4\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/2/296cdb04dd32901b6f6baae4682ba3bb3b50b7f4_2_436x500.png\" alt=\"image\" data-base62-sha1=\"5UsNukEA4H952NL7WivOXvjRwxe\" width=\"436\" height=\"500\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/2/296cdb04dd32901b6f6baae4682ba3bb3b50b7f4_2_436x500.png, https://forum.typst.app/uploads/default/optimized/2X/2/296cdb04dd32901b6f6baae4682ba3bb3b50b7f4_2_654x750.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/2/296cdb04dd32901b6f6baae4682ba3bb3b50b7f4_2_872x1000.png 2x\" data-dominant-color=\"F6F6F6\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">1412×1618 155 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>The problem is that the canvas automatically fits the image to the top and left edges of the page, and so the Sun ends up equidistant from these edges, despite supposedly having coordinates <code>(3,-7)</code>. Is it possible to draw shapes where I actually want them to appear on the page, and just crop them if they go out of bounds? Ideally, I would like something like this (this was drawn in Asymptote):<br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/8/87a4af736cf9b26384fd3814d3d5a168bf3cce76.png\" data-download-href=\"https://forum.typst.app/uploads/default/87a4af736cf9b26384fd3814d3d5a168bf3cce76\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/8/87a4af736cf9b26384fd3814d3d5a168bf3cce76_2_353x500.png\" alt=\"image\" data-base62-sha1=\"jlXiiXSCmErXp6ZBTZ4KtDCOBrE\" width=\"353\" height=\"500\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/8/87a4af736cf9b26384fd3814d3d5a168bf3cce76_2_353x500.png, https://forum.typst.app/uploads/default/optimized/2X/8/87a4af736cf9b26384fd3814d3d5a168bf3cce76_2_529x750.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/8/87a4af736cf9b26384fd3814d3d5a168bf3cce76_2_706x1000.png 2x\" data-dominant-color=\"F8F8F8\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">1146×1620 73.1 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "Hi everyone! I'm writing an article about astronomy, and I'd like a page-wide schematic picture of the solar system on my title page. This is my code so far:\n```typ\n#import \"@preview/cetz:0.3.4\" as cz\n#set page(margin: 0pt)\n#cz.canvas(\n  length: 2cm,\n  {\n    import cz.draw: *\n    let sunpos = (3,-7)\n    let sunrad = .8\n    let fontsize = 30pt\n\n    // Drawing the Sun\n    circle(name: \"sun\", sunpos, radius: sunrad, fill: black)\n    content(\"sun\", text(\"S\", size: fontsize, fill: white, stroke: white))\n\n    // Drawing the orbits\n    circle(sunpos, radius: 2, name: \"orbit-mercury\")\n    circle(sunpos, radius: 3, name: \"orbit-venus\")\n    circle(sunpos, radius: 4, name: \"orbit-earth\")\n    circle(sunpos, radius: 5, name: \"orbit-mars\")\n  }\n)\n#pagebreak()\n```\n\nThis yields the following PDF page:\n![image|436x500](upload://5UsNukEA4H952NL7WivOXvjRwxe.png)\n\nThe problem is that the canvas automatically fits the image to the top and left edges of the page, and so the Sun ends up equidistant from these edges, despite supposedly having coordinates `(3,-7)`. Is it possible to draw shapes where I actually want them to appear on the page, and just crop them if they go out of bounds? Ideally, I would like something like this (this was drawn in Asymptote):\n![image|353x500](upload://jlXiiXSCmErXp6ZBTZ4KtDCOBrE.png)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 35,
      "score": 187.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1159
    },
    {
      "id": 10833,
      "post_number": 2,
      "username": "Mathemensch",
      "name": "Alexander Schulz",
      "created_at": "2025-04-09T07:59:57.992Z",
      "updated_at": "2025-04-09T07:59:57.992Z",
      "cooked": "<p>Hi thornoa,</p>\n<p>As mentioned in the CeTZ manual, clipping is currently not supported. This means you can’t define a drawing box that restricts where lines are drawn—everything will be rendered regardless of the canvas boundaries.</p><aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://cetz-package.github.io/docs/tutorials/karl/#not-really-path-clipping\">\n  <header class=\"source\">\n\n      <a href=\"https://cetz-package.github.io/docs/tutorials/karl/#not-really-path-clipping\" target=\"_blank\" rel=\"noopener\">cetz-package.github.io</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    \n\n<h3><a href=\"https://cetz-package.github.io/docs/tutorials/karl/#not-really-path-clipping\" target=\"_blank\" rel=\"noopener\">A Picture for Karl's New Students | CeTZ Documentation</a></h3>\n\n  <p>This tutorial is intended for new users of CeTZ. It does not give an exhaustive account of all the features of CeTZ, just of those you are likely to use right away. This tutorial also acts as a parallel to TikZ's tutorial A Picture for Karl's...</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<p>A workaround is to place your canvas in the center of the page and shift it slightly, so the page edges effectively act as a “clip” for your solar system. You can even set the canvas as the page background:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/cetz:0.3.4\" as cz\n#set page(margin: 0pt, background: \n  move(\n    dx: 5cm,\n    dy: 5cm,\n    cz.canvas(\n      length: 4cm,\n      {\n        import cz.draw: *\n        let sunpos = (3, -7)\n        let sunrad = 0.8\n        let fontsize = 30pt\n\n        // Drawing the Sun\n        circle(name: \"sun\", sunpos, radius: sunrad, fill: black)\n        content(\"sun\", text(\"S\", size: fontsize, fill: white, stroke: white))\n\n        // Drawing the orbits\n        circle(sunpos, radius: 2, name: \"orbit-mercury\")\n        circle(sunpos, radius: 3, name: \"orbit-venus\")\n        circle(sunpos, radius: 4, name: \"orbit-earth\")\n        circle(sunpos, radius: 5, name: \"orbit-mars\")\n      }\n    )\n  )\n)\n#pagebreak()\n#set page(background: none)\n</code></pre>\n<p>Which results in this:<br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/2/2cf75bc6663d49ac7a622cf256a391059a1d41ec.png\" data-download-href=\"https://forum.typst.app/uploads/default/2cf75bc6663d49ac7a622cf256a391059a1d41ec\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/2/2cf75bc6663d49ac7a622cf256a391059a1d41ec_2_361x500.png\" alt=\"image\" data-base62-sha1=\"6pMYfJ7FiGE6FOHYZJY8GIi1SNu\" width=\"361\" height=\"500\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/2/2cf75bc6663d49ac7a622cf256a391059a1d41ec_2_361x500.png, https://forum.typst.app/uploads/default/optimized/2X/2/2cf75bc6663d49ac7a622cf256a391059a1d41ec_2_541x750.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/2/2cf75bc6663d49ac7a622cf256a391059a1d41ec_2_722x1000.png 2x\" data-dominant-color=\"EEEEEE\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">1041×1440 106 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "Hi thornoa,\n\nAs mentioned in the CeTZ manual, clipping is currently not supported. This means you can't define a drawing box that restricts where lines are drawn—everything will be rendered regardless of the canvas boundaries.  \nhttps://cetz-package.github.io/docs/tutorials/karl/#not-really-path-clipping\n\nA workaround is to place your canvas in the center of the page and shift it slightly, so the page edges effectively act as a \"clip\" for your solar system. You can even set the canvas as the page background:\n\n```typ\n#import \"@preview/cetz:0.3.4\" as cz\n#set page(margin: 0pt, background: \n  move(\n    dx: 5cm,\n    dy: 5cm,\n    cz.canvas(\n      length: 4cm,\n      {\n        import cz.draw: *\n        let sunpos = (3, -7)\n        let sunrad = 0.8\n        let fontsize = 30pt\n\n        // Drawing the Sun\n        circle(name: \"sun\", sunpos, radius: sunrad, fill: black)\n        content(\"sun\", text(\"S\", size: fontsize, fill: white, stroke: white))\n\n        // Drawing the orbits\n        circle(sunpos, radius: 2, name: \"orbit-mercury\")\n        circle(sunpos, radius: 3, name: \"orbit-venus\")\n        circle(sunpos, radius: 4, name: \"orbit-earth\")\n        circle(sunpos, radius: 5, name: \"orbit-mars\")\n      }\n    )\n  )\n)\n#pagebreak()\n#set page(background: none)\n```\n\nWhich results in this:\n![image|361x500](upload://6pMYfJ7FiGE6FOHYZJY8GIi1SNu.png)",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 4,
      "reads": 33,
      "score": 76.6,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 307
    },
    {
      "id": 10835,
      "post_number": 3,
      "username": "thornoar",
      "name": "Roman Maksimovich",
      "created_at": "2025-04-09T09:04:20.085Z",
      "updated_at": "2025-04-09T09:04:20.085Z",
      "cooked": "<p>Thank you! That’s a great solution.</p>",
      "raw": "Thank you! That's a great solution.",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 30,
      "score": 36.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1159
    },
    {
      "id": 10949,
      "post_number": 4,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-11T21:19:08.974Z",
      "updated_at": "2025-04-11T21:19:08.974Z",
      "cooked": "<p>Yeah, since CeTZ is a package for drawing, it will show a full drawing, so to use negative value to move the drawing into the opposite direction you would have to use <code>move()</code>, although depending on what you need, a <code>place(dx: ..., dy: ..., cetz.canvas())</code> can be a better solution since it will by default start in the top left corner bypassing page margins if used as <code>background</code> or <code>foreground</code>.</p>",
      "raw": "Yeah, since CeTZ is a package for drawing, it will show a full drawing, so to use negative value to move the drawing into the opposite direction you would have to use `move()`, although depending on what you need, a `place(dx: ..., dy: ..., cetz.canvas())` can be a better solution since it will by default start in the top left corner bypassing page margins if used as `background` or `foreground`.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 23,
      "score": 9.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11287,
      "post_number": 5,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2025-04-18T15:44:30.109Z",
      "updated_at": "2025-04-18T15:44:30.109Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/thornoar\">@thornoar</a>, thanks for your question! If you feel the response you got has sufficiently answered your question, be sure to give it a checkmark <img src=\"https://forum.typst.app/images/emoji/apple/ballot_box_with_check.png?v=12\" title=\":ballot_box_with_check:\" class=\"emoji\" alt=\":ballot_box_with_check:\" loading=\"lazy\" width=\"20\" height=\"20\">. This will help others find the solution in the future. Thanks!</p>\n<p>As an aside - even though CeTZ doesn’t support clipping, <a href=\"https://typst.app/docs/reference/layout/block/#parameters-clip\"><code>block</code> does</a>, so you can use the shifting trick even when you don’t want to fill the full page. In addition to <code>move</code> (which will affect <em>where</em> the canvas is but not its size), you could also use <a href=\"https://typst.app/docs/reference/layout/pad/\"><code>pad</code></a> with negative values, so that Typst’s layouting (i.e. the surrounding clipping block) treats the canvas as smaller than it actually is.</p>",
      "raw": "Hi @thornoar, thanks for your question! If you feel the response you got has sufficiently answered your question, be sure to give it a checkmark :ballot_box_with_check:. This will help others find the solution in the future. Thanks!\n\nAs an aside - even though CeTZ doesn't support clipping, [`block` does](https://typst.app/docs/reference/layout/block/#parameters-clip), so you can use the shifting trick even when you don't want to fill the full page. In addition to `move` (which will affect _where_ the canvas is but not its size), you could also use [`pad`](https://typst.app/docs/reference/layout/pad/) with negative values, so that Typst's layouting (i.e. the surrounding clipping block) treats the canvas as smaller than it actually is.",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 20,
      "score": 4.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    }
  ],
  "scraped_at": "2025-06-10T09:49:30.597461"
}
{
  "topic_metadata": {
    "id": 3576,
    "title": "How can I parse content into a custom structure?",
    "slug": "how-can-i-parse-content-into-a-custom-structure",
    "posts_count": 5,
    "created_at": "2025-04-09T03:51:21.851Z",
    "last_posted_at": "2025-04-11T21:27:07.335Z",
    "views": 139,
    "like_count": 3,
    "reply_count": 3,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 3,
    "accepted_answer_username": "Bolt",
    "tags": [
      "scripting"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 389
  },
  "posts": [
    {
      "id": 10826,
      "post_number": 1,
      "username": "Bolt",
      "name": "",
      "created_at": "2025-04-09T03:51:21.987Z",
      "updated_at": "2025-04-11T01:20:17.917Z",
      "cooked": "<p>Is it possible to have a function parse content into a custom structure like so?</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#parse[\n  [a[b[c][d]]]\n] == (body: [a], children: (\n  (body: [b], children: (\n      (body: [c], children: ()),\n      (body: [d], children: ()),\n    )\n  ),\n))\n</code></pre>\n<p>I know how to do this for strings and have done so, but would like to write a solution which allows for any content as the nodes’ bodies. I could try going into the sequence and messing around, but I wanted to see if there’s a better way to approah this first.</p>\n<p>As a note, square brackets are typically used for this (linguistics syntax trees), but if it’s not possible I’d still be interested in how to do this for other delimiters.</p>",
      "raw": "Is it possible to have a function parse content into a custom structure like so?\n```typ\n#parse[\n  [a[b[c][d]]]\n] == (body: [a], children: (\n  (body: [b], children: (\n      (body: [c], children: ()),\n      (body: [d], children: ()),\n    )\n  ),\n))\n```\nI know how to do this for strings and have done so, but would like to write a solution which allows for any content as the nodes' bodies. I could try going into the sequence and messing around, but I wanted to see if there's a better way to approah this first. \n\nAs a note, square brackets are typically used for this (linguistics syntax trees), but if it's not possible I'd still be interested in how to do this for other delimiters.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 31,
      "score": 196.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 737
    },
    {
      "id": 10830,
      "post_number": 2,
      "username": "gezepi",
      "name": "",
      "created_at": "2025-04-09T05:58:21.073Z",
      "updated_at": "2025-04-09T05:58:21.073Z",
      "cooked": "<p>Since you’ve already got a way to turn a string like “a[b[c]]” into that type of structure, maybe all you need is a way to convert <code>content</code> to <code>string</code>:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let parseAsString(it) = {\n  let asString = it.fields().at(\"children\")\n    .map(c =&gt; c.fields())\n    .map(v =&gt; v.at(\"text\", default: none))\n    .filter(v =&gt; v != none).join()\n  \n  return asString\n}\n</code></pre>\n<p>A more general solution for converting content to string was provided by GitHub user <code>lvjr</code> here:</p><aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://github.com/typst/typst/discussions/3876#discussioncomment-9016808\">\n  <header class=\"source\">\n      <img src=\"https://forum.typst.app/uploads/default/original/2X/b/bad3e5f9ad67c1ddf145107ce7032ac1d7b22563.svg\" class=\"site-icon\" data-dominant-color=\"\" width=\"32\" height=\"32\">\n\n      <a href=\"https://github.com/typst/typst/discussions/3876#discussioncomment-9016808\" target=\"_blank\" rel=\"noopener\">GitHub</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/344;\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/9/9119129a5c9b4de1ee748c64a1ea5f6efb67705f_2_690x345.png\" class=\"thumbnail\" data-dominant-color=\"F4F5F3\" width=\"690\" height=\"345\"></div>\n\n<h3><a href=\"https://github.com/typst/typst/discussions/3876#discussioncomment-9016808\" target=\"_blank\" rel=\"noopener\">Turning content into string · typst/typst · Discussion #3876</a></h3>\n\n  <p>In a comment in issue #2196, @EpicEricEE gave a function for turning content into string, but it failed when the content has some math function such as sin: #let to-string(content) = { if content.h...</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
      "raw": "Since you've already got a way to turn a string like \"a[b[c]]\" into that type of structure, maybe all you need is a way to convert `content` to `string`:\n```typ\n#let parseAsString(it) = {\n  let asString = it.fields().at(\"children\")\n    .map(c => c.fields())\n    .map(v => v.at(\"text\", default: none))\n    .filter(v => v != none).join()\n  \n  return asString\n}\n```\n\nA more general solution for converting content to string was provided by GitHub user `lvjr` here:\nhttps://github.com/typst/typst/discussions/3876#discussioncomment-9016808",
      "reply_to_post_number": null,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 0,
      "reads": 29,
      "score": 20.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 326
    },
    {
      "id": 10851,
      "post_number": 3,
      "username": "Bolt",
      "name": "",
      "created_at": "2025-04-09T14:58:14.133Z",
      "updated_at": "2025-04-09T14:58:14.133Z",
      "cooked": "<p>That would work if I only wanted string output. I was able to find a solution that preserves content (ie. allows <code>[$x$[*y*][@z]]</code>). As a result of using square brackets, all content passed into the function ends up being a sequence (as far as I can tell), where <code>[</code> and <code>]</code> are never grouped with anything else (they’re their own child). So I ended up taking the sequence’s children and matching on <code>[[]</code> and <code>[]]</code> instead of <code>\"[\"</code> and <code>\"]\"</code>, then concatenating the children which make up the body.</p>",
      "raw": "That would work if I only wanted string output. I was able to find a solution that preserves content (ie. allows `[$x$[*y*][@z]]`). As a result of using square brackets, all content passed into the function ends up being a sequence (as far as I can tell), where `[` and `]` are never grouped with anything else (they're their own child). So I ended up taking the sequence's children and matching on `[[]` and `[]]` instead of `\"[\"` and `\"]\"`, then concatenating the children which make up the body.",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 5.0,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 737
    },
    {
      "id": 10867,
      "post_number": 4,
      "username": "Bolt",
      "name": "",
      "created_at": "2025-04-10T01:35:52.510Z",
      "updated_at": "2025-04-10T01:35:52.510Z",
      "cooked": "<p>I ended up needing this for an extension to my parser, so it was super helpful. Thanks! I  modified it for my use case to preserve quotation marks, so here’s that for posterity.</p>\n<pre><code class=\"lang-auto\">let stringify(it) = {\n  for child in it.children {\n    if child.func() == smartquote {\n        if child.double { \"\\\"\" } else { \"'\" }\n      } else {\n        child.at(\"text\", default: none)\n      }\n  }\n}\n</code></pre>",
      "raw": "I ended up needing this for an extension to my parser, so it was super helpful. Thanks! I  modified it for my use case to preserve quotation marks, so here's that for posterity.\n\n```\nlet stringify(it) = {\n  for child in it.children {\n    if child.func() == smartquote {\n        if child.double { \"\\\"\" } else { \"'\" }\n      } else {\n        child.at(\"text\", default: none)\n      }\n  }\n}\n```",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 3,
      "reads": 22,
      "score": 64.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 737
    },
    {
      "id": 10951,
      "post_number": 5,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-11T21:27:07.335Z",
      "updated_at": "2025-04-11T21:27:07.335Z",
      "cooked": "<p>For converting content to string, there is t4t package:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/t4t:0.4.2\": get\n#get.text[content]\n</code></pre>\n<p>Although it doesn’t always work as expected, like for math mode, but I think there are other packages that can handle math conversion.</p>",
      "raw": "For converting content to string, there is t4t package:\n\n```typ\n#import \"@preview/t4t:0.4.2\": get\n#get.text[content]\n```\n\nAlthough it doesn't always work as expected, like for math mode, but I think there are other packages that can handle math conversion.",
      "reply_to_post_number": 4,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 18,
      "score": 3.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:49:29.877146"
}
{
  "topic_metadata": {
    "id": 3579,
    "title": "How can I replace markup tags in a CSV file with Typst markup?",
    "slug": "how-can-i-replace-markup-tags-in-a-csv-file-with-typst-markup",
    "posts_count": 6,
    "created_at": "2025-04-09T10:06:55.111Z",
    "last_posted_at": "2025-04-18T16:25:32.487Z",
    "views": 86,
    "like_count": 4,
    "reply_count": 4,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Mathemensch",
    "tags": [
      "text-formatting",
      "data-loading"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 1096
  },
  "posts": [
    {
      "id": 10836,
      "post_number": 1,
      "username": "maxigaz",
      "name": "maxigaz",
      "created_at": "2025-04-09T10:06:55.275Z",
      "updated_at": "2025-04-09T10:11:57.274Z",
      "cooked": "<p>There’s a video game that stores its dialogue transcript in all the languages supported by the game inside a single <code>.csv</code> file. With Typst, I can turn this into a table, which helps me a lot in learning/practising some of the languages.</p>\n<p>The <code>.csv</code> file contains some game-specific markup that makes pieces of the text show up as bold or italics, or with a different size or colour in the game. Here are a few examples:</p>\n<pre><code class=\"lang-auto\">{i}This{/i} should be emphasized. {i}Another{/i} example.\n\n{color=#3761d9}Blue{/color} coloured text.\n\n{size=20}This{/size} should be smaller.\n</code></pre>\n<p>My end-goal would be to turn the example above into this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#emph[This] should be emphasized. #emph[Another] example.\n\n#text(rgb(\"#3761d9\"), [Blue]) coloured text.\n\n#text(0.7em, [This]) should be smaller.\n</code></pre>\n<details>\n<summary>\nOutput screenshot</summary>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/1/19d16ec5aabef834f52146c2b9bbc3672e332836.png\" alt=\"typst-csv-formatting-goal\" data-base62-sha1=\"3GoDWx3l7d8rwJ5QOthFTsKulOm\" width=\"409\" height=\"109\"></p>\n</details>\n<p>Here’s my attempt so far:</p>\n<details>\n<summary>\nSource code with rules and turning the CSV into a table</summary>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let transcript = csv(\"transcript.csv\", row-type: dictionary)\n\n// Italics and bold\n#show regex(\"\\{i\\}.*\\{/i\\}\"): it =&gt; {\n  show regex(\"\\{i\\}\"): \"\"\n  show regex(\"\\{/i\\}\"): \"\"\n  emph[#it]\n}\n#show regex(\"\\{b\\}.*\\{/b\\}\"): it =&gt; {\n  show regex(\"\\{b\\}\"): \"\"\n  show regex(\"\\{/b\\}\"): \"\"\n  emph[#it]\n}\n\n// Size and colour\n#show regex(\"\\{size=\\d+\\}.*\\{/size\\}\"): it =&gt; {\n  show regex(\"\\{size=\\d+\\}\"): \"\"\n  show regex(\"\\{/size\\}\"): \"\"\n  text(rgb(\"#666\"), it)\n}\n#show regex(\"\\{color=#......\\}.*\\{/color\\}\"): it =&gt; {\n  show regex(\"\\{color=#......\\}\"): \"\"\n  show regex(\"\\{/color\\}\"): \"\"\n  text(rgb(\"#666\"), it)\n}\n\n#table(\n  columns: 4,\n  stroke: 0.3pt,\n  table.header([*Key*], [*English*], [*Spanish*], [*Japanese*],),\n  ..transcript.map(row =&gt; (row.Key, row.Standard, row.Spanish, row.Japanese)).flatten()\n)\n</code></pre>\n</details>\n<p>For handling the markup for colour and size changes, I believe I would need to capture the values for that (like <code>#3761d9</code> and <code>20</code>), which I don’t know how to do (yet). So, for now, I’ve just made two rules that turn anything wrapped in a <code>{color}</code> or <code>{size}</code> into grey. (While not the ideal solution, at least this would be a clear indication that the passage in question is supposed to have some special markup.)</p>\n<p>As for text wrapped in <code>{i}</code> or <code>{b}</code>, the rules mostly work. The only problem is when there are two non-consecutive pieces of text meant to be displayed in italics, everything between them is also turned into italics. (This might have something to do with how greedy the regex rule is.)</p>\n<details>\n<summary>\nOutput screenshot with the italics rule</summary>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/2/2eab0780fa1656727a9267ad269029b223ae2875.png\" alt=\"typst-csv-formatting-italics\" data-base62-sha1=\"6EQojOrujwLKwmqiOObwxe0T0vH\" width=\"397\" height=\"35\"></p>\n</details>\n<p>P.S.: I’ve also thought about manipulating the <code>.csv</code> file with <code>sed</code> in a way that  Typst’s own markup is read from there instead of relying on show rules, but I’m not sure if Typst would recognise the markup that way.</p>",
      "raw": "There's a video game that stores its dialogue transcript in all the languages supported by the game inside a single `.csv` file. With Typst, I can turn this into a table, which helps me a lot in learning/practising some of the languages.\n\nThe `.csv` file contains some game-specific markup that makes pieces of the text show up as bold or italics, or with a different size or colour in the game. Here are a few examples:\n\n```\n{i}This{/i} should be emphasized. {i}Another{/i} example.\n\n{color=#3761d9}Blue{/color} coloured text.\n\n{size=20}This{/size} should be smaller.\n```\n\nMy end-goal would be to turn the example above into this:\n\n```typ\n#emph[This] should be emphasized. #emph[Another] example.\n\n#text(rgb(\"#3761d9\"), [Blue]) coloured text.\n\n#text(0.7em, [This]) should be smaller.\n```\n\n[details=\"Output screenshot\"]\n![typst-csv-formatting-goal|409x109](upload://3GoDWx3l7d8rwJ5QOthFTsKulOm.png)\n[/details]\n\nHere's my attempt so far:\n\n[details=\"Source code with rules and turning the CSV into a table\"]\n```typ\n#let transcript = csv(\"transcript.csv\", row-type: dictionary)\n\n// Italics and bold\n#show regex(\"\\{i\\}.*\\{/i\\}\"): it => {\n  show regex(\"\\{i\\}\"): \"\"\n  show regex(\"\\{/i\\}\"): \"\"\n  emph[#it]\n}\n#show regex(\"\\{b\\}.*\\{/b\\}\"): it => {\n  show regex(\"\\{b\\}\"): \"\"\n  show regex(\"\\{/b\\}\"): \"\"\n  emph[#it]\n}\n\n// Size and colour\n#show regex(\"\\{size=\\d+\\}.*\\{/size\\}\"): it => {\n  show regex(\"\\{size=\\d+\\}\"): \"\"\n  show regex(\"\\{/size\\}\"): \"\"\n  text(rgb(\"#666\"), it)\n}\n#show regex(\"\\{color=#......\\}.*\\{/color\\}\"): it => {\n  show regex(\"\\{color=#......\\}\"): \"\"\n  show regex(\"\\{/color\\}\"): \"\"\n  text(rgb(\"#666\"), it)\n}\n\n#table(\n  columns: 4,\n  stroke: 0.3pt,\n  table.header([*Key*], [*English*], [*Spanish*], [*Japanese*],),\n  ..transcript.map(row => (row.Key, row.Standard, row.Spanish, row.Japanese)).flatten()\n)\n```\n[/details]\n\nFor handling the markup for colour and size changes, I believe I would need to capture the values for that (like `#3761d9` and `20`), which I don't know how to do (yet). So, for now, I've just made two rules that turn anything wrapped in a `{color}` or `{size}` into grey. (While not the ideal solution, at least this would be a clear indication that the passage in question is supposed to have some special markup.)\n\nAs for text wrapped in `{i}` or `{b}`, the rules mostly work. The only problem is when there are two non-consecutive pieces of text meant to be displayed in italics, everything between them is also turned into italics. (This might have something to do with how greedy the regex rule is.)\n\n[details=\"Output screenshot with the italics rule\"]\n![typst-csv-formatting-italics|397x35](upload://6EQojOrujwLKwmqiOObwxe0T0vH.png)\n[/details]\n\nP.S.: I've also thought about manipulating the `.csv` file with `sed` in a way that  Typst's own markup is read from there instead of relying on show rules, but I'm not sure if Typst would recognise the markup that way.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 21,
      "score": 64.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 738
    },
    {
      "id": 10837,
      "post_number": 2,
      "username": "Mathemensch",
      "name": "Alexander Schulz",
      "created_at": "2025-04-09T10:15:16.242Z",
      "updated_at": "2025-04-09T10:54:39.959Z",
      "cooked": "<p>Hey! I put together a little Typst snippet that does exactly what you described — it handles <em>italics</em>, <em>bold</em>, <em>color</em>, and <em>size</em>, and even extracts the actual values for color and size dynamically.</p>\n<p>I wasn’t sure what font sizes the game actually uses apart from 20, so I just picked an arbitrary scaling factor for now. If there are only a few distinct sizes, it might make more sense to map them explicitly — but for that, I’d need a bit more info on what sizes actually occur.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// Italics and bold\n#show regex(\"\\{i\\}.*?\\{/i\\}\"): it =&gt; {\n  emph[#it.text.replace(regex(\"\\{\\/?i\\}\"), \"\")]\n}\n#show regex(\"\\{b\\}.*?\\{/b\\}\"): it =&gt; {\n  strong[#it.text.replace(regex(\"\\{\\/?b\\}\"), \"\")]\n}\n\n// Size and colour\n#show regex(\"\\{size=\\d+\\}.*?\\{/size\\}\"): it =&gt; {\n  let size = int(it.text.match(regex(\"\\{size=(\\d+)\\}.*?\\{/size\\}\")).captures.at(0))\n  text(size: size * 0.03em, it.text.replace(regex(\"\\{\\/?size(?:=\\d+)?\\}\"), \"\"))\n}\n\n#show regex(\"\\{color=#[0-9a-fA-F]+\\}.*?\\{/color\\}\"): it =&gt; {\n  let color = rgb(it.text.match(regex(\"\\{color=(#[0-9a-fA-F]+)\\}.*?\\{/color\\}\")).captures.at(0))\n  text(color, it.text.replace(regex(\"\\{\\/?color+?=?#?[0-9a-fA-F]?+\\}\"), \"\"))\n}\n\n{i}This{/i} should be emphasized. {i}Another{/i} example.\n\n{b}This{/b} should be strong. {b}Another{/b} example.\n\n{color=\\#3761d9}Blue{/color} coloured text.\n\n{size=20}This{/size} should be smaller.\n</code></pre>\n<p>Which results in:<br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/9/9b72e68384182c7904409b34abdff7bda34d63ec.png\" data-download-href=\"https://forum.typst.app/uploads/default/9b72e68384182c7904409b34abdff7bda34d63ec\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/9/9b72e68384182c7904409b34abdff7bda34d63ec_2_690x305.png\" alt=\"image\" data-base62-sha1=\"mbabdI3Mj3QNqSHJt1tZ2h15f3K\" width=\"690\" height=\"305\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/9/9b72e68384182c7904409b34abdff7bda34d63ec_2_690x305.png, https://forum.typst.app/uploads/default/original/2X/9/9b72e68384182c7904409b34abdff7bda34d63ec.png 1.5x, https://forum.typst.app/uploads/default/original/2X/9/9b72e68384182c7904409b34abdff7bda34d63ec.png 2x\" data-dominant-color=\"F4F4F4\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">702×311 36 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>Let me know if you run into any issues adapting it to your use case! Also, if you can share a short sample of your CSV, that might help refine things even further. Would be happy to help you tweak it if needed!</p>",
      "raw": "Hey! I put together a little Typst snippet that does exactly what you described — it handles *italics*, *bold*, *color*, and *size*, and even extracts the actual values for color and size dynamically.\n\nI wasn’t sure what font sizes the game actually uses apart from 20, so I just picked an arbitrary scaling factor for now. If there are only a few distinct sizes, it might make more sense to map them explicitly — but for that, I’d need a bit more info on what sizes actually occur.\n\n\n```typ\n// Italics and bold\n#show regex(\"\\{i\\}.*?\\{/i\\}\"): it => {\n  emph[#it.text.replace(regex(\"\\{\\/?i\\}\"), \"\")]\n}\n#show regex(\"\\{b\\}.*?\\{/b\\}\"): it => {\n  strong[#it.text.replace(regex(\"\\{\\/?b\\}\"), \"\")]\n}\n\n// Size and colour\n#show regex(\"\\{size=\\d+\\}.*?\\{/size\\}\"): it => {\n  let size = int(it.text.match(regex(\"\\{size=(\\d+)\\}.*?\\{/size\\}\")).captures.at(0))\n  text(size: size * 0.03em, it.text.replace(regex(\"\\{\\/?size(?:=\\d+)?\\}\"), \"\"))\n}\n\n#show regex(\"\\{color=#[0-9a-fA-F]+\\}.*?\\{/color\\}\"): it => {\n  let color = rgb(it.text.match(regex(\"\\{color=(#[0-9a-fA-F]+)\\}.*?\\{/color\\}\")).captures.at(0))\n  text(color, it.text.replace(regex(\"\\{\\/?color+?=?#?[0-9a-fA-F]?+\\}\"), \"\"))\n}\n\n{i}This{/i} should be emphasized. {i}Another{/i} example.\n\n{b}This{/b} should be strong. {b}Another{/b} example.\n\n{color=\\#3761d9}Blue{/color} coloured text.\n\n{size=20}This{/size} should be smaller.\n```\n\nWhich results in:\n![image|690x305](upload://mbabdI3Mj3QNqSHJt1tZ2h15f3K.png)\n\nLet me know if you run into any issues adapting it to your use case! Also, if you can share a short sample of your CSV, that might help refine things even further. Would be happy to help you tweak it if needed!",
      "reply_to_post_number": null,
      "reply_count": 3,
      "quote_count": 0,
      "like_count": 2,
      "reads": 20,
      "score": 49.0,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 307
    },
    {
      "id": 10845,
      "post_number": 3,
      "username": "maxigaz",
      "name": "maxigaz",
      "created_at": "2025-04-09T12:13:21.752Z",
      "updated_at": "2025-04-09T12:13:21.752Z",
      "cooked": "<p>Thank you very much for the solution! It seems to work perfectly!</p>\n<p>Here’s a sample of the CSV file. I included the very first line from the original (which has the field names) and also 200 lines from somewhere in the middle, which also include lines with markup for italics, size, and color.</p>\n<p><a class=\"attachment\" href=\"/uploads/short-url/wXo0oZxcpZ4Z9S7mukZg0iUMvYI.csv\">transcript-sample.csv</a> (87.6 KB)</p>",
      "raw": "Thank you very much for the solution! It seems to work perfectly!\n\nHere's a sample of the CSV file. I included the very first line from the original (which has the field names) and also 200 lines from somewhere in the middle, which also include lines with markup for italics, size, and color.\n\n[transcript-sample.csv|attachment](upload://wXo0oZxcpZ4Z9S7mukZg0iUMvYI.csv) (87.6 KB)",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 18,
      "score": 18.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 738
    },
    {
      "id": 10953,
      "post_number": 4,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-11T22:55:11.466Z",
      "updated_at": "2025-04-11T22:59:56.611Z",
      "cooked": "<p>Since data comes from strings, <code>str.replace</code> can be effectively used here:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let process-text(text) = {\n  import \"@preview/oxifmt:0.2.1\": strfmt\n  let args(left, right, substitution) = (\n    regex(\"\\{\" + left + \"}(.*?)\\{/\" + right + \"}\"),\n    x =&gt; strfmt(substitution, ..x.captures),\n  )\n  let str = text\n    .replace(..args(\"i\", \"i\", \"#emph[{}]\"))\n    .replace(..args(\"b\", \"b\", \"#strong[{}]\"))\n    .replace(..args(\"size=(\\d+)\", \"size\", \"#text({} * 0.03em)[{}]\"))\n    .replace(..args(\"color=#(\\w+)\", \"color\", \"#text(rgb(\\\"{}\\\"))[{}]\"))\n    .replace(regex(\"[$]\"), x =&gt; \"\\\\\" + x.text)\n  eval(str, mode: \"markup\")\n}\n\n#let text = ```\n{i}Just italic{/i}.\n{b}Just bold{/b}.\n{color=#00FF00}Just colored{/color}.\n{size=20}Just resized{/size}.\n\nHere {b} is {i}{size=20}a{/size} mixed{/i} {color=#3761d9}situation{/color}{/b}.\n```.text\n\n#process-text(text)\n\n#let transcript = for row in csv(\"transcript.csv\", row-type: dictionary) {\n  (row.pairs().map(((k, v)) =&gt; ((k): process-text(v))).join(),)\n}\n\n#show table.cell.where(y: 0): strong\n#table(\n  columns: 4,\n  stroke: 0.3pt,\n  table.header[Key][English][Spanish][Japanese],\n  ..transcript\n    .map(row =&gt; (row.Key, row.Standard, row.Spanish, row.Japanese))\n    .flatten(),\n)\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/e/e24d3ff6923827a57ede99fb0cc914eb1ee6a8e2.png\" alt=\"image\" data-base62-sha1=\"whXpKHtvLzfh7Wc7hDaQY2oXxgm\" width=\"297\" height=\"57\"></p>\n<p>The solution is much shorter, but requires additional data processing and escaping of stuff that will error in markup mode.</p>\n<aside class=\"onebox githubissue\" data-onebox-src=\"https://github.com/typst/typst/issues/2093\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/typst/typst/issues/2093\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com/typst/typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"github-row\">\n  <div class=\"github-icon-container\" title=\"Issue\" data-github-private-repo=\"false\">\n\t  <svg width=\"60\" height=\"60\" class=\"github-icon\" viewBox=\"0 0 14 16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg>\n  </div>\n\n  <div class=\"github-info-container\">\n    <h4>\n      <a href=\"https://github.com/typst/typst/issues/2093\" target=\"_blank\" rel=\"noopener nofollow ugc\">String and regex show rules with a function should pass a match dict, rather than content</a>\n    </h4>\n\n    <div class=\"github-info\">\n      <div class=\"date\">\n        opened <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2023-09-09\" data-time=\"14:24:35\" data-timezone=\"UTC\">02:24PM - 09 Sep 23 UTC</span>\n      </div>\n\n        <div class=\"date\">\n          closed <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2024-08-06\" data-time=\"16:06:15\" data-timezone=\"UTC\">04:06PM - 06 Aug 24 UTC</span>\n        </div>\n\n      <div class=\"user\">\n        <a href=\"https://github.com/emilyyyylime\" target=\"_blank\" rel=\"noopener nofollow ugc\">\n          <img alt=\"emilyyyylime\" src=\"https://forum.typst.app/uploads/default/original/2X/6/660725e6dca9415652fee4ddafeb76399fe0f86f.png\" class=\"onebox-avatar-inline\" width=\"20\" height=\"20\" data-dominant-color=\"71970F\">\n          emilyyyylime\n        </a>\n      </div>\n    </div>\n\n    <div class=\"labels\">\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          scripting\n        </span>\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          styling\n        </span>\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          change request\n        </span>\n    </div>\n  </div>\n</div>\n\n  <div class=\"github-row\">\n    <p class=\"github-body-container\">### Description\n\nLike the dict returned by `str.match`\n\n### Use Case\n\n```\n#show<span class=\"show-more-container\"><a href=\"\" rel=\"noopener\" class=\"show-more\">…</a></span><span class=\"excerpt hidden\"> regex(\"(?i)hello (\\w+)\"): m =&gt; \"goodbye \" + m.captures.at(1)\n```</span></p>\n  </div>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<p>Also, table header can be simplified.</p>\n<aside class=\"onebox githubissue\" data-onebox-src=\"https://github.com/typst/typst/issues/3640\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/typst/typst/issues/3640\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com/typst/typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"github-row\">\n  <div class=\"github-icon-container\" title=\"Issue\" data-github-private-repo=\"false\">\n\t  <svg width=\"60\" height=\"60\" class=\"github-icon\" viewBox=\"0 0 14 16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg>\n  </div>\n\n  <div class=\"github-info-container\">\n    <h4>\n      <a href=\"https://github.com/typst/typst/issues/3640\" target=\"_blank\" rel=\"noopener nofollow ugc\">Unable to style `table.header` and `table.footer`</a>\n    </h4>\n\n    <div class=\"github-info\">\n      <div class=\"date\">\n        opened <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2024-03-12\" data-time=\"19:20:39\" data-timezone=\"UTC\">07:20PM - 12 Mar 24 UTC</span>\n      </div>\n\n\n      <div class=\"user\">\n        <a href=\"https://github.com/MDLC01\" target=\"_blank\" rel=\"noopener nofollow ugc\">\n          <img alt=\"MDLC01\" src=\"https://forum.typst.app/uploads/default/original/1X/41af6371f4684cc3047e3a64a6bad62f1de86391.png\" class=\"onebox-avatar-inline\" width=\"20\" height=\"20\" data-dominant-color=\"4995B1\">\n          MDLC01\n        </a>\n      </div>\n    </div>\n\n    <div class=\"labels\">\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          bug\n        </span>\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          styling\n        </span>\n    </div>\n  </div>\n</div>\n\n  <div class=\"github-row\">\n    <p class=\"github-body-container\">### Description\n\nIt is not possible to style `table.header` and `table.footer` e<span class=\"show-more-container\"><a href=\"\" rel=\"noopener\" class=\"show-more\">…</a></span><span class=\"excerpt hidden\">lements using show rules. \n\nTo reproduce:\n```typ\n#show table.header: set text(weight: \"bold\")\n#show table.footer: set text(weight: \"bold\")\n\n#table(\n  table.header[Header],\n  [Regular cell],\n  table.footer[Fotter],\n)\n```\n\n[Related discussion on Discord.](https://discord.com/channels/1054443721975922748/1182377294682128445/1217187734934917130)\n\n### Reproduction URL\n\n_No response_\n\n### Operating system\n\n_No response_\n\n### Typst version\n\n- [X] I am using the latest version of Typst</span></p>\n  </div>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
      "raw": "Since data comes from strings, `str.replace` can be effectively used here:\n\n````typ\n#let process-text(text) = {\n  import \"@preview/oxifmt:0.2.1\": strfmt\n  let args(left, right, substitution) = (\n    regex(\"\\{\" + left + \"}(.*?)\\{/\" + right + \"}\"),\n    x => strfmt(substitution, ..x.captures),\n  )\n  let str = text\n    .replace(..args(\"i\", \"i\", \"#emph[{}]\"))\n    .replace(..args(\"b\", \"b\", \"#strong[{}]\"))\n    .replace(..args(\"size=(\\d+)\", \"size\", \"#text({} * 0.03em)[{}]\"))\n    .replace(..args(\"color=#(\\w+)\", \"color\", \"#text(rgb(\\\"{}\\\"))[{}]\"))\n    .replace(regex(\"[$]\"), x => \"\\\\\" + x.text)\n  eval(str, mode: \"markup\")\n}\n\n#let text = ```\n{i}Just italic{/i}.\n{b}Just bold{/b}.\n{color=#00FF00}Just colored{/color}.\n{size=20}Just resized{/size}.\n\nHere {b} is {i}{size=20}a{/size} mixed{/i} {color=#3761d9}situation{/color}{/b}.\n```.text\n\n#process-text(text)\n\n#let transcript = for row in csv(\"transcript.csv\", row-type: dictionary) {\n  (row.pairs().map(((k, v)) => ((k): process-text(v))).join(),)\n}\n\n#show table.cell.where(y: 0): strong\n#table(\n  columns: 4,\n  stroke: 0.3pt,\n  table.header[Key][English][Spanish][Japanese],\n  ..transcript\n    .map(row => (row.Key, row.Standard, row.Spanish, row.Japanese))\n    .flatten(),\n)\n````\n\n![image|297x57](upload://whXpKHtvLzfh7Wc7hDaQY2oXxgm.png)\n\nThe solution is much shorter, but requires additional data processing and escaping of stuff that will error in markup mode.\n\nhttps://github.com/typst/typst/issues/2093\n\nAlso, table header can be simplified.\n\nhttps://github.com/typst/typst/issues/3640",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 16,
      "score": 3.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11289,
      "post_number": 5,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2025-04-18T15:53:08.871Z",
      "updated_at": "2025-04-18T15:53:08.871Z",
      "cooked": "<p>note that this will struggle with strangely nested tags:</p>\n<pre><code class=\"lang-auto\">{i}{i}This{/i}{/i} should be emphasized.\n</code></pre>\n<p>Result:</p>\n<blockquote>\n<p><em>This{/i}</em> should be emphasized.</p>\n</blockquote>\n<p>This happens because regex (regular expressions) can only parse regular languages, while arbitrarily nested formatting tags form a context-free language which is more general.</p>\n<p>For more info, consult this classic text: <a href=\"https://stackoverflow.com/a/1732454/371191\" class=\"inline-onebox\">html - RegEx match open tags except XHTML self-contained tags - Stack Overflow</a> <img src=\"https://forum.typst.app/images/emoji/apple/wink.png?v=12\" title=\":wink:\" class=\"emoji\" alt=\":wink:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "note that this will struggle with strangely nested tags:\n\n```\n{i}{i}This{/i}{/i} should be emphasized.\n```\n\nResult:\n\n> _This{/i}_ should be emphasized.\n\nThis happens because regex (regular expressions) can only parse regular languages, while arbitrarily nested formatting tags form a context-free language which is more general.\n\nFor more info, consult this classic text: https://stackoverflow.com/a/1732454/371191 :wink:",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 14,
      "score": 7.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 11292,
      "post_number": 6,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-18T16:25:32.487Z",
      "updated_at": "2025-04-18T16:25:32.487Z",
      "cooked": "<p>Strangely nested tags would be strange to see, since they don’t do any good. So for this use case it doesn’t matter. For nested stuff, you need to do much more than just find and replace.</p>",
      "raw": "Strangely nested tags would be strange to see, since they don't do any good. So for this use case it doesn't matter. For nested stuff, you need to do much more than just find and replace.",
      "reply_to_post_number": 5,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 14,
      "score": 47.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:49:29.153166"
}
{
  "topic_metadata": {
    "id": 3585,
    "title": "How to optimize a `query` that leads to severe performance problems?",
    "slug": "how-to-optimize-a-query-that-leads-to-severe-performance-problems",
    "posts_count": 17,
    "created_at": "2025-04-09T12:30:33.478Z",
    "last_posted_at": "2025-04-24T17:45:05.054Z",
    "views": 249,
    "like_count": 18,
    "reply_count": 11,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 7,
    "accepted_answer_username": "bluss",
    "tags": [
      "scripting",
      "query"
    ],
    "category_id": 5,
    "participant_count": 5,
    "word_count": 4218
  },
  "posts": [
    {
      "id": 10846,
      "post_number": 1,
      "username": "a_w",
      "name": "Alex",
      "created_at": "2025-04-09T12:30:33.574Z",
      "updated_at": "2025-04-09T19:20:50.295Z",
      "cooked": "<p>Hey <img src=\"https://forum.typst.app/images/emoji/apple/smiling_face.png?v=12\" title=\":smiling_face:\" class=\"emoji\" alt=\":smiling_face:\" loading=\"lazy\" width=\"20\" height=\"20\"> I’m working with some fairly large documents (up to 1000 pages) where the headers must guide through the readers the sections, chapters and paragraphs.</p>\n<p>(Example: <code>Section 3 · Chap. F · Par. 25 — Section 3 · Chapter G · Par. 2</code>)</p>\n<p>Thanks to the support of three very helpful members here, I was able to implement a solution with <code>query</code> like so: <a href=\"https://forum.typst.app/t/3456/\" class=\"inline-onebox\">How to get the number of the first and last paragraph on a page and show the result in the header?</a></p>\n<p>The main part to get the paragraph numbers for the header looks like this (full code at the end):</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">// Helper Functions\n#let get-short(label, x) = {\n  let shorts = query(selector(label).before(x.location()))\n  return shorts.at(-1, default: none)\n}\n#let shorts-and-id(x) = {\n  let h1 = get-short(&lt;h1-short&gt;, x)\n  let h2 = get-short(&lt;h2-short&gt;, x)\n  return (h1: h1.value, h2: h2.value, id: x.value)\n}\n\n// Chunk of the query code\nlet pars = query(selector.or(&lt;h4-start&gt;, &lt;h4-end&gt;))\n  .filter(x =&gt; x.location().page() == here().page())\n  .map(shorts-and-id)\n  .dedup()\nif pars.len() == 0 {\n  // No paragraph starting or ending on this page\n  // -&gt; check if a paragraph starts before and ends after this page\n  let prevs = query(selector(&lt;h4-start&gt;).before(here()))\n  let nexts = query(selector(&lt;h4-end&gt;).after(here()))\n  if prevs.len() == 0 or nexts.len() == 0 {\n    return\n  }\n</code></pre>\n<p>The problem with the solution is, that <strong>compilation times grow so extensively (cubic or even higher)</strong>, that the documents quickly become uncompileable.</p>\n<p>I didn’t notice that at first, because I worked only with draft parts. When I tried to compile one of the actual documents, it didn’t finish in +5 hours and I had to cancel the compilation process.</p>\n<p>The minimal example code (you’ll find a copy at the end) generates the following results on my M1 MacBook (measured with <code>time</code> for <code>typst compile</code> in zsh):</p>\n<pre data-code-wrap=\"txt\"><code class=\"lang-txt\">1 Section:    0,64s user  0,07s system  95% cpu 0,743 total\n2 Sections:   4,99s user  0,46s system 127% cpu 4,264 total\n3 Sections:  27,57s user  3,39s system 141% cpu 21,922 total\n4 Sections:  72,40s user  7,25s system 145% cpu 54,725 total\n5 Sections: 151,57s user 24,86s system 135% cpu 2:09,92 total\n6 Sections: 257,02s user 60,35s system 133% cpu 3:57,47 total\n</code></pre>\n<p><strong>So while the amount of content went up 6x, the CPU user time went up 400x.</strong> Showing a bottleneck that scales cubic or even higher, quickly leading to unworkable compile times for the actual documents… <img src=\"https://forum.typst.app/images/emoji/apple/snail.png?v=12\" title=\":snail:\" class=\"emoji\" alt=\":snail:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<ul>\n<li>Is there maybe an error or ineffieciency in my code that leads to this (maybe parts like <code>.before(here()</code> are to open ended)?</li>\n<li>How can I optimize the <code>query</code> code to display the Section/Chapter/Paraphs with compile times that don’t feel like I’m mining Bitcoin on my poor laptop? <img src=\"https://forum.typst.app/images/emoji/apple/smile.png?v=12\" title=\":smile:\" class=\"emoji\" alt=\":smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></li>\n</ul>\n<p>You can quickly test/reproduce this with the <strong>following MWE</strong> <img src=\"https://forum.typst.app/images/emoji/apple/arrow_down.png?v=12\" title=\":arrow_down:\" class=\"emoji\" alt=\":arrow_down:\" loading=\"lazy\" width=\"20\" height=\"20\">:</p>\n<details>\n<summary>\nFull Code Example 📋</summary>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// Helper Functions\n#let get-short(label, x) = {\n  let shorts = query(selector(label).before(x.location()))\n  return shorts.at(-1, default: none)\n}\n#let shorts-and-id(x) = {\n  let h1 = get-short(&lt;h1-short&gt;, x)\n  let h2 = get-short(&lt;h2-short&gt;, x)\n  return (h1: h1.value, h2: h2.value, id: x.value)\n}\n// Output assembly\n#let header-content(a, b) = {\n  return [#a.h1, #a.h2, Par. #a.id --- #b.h1, #b.h2, Par. #b.id]\n}\n\n// Actual Query\n#set page(\n  width: 120mm,\n  height: 100mm,\n  header: context {\n    let pars = query(selector.or(&lt;h4-start&gt;, &lt;h4-end&gt;))\n      .filter(x =&gt; x.location().page() == here().page())\n      .map(shorts-and-id)\n      .dedup()\n    if pars.len() == 0 {\n      // No paragraph starting or ending on this page\n      // -&gt; check if a paragraph starts before and ends after this page\n      let prevs = query(selector(&lt;h4-start&gt;).before(here()))\n      let nexts = query(selector(&lt;h4-end&gt;).after(here()))\n      if prevs.len() == 0 or nexts.len() == 0 {\n        return\n      }\n      let prev = shorts-and-id(prevs.last())\n      let next = shorts-and-id(nexts.first())\n      if prev != next {\n        return\n      }\n      return header-content(prev, next)\n    }\n    return header-content(pars.first(), pars.at(-1, default: none))\n  },\n)\n\n// The Elements\n#let my-h1(short: none, ..args) = {\n  heading(level: 1, ..args)\n  [#metadata(short)&lt;h1-short&gt;]\n}\n#show heading.where(level: 1): it =&gt; {\n  pagebreak(weak: true)\n  it\n}\n#let my-h2(short: none, ..args) = {\n  heading(level: 2, ..args)\n  [#metadata(short)&lt;h2-short&gt;]\n}\n#let my-par(id: none, body) = text({\n  [#metadata([#id])&lt;h4-start&gt;]\n  if id != none {\n    heading(level: 4, id)\n  }\n  body\n  [#metadata([#id])&lt;h4-end&gt;]\n  hide(\"​\")\n})\n#show heading.where(level: 4): it =&gt; it.body + \" \"\n\n// ⬇️ Test Content (setting num-sections below to 1,2,3…6 should roughly lead to the results in my post)\n#let num-sections = 1\n// Used chapter letters just for better overview in the example output\n// ABCDEFGHIJKLMNOPQRSTUVWXYZ\n#let chapter-letters = \"ABCDEFGH\"\n#let num-paragraphs-per-chapter = 25\n\n#let s = 1\n#while s &lt;= num-sections {\n  my-h1(short: \"Section \" + [#s])[This is Section #s]\n  let c = 1\n  for letter in chapter-letters {\n    my-h2(short: \"Chap. \" + [#letter])[This is Chapter #letter]\n    let p = 1\n    while p &lt;= num-paragraphs-per-chapter {\n      my-par(id: [#p], lorem(50))\n      p = p + 1\n    }\n  }\n  s = s + 1\n}\n\n</code></pre>\n</details>\n<p>(Note: It is set to output 1 section by default, so it doesn’t crash anyones tinymist. You can flexibly set the amount of test output is at the end to reproduce.)</p>",
      "raw": "Hey ☺️ I'm working with some fairly large documents (up to 1000 pages) where the headers must guide through the readers the sections, chapters and paragraphs.\n\n(Example: `Section 3 · Chap. F · Par. 25 — Section 3 · Chapter G · Par. 2`)\n\nThanks to the support of three very helpful members here, I was able to implement a solution with `query` like so: https://forum.typst.app/t/3456/\n\nThe main part to get the paragraph numbers for the header looks like this (full code at the end):\n```typc\n// Helper Functions\n#let get-short(label, x) = {\n  let shorts = query(selector(label).before(x.location()))\n  return shorts.at(-1, default: none)\n}\n#let shorts-and-id(x) = {\n  let h1 = get-short(<h1-short>, x)\n  let h2 = get-short(<h2-short>, x)\n  return (h1: h1.value, h2: h2.value, id: x.value)\n}\n\n// Chunk of the query code\nlet pars = query(selector.or(<h4-start>, <h4-end>))\n  .filter(x => x.location().page() == here().page())\n  .map(shorts-and-id)\n  .dedup()\nif pars.len() == 0 {\n  // No paragraph starting or ending on this page\n  // -> check if a paragraph starts before and ends after this page\n  let prevs = query(selector(<h4-start>).before(here()))\n  let nexts = query(selector(<h4-end>).after(here()))\n  if prevs.len() == 0 or nexts.len() == 0 {\n    return\n  }\n```\n\nThe problem with the solution is, that **compilation times grow so extensively (cubic or even higher)**, that the documents quickly become uncompileable.\n\nI didn't notice that at first, because I worked only with draft parts. When I tried to compile one of the actual documents, it didn't finish in +5 hours and I had to cancel the compilation process.\n\nThe minimal example code (you'll find a copy at the end) generates the following results on my M1 MacBook (measured with `time` for `typst compile` in zsh):\n\n```txt\n1 Section:    0,64s user  0,07s system  95% cpu 0,743 total\n2 Sections:   4,99s user  0,46s system 127% cpu 4,264 total\n3 Sections:  27,57s user  3,39s system 141% cpu 21,922 total\n4 Sections:  72,40s user  7,25s system 145% cpu 54,725 total\n5 Sections: 151,57s user 24,86s system 135% cpu 2:09,92 total\n6 Sections: 257,02s user 60,35s system 133% cpu 3:57,47 total\n```\n\n**So while the amount of content went up 6x, the CPU user time went up 400x.** Showing a bottleneck that scales cubic or even higher, quickly leading to unworkable compile times for the actual documents… 🐌\n\n- Is there maybe an error or ineffieciency in my code that leads to this (maybe parts like `.before(here()` are to open ended)?\n- How can I optimize the `query` code to display the Section/Chapter/Paraphs with compile times that don't feel like I'm mining Bitcoin on my poor laptop? 😄\n\nYou can quickly test/reproduce this with the **following MWE** ⬇️:\n\n[details=\"Full Code Example 📋\"]\n```typ\n// Helper Functions\n#let get-short(label, x) = {\n  let shorts = query(selector(label).before(x.location()))\n  return shorts.at(-1, default: none)\n}\n#let shorts-and-id(x) = {\n  let h1 = get-short(<h1-short>, x)\n  let h2 = get-short(<h2-short>, x)\n  return (h1: h1.value, h2: h2.value, id: x.value)\n}\n// Output assembly\n#let header-content(a, b) = {\n  return [#a.h1, #a.h2, Par. #a.id --- #b.h1, #b.h2, Par. #b.id]\n}\n\n// Actual Query\n#set page(\n  width: 120mm,\n  height: 100mm,\n  header: context {\n    let pars = query(selector.or(<h4-start>, <h4-end>))\n      .filter(x => x.location().page() == here().page())\n      .map(shorts-and-id)\n      .dedup()\n    if pars.len() == 0 {\n      // No paragraph starting or ending on this page\n      // -> check if a paragraph starts before and ends after this page\n      let prevs = query(selector(<h4-start>).before(here()))\n      let nexts = query(selector(<h4-end>).after(here()))\n      if prevs.len() == 0 or nexts.len() == 0 {\n        return\n      }\n      let prev = shorts-and-id(prevs.last())\n      let next = shorts-and-id(nexts.first())\n      if prev != next {\n        return\n      }\n      return header-content(prev, next)\n    }\n    return header-content(pars.first(), pars.at(-1, default: none))\n  },\n)\n\n// The Elements\n#let my-h1(short: none, ..args) = {\n  heading(level: 1, ..args)\n  [#metadata(short)<h1-short>]\n}\n#show heading.where(level: 1): it => {\n  pagebreak(weak: true)\n  it\n}\n#let my-h2(short: none, ..args) = {\n  heading(level: 2, ..args)\n  [#metadata(short)<h2-short>]\n}\n#let my-par(id: none, body) = text({\n  [#metadata([#id])<h4-start>]\n  if id != none {\n    heading(level: 4, id)\n  }\n  body\n  [#metadata([#id])<h4-end>]\n  hide(\"​\")\n})\n#show heading.where(level: 4): it => it.body + \" \"\n\n// ⬇️ Test Content (setting num-sections below to 1,2,3…6 should roughly lead to the results in my post)\n#let num-sections = 1\n// Used chapter letters just for better overview in the example output\n// ABCDEFGHIJKLMNOPQRSTUVWXYZ\n#let chapter-letters = \"ABCDEFGH\"\n#let num-paragraphs-per-chapter = 25\n\n#let s = 1\n#while s <= num-sections {\n  my-h1(short: \"Section \" + [#s])[This is Section #s]\n  let c = 1\n  for letter in chapter-letters {\n    my-h2(short: \"Chap. \" + [#letter])[This is Chapter #letter]\n    let p = 1\n    while p <= num-paragraphs-per-chapter {\n      my-par(id: [#p], lorem(50))\n      p = p + 1\n    }\n  }\n  s = s + 1\n}\n\n```\n[/details]\n\n(Note: It is set to output 1 section by default, so it doesn't crash anyones tinymist. You can flexibly set the amount of test output is at the end to reproduce.)",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 44,
      "score": 93.8,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 566
    },
    {
      "id": 10856,
      "post_number": 2,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-09T16:18:01.282Z",
      "updated_at": "2025-04-09T16:22:40.532Z",
      "cooked": "<p>If it’s possible maybe you could share a project with the complete code (not necessarily the complete document) and then it would be easier to work with in practice.</p>\n<p>It’s clear that the paragraph scan is at least O(n²) when performed once per page. I wonder now if it could be written like this:</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">let thispage = here().page()\nlet pagestart = label(\"page-begin-\" + str(thispage))\nlet pageend = label(\"page-end-\" + str(thispage))\nlet pars = query(selector.or(&lt;h4-start&gt;, &lt;h4-end&gt;).after(pagestart).before(pageend))\n</code></pre>\n<p>Where you use labels that delimit each page (you place them in header/footer so that they do). That is assuming of course that query before/after benefits from this.</p>\n<p>If that works, it could be an improvement. Then the “no paragraph on this page” case needs the same kind of care too. Maybe you could disable that case and see if it contributes to the slowdown or not.</p>\n<p>I wonder if none of that works, maybe it’s possible to yourself optimize by performing certain queries only once (and storing in state) instead of repeating variants of them each page.</p>\n<hr>\n<p>Based on code from the previous thread, I mean that you can query certain information only once or once per chapter, and then you refer back to it later.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#context {\n  query(selector.or(&lt;h4-start&gt;, &lt;h4-end&gt;)).map(x =&gt; (x.location().page(), shorts-and-id(x))).dedup()\n}\n</code></pre>\n<p>Once you have that data in a dictionary, it should be efficient to use.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/9/90b500f41726c1dd18aea1df80c7cf90646c813b.png\" data-download-href=\"https://forum.typst.app/uploads/default/90b500f41726c1dd18aea1df80c7cf90646c813b\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/9/90b500f41726c1dd18aea1df80c7cf90646c813b_2_535x500.png\" alt=\"image\" data-base62-sha1=\"kE8ynfBS1PulVI6Kiwrg93x2ftp\" width=\"535\" height=\"500\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/9/90b500f41726c1dd18aea1df80c7cf90646c813b_2_535x500.png, https://forum.typst.app/uploads/default/original/2X/9/90b500f41726c1dd18aea1df80c7cf90646c813b.png 1.5x, https://forum.typst.app/uploads/default/original/2X/9/90b500f41726c1dd18aea1df80c7cf90646c813b.png 2x\" data-dominant-color=\"F1F4F0\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">558×521 119 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "If it's possible maybe you could share a project with the complete code (not necessarily the complete document) and then it would be easier to work with in practice.\n\nIt's clear that the paragraph scan is at least O(n²) when performed once per page. I wonder now if it could be written like this:\n\n```typc\nlet thispage = here().page()\nlet pagestart = label(\"page-begin-\" + str(thispage))\nlet pageend = label(\"page-end-\" + str(thispage))\nlet pars = query(selector.or(<h4-start>, <h4-end>).after(pagestart).before(pageend))\n```\n\nWhere you use labels that delimit each page (you place them in header/footer so that they do). That is assuming of course that query before/after benefits from this.\n\nIf that works, it could be an improvement. Then the \"no paragraph on this page\" case needs the same kind of care too. Maybe you could disable that case and see if it contributes to the slowdown or not.\n\nI wonder if none of that works, maybe it's possible to yourself optimize by performing certain queries only once (and storing in state) instead of repeating variants of them each page.\n\n----\n\nBased on code from the previous thread, I mean that you can query certain information only once or once per chapter, and then you refer back to it later.\n\n```typ\n#context {\n  query(selector.or(<h4-start>, <h4-end>)).map(x => (x.location().page(), shorts-and-id(x))).dedup()\n}\n```\n\nOnce you have that data in a dictionary, it should be efficient to use.\n\n![image|535x500](upload://kE8ynfBS1PulVI6Kiwrg93x2ftp.png)",
      "reply_to_post_number": null,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 0,
      "reads": 41,
      "score": 18.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 10857,
      "post_number": 3,
      "username": "a_w",
      "name": "Alex",
      "created_at": "2025-04-09T16:46:42.967Z",
      "updated_at": "2025-04-09T16:50:59.554Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"bluss\" data-post=\"2\" data-topic=\"3585\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/b/441A5E/48.png\" class=\"avatar\"> bluss:</div>\n<blockquote>\n<p>If it’s possible maybe you could share a project with the complete code (not necessarily the complete document) and then it would be easier to work with in practice.</p>\n</blockquote>\n</aside>\n<p>You mean in addition to the full code example at the end (Update: I’ve tried to make it more visible in case it was too easy to overlook)? I thought it would be easier for anyone willing to help if the example was abstracted to the problem (thinking SSCCE) and flexibly scalable for trying different approaches, rather than having to deal with a huge file containing a large chunk of static (test) content? What form should I provide that would be easier to work with? <img src=\"https://forum.typst.app/images/emoji/apple/blush.png?v=12\" title=\":blush:\" class=\"emoji\" alt=\":blush:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<aside class=\"quote no-group\" data-username=\"bluss\" data-post=\"2\" data-topic=\"3585\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/b/441A5E/48.png\" class=\"avatar\"> bluss:</div>\n<blockquote>\n<p>I wonder if none of that works, maybe it’s possible to yourself optimize by performing certain queries only once (and storing in state) instead of repeating variants of them each page.</p>\n</blockquote>\n</aside>\n<p>That would be the ideal case I guess, but combining <code>state</code> and <code>query</code> in a way that doesn’t make things worse is currently still a bit above my Typst skill level <img src=\"https://forum.typst.app/images/emoji/apple/joy.png?v=12\" title=\":joy:\" class=\"emoji\" alt=\":joy:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<p>But as you say (or rather as I was hoping), and from my limited understanding of how Typst works internally, if the scope of the <code>query</code> were as narrow as it can be (which I don’t know: Can an element that didn’t start, but instead only reaches to a given page can be still queried there?), it would likely speed up the processing considerably.</p>",
      "raw": "[quote=\"bluss, post:2, topic:3585\"]\nIf it’s possible maybe you could share a project with the complete code (not necessarily the complete document) and then it would be easier to work with in practice.\n[/quote]\n\nYou mean in addition to the full code example at the end (Update: I've tried to make it more visible in case it was too easy to overlook)? I thought it would be easier for anyone willing to help if the example was abstracted to the problem (thinking SSCCE) and flexibly scalable for trying different approaches, rather than having to deal with a huge file containing a large chunk of static (test) content? What form should I provide that would be easier to work with? 😊\n\n[quote=\"bluss, post:2, topic:3585\"]\nI wonder if none of that works, maybe it’s possible to yourself optimize by performing certain queries only once (and storing in state) instead of repeating variants of them each page.\n[/quote]\n\nThat would be the ideal case I guess, but combining `state` and `query` in a way that doesn't make things worse is currently still a bit above my Typst skill level 😂\n\nBut as you say (or rather as I was hoping), and from my limited understanding of how Typst works internally, if the scope of the `query` were as narrow as it can be (which I don't know: Can an element that didn't start, but instead only reaches to a given page can be still queried there?), it would likely speed up the processing considerably.",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 0,
      "reads": 37,
      "score": 17.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 566
    },
    {
      "id": 10858,
      "post_number": 4,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-09T17:02:33.548Z",
      "updated_at": "2025-04-09T17:02:33.548Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"a_w\" data-post=\"3\" data-topic=\"3585\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/a_w/48/1206_2.png\" class=\"avatar\"> a_w:</div>\n<blockquote>\n<p>(Update: I’ve tried to make it more visible in case it was too easy to overlook)</p>\n</blockquote>\n</aside>\n<p>I’m sorry, I missed that <img src=\"https://forum.typst.app/images/emoji/apple/blush.png?v=12\" title=\":blush:\" class=\"emoji\" alt=\":blush:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "[quote=\"a_w, post:3, topic:3585\"]\n(Update: I’ve tried to make it more visible in case it was too easy to overlook)\n[/quote]\nI'm sorry, I missed that :blush:",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 1,
      "reads": 36,
      "score": 22.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 10859,
      "post_number": 5,
      "username": "laurmaedje",
      "name": "Laurenz Mädje",
      "created_at": "2025-04-09T17:21:30.376Z",
      "updated_at": "2025-04-09T17:21:30.376Z",
      "cooked": "<p>I haven’t looked at the details here, but this <em>could</em> be relevant: <a href=\"https://github.com/typst/typst/issues/5220\" class=\"inline-onebox\">Quadratic runtime of cache validation · Issue #5220 · typst/typst · GitHub</a></p>",
      "raw": "I haven't looked at the details here, but this _could_ be relevant: https://github.com/typst/typst/issues/5220",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 36,
      "score": 27.2,
      "accepted_answer": false,
      "trust_level": 4,
      "user_id": 2
    },
    {
      "id": 10878,
      "post_number": 6,
      "username": "a_w",
      "name": "Alex",
      "created_at": "2025-04-10T12:16:37.003Z",
      "updated_at": "2025-04-10T12:16:37.003Z",
      "cooked": "<p>Thank you, that’s good to know. Unfortunately, I can’t verify if that applies here, since I don’t know what the (temporary?) solution would look like in this case for comparison — kind of like a cache buster for the query?</p>",
      "raw": "Thank you, that’s good to know. Unfortunately, I can’t verify if that applies here, since I don’t know what the (temporary?) solution would look like in this case for comparison — kind of like a cache buster for the query?",
      "reply_to_post_number": 5,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 6.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 566
    },
    {
      "id": 10918,
      "post_number": 7,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-10T20:48:52.379Z",
      "updated_at": "2025-04-10T23:35:31.282Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"bluss\" data-post=\"2\" data-topic=\"3585\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/b/441A5E/48.png\" class=\"avatar\"> bluss:</div>\n<blockquote>\n<p>Where you use labels that delimit each page (you place them in header/footer so that they do). That is assuming of course that query before/after benefits from this.</p>\n</blockquote>\n</aside>\n<p>This page-start/end idea helps in the example, but only by increasing performance by 30% or so. It doesn’t change the scaling of the issue I think so it’s not a solution at all.</p>\n<p>I have some success now with the cache strategy. I think this 1) speeds it up massively, 2) changes scaling to be better(?). It’s not blazingly fast, but it’s much better.</p>\n<p>The pars.len() == 0 case is unimplemented, it doesn’t affect the example. But it needs to use the same cached datastructure too.</p>\n<details>\n<summary>Code</summary>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// Helper Functions\n#let get-short(label, x) = {\n  let shorts = query(selector(label).before(x.location()))\n  return shorts.at(-1, default: none)\n}\n#let shorts-and-id(x) = {\n  let h1 = get-short(&lt;h1-short&gt;, x)\n  let h2 = get-short(&lt;h2-short&gt;, x)\n  return (h1: h1.value, h2: h2.value, id: x.value)\n}\n// Output assembly\n#let header-content(a, b) = {\n  return [#a.h1, #a.h2, Par. #a.id --- #b.h1, #b.h2, Par. #b.id]\n}\n\n// Return array. Index: page number. Value: Array of paragraph info on that page.\n#let shorts-per-page() = {\n    let pars = query(selector.or(&lt;h4-start&gt;, &lt;h4-end&gt;))\n    let d = ()\n    for par in pars {\n      let pg = par.location().page()\n      while d.len() &lt;= pg { d.push(()) }\n      d.at(pg).push(shorts-and-id(par))\n    }\n    return d\n}\n\n#let cache = state(\"parscache\", none)\n\n\n// Actual Query\n#set page(\n  width: 120mm,\n  height: 100mm,\n  header: context {\n    let pg = here().page()\n    let cachedpars = cache.get()\n    if cachedpars == none {\n      cachedpars = shorts-per-page()\n      cache.update(_ =&gt; cachedpars)\n    }\n    let pars = cachedpars.at(pg, default: none)\n    if pars == none {\n      return\n    }\n    if pars.len() == 0 {\n      return\n    }\n    header-content(pars.first(), pars.at(-1, default: none))\n  }\n)\n\n// The Elements\n#let my-h1(short: none, ..args) = {\n  heading(level: 1, ..args)\n  [#metadata(short)&lt;h1-short&gt;]\n}\n#show heading.where(level: 1): it =&gt; {\n  pagebreak(weak: true)\n  it\n}\n#let my-h2(short: none, ..args) = {\n  heading(level: 2, ..args)\n  [#metadata(short)&lt;h2-short&gt;]\n}\n#let my-par(id: none, body) = text({\n  [#metadata([#id])&lt;h4-start&gt;]\n  if id != none {\n    heading(level: 4, id)\n  }\n  body\n  [#metadata([#id])&lt;h4-end&gt;]\n  hide(\"​\")\n})\n#show heading.where(level: 4): it =&gt; it.body + \" \"\n\n// ⬇️ Test Content (setting num-sections below to 1,2,3…6 should roughly lead to the results in my post)\n// Used chapter letters just for better overview in the example output\n// ABCDEFGHIJKLMNOPQRSTUVWXYZ\n#let chapter-letters = \"ABCDEFGH\"\n#let num-paragraphs-per-chapter = 25\n\n// use sys.inputs for command line parametrization\n#let s = 1\n#let num-sections = int(sys.inputs.at(\"N\", default: \"1\"))\n#while s &lt;= num-sections {\n  my-h1(short: \"Section \" + [#s])[This is Section #s]\n  let c = 1\n  for letter in chapter-letters {\n    my-h2(short: \"Chap. \" + [#letter])[This is Chapter #letter]\n    let p = 1\n    while p &lt;= num-paragraphs-per-chapter {\n      my-par(id: [#p], lorem(50))\n      p = p + 1\n    }\n  }\n  s = s + 1\n}\n</code></pre>\n</details>\n<br>\n<br>\n<pre data-code-wrap=\"shell\"><code class=\"lang-shell\">time typst compile patho.typ  --input N=1\n0.20user 0.07system 0:00.27elapsed 105%CPU (0avgtext+0avgdata 54300maxresident)k\ntime typst compile patho.typ  --input N=2\n0.41user 0.10system 0:00.39elapsed 130%CPU (0avgtext+0avgdata 78108maxresident)k\ntime typst compile patho.typ  --input N=3\n0.77user 0.14system 0:00.58elapsed 156%CPU (0avgtext+0avgdata 107572maxresident)k\ntime typst compile patho.typ  --input N=4\n1.34user 0.19system 0:00.83elapsed 184%CPU (0avgtext+0avgdata 129604maxresident)k\ntime typst compile patho.typ  --input N=5\n2.05user 0.24system 0:01.11elapsed 207%CPU (0avgtext+0avgdata 150760maxresident)k\ntime typst compile patho.typ  --input N=6\n3.35user 0.34system 0:01.64elapsed 225%CPU (0avgtext+0avgdata 185552maxresident)k                                                     \n</code></pre>\n<p>Time is still scaling nonlinearlly.</p>",
      "raw": "[quote=\"bluss, post:2, topic:3585\"]\nWhere you use labels that delimit each page (you place them in header/footer so that they do). That is assuming of course that query before/after benefits from this.\n[/quote]\n\nThis page-start/end idea helps in the example, but only by increasing performance by 30% or so. It doesn't change the scaling of the issue I think so it's not a solution at all.\n\n\n\nI have some success now with the cache strategy. I think this 1) speeds it up massively, 2) changes scaling to be better(?). It's not blazingly fast, but it's much better.\n\nThe pars.len() == 0 case is unimplemented, it doesn't affect the example. But it needs to use the same cached datastructure too.\n\n\n<details>\n<summary>Code</summary>\n\n```typ\n// Helper Functions\n#let get-short(label, x) = {\n  let shorts = query(selector(label).before(x.location()))\n  return shorts.at(-1, default: none)\n}\n#let shorts-and-id(x) = {\n  let h1 = get-short(<h1-short>, x)\n  let h2 = get-short(<h2-short>, x)\n  return (h1: h1.value, h2: h2.value, id: x.value)\n}\n// Output assembly\n#let header-content(a, b) = {\n  return [#a.h1, #a.h2, Par. #a.id --- #b.h1, #b.h2, Par. #b.id]\n}\n\n// Return array. Index: page number. Value: Array of paragraph info on that page.\n#let shorts-per-page() = {\n    let pars = query(selector.or(<h4-start>, <h4-end>))\n    let d = ()\n    for par in pars {\n      let pg = par.location().page()\n      while d.len() <= pg { d.push(()) }\n      d.at(pg).push(shorts-and-id(par))\n    }\n    return d\n}\n\n#let cache = state(\"parscache\", none)\n\n\n// Actual Query\n#set page(\n  width: 120mm,\n  height: 100mm,\n  header: context {\n    let pg = here().page()\n    let cachedpars = cache.get()\n    if cachedpars == none {\n      cachedpars = shorts-per-page()\n      cache.update(_ => cachedpars)\n    }\n    let pars = cachedpars.at(pg, default: none)\n    if pars == none {\n      return\n    }\n    if pars.len() == 0 {\n      return\n    }\n    header-content(pars.first(), pars.at(-1, default: none))\n  }\n)\n\n// The Elements\n#let my-h1(short: none, ..args) = {\n  heading(level: 1, ..args)\n  [#metadata(short)<h1-short>]\n}\n#show heading.where(level: 1): it => {\n  pagebreak(weak: true)\n  it\n}\n#let my-h2(short: none, ..args) = {\n  heading(level: 2, ..args)\n  [#metadata(short)<h2-short>]\n}\n#let my-par(id: none, body) = text({\n  [#metadata([#id])<h4-start>]\n  if id != none {\n    heading(level: 4, id)\n  }\n  body\n  [#metadata([#id])<h4-end>]\n  hide(\"​\")\n})\n#show heading.where(level: 4): it => it.body + \" \"\n\n// ⬇️ Test Content (setting num-sections below to 1,2,3…6 should roughly lead to the results in my post)\n// Used chapter letters just for better overview in the example output\n// ABCDEFGHIJKLMNOPQRSTUVWXYZ\n#let chapter-letters = \"ABCDEFGH\"\n#let num-paragraphs-per-chapter = 25\n\n// use sys.inputs for command line parametrization\n#let s = 1\n#let num-sections = int(sys.inputs.at(\"N\", default: \"1\"))\n#while s <= num-sections {\n  my-h1(short: \"Section \" + [#s])[This is Section #s]\n  let c = 1\n  for letter in chapter-letters {\n    my-h2(short: \"Chap. \" + [#letter])[This is Chapter #letter]\n    let p = 1\n    while p <= num-paragraphs-per-chapter {\n      my-par(id: [#p], lorem(50))\n      p = p + 1\n    }\n  }\n  s = s + 1\n}\n```\n\n</details>\n\n\n<br>\n<br>\n\n\n```shell\ntime typst compile patho.typ  --input N=1\n0.20user 0.07system 0:00.27elapsed 105%CPU (0avgtext+0avgdata 54300maxresident)k\ntime typst compile patho.typ  --input N=2\n0.41user 0.10system 0:00.39elapsed 130%CPU (0avgtext+0avgdata 78108maxresident)k\ntime typst compile patho.typ  --input N=3\n0.77user 0.14system 0:00.58elapsed 156%CPU (0avgtext+0avgdata 107572maxresident)k\ntime typst compile patho.typ  --input N=4\n1.34user 0.19system 0:00.83elapsed 184%CPU (0avgtext+0avgdata 129604maxresident)k\ntime typst compile patho.typ  --input N=5\n2.05user 0.24system 0:01.11elapsed 207%CPU (0avgtext+0avgdata 150760maxresident)k\ntime typst compile patho.typ  --input N=6\n3.35user 0.34system 0:01.64elapsed 225%CPU (0avgtext+0avgdata 185552maxresident)k                                                     \n```\n\nTime is still scaling nonlinearlly.",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 2,
      "reads": 33,
      "score": 46.6,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 10930,
      "post_number": 8,
      "username": "a_w",
      "name": "Alex",
      "created_at": "2025-04-11T10:10:46.200Z",
      "updated_at": "2025-04-11T10:14:25.346Z",
      "cooked": "<p>I think you are not giving yourself enough credit, so I will: You’ve just sped up the processing time by a couple of thousand percent <img src=\"https://forum.typst.app/images/emoji/apple/face_holding_back_tears.png?v=12\" title=\":face_holding_back_tears:\" class=\"emoji\" alt=\":face_holding_back_tears:\" loading=\"lazy\" width=\"20\" height=\"20\"> thanks so much! <img src=\"https://forum.typst.app/images/emoji/apple/pray.png?v=12\" title=\":pray:\" class=\"emoji\" alt=\":pray:\" loading=\"lazy\" width=\"20\" height=\"20\"> As you mention, it still scales nonlinearly, but it is WAY faster than before and actually compileable. Out of curiosity… in <a href=\"https://github.com/typst/typst/issues/5220#issuecomment-2417525288\" rel=\"noopener nofollow ugc\">the issue</a> <a class=\"mention\" href=\"/u/laurmaedje\">@laurmaedje</a> mentioned…</p>\n<blockquote>\n<p>What you are most likely observing is a problem with incremental compilation where validating a cache hit is much more expensive than recomputing from scratch in some cases.</p>\n</blockquote>\n<p>Would this mean it could get even faster when switching the…</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">// Out of your code\nlet cachedpars = cache.get()\n\n// As in his example (slow)\n#for _ in range(n) {\n  context bar()\n}\n// vs. (faster)\n#for i in range(n) {\n  context bar(i)\n}\n</code></pre>\n<p>…for example every 10 or 20 pages?</p>",
      "raw": "I think you are not giving yourself enough credit, so I will: You've just sped up the processing time by a couple of thousand percent 🥹 thanks so much! 🙏 As you mention, it still scales nonlinearly, but it is WAY faster than before and actually compileable. Out of curiosity… in [the issue](https://github.com/typst/typst/issues/5220#issuecomment-2417525288) @laurmaedje mentioned…\n\n> What you are most likely observing is a problem with incremental compilation where validating a cache hit is much more expensive than recomputing from scratch in some cases.\n\nWould this mean it could get even faster when switching the…\n```typc\n// Out of your code\nlet cachedpars = cache.get()\n\n// As in his example (slow)\n#for _ in range(n) {\n  context bar()\n}\n// vs. (faster)\n#for i in range(n) {\n  context bar(i)\n}\n```\n…for example every 10 or 20 pages?",
      "reply_to_post_number": 7,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 30,
      "score": 26.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 566
    },
    {
      "id": 10958,
      "post_number": 9,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-12T11:52:10.330Z",
      "updated_at": "2025-04-12T12:01:48.780Z",
      "cooked": "<p>The syntax, especially for the loops, can be simplified to be more readable:</p>\n<details><summary>code</summary>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// Helper Functions\n#let get-short(label, x) = {\n  query(selector(label).before(x.location())).at(-1, default: none)\n}\n#let shorts-and-id(x) = {\n  let h1 = get-short(&lt;h1-short&gt;, x)\n  let h2 = get-short(&lt;h2-short&gt;, x)\n  (h1: h1.value, h2: h2.value, id: x.value)\n}\n// Output assembly\n#let header-content(a, b) = {\n  [#a.h1, #a.h2, Par. #a.id --- #b.h1, #b.h2, Par. #b.id]\n}\n\n// Actual Query\n#let header = context {\n  let pars = query(selector.or(&lt;h4-start&gt;, &lt;h4-end&gt;))\n    .filter(x =&gt; x.location().page() == here().page())\n    .map(shorts-and-id)\n    .dedup()\n  if pars.len() != 0 {\n    return header-content(pars.first(), pars.at(-1, default: none))\n  }\n  // No paragraph starting or ending on this page\n  // -&gt; check if a paragraph starts before and ends after this page\n  let prevs = query(selector(&lt;h4-start&gt;).before(here()))\n  let nexts = query(selector(&lt;h4-end&gt;).after(here()))\n  if prevs.len() == 0 or nexts.len() == 0 { return }\n  let prev = shorts-and-id(prevs.last())\n  let next = shorts-and-id(nexts.first())\n  if prev != next { return }\n  header-content(prev, next)\n}\n\n#set page(width: 120mm, height: 100mm, header: header)\n\n// The Elements\n#let my-h1(short: none, ..args) = {\n  heading(level: 1, ..args)\n  [#metadata(short)&lt;h1-short&gt;]\n}\n#show heading.where(level: 1): it =&gt; pagebreak(weak: true) + it\n\n#let my-h2(short: none, ..args) = {\n  heading(level: 2, ..args)\n  [#metadata(short)&lt;h2-short&gt;]\n}\n\n#let my-par(id: none, body) = {\n  [#metadata[#id]&lt;h4-start&gt;]\n  if id != none { heading(level: 4, id) }\n  body\n  [#metadata[#id]&lt;h4-end&gt;]\n  hide(\"​\")\n}\n#show heading.where(level: 4): it =&gt; it.body + \" \"\n\n// ⬇️ Test Content (setting num-sections below to 1,2,3…6 should roughly lead to the results in my post)\n#let num-sections = 1\n// Used chapter letters just for better overview in the example output\n// ABCDEFGHIJKLMNOPQRSTUVWXYZ\n#let chapter-letters = \"ABCDEFGH\"\n#let num-paragraphs-per-chapter = 25\n\n#for s in range(1, num-sections + 1) {\n  my-h1(short: [Section #s])[This is Section #s]\n  for letter in chapter-letters {\n    my-h2(short: [Chap. #letter])[This is Chapter #letter]\n    for p in range(1, num-paragraphs-per-chapter + 1) {\n      my-par(id: [#p], lorem(50))\n    }\n  }\n}\n</code></pre>\n</details>\n<p>And for the last solution:</p>\n<details><summary>code</summary>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// Helper Functions\n#let get-short(label, x) = {\n  query(selector(label).before(x.location())).at(-1, default: none)\n}\n#let shorts-and-id(x) = {\n  let h1 = get-short(&lt;h1-short&gt;, x)\n  let h2 = get-short(&lt;h2-short&gt;, x)\n  (h1: h1.value, h2: h2.value, id: x.value)\n}\n// Output assembly\n#let header-content(a, b) = {\n  [#a.h1, #a.h2, Par. #a.id --- #b.h1, #b.h2, Par. #b.id]\n}\n\n// Return array. Index: page number. Value: Array of paragraph info on that page.\n#let shorts-per-page() = {\n  let pars = query(selector.or(&lt;h4-start&gt;, &lt;h4-end&gt;))\n  let page-pars-array = ((),) * (counter(page).final().first() + 1)\n  for par in pars {\n    page-pars-array.at(par.location().page()).push(shorts-and-id(par))\n  }\n  page-pars-array\n}\n\n#let cache = state(\"parscache\", none)\n\n// Actual Query\n#let header = context {\n  let page = here().page()\n  let cachedpars = cache.get()\n  if cachedpars == none {\n    cachedpars = shorts-per-page()\n    cache.update(_ =&gt; cachedpars)\n  }\n  let pars = cachedpars.at(page, default: none)\n  if pars == none or pars.len() == 0 { return }\n  header-content(pars.first(), pars.at(-1, default: none))\n}\n\n#set page(width: 120mm, height: 100mm, header: header)\n\n// The Elements\n#let my-h1(short: none, ..args) = {\n  heading(level: 1, ..args)\n  [#metadata(short)&lt;h1-short&gt;]\n}\n#show heading.where(level: 1): it =&gt; pagebreak(weak: true) + it\n\n#let my-h2(short: none, ..args) = {\n  heading(level: 2, ..args)\n  [#metadata(short)&lt;h2-short&gt;]\n}\n\n#let my-par(id: none, body) = {\n  [#metadata[#id]&lt;h4-start&gt;]\n  if id != none { heading(level: 4, id) }\n  body\n  [#metadata[#id]&lt;h4-end&gt;]\n  hide(\"​\")\n}\n#show heading.where(level: 4): it =&gt; it.body + \" \"\n\n// ⬇️ Test Content (setting num-sections below to 1,2,3…6 should roughly lead to the results in my post)\n// Used chapter letters just for better overview in the example output\n// ABCDEFGHIJKLMNOPQRSTUVWXYZ\n#let chapter-letters = \"ABCDEFGH\"\n#let num-paragraphs-per-chapter = 25\n\n// Use sys.inputs for command line parametrization.\n#let num-sections = int(sys.inputs.at(\"N\", default: \"1\"))\n#for s in range(1, num-sections + 1) {\n  my-h1(short: [Section #s])[This is Section #s]\n  for letter in chapter-letters {\n    my-h2(short: [Chap. #letter])[This is Chapter #letter]\n    for p in range(1, num-paragraphs-per-chapter + 1) {\n      my-par(id: [#p], lorem(50))\n    }\n  }\n}\n</code></pre>\n</details>\n<p>However, from limited testing, this doesn’t affect performance.</p>\n<aside class=\"quote no-group quote-modified\" data-username=\"a_w\" data-post=\"8\" data-topic=\"3585\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/a_w/48/1206_2.png\" class=\"avatar\"> a_w:</div>\n<blockquote>\n<p>Would this mean it could get even faster when switching the…</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// Out of your code\n#let cachedpars = cache.get()\n\n// As in his example (slow)\n#for _ in range(n) {\n  context bar()\n}\n// vs. (faster)\n#for i in range(n) {\n  context bar(i)\n}\n</code></pre>\n<p>…for example every 10 or 20 pages?</p>\n</blockquote>\n</aside>\n<p>Using a <code>bar(page)</code> for <code>cache.get()</code> doesn’t seem to make a difference, at least for 1 s runs.</p>\n<p>By the way, you should check out <a href=\"https://github.com/sharkdp/hyperfine\" rel=\"noopener nofollow ugc\"><code>hyperfine</code></a> for benchmarking and <code>--timings</code> <code>typst compile</code> flag.</p>\n<pre data-code-wrap=\"sh\"><code class=\"lang-sh\">hyperfine --warmup 1 'typst c file.typ'\n</code></pre>",
      "raw": "The syntax, especially for the loops, can be simplified to be more readable:\n\n<details><summary>code</summary>\n\n```typ\n// Helper Functions\n#let get-short(label, x) = {\n  query(selector(label).before(x.location())).at(-1, default: none)\n}\n#let shorts-and-id(x) = {\n  let h1 = get-short(<h1-short>, x)\n  let h2 = get-short(<h2-short>, x)\n  (h1: h1.value, h2: h2.value, id: x.value)\n}\n// Output assembly\n#let header-content(a, b) = {\n  [#a.h1, #a.h2, Par. #a.id --- #b.h1, #b.h2, Par. #b.id]\n}\n\n// Actual Query\n#let header = context {\n  let pars = query(selector.or(<h4-start>, <h4-end>))\n    .filter(x => x.location().page() == here().page())\n    .map(shorts-and-id)\n    .dedup()\n  if pars.len() != 0 {\n    return header-content(pars.first(), pars.at(-1, default: none))\n  }\n  // No paragraph starting or ending on this page\n  // -> check if a paragraph starts before and ends after this page\n  let prevs = query(selector(<h4-start>).before(here()))\n  let nexts = query(selector(<h4-end>).after(here()))\n  if prevs.len() == 0 or nexts.len() == 0 { return }\n  let prev = shorts-and-id(prevs.last())\n  let next = shorts-and-id(nexts.first())\n  if prev != next { return }\n  header-content(prev, next)\n}\n\n#set page(width: 120mm, height: 100mm, header: header)\n\n// The Elements\n#let my-h1(short: none, ..args) = {\n  heading(level: 1, ..args)\n  [#metadata(short)<h1-short>]\n}\n#show heading.where(level: 1): it => pagebreak(weak: true) + it\n\n#let my-h2(short: none, ..args) = {\n  heading(level: 2, ..args)\n  [#metadata(short)<h2-short>]\n}\n\n#let my-par(id: none, body) = {\n  [#metadata[#id]<h4-start>]\n  if id != none { heading(level: 4, id) }\n  body\n  [#metadata[#id]<h4-end>]\n  hide(\"​\")\n}\n#show heading.where(level: 4): it => it.body + \" \"\n\n// ⬇️ Test Content (setting num-sections below to 1,2,3…6 should roughly lead to the results in my post)\n#let num-sections = 1\n// Used chapter letters just for better overview in the example output\n// ABCDEFGHIJKLMNOPQRSTUVWXYZ\n#let chapter-letters = \"ABCDEFGH\"\n#let num-paragraphs-per-chapter = 25\n\n#for s in range(1, num-sections + 1) {\n  my-h1(short: [Section #s])[This is Section #s]\n  for letter in chapter-letters {\n    my-h2(short: [Chap. #letter])[This is Chapter #letter]\n    for p in range(1, num-paragraphs-per-chapter + 1) {\n      my-par(id: [#p], lorem(50))\n    }\n  }\n}\n```\n\n</details>\n\nAnd for the last solution:\n\n<details><summary>code</summary>\n\n```typ\n// Helper Functions\n#let get-short(label, x) = {\n  query(selector(label).before(x.location())).at(-1, default: none)\n}\n#let shorts-and-id(x) = {\n  let h1 = get-short(<h1-short>, x)\n  let h2 = get-short(<h2-short>, x)\n  (h1: h1.value, h2: h2.value, id: x.value)\n}\n// Output assembly\n#let header-content(a, b) = {\n  [#a.h1, #a.h2, Par. #a.id --- #b.h1, #b.h2, Par. #b.id]\n}\n\n// Return array. Index: page number. Value: Array of paragraph info on that page.\n#let shorts-per-page() = {\n  let pars = query(selector.or(<h4-start>, <h4-end>))\n  let page-pars-array = ((),) * (counter(page).final().first() + 1)\n  for par in pars {\n    page-pars-array.at(par.location().page()).push(shorts-and-id(par))\n  }\n  page-pars-array\n}\n\n#let cache = state(\"parscache\", none)\n\n// Actual Query\n#let header = context {\n  let page = here().page()\n  let cachedpars = cache.get()\n  if cachedpars == none {\n    cachedpars = shorts-per-page()\n    cache.update(_ => cachedpars)\n  }\n  let pars = cachedpars.at(page, default: none)\n  if pars == none or pars.len() == 0 { return }\n  header-content(pars.first(), pars.at(-1, default: none))\n}\n\n#set page(width: 120mm, height: 100mm, header: header)\n\n// The Elements\n#let my-h1(short: none, ..args) = {\n  heading(level: 1, ..args)\n  [#metadata(short)<h1-short>]\n}\n#show heading.where(level: 1): it => pagebreak(weak: true) + it\n\n#let my-h2(short: none, ..args) = {\n  heading(level: 2, ..args)\n  [#metadata(short)<h2-short>]\n}\n\n#let my-par(id: none, body) = {\n  [#metadata[#id]<h4-start>]\n  if id != none { heading(level: 4, id) }\n  body\n  [#metadata[#id]<h4-end>]\n  hide(\"​\")\n}\n#show heading.where(level: 4): it => it.body + \" \"\n\n// ⬇️ Test Content (setting num-sections below to 1,2,3…6 should roughly lead to the results in my post)\n// Used chapter letters just for better overview in the example output\n// ABCDEFGHIJKLMNOPQRSTUVWXYZ\n#let chapter-letters = \"ABCDEFGH\"\n#let num-paragraphs-per-chapter = 25\n\n// Use sys.inputs for command line parametrization.\n#let num-sections = int(sys.inputs.at(\"N\", default: \"1\"))\n#for s in range(1, num-sections + 1) {\n  my-h1(short: [Section #s])[This is Section #s]\n  for letter in chapter-letters {\n    my-h2(short: [Chap. #letter])[This is Chapter #letter]\n    for p in range(1, num-paragraphs-per-chapter + 1) {\n      my-par(id: [#p], lorem(50))\n    }\n  }\n}\n```\n\n</details>\n\nHowever, from limited testing, this doesn't affect performance.\n\n[quote=\"a_w, post:8, topic:3585\"]\nWould this mean it could get even faster when switching the…\n\n```typ\n// Out of your code\n#let cachedpars = cache.get()\n\n// As in his example (slow)\n#for _ in range(n) {\n  context bar()\n}\n// vs. (faster)\n#for i in range(n) {\n  context bar(i)\n}\n```\n\n…for example every 10 or 20 pages?\n[/quote]\n\nUsing a `bar(page)` for `cache.get()` doesn't seem to make a difference, at least for 1 s runs.\n\nBy the way, you should check out [`hyperfine`](https://github.com/sharkdp/hyperfine) for benchmarking and `--timings` `typst compile` flag.\n\n```sh\nhyperfine --warmup 1 'typst c file.typ'\n```",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 1,
      "reads": 29,
      "score": 25.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11049,
      "post_number": 10,
      "username": "a_w",
      "name": "Alex",
      "created_at": "2025-04-14T06:30:57.850Z",
      "updated_at": "2025-04-14T06:30:57.850Z",
      "cooked": "<p>Thank you for the refactoring, <a class=\"mention\" href=\"/u/andrew\">@Andrew</a>; I’ve learned a couple of random shortcuts there too. I’ve marked the answer of <a class=\"mention\" href=\"/u/bluss\">@bluss</a> as a solution, as everything else builds upon his cache strategy. Which I want to thank him for again; I can now compile the actual documents. It is still somewhat slow, but ~10 minutes is MUCH better than +5 hours (without finishing).</p>\n<p>And also thanks for the tip with hyperfine, <a class=\"mention\" href=\"/u/andrew\">@Andrew</a>, I’ve checked it out. About the…</p>\n<aside class=\"quote no-group\" data-username=\"Andrew\" data-post=\"9\" data-topic=\"3585\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/andrew/48/62_2.png\" class=\"avatar\"> Andrew:</div>\n<blockquote>\n<p>Using a <code>bar(page)</code> for <code>cache.get()</code> doesn’t seem to make a difference, at least for 1 s runs.</p>\n</blockquote>\n</aside>\n<p>Can you show me how you tested it? I would like to try to fiddle with <code>--jobs</code> and the “busted” cache for the longer runs. My “idea” (rather my understanding of what Laurenz said in the issue) would have been to try “recomputing from scratch” every couple of pages, but I don’t know WHEN validating the cache hit becomes more taxing than recomputing (so e.g. if it makes sense to recompute everytime or just after x pages).</p>",
      "raw": "Thank you for the refactoring, @Andrew; I've learned a couple of random shortcuts there too. I've marked the answer of @bluss as a solution, as everything else builds upon his cache strategy. Which I want to thank him for again; I can now compile the actual documents. It is still somewhat slow, but ~10 minutes is MUCH better than +5 hours (without finishing).\n\nAnd also thanks for the tip with hyperfine, @Andrew, I've checked it out. About the…\n\n[quote=\"Andrew, post:9, topic:3585\"]\nUsing a `bar(page)` for `cache.get()` doesn’t seem to make a difference, at least for 1 s runs.\n[/quote]\n\nCan you show me how you tested it? I would like to try to fiddle with `--jobs` and the \"busted\" cache for the longer runs. My \"idea\" (rather my understanding of what Laurenz said in the issue) would have been to try \"recomputing from scratch\" every couple of pages, but I don't know WHEN validating the cache hit becomes more taxing than recomputing (so e.g. if it makes sense to recompute everytime or just after x pages).",
      "reply_to_post_number": null,
      "reply_count": 3,
      "quote_count": 1,
      "like_count": 1,
      "reads": 27,
      "score": 35.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 566
    },
    {
      "id": 11056,
      "post_number": 11,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-14T07:51:15.276Z",
      "updated_at": "2025-04-14T07:51:15.276Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"a_w\" data-post=\"10\" data-topic=\"3585\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/a_w/48/1206_2.png\" class=\"avatar\"> a_w:</div>\n<blockquote>\n<p>Which I want to thank him for again; I can now compile the actual documents.</p>\n</blockquote>\n</aside>\n<p>I’m happy that it helps! I didn’t realize you had documents that were even bigger than these examples, 10 minutes of compile time is still an insane scale of document <img src=\"https://forum.typst.app/images/emoji/apple/smile.png?v=12\" title=\":smile:\" class=\"emoji\" alt=\":smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<p>I did some experiments in the direction of - what if you use different label names in different chapters of the document <code>&lt;h4-start-chapter1&gt;</code> and so on, but from early testing it seems like the count of each label type doesn’t matter, only the total number of labels or total count of pages where the query is used. (But maybe there is some kind of improvement that can be found?)</p>\n<p>I think that at this scale, every label and locatable element has some overhead, so it’s worth thinking about and testing every little detail.</p>",
      "raw": "[quote=\"a_w, post:10, topic:3585\"]\nWhich I want to thank him for again; I can now compile the actual documents.\n[/quote]\nI'm happy that it helps! I didn't realize you had documents that were even bigger than these examples, 10 minutes of compile time is still an insane scale of document :smile: \n\nI did some experiments in the direction of - what if you use different label names in different chapters of the document `<h4-start-chapter1>` and so on, but from early testing it seems like the count of each label type doesn't matter, only the total number of labels or total count of pages where the query is used. (But maybe there is some kind of improvement that can be found?)\n\nI think that at this scale, every label and locatable element has some overhead, so it's worth thinking about and testing every little detail.",
      "reply_to_post_number": 10,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 0,
      "reads": 27,
      "score": 5.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11057,
      "post_number": 12,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-14T07:54:36.586Z",
      "updated_at": "2025-04-14T07:54:36.586Z",
      "cooked": "<p>There might have been a small win if you - using Andrew’s code and function name - call it like <code>header(here().page())</code> and remove the here().page() lookup from the inside header function. I saw in timings that there was a small improvement that way. I would expect that the caching in a state variable we did solves most of the cache validation problem, but I don’t know.</p>",
      "raw": "There might have been a small win if you - using Andrew's code and function name - call it like `header(here().page())` and remove the here().page() lookup from the inside header function. I saw in timings that there was a small improvement that way. I would expect that the caching in a state variable we did solves most of the cache validation problem, but I don't know.",
      "reply_to_post_number": 10,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 28,
      "score": 25.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11178,
      "post_number": 13,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T18:12:03.520Z",
      "updated_at": "2025-04-16T18:12:03.520Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"a_w\" data-post=\"10\" data-topic=\"3585\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/a_w/48/1206_2.png\" class=\"avatar\"> a_w:</div>\n<blockquote>\n<p>Can you show me how you tested it?</p>\n</blockquote>\n</aside>\n<p>I changed <code>let cachedpars = cache.get()</code> to <code>let cachedpars = bar(page)</code> with <code>let bar(_) = cache.get()</code> and run <code>hyperfine</code>.</p>",
      "raw": "[quote=\"a_w, post:10, topic:3585\"]\nCan you show me how you tested it?\n[/quote]\n\nI changed `let cachedpars = cache.get()` to `let cachedpars = bar(page)` with `let bar(_) = cache.get()` and run `hyperfine`.",
      "reply_to_post_number": 10,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 1,
      "reads": 23,
      "score": 24.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11204,
      "post_number": 14,
      "username": "a_w",
      "name": "Alex",
      "created_at": "2025-04-17T06:14:05.414Z",
      "updated_at": "2025-04-17T06:14:05.414Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"bluss\" data-post=\"12\" data-topic=\"3585\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/b/441A5E/48.png\" class=\"avatar\"> bluss:</div>\n<blockquote>\n<p>I saw in timings that there was a small improvement that way.</p>\n</blockquote>\n</aside>\n<aside class=\"quote no-group\" data-username=\"Andrew\" data-post=\"13\" data-topic=\"3585\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/andrew/48/62_2.png\" class=\"avatar\"> Andrew:</div>\n<blockquote>\n<p>I changed <code>let cachedpars = cache.get()</code> to <code>let cachedpars = bar(page)</code> with <code>let bar(_) = cache.get()</code> and run <code>hyperfine</code>.</p>\n</blockquote>\n</aside>\n<p>Thank you <img src=\"https://forum.typst.app/images/emoji/apple/pray.png?v=12\" title=\":pray:\" class=\"emoji\" alt=\":pray:\" loading=\"lazy\" width=\"20\" height=\"20\"> I will test everything mentioned and report back.</p>",
      "raw": "[quote=\"bluss, post:12, topic:3585\"]\nI saw in timings that there was a small improvement that way.\n[/quote]\n\n[quote=\"Andrew, post:13, topic:3585\"]\nI changed `let cachedpars = cache.get()` to `let cachedpars = bar(page)` with `let bar(_) = cache.get()` and run `hyperfine`.\n[/quote]\n\nThank you 🙏 I will test everything mentioned and report back.",
      "reply_to_post_number": 13,
      "reply_count": 0,
      "quote_count": 2,
      "like_count": 0,
      "reads": 23,
      "score": 4.6,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 566
    },
    {
      "id": 11302,
      "post_number": 15,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2025-04-18T20:19:47.691Z",
      "updated_at": "2025-04-18T20:19:47.691Z",
      "cooked": "<p>I played with this a bit as well, and <a class=\"mention\" href=\"/u/bluss\">@bluss</a>’s solution basically adds two big improvements: the caching, and removing the two queries</p>\n<aside class=\"quote no-group\" data-username=\"a_w\" data-post=\"1\" data-topic=\"3585\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/a_w/48/1206_2.png\" class=\"avatar\"> a_w:</div>\n<blockquote>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">      let prevs = query(selector(&lt;h4-start&gt;).before(here()))\n      let nexts = query(selector(&lt;h4-end&gt;).after(here()))\n</code></pre>\n</blockquote>\n</aside>\n<p>For me the runtime (real, N=3) goes from ~25.6s with the original code to ~10.7s without caching, only the additional queries removed, to ~0.5s with bluss’s code.</p>\n<p>This makes sense: even without caching, not performing these two queries per page (which are distinct due to the <code>before(here())</code> filter) will add up.</p>\n<p>So I tried to also get rid of the queries in <code>get-short</code>; that’s four queries per paragraph (<code>shorts-and-id()</code> performs two queries, and it’s called for both paragraph start and end). I ended up with the following <code>shorts-per-page()</code>:</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">// Return array. Index: page number. Value: Array of paragraph info on that page.\n#let shorts-per-page() = {\n    let elems = query(selector.or(&lt;h1-short&gt;, &lt;h2-short&gt;, &lt;h4-start&gt;, &lt;h4-end&gt;))\n\n    let h1 = none\n    let h2 = none\n    let d = ()\n    for elem in elems {\n      let lbl = elem.label\n      if lbl == &lt;h1-short&gt; { h1 = elem }\n      else if lbl == &lt;h2-short&gt; { h2 = elem }\n      else {\n        let pg = elem.location().page()\n        while d.len() &lt;= pg { d.push(()) }\n        d.at(pg).push((h1: h1.value, h2: h2.value, id: elem.value))\n      }\n    }\n\n    return d\n}\n</code></pre>\n<p>(The helpers are no longer needed.) Overall this means that Typst is now only running a single query per layout iteration – just that that query has more results.</p>\n<p>This brought the runtime (real, N=10) from ~3.1s to ~2.1s. So the speedup is not as extreme as what bluss was already able to achieve, but it probably will still add up. <img src=\"https://forum.typst.app/images/emoji/apple/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "I played with this a bit as well, and @bluss's solution basically adds two big improvements: the caching, and removing the two queries\n\n[quote=\"a_w, post:1, topic:3585\"]\n```typc\n      let prevs = query(selector(<h4-start>).before(here()))\n      let nexts = query(selector(<h4-end>).after(here()))\n```\n[/quote]\n\nFor me the runtime (real, N=3) goes from ~25.6s with the original code to ~10.7s without caching, only the additional queries removed, to ~0.5s with bluss's code.\n\nThis makes sense: even without caching, not performing these two queries per page (which are distinct due to the `before(here())` filter) will add up.\n\nSo I tried to also get rid of the queries in `get-short`; that's four queries per paragraph (`shorts-and-id()` performs two queries, and it's called for both paragraph start and end). I ended up with the following `shorts-per-page()`:\n\n```typc\n// Return array. Index: page number. Value: Array of paragraph info on that page.\n#let shorts-per-page() = {\n    let elems = query(selector.or(<h1-short>, <h2-short>, <h4-start>, <h4-end>))\n\n    let h1 = none\n    let h2 = none\n    let d = ()\n    for elem in elems {\n      let lbl = elem.label\n      if lbl == <h1-short> { h1 = elem }\n      else if lbl == <h2-short> { h2 = elem }\n      else {\n        let pg = elem.location().page()\n        while d.len() <= pg { d.push(()) }\n        d.at(pg).push((h1: h1.value, h2: h2.value, id: elem.value))\n      }\n    }\n\n    return d\n}\n```\n(The helpers are no longer needed.) Overall this means that Typst is now only running a single query per layout iteration -- just that that query has more results.\n\nThis brought the runtime (real, N=10) from ~3.1s to ~2.1s. So the speedup is not as extreme as what bluss was already able to achieve, but it probably will still add up. :slight_smile:",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 6,
      "reads": 20,
      "score": 99.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 11561,
      "post_number": 16,
      "username": "a_w",
      "name": "Alex",
      "created_at": "2025-04-24T15:23:46.137Z",
      "updated_at": "2025-04-24T15:27:42.809Z",
      "cooked": "<p>The easter holidays delayed my tests a bit, but I want to begin with thanking <a class=\"mention\" href=\"/u/sillyfreak\">@SillyFreak</a> for his effort on top of the work of Andrew and bluss, thank you very much! <img src=\"https://forum.typst.app/images/emoji/apple/face_holding_back_tears.png?v=12\" title=\":face_holding_back_tears:\" class=\"emoji\" alt=\":face_holding_back_tears:\" loading=\"lazy\" width=\"20\" height=\"20\"><img src=\"https://forum.typst.app/images/emoji/apple/pray.png?v=12\" title=\":pray:\" class=\"emoji\" alt=\":pray:\" loading=\"lazy\" width=\"20\" height=\"20\"> Your solution cuts the rendering time almost in half again.</p>\n<p>Here is an overview of what I get in terms of real rendering time for one of my documents. I didn’t use <code>hyperfine</code> as I only did 1-2 runs each, because it still takes 1,5-2 Min. to render. So the following timings are the <code>total</code> time given by the <code>time</code> command on a M1 Max Mac.</p>\n<p><strong>1. Original version</strong><br>\nNot compilable (5h+)</p>\n<p><strong>2. Optimized version of Bluss</strong><br>\n2:34,80 total</p>\n<p><strong>3. Optimized version of SillyFreak</strong><br>\n1:21,97 total</p>\n<p><strong>4. Cache busting attempt</strong></p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">let bar(_) = cache.get()\nlet cachedpars = bar(page)\n</code></pre>\n<p> → No change</p>\n<p><strong>5. Moving Code to header() function</strong><br>\n → Made it 5-6 seconds slower in my tests (probably “No change”)</p>\n<p><strong>6. Removing heading page break</strong></p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">#show heading.where(level: 1): it =&gt; {\n  pagebreak(weak: true)\n  it\n}\n</code></pre>\n<p> → 1:13,24 total</p>\n<p><strong>7. Running on M2 instead of M1 Max</strong><br>\n → 1:08,04 total</p>\n<p><strong>8. Rendering without any paragraph count</strong><br>\n → 20,644 total</p>\n<p><strong>9. Removing ToC as well</strong><br>\n → 19,830 total</p>\n<p><strong>10. Removing page numbers as well</strong><br>\n → 9,683 total</p>\n<p><strong>11. --jobs=2 vs. --jobs=10</strong><br>\n → No Change</p>\n<p>The biggest remaining levers were throwing more single-core performance on the problem and removing the default page break for level 1 headings. But we probably can’t expect more speed ups even if the memoization in comemo improves as the cache busting didn’t affect the compilation times. The query, page numbers and headline page break add about ~1:10 of overhead in total.</p>\n<p>But I can now render the documents! <img src=\"https://forum.typst.app/images/emoji/apple/partying_face.png?v=12\" title=\":partying_face:\" class=\"emoji\" alt=\":partying_face:\" loading=\"lazy\" width=\"20\" height=\"20\"> Thanks so much again to everyone involved.</p>",
      "raw": "The easter holidays delayed my tests a bit, but I want to begin with thanking @SillyFreak for his effort on top of the work of Andrew and bluss, thank you very much! 🥹🙏 Your solution cuts the rendering time almost in half again.\n\nHere is an overview of what I get in terms of real rendering time for one of my documents. I didn't use `hyperfine` as I only did 1-2 runs each, because it still takes 1,5-2 Min. to render. So the following timings are the `total` time given by the `time` command on a M1 Max Mac.\n\n**1. Original version**\nNot compilable (5h+)\n\n**2. Optimized version of Bluss**\n2:34,80 total\n\n**3. Optimized version of SillyFreak**\n1:21,97 total\n\n**4. Cache busting attempt**\n```typc\nlet bar(_) = cache.get()\nlet cachedpars = bar(page)\n```\n-> No change\n\n**5. Moving Code to header() function**\n-> Made it 5-6 seconds slower in my tests (probably \"No change\")\n\n**6. Removing heading page break**\n```typc\n#show heading.where(level: 1): it => {\n  pagebreak(weak: true)\n  it\n}\n```\n-> 1:13,24 total\n\n**7. Running on M2 instead of M1 Max**\n-> 1:08,04 total\n\n**8. Rendering without any paragraph count**\n-> 20,644 total\n\n**9. Removing ToC as well**\n-> 19,830 total\n\n**10. Removing page numbers as well**\n-> 9,683 total\n\n**11. --jobs=2 vs. --jobs=10**\n-> No Change\n\nThe biggest remaining levers were throwing more single-core performance on the problem and removing the default page break for level 1 headings. But we probably can't expect more speed ups even if the memoization in comemo improves as the cache busting didn't affect the compilation times. The query, page numbers and headline page break add about ~1:10 of overhead in total.\n\nBut I can now render the documents! 🥳 Thanks so much again to everyone involved.",
      "reply_to_post_number": 15,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 17,
      "score": 68.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 566
    },
    {
      "id": 11569,
      "post_number": 17,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-24T17:45:05.054Z",
      "updated_at": "2025-04-24T17:45:05.054Z",
      "cooked": "<pre data-code-wrap=\"sh\"><code class=\"lang-sh\">hyperfine --runs 2\n</code></pre>",
      "raw": "```sh\nhyperfine --runs 2\n```",
      "reply_to_post_number": 16,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 17,
      "score": 3.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:49:28.399196"
}
{
  "topic_metadata": {
    "id": 3587,
    "title": "How can I make uppercase letters upright by default in math mode, but selectively italic?",
    "slug": "how-can-i-make-uppercase-letters-upright-by-default-in-math-mode-but-selectively-italic",
    "posts_count": 3,
    "created_at": "2025-04-09T14:28:30.329Z",
    "last_posted_at": "2025-04-09T15:19:25.911Z",
    "views": 62,
    "like_count": 5,
    "reply_count": 0,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "janekfleper",
    "tags": [
      "math"
    ],
    "category_id": 5,
    "participant_count": 2,
    "word_count": 377
  },
  "posts": [
    {
      "id": 10849,
      "post_number": 1,
      "username": "Kyok",
      "name": "Kyok",
      "created_at": "2025-04-09T14:28:30.444Z",
      "updated_at": "2025-04-18T15:21:59.107Z",
      "cooked": "<p>Hello everyone,</p>\n<p>I’m trying to implement a specific formatting rule in my Typst document where uppercase letters in math mode should be upright by default (instead of the default italic style), but I still want to be able to selectively make some of them italic when needed.</p>\n<p>Here’s what I’ve tried:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#show math.equation: eq =&gt; {\n  show regex(\"[A-Z]\"): it =&gt; math.upright(it.text)\n  eq\n}\n\n$A = B + C + italic(A)$\n</code></pre>\n<p>The problem is that while this successfully makes all uppercase letters upright by default (A, B, C), the <code>italic(A)</code> still appears upright, ignoring the <code>italic()</code> function.</p>\n<p>I understand this happens because the regex rule is applied after other styling, effectively “overriding” any <code>italic()</code> commands.</p>\n<p>Is there a way to achieve what I’m trying to do? Ideally, I’d like:</p>\n<ol>\n<li>All uppercase letters to be upright by default in math mode</li>\n<li>The ability to use something like <code>italic(A)</code> or a custom function to selectively make specific uppercase letters italic when needed</li>\n</ol>\n<p>I don’t want to use “A” (quoted text) in math mode to get upright letters, as this would require changing too much of my existing document. I’m looking for a solution that works with regular uppercase letters and math syntax.</p>\n<p>Any suggestions would be greatly appreciated!</p>\n<p>Thank you!</p>",
      "raw": "Hello everyone,\n\nI'm trying to implement a specific formatting rule in my Typst document where uppercase letters in math mode should be upright by default (instead of the default italic style), but I still want to be able to selectively make some of them italic when needed.\n\nHere's what I've tried:\n\n```typst\n#show math.equation: eq => {\n  show regex(\"[A-Z]\"): it => math.upright(it.text)\n  eq\n}\n\n$A = B + C + italic(A)$\n```\n\nThe problem is that while this successfully makes all uppercase letters upright by default (A, B, C), the `italic(A)` still appears upright, ignoring the `italic()` function.\n\nI understand this happens because the regex rule is applied after other styling, effectively \"overriding\" any `italic()` commands.\n\nIs there a way to achieve what I'm trying to do? Ideally, I'd like:\n1. All uppercase letters to be upright by default in math mode\n2. The ability to use something like `italic(A)` or a custom function to selectively make specific uppercase letters italic when needed\n\nI don't want to use \"A\" (quoted text) in math mode to get upright letters, as this would require changing too much of my existing document. I'm looking for a solution that works with regular uppercase letters and math syntax.\n\nAny suggestions would be greatly appreciated!\n\nThank you!",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 24,
      "score": 164.6,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1437
    },
    {
      "id": 10850,
      "post_number": 2,
      "username": "janekfleper",
      "name": "Janek Fleper",
      "created_at": "2025-04-09T14:51:43.522Z",
      "updated_at": "2025-04-09T14:52:08.952Z",
      "cooked": "<p>The regex show rule only matches the “raw” content without the <code>math.italic()</code> style. The style <code>math.upright()</code> is therefore added first and the “custom” style <code>math.italic()</code> is ignored. You could work around this (or even use this behavior) by applying a general show rule that applies <code>math.upright()</code> and a regex show rule matching everything <em>but</em> uppercase characters that applies <code>math.italic()</code>.</p>\n<p>I don’t know if there are any special cases where this approach fails. The few examples below work exactly according to your specifications.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show math.equation: eq =&gt; {\n  show: math.upright\n  show regex(\"[^A-Z]\"): math.italic\n  eq\n}\n\n$A = B + C + italic(A)$ \\\n$a = b + c + d$ \\\n$1 + 2$\n</code></pre>",
      "raw": "The regex show rule only matches the \"raw\" content without the `math.italic()` style. The style `math.upright()` is therefore added first and the \"custom\" style `math.italic()` is ignored. You could work around this (or even use this behavior) by applying a general show rule that applies `math.upright()` and a regex show rule matching everything _but_ uppercase characters that applies `math.italic()`.\n\nI don't know if there are any special cases where this approach fails. The few examples below work exactly according to your specifications.\n\n```typ\n#show math.equation: eq => {\n  show: math.upright\n  show regex(\"[^A-Z]\"): math.italic\n  eq\n}\n\n$A = B + C + italic(A)$ \\\n$a = b + c + d$ \\\n$1 + 2$\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 24,
      "score": 39.6,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 69
    },
    {
      "id": 10852,
      "post_number": 3,
      "username": "Kyok",
      "name": "Kyok",
      "created_at": "2025-04-09T15:19:25.911Z",
      "updated_at": "2025-04-09T15:19:25.911Z",
      "cooked": "<p>Thank you for your solution! This works perfectly and helped me understand how Typst handles style application. I appreciate you taking the time to explain the underlying mechanism with the regex matching only raw content. Your approach is elegant and exactly what I needed.</p>",
      "raw": "Thank you for your solution! This works perfectly and helped me understand how Typst handles style application. I appreciate you taking the time to explain the underlying mechanism with the regex matching only raw content. Your approach is elegant and exactly what I needed.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 24,
      "score": 19.6,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1437
    }
  ],
  "scraped_at": "2025-06-10T09:49:27.598046"
}
{
  "topic_metadata": {
    "id": 3590,
    "title": "How to add spacing to list or enum without affecting linespacing?",
    "slug": "how-to-add-spacing-to-list-or-enum-without-affecting-linespacing",
    "posts_count": 16,
    "created_at": "2025-04-09T19:06:15.997Z",
    "last_posted_at": "2025-04-16T16:02:32.589Z",
    "views": 229,
    "like_count": 15,
    "reply_count": 10,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 8,
    "accepted_answer_username": "Andrew",
    "tags": [
      "lists",
      "spacing"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 1838
  },
  "posts": [
    {
      "id": 10861,
      "post_number": 1,
      "username": "Jarko",
      "name": "Jarko",
      "created_at": "2025-04-09T19:06:16.132Z",
      "updated_at": "2025-04-18T19:21:56.979Z",
      "cooked": "<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/2/2d1a213d3f30f174fc7e72343e96e0809d06f522.png\" data-download-href=\"https://forum.typst.app/uploads/default/2d1a213d3f30f174fc7e72343e96e0809d06f522\" title=\"BulletSpacing\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/2/2d1a213d3f30f174fc7e72343e96e0809d06f522_2_690x412.png\" alt=\"BulletSpacing\" data-base62-sha1=\"6qZt5cHaNlhYfrN3UHd0yVjPdRw\" width=\"690\" height=\"412\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/2/2d1a213d3f30f174fc7e72343e96e0809d06f522_2_690x412.png, https://forum.typst.app/uploads/default/optimized/2X/2/2d1a213d3f30f174fc7e72343e96e0809d06f522_2_1035x618.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/2/2d1a213d3f30f174fc7e72343e96e0809d06f522_2_1380x824.png 2x\" data-dominant-color=\"F7F6F7\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">BulletSpacing</span><span class=\"informations\">1646×984 291 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>I can’t seem to find a way to achieve consistent spacing with bullet lists and numbered lists. The spacing of the marked spots is somehow tied to par(leading)? What should I change to achieve same spacing throughout my list without affecting the par line spacing?</p>",
      "raw": "![BulletSpacing|690x412](upload://6qZt5cHaNlhYfrN3UHd0yVjPdRw.png)\n\nI can't seem to find a way to achieve consistent spacing with bullet lists and numbered lists. The spacing of the marked spots is somehow tied to par(leading)? What should I change to achieve same spacing throughout my list without affecting the par line spacing?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 43,
      "score": 188.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1287
    },
    {
      "id": 10862,
      "post_number": 2,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-09T19:19:31.530Z",
      "updated_at": "2025-04-09T19:19:31.530Z",
      "cooked": "<p>Maybe you could try something like this,</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show list: set par(leading: välys)\n#show list.item: set par(leading: 0.2em)\n</code></pre>\n<p>So inside the list set par.leading and then restore it in list.item so that any paragraphs in the list still use your tight spacing</p>",
      "raw": "Maybe you could try something like this,\n\n```typ\n#show list: set par(leading: välys)\n#show list.item: set par(leading: 0.2em)\n```\n\nSo inside the list set par.leading and then restore it in list.item so that any paragraphs in the list still use your tight spacing",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 42,
      "score": 13.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 10889,
      "post_number": 4,
      "username": "Jarko",
      "name": "Jarko",
      "created_at": "2025-04-10T15:26:01.169Z",
      "updated_at": "2025-04-10T15:26:01.169Z",
      "cooked": "<p>Thank you bluss. I adjusted my code but still can’t quite get the consistency with spacings with all the items:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/8/8475bfa4b9768c117ccf3afa3c4bae865986f61f.jpeg\" data-download-href=\"https://forum.typst.app/uploads/default/8475bfa4b9768c117ccf3afa3c4bae865986f61f\" title=\"Closer\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/8/8475bfa4b9768c117ccf3afa3c4bae865986f61f_2_613x500.jpeg\" alt=\"Closer\" data-base62-sha1=\"iTNiGiCju06wGL8Luz6OExXRyUv\" width=\"613\" height=\"500\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/8/8475bfa4b9768c117ccf3afa3c4bae865986f61f_2_613x500.jpeg, https://forum.typst.app/uploads/default/optimized/2X/8/8475bfa4b9768c117ccf3afa3c4bae865986f61f_2_919x750.jpeg 1.5x, https://forum.typst.app/uploads/default/optimized/2X/8/8475bfa4b9768c117ccf3afa3c4bae865986f61f_2_1226x1000.jpeg 2x\" data-dominant-color=\"F4F4F5\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">Closer</span><span class=\"informations\">1920×1564 180 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>Any ideas how to continue?</p>\n<p>Here’s the typst code from the pic in plain text:</p>\n<pre><code class=\"lang-auto\">\n#set page(paper: \"a5\")\n\n#let välys = 2.2em\n#let linespace = 0.2em\n\n#set list(\n  marker: (\n    text(1.0em, fill: rgb(\"#0969DA\"),[▸]),\n    text(1.0em, fill: rgb(\"#0969DA\"),[▹]),\n  )\n)\n\n#set enum(\n  numbering: (it =&gt; text(1.0em, fill: rgb(\"#0969DA\"),strong[#it.]))\n)\n\n#show enum: set par(leading: välys, spacing: välys)\n#show list: set par(leading: välys, spacing: välys)\n\n#set par(leading: linespace, spacing: välys)\n#show list.item: set par(leading: linespace)\n#show enum.item: set par(leading: linespace)\n\n#lorem(20)\n\n#lorem(20)\n- #lorem(20)\n- #strong[Aaa] #lorem(20)\n- #strong[Bbb] #lorem(20)\n  - #strong[Ccc] #lorem(20)\n  - #strong[Ddd] #lorem(20)\n    - #strong[Eee] #lorem(20)\n    - #strong[Fff] #lorem(20)\n  - #strong[Ggg] #lorem(20)\n    1. #strong[Hhh] #lorem(20)\n    2. #strong[Iii] #lorem(20)\n    3. #strong[Jjj] #lorem(20)\n1. #strong[Kkk] #lorem(20)\n  - #strong[Lll] #lorem(20)\n  - #strong[Mmm] #lorem(20)\n  - #strong[Nnn] #lorem(20)\n\n</code></pre>",
      "raw": "Thank you bluss. I adjusted my code but still can't quite get the consistency with spacings with all the items:\n\n![Closer|613x500](upload://iTNiGiCju06wGL8Luz6OExXRyUv.jpeg)\n\nAny ideas how to continue?\n\nHere's the typst code from the pic in plain text:\n\n```\n\n#set page(paper: \"a5\")\n\n#let välys = 2.2em\n#let linespace = 0.2em\n\n#set list(\n  marker: (\n    text(1.0em, fill: rgb(\"#0969DA\"),[▸]),\n    text(1.0em, fill: rgb(\"#0969DA\"),[▹]),\n  )\n)\n\n#set enum(\n  numbering: (it => text(1.0em, fill: rgb(\"#0969DA\"),strong[#it.]))\n)\n\n#show enum: set par(leading: välys, spacing: välys)\n#show list: set par(leading: välys, spacing: välys)\n\n#set par(leading: linespace, spacing: välys)\n#show list.item: set par(leading: linespace)\n#show enum.item: set par(leading: linespace)\n\n#lorem(20)\n\n#lorem(20)\n- #lorem(20)\n- #strong[Aaa] #lorem(20)\n- #strong[Bbb] #lorem(20)\n  - #strong[Ccc] #lorem(20)\n  - #strong[Ddd] #lorem(20)\n    - #strong[Eee] #lorem(20)\n    - #strong[Fff] #lorem(20)\n  - #strong[Ggg] #lorem(20)\n    1. #strong[Hhh] #lorem(20)\n    2. #strong[Iii] #lorem(20)\n    3. #strong[Jjj] #lorem(20)\n1. #strong[Kkk] #lorem(20)\n  - #strong[Lll] #lorem(20)\n  - #strong[Mmm] #lorem(20)\n  - #strong[Nnn] #lorem(20)\n\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 36,
      "score": 27.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1287
    },
    {
      "id": 10901,
      "post_number": 5,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-10T17:51:14.012Z",
      "updated_at": "2025-04-10T17:51:14.012Z",
      "cooked": "<p>That looks inconsistent yes, first problem is on the item called Ccc I assume. I don’t have any suggestion.</p>",
      "raw": "That looks inconsistent yes, first problem is on the item called Ccc I assume. I don't have any suggestion.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 11.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 10913,
      "post_number": 6,
      "username": "Jarko",
      "name": "Jarko",
      "created_at": "2025-04-10T18:32:43.064Z",
      "updated_at": "2025-04-10T18:32:43.064Z",
      "cooked": "<p>Exactly.<br>\nThanks for taking a look.<br>\nI’ll keep this unsolved for the time being.</p>",
      "raw": "Exactly.\nThanks for taking a look.\nI'll keep this unsolved for the time being.",
      "reply_to_post_number": 5,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 31,
      "score": 6.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1287
    },
    {
      "id": 10961,
      "post_number": 7,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-12T13:59:58.929Z",
      "updated_at": "2025-04-12T13:59:58.929Z",
      "cooked": "<p><a class=\"mention\" href=\"/u/jarko\">@Jarko</a>, please read <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\" class=\"inline-onebox\">How to post in the Questions category</a>.</p>\n<aside class=\"quote no-group quote-modified\" data-username=\"reknih\" data-post=\"1\" data-topic=\"11\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/reknih/48/3_2.png\" class=\"avatar\"><a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11/1\">How to post in the Questions category</a></div>\n<blockquote>\n<p>If your question pertains to a bit of Typst markup you have problems with, put it in the question body! You can syntax-highlight Typst code by wrapping it in ` ```typ … ````. It will then look like this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set font(size: 12pt)\n\nHello from *Typst* at $ pi.var + 1 $ o'clock!\n</code></pre>\n<p>If you need to highlight a code or math mode snippet instead, the language tags <code>typc</code> and <code>typm</code> do that, respectively.</p>\n<p>It would be great if you could post the <strong>smallest possible code samples</strong> that allow people to see what your problem is.</p>\n</blockquote>\n</aside>\n<p>When creating a topic in <a class=\"hashtag-cooked\" href=\"/c/questions/5\" data-type=\"category\" data-slug=\"questions\" data-id=\"5\"><span class=\"hashtag-icon-placeholder\"><svg class=\"fa d-icon d-icon-square-full svg-icon svg-node\"><use href=\"#square-full\"></use></svg></span><span>Questions</span></a>, there should be no reason to post an image of the code the question is about, instead it needs to be included using instructions from the linked post above. If you need to show an output, then it must be inserted by itself without unnecessary information like source code.</p>\n<hr>\n<p>Sometimes it’s also useful to add <code>details</code> block or “Hide Details” from the post composer dropdown menu with the gear icon.</p>\n<pre><code class=\"lang-plaintext\">[details=\"Summary\"]\nThis text will be hidden\n[/details]\n</code></pre>\n<p>Or the HTML tag:</p>\n<pre><code class=\"lang-plaintext\">&lt;details&gt;&lt;summary&gt;Summary&lt;/summary&gt;\n\nBig image or code block\n\n```typ\n```\n\n&lt;/details&gt;\n</code></pre>",
      "raw": "@Jarko, please read https://forum.typst.app/t/how-to-post-in-the-questions-category/11.\n\n[quote=\"reknih, post:1, topic:11\"]\nIf your question pertains to a bit of Typst markup you have problems with, put it in the question body! You can syntax-highlight Typst code by wrapping it in ` ```typ ... ````. It will then look like this:\n\n```typ\n#set font(size: 12pt)\n\nHello from *Typst* at $ pi.var + 1 $ o'clock!\n```\n\nIf you need to highlight a code or math mode snippet instead, the language tags `typc` and `typm` do that, respectively.\n\nIt would be great if you could post the **smallest possible code samples** that allow people to see what your problem is.\n[/quote]\n\nWhen creating a topic in #questions, there should be no reason to post an image of the code the question is about, instead it needs to be included using instructions from the linked post above. If you need to show an output, then it must be inserted by itself without unnecessary information like source code.\n\n---\n\nSometimes it's also useful to add `details` block or \"Hide Details\" from the post composer dropdown menu with the gear icon.\n\n```text\n[details=\"Summary\"]\nThis text will be hidden\n[/details]\n```\n\nOr the HTML tag:\n\n````text\n<details><summary>Summary</summary>\n\nBig image or code block\n\n```typ\n```\n\n</details>\n````",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 33,
      "score": 41.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 10962,
      "post_number": 8,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-12T14:23:01.085Z",
      "updated_at": "2025-04-12T21:06:34.082Z",
      "cooked": "<p>It is not clear what exact spacing and in what places you want, and the provided snippet looks wrong, because it looks like it tries to override the same field in different places.</p>\n<p>Here is a solution where everything is using the same spacing (or so it looks visually):</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set page(width: 150mm, height: auto)\n\n#let marker-num-color = rgb(\"#0969DA\")\n#set list(marker: ([▸], [▹]).map(text.with(marker-num-color)))\n#set enum(numbering: (..n) =&gt; text(marker-num-color, numbering(\"1.\", ..n)))\n\n#let spacing = 2.2em\n\n#set par(spacing: spacing, leading: spacing, justify: true)\n\n#let words = 26\n\n#lorem(words)\n\n#lorem(words)\n- #lorem(words)\n- #strong[Aaa] #lorem(words)\n- #strong[Bbb] #lorem(words)\n  - #strong[Ccc] #lorem(words)\n  - #strong[Ddd] #lorem(words)\n    - #strong[Eee] #lorem(words)\n    - #strong[Fff] #lorem(words)\n  - #strong[Ggg] #lorem(words)\n    + #strong[Hhh] #lorem(words)\n    + #strong[Iii] #lorem(words)\n    + #strong[Jjj] #lorem(words)\n+ #strong[Kkk] #lorem(words)\n  - #strong[Lll] #lorem(words)\n  - #strong[Mmm] #lorem(words)\n  - #strong[Nnn] #lorem(words)\n</code></pre>\n<details><summary>output</summary>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/1/1dd435e0d23f31bee9bb99e2c70dfba05f450c8d.png\" data-download-href=\"https://forum.typst.app/uploads/default/1dd435e0d23f31bee9bb99e2c70dfba05f450c8d\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/1/1dd435e0d23f31bee9bb99e2c70dfba05f450c8d_2_111x500.png\" alt=\"image\" data-base62-sha1=\"4fSvkZnzF5Neu6ACGDrkNQ4d4AJ\" width=\"111\" height=\"500\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/1/1dd435e0d23f31bee9bb99e2c70dfba05f450c8d_2_111x500.png, https://forum.typst.app/uploads/default/optimized/2X/1/1dd435e0d23f31bee9bb99e2c70dfba05f450c8d_2_166x750.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/1/1dd435e0d23f31bee9bb99e2c70dfba05f450c8d_2_222x1000.png 2x\" data-dominant-color=\"1A1A1A\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">226×1010 72.7 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n</details>\n<p>If you want to set in-paragraph line spacing separately, but the rest is the same, then use this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set par(spacing: 2.2em, leading: 0.2em, justify: true)\n#show selector.or(list.item, enum.item): block\n</code></pre>\n<details><summary>output</summary>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/b/b7030b040e52105f08fbbdfa5f85e426ab1b7625.png\" data-download-href=\"https://forum.typst.app/uploads/default/b7030b040e52105f08fbbdfa5f85e426ab1b7625\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/b/b7030b040e52105f08fbbdfa5f85e426ab1b7625_2_209x499.png\" alt=\"image\" data-base62-sha1=\"q6ZTB7SUqATOEkHx3XzXD5MvLjD\" width=\"209\" height=\"499\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/b/b7030b040e52105f08fbbdfa5f85e426ab1b7625_2_209x499.png, https://forum.typst.app/uploads/default/optimized/2X/b/b7030b040e52105f08fbbdfa5f85e426ab1b7625_2_313x748.png 1.5x, https://forum.typst.app/uploads/default/original/2X/b/b7030b040e52105f08fbbdfa5f85e426ab1b7625.png 2x\" data-dominant-color=\"242525\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">405×965 160 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n</details>\n<p>I’m not sure why <code>v(0pt)</code> works but <code>\"\"</code> doesn’t. This post is actually a duplicate of <a href=\"https://forum.typst.app/t/how-to-control-spacing-between-an-outer-enum-and-inner-bullet-list/3483\" class=\"inline-onebox\">How to control spacing between an outer enum and inner bullet list</a>, but with some additional settings on top, which makes the solution a bit different.</p>",
      "raw": "It is not clear what exact spacing and in what places you want, and the provided snippet looks wrong, because it looks like it tries to override the same field in different places.\n\nHere is a solution where everything is using the same spacing (or so it looks visually):\n\n```typ\n#set page(width: 150mm, height: auto)\n\n#let marker-num-color = rgb(\"#0969DA\")\n#set list(marker: ([▸], [▹]).map(text.with(marker-num-color)))\n#set enum(numbering: (..n) => text(marker-num-color, numbering(\"1.\", ..n)))\n\n#let spacing = 2.2em\n\n#set par(spacing: spacing, leading: spacing, justify: true)\n\n#let words = 26\n\n#lorem(words)\n\n#lorem(words)\n- #lorem(words)\n- #strong[Aaa] #lorem(words)\n- #strong[Bbb] #lorem(words)\n  - #strong[Ccc] #lorem(words)\n  - #strong[Ddd] #lorem(words)\n    - #strong[Eee] #lorem(words)\n    - #strong[Fff] #lorem(words)\n  - #strong[Ggg] #lorem(words)\n    + #strong[Hhh] #lorem(words)\n    + #strong[Iii] #lorem(words)\n    + #strong[Jjj] #lorem(words)\n+ #strong[Kkk] #lorem(words)\n  - #strong[Lll] #lorem(words)\n  - #strong[Mmm] #lorem(words)\n  - #strong[Nnn] #lorem(words)\n```\n\n<details><summary>output</summary>\n\n![image|111x500](upload://4fSvkZnzF5Neu6ACGDrkNQ4d4AJ.png)\n\n</details>\n\nIf you want to set in-paragraph line spacing separately, but the rest is the same, then use this:\n\n```typ\n#set par(spacing: 2.2em, leading: 0.2em, justify: true)\n#show selector.or(list.item, enum.item): block\n```\n\n<details><summary>output</summary>\n\n![image|209x499](upload://q6ZTB7SUqATOEkHx3XzXD5MvLjD.png)\n\n</details>\n\nI'm not sure why `v(0pt)` works but `\"\"` doesn't. This post is actually a duplicate of https://forum.typst.app/t/how-to-control-spacing-between-an-outer-enum-and-inner-bullet-list/3483, but with some additional settings on top, which makes the solution a bit different.",
      "reply_to_post_number": null,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 3,
      "reads": 29,
      "score": 150.8,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 10965,
      "post_number": 9,
      "username": "Jarko",
      "name": "Jarko",
      "created_at": "2025-04-12T18:15:55.972Z",
      "updated_at": "2025-04-12T18:15:55.972Z",
      "cooked": "<p>You solved it. Thank you so much.</p>",
      "raw": "You solved it. Thank you so much.",
      "reply_to_post_number": 8,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 26,
      "score": 20.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1287
    },
    {
      "id": 10966,
      "post_number": 10,
      "username": "Jarko",
      "name": "Jarko",
      "created_at": "2025-04-12T18:22:36.082Z",
      "updated_at": "2025-04-12T18:22:36.082Z",
      "cooked": "<p>Thank you.</p>\n<p>This could be the default placeholder text for us newbies posting a new topic.</p>\n<aside class=\"quote no-group quote-modified\" data-username=\"Andrew\" data-post=\"7\" data-topic=\"3590\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/andrew/48/62_2.png\" class=\"avatar\"> Andrew:</div>\n<blockquote>\n<pre><code class=\"lang-auto\">&lt;details&gt;&lt;summary&gt;Your sumary here&lt;/summary&gt;\n\nYour big imagefile or codeblock here\n\n```typ```\n\n&lt;/details&gt;\n</code></pre>\n</blockquote>\n</aside>",
      "raw": "Thank you.\n\nThis could be the default placeholder text for us newbies posting a new topic.\n\n[quote=\"Andrew, post:7, topic:3590\"]\n```\n<details><summary>Your sumary here</summary>\n\nYour big imagefile or codeblock here\n\n```typ```\n\n</details>\n```\n[/quote]",
      "reply_to_post_number": 7,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 1,
      "reads": 26,
      "score": 25.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1287
    },
    {
      "id": 10967,
      "post_number": 11,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-12T18:38:25.561Z",
      "updated_at": "2025-04-12T18:38:25.561Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Andrew\" data-post=\"8\" data-topic=\"3590\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/andrew/48/62_2.png\" class=\"avatar\"> Andrew:</div>\n<blockquote>\n<p><code>show enum-or-list: x =&gt; v(0pt) + x</code></p>\n</blockquote>\n</aside>\n<p>Nice. What insight led you to this solution? This inserts an extra space so that something about paragraph placement or spacing logic changes, is that it?</p>",
      "raw": "[quote=\"Andrew, post:8, topic:3590\"]\n`show enum-or-list: x => v(0pt) + x`\n[/quote]\nNice. What insight led you to this solution? This inserts an extra space so that something about paragraph placement or spacing logic changes, is that it?",
      "reply_to_post_number": 8,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 0,
      "reads": 23,
      "score": 9.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 10970,
      "post_number": 12,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-12T19:07:10.997Z",
      "updated_at": "2025-04-12T19:07:10.997Z",
      "cooked": "<p>As I said, it felt, and it mostly is a duplicate of <a href=\"https://forum.typst.app/t/how-to-control-spacing-between-an-outer-enum-and-inner-bullet-list/3483\" class=\"inline-onebox\">How to control spacing between an outer enum and inner bullet list</a>, so I just yonked <a href=\"https://forum.typst.app/t/how-to-control-spacing-between-an-outer-enum-and-inner-bullet-list/3483/3\" class=\"inline-onebox\">How to control spacing between an outer enum and inner bullet list - #3 by Andrew</a> and adapted it. It was too much, but then I reduced it to 0, and it looked correct, so I rolled with it. I’m definitely not sure how the logic works with this one, but the rest of the solution does make sense for the most part.</p>",
      "raw": "As I said, it felt, and it mostly is a duplicate of https://forum.typst.app/t/how-to-control-spacing-between-an-outer-enum-and-inner-bullet-list/3483, so I just yonked https://forum.typst.app/t/how-to-control-spacing-between-an-outer-enum-and-inner-bullet-list/3483/3?u=andrew and adapted it. It was too much, but then I reduced it to 0, and it looked correct, so I rolled with it. I'm definitely not sure how the logic works with this one, but the rest of the solution does make sense for the most part.",
      "reply_to_post_number": 11,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 24,
      "score": 4.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 10971,
      "post_number": 13,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-12T19:14:57.936Z",
      "updated_at": "2025-04-12T19:14:57.936Z",
      "cooked": "<p>When you select something, you should use “Quote” or “Copy Quote”. Doesn’t look like you did, because that is not how I wrote it. Also, there is a Discource bug that the language identifier is not preserved when quoting, so you kind of have to re-insert it yourself for the time being.</p>\n<aside class=\"onebox discoursetopic\" data-onebox-src=\"https://meta.discourse.org/t/language-identifier-is-missing-from-fenced-code-block-when-it-is-quoted/327895\">\n  <header class=\"source\">\n      <img src=\"https://d11a6trkgmumsb.cloudfront.net/optimized/3X/b/3/b33be9538df3547fcf9d1a51a4637d77392ac6f9_2_32x32.png\" class=\"site-icon\" width=\"32\" height=\"32\">\n\n      <a href=\"https://meta.discourse.org/t/language-identifier-is-missing-from-fenced-code-block-when-it-is-quoted/327895\" target=\"_blank\" rel=\"noopener nofollow ugc\" title=\"10:53AM - 24 September 2024\">Discourse Meta – 24 Sep 24</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/362;\"><img src=\"https://d11a6trkgmumsb.cloudfront.net/original/4X/4/2/7/42734728531d1b8d4906ac646d5cc06c9ddd52c9.jpeg\" class=\"thumbnail\" width=\"690\" height=\"362\"></div>\n\n<div class=\"title-wrapper\">\n  <h3><a href=\"https://meta.discourse.org/t/language-identifier-is-missing-from-fenced-code-block-when-it-is-quoted/327895\" target=\"_blank\" rel=\"noopener nofollow ugc\">Language identifier is missing from fenced code block when it is quoted</a></h3>\n  <div class=\"topic-category\">\n      <span class=\"badge-wrapper bullet\">\n        <span class=\"badge-category-bg\" style=\"background-color: #ffef00;\"></span>\n        <span class=\"badge-category clear-badge\">\n          <span class=\"category-name\">Bug</span>\n        </span>\n      </span>\n  </div>\n</div>\n\n  <p>Someone can write something like this:  ```py print() ```  But when you then quote its output:  print()  it will be quoted without the language identifier, like this:   print()   Specifically, I noticed this in https://forum.typst.app, and not...</p>\n\n  <p>\n    <span class=\"label1\">Reading time: 1 mins 🕑</span>\n      <span class=\"label2\">Likes: 6 ❤</span>\n  </p>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
      "raw": "When you select something, you should use \"Quote\" or \"Copy Quote\". Doesn't look like you did, because that is not how I wrote it. Also, there is a Discource bug that the language identifier is not preserved when quoting, so you kind of have to re-insert it yourself for the time being.\n\nhttps://meta.discourse.org/t/language-identifier-is-missing-from-fenced-code-block-when-it-is-quoted/327895",
      "reply_to_post_number": 10,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 5.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 10973,
      "post_number": 14,
      "username": "Eric",
      "name": "Eric Biedert",
      "created_at": "2025-04-12T20:12:30.042Z",
      "updated_at": "2025-04-12T20:12:30.042Z",
      "cooked": "<p>I think all answers so far are missing something:</p>\n<ul>\n<li>The spacing between the list and the preceding paragraph is given by <code>par.leading</code> if the list is <code>tight</code> <em>and</em> attached (i.e. no empty line in between), and <code>block.spacing</code> (which falls back to <code>par.spacing</code>) otherwise.</li>\n<li>The spacing between two list items is given by <code>list.spacing</code>, which by default (i.e. when set to <code>auto</code>) falls back to <code>par.leading</code> or <code>par.spacing</code>, depending on whether the list is <code>tight</code> or not.</li>\n</ul>\n<p>This means that just with the syntax you use to create the list, you can already control much of the spacing.</p>\n<table>\n<tbody><tr>\n<th>Tight and attached</th>\n<th>Tight and not attached</th>\n<th>Not tight and attached</th>\n<th>Not tight and not attached</th>\n</tr>\n<tr>\n<td>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">Some text\n- First item\n- Second item\n\n\n</code></pre>\n</td>\n<td>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">Some text\n\n- First item\n- Second item\n\n</code></pre>\n</td>\n<td>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">Some text\n- First item\n\n- Second item\n\n</code></pre>\n</td>\n<td>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">Some text\n\n- First item\n\n- Second item\n</code></pre>\n</td>\n</tr>\n<tr>\n<td>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/5/5d804be0ea55e435dbadfedac8b632c6d54f2784.png\" alt=\"image\" data-base62-sha1=\"dl9hgDIsiVpwfVLBtnpDEpdqGPy\" width=\"217\" height=\"167\"></p>\n</td>\n<td>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/d/db0ce2f3aea13af217098a862c78f3bee7f5e284.png\" alt=\"image\" data-base62-sha1=\"vfOaRPhLPF3igrRtxey233ai24k\" width=\"217\" height=\"167\"></p>\n</td>\n<td>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/8/86d98afc49616890454a5731de81e63210394a0f.png\" alt=\"image\" data-base62-sha1=\"jeW40famvj7HUHr2qxMVaFTkCUT\" width=\"217\" height=\"167\"></p>\n</td>\n<td>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/8/86d98afc49616890454a5731de81e63210394a0f.png\" alt=\"image\" data-base62-sha1=\"jeW40famvj7HUHr2qxMVaFTkCUT\" width=\"217\" height=\"167\"></p>\n</td>\n</tr>\n</tbody></table>\n<p>Usually, you only need to add the empty line once to mark the whole list as not tight. For example, the list</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">- First item\n \n- Second item\n- Third item\n</code></pre>\n<p>will not be tight, even though there is no empty line between the last two items. However, when creating sub-lists, a new nested list is created, which may attach to the body of the parent list item. For example, in</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">- First item\n\n- Second item\n  - Nested list\n</code></pre>\n<p>the nested sub-list is tight and attached to paragraph containing the text “Parent list item”, even though the outer list is not tight. To fix that, you would need to make the nested list again not attached or not tight by adding another empty line.</p>\n<hr>\n<p>If you don’t want to always have to introduce empty lines, you can override the spacing rules introduced by the tightness and paragraph attachments by just wrapping every list item (and enum item, maybe also terms item) in a block with custom set spacing. If you still want set rules for <code>list.spacing</code> to have an effect, you can use that as the block spacing:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// If `list.spacing` is set to auto, falls back to `par.spacing`.\n#show list.item: it =&gt; block(spacing: list.spacing, it)\n#show enum.item: it =&gt; block(spacing: enum.spacing, it)\n\n// Alternatively, if you don't need list.spacing rules to work:\n#show selector.or(list.item, enum.item): block\n</code></pre>\n<p>The spacing between list items and the spacing between the preceding paragraph and the list is then only determined by that value, making all lists behave the same, no matter if you put any empty lines in your source code.</p>",
      "raw": "I think all answers so far are missing something:\n- The spacing between the list and the preceding paragraph is given by `par.leading` if the list is `tight` _and_ attached (i.e. no empty line in between), and `block.spacing` (which falls back to `par.spacing`) otherwise.\n- The spacing between two list items is given by `list.spacing`, which by default (i.e. when set to `auto`) falls back to `par.leading` or `par.spacing`, depending on whether the list is `tight` or not. \n\nThis means that just with the syntax you use to create the list, you can already control much of the spacing.\n\n<table>\n<tr style=\"text-align: center\">\n<th>Tight and attached</th>\n<th>Tight and not attached</th>\n<th>Not tight and attached</th>\n<th>Not tight and not attached</th>\n</tr>\n<tr>\n<td>\n\n```typ\nSome text\n- First item\n- Second item\n\n\n```\n\n</td>\n<td>\n\n```typ\nSome text\n\n- First item\n- Second item\n\n```\n\n</td>\n<td>\n\n```typ\nSome text\n- First item\n\n- Second item\n\n```\n\n</td>\n<td>\n\n```typ\nSome text\n\n- First item\n\n- Second item\n```\n\n</td>\n</tr>\n\n<tr>\n<td>\n\n![image|217x167](upload://dl9hgDIsiVpwfVLBtnpDEpdqGPy.png)\n\n</td>\n<td>\n\n![image|217x167](upload://vfOaRPhLPF3igrRtxey233ai24k.png)\n\n\n</td>\n<td>\n\n![image|217x167](upload://jeW40famvj7HUHr2qxMVaFTkCUT.png)\n\n</td>\n<td>\n\n![image|217x167](upload://jeW40famvj7HUHr2qxMVaFTkCUT.png)\n\n</td>\n\n</tr>\n</table>\n\nUsually, you only need to add the empty line once to mark the whole list as not tight. For example, the list\n```typ\n- First item\n \n- Second item\n- Third item\n```\nwill not be tight, even though there is no empty line between the last two items. However, when creating sub-lists, a new nested list is created, which may attach to the body of the parent list item. For example, in\n```typ\n- First item\n\n- Second item\n  - Nested list\n```\nthe nested sub-list is tight and attached to paragraph containing the text \"Parent list item\", even though the outer list is not tight. To fix that, you would need to make the nested list again not attached or not tight by adding another empty line.\n\n---\n\nIf you don't want to always have to introduce empty lines, you can override the spacing rules introduced by the tightness and paragraph attachments by just wrapping every list item (and enum item, maybe also terms item) in a block with custom set spacing. If you still want set rules for `list.spacing` to have an effect, you can use that as the block spacing:\n```typ\n// If `list.spacing` is set to auto, falls back to `par.spacing`.\n#show list.item: it => block(spacing: list.spacing, it)\n#show enum.item: it => block(spacing: enum.spacing, it)\n\n// Alternatively, if you don't need list.spacing rules to work:\n#show selector.or(list.item, enum.item): block\n```\nThe spacing between list items and the spacing between the preceding paragraph and the list is then only determined by that value, making all lists behave the same, no matter if you put any empty lines in your source code.",
      "reply_to_post_number": null,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 6,
      "reads": 25,
      "score": 135.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 88
    },
    {
      "id": 10975,
      "post_number": 15,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-12T21:12:20.693Z",
      "updated_at": "2025-04-12T21:12:20.693Z",
      "cooked": "<p>Thank you for the elaborate explanation. I’ve simplified my answer.</p>",
      "raw": "Thank you for the elaborate explanation. I've simplified my answer.",
      "reply_to_post_number": 14,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 20,
      "score": 14.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 10977,
      "post_number": 16,
      "username": "Jarko",
      "name": "Jarko",
      "created_at": "2025-04-13T04:30:52.446Z",
      "updated_at": "2025-04-13T04:33:40.338Z",
      "cooked": "<details><summary>Thank you guys.\n<p>To demonstrate and for debugging purposes I added: <span class=\"hashtag-raw\">#show</span> selector(par): rect</p>\n<p>The typst code is now very close to what I am really trying to achieve: <strong>I do need to add additional spacing between the “top level” paragraphs which do not have list or enum markers before them.</strong> The ideal situation would be to have control over these “real non-enum non-list paragraphs” whether they are followed by an enum-list-item or something else (such as another “real paragraph” or heading or image or table or quote). <strong>But I struggle to select them as can be seen from the screenshot below:</strong> </p></summary><p></p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/2/238ac7f05f50f9d6882c45b8d0a3dd46fbec9140.png\" data-download-href=\"https://forum.typst.app/uploads/default/238ac7f05f50f9d6882c45b8d0a3dd46fbec9140\" title=\"SelectingPars\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/2/238ac7f05f50f9d6882c45b8d0a3dd46fbec9140_2_245x499.png\" alt=\"SelectingPars\" data-base62-sha1=\"54q305QEmbuvBZXkSMbTqGZpOMg\" width=\"245\" height=\"499\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/2/238ac7f05f50f9d6882c45b8d0a3dd46fbec9140_2_245x499.png, https://forum.typst.app/uploads/default/optimized/2X/2/238ac7f05f50f9d6882c45b8d0a3dd46fbec9140_2_367x748.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/2/238ac7f05f50f9d6882c45b8d0a3dd46fbec9140_2_490x998.png 2x\" data-dominant-color=\"E3E4E2\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">SelectingPars</span><span class=\"informations\">756×1538 472 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>Here’s the typst code that’s being used so far:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set page(width: 150mm, height: auto)\n\n#let marker-num-color = rgb(\"#0969DA\")\n#set list(marker: ([▸], [▹]).map(text.with(marker-num-color)))\n#set enum(numbering: (..n) =&gt; text(marker-num-color, numbering(\"1.\", ..n)))\n\n#let välys = 1.2em\n#let riviväli = 0.2em\n\n#set par(spacing: välys, leading: riviväli, justify: true)\n#show selector.or(list.item, enum.item): block\n\n#show selector(par): rect // How to adjust this line?\n\n#let words = 26\n\n#lorem(words)\n\n#lorem(words)\n\n- #lorem(words)\n- #strong[Aaa] #lorem(words)\n- #strong[Bbb] #lorem(words)\n  - #strong[Ccc] #lorem(words)\n  - #strong[Ddd] #lorem(words)\n    - #strong[Eee] #lorem(words)\n    - #strong[Fff] #lorem(words)\n  - #strong[Ggg] #lorem(words)\n    + #strong[Hhh] #lorem(words)\n    + #strong[Iii] #lorem(words)\n    + #strong[Jjj] #lorem(words)\n+ #strong[Kkk] #lorem(words)\n  - #strong[Lll] #lorem(words)\n  - #strong[Mmm] #lorem(words)\n  - #strong[Nnn] #lorem(words)\n</code></pre>\n</details>",
      "raw": "<details><summary>Thank you guys.\n\nTo demonstrate and for debugging purposes I added: #show selector(par): rect\n\nThe typst code is now very close to what I am really trying to achieve: **I do need to add additional spacing between the \"top level\" paragraphs which do not have list or enum markers before them.** The ideal situation would be to have control over these \"real non-enum non-list paragraphs\" whether they are followed by an enum-list-item or something else (such as another \"real paragraph\" or heading or image or table or quote). **But I struggle to select them as can be seen from the screenshot below:** </summary>\n\n![SelectingPars|245x499](upload://54q305QEmbuvBZXkSMbTqGZpOMg.png)\n\nHere's the typst code that's being used so far:\n\n```typ\n#set page(width: 150mm, height: auto)\n\n#let marker-num-color = rgb(\"#0969DA\")\n#set list(marker: ([▸], [▹]).map(text.with(marker-num-color)))\n#set enum(numbering: (..n) => text(marker-num-color, numbering(\"1.\", ..n)))\n\n#let välys = 1.2em\n#let riviväli = 0.2em\n\n#set par(spacing: välys, leading: riviväli, justify: true)\n#show selector.or(list.item, enum.item): block\n\n#show selector(par): rect // How to adjust this line?\n\n#let words = 26\n\n#lorem(words)\n\n#lorem(words)\n\n- #lorem(words)\n- #strong[Aaa] #lorem(words)\n- #strong[Bbb] #lorem(words)\n  - #strong[Ccc] #lorem(words)\n  - #strong[Ddd] #lorem(words)\n    - #strong[Eee] #lorem(words)\n    - #strong[Fff] #lorem(words)\n  - #strong[Ggg] #lorem(words)\n    + #strong[Hhh] #lorem(words)\n    + #strong[Iii] #lorem(words)\n    + #strong[Jjj] #lorem(words)\n+ #strong[Kkk] #lorem(words)\n  - #strong[Lll] #lorem(words)\n  - #strong[Mmm] #lorem(words)\n  - #strong[Nnn] #lorem(words)\n```\n\n</details>",
      "reply_to_post_number": 14,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 19,
      "score": 23.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1287
    },
    {
      "id": 11174,
      "post_number": 17,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T16:02:32.589Z",
      "updated_at": "2025-04-16T16:02:56.297Z",
      "cooked": "<p>If you have further questions or problems, feel free to open a new <a class=\"hashtag-cooked\" href=\"/c/questions/5\" data-type=\"category\" data-slug=\"questions\" data-id=\"5\"><span class=\"hashtag-icon-placeholder\"><svg class=\"fa d-icon d-icon-square-full svg-icon svg-node\"><use href=\"#square-full\"></use></svg></span><span>Questions</span></a> topic, since this question has been answered.</p>",
      "raw": "If you have further questions or problems, feel free to open a new #questions topic, since this question has been answered.",
      "reply_to_post_number": 16,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 17,
      "score": 18.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:49:26.854725"
}
{
  "topic_metadata": {
    "id": 3591,
    "title": "How do I customize outline entries (`it.inner()` / `it.body()`)?",
    "slug": "how-do-i-customize-outline-entries-it-inner-it-body",
    "posts_count": 9,
    "created_at": "2025-04-09T21:35:55.519Z",
    "last_posted_at": "2025-04-16T21:45:01.870Z",
    "views": 191,
    "like_count": 0,
    "reply_count": 3,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 4,
    "accepted_answer_username": "Chris",
    "tags": [
      "outline",
      "styling"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 1425
  },
  "posts": [
    {
      "id": 10863,
      "post_number": 1,
      "username": "Chris",
      "name": "Christopher T. Kenny",
      "created_at": "2025-04-09T21:35:55.646Z",
      "updated_at": "2025-04-18T19:28:17.987Z",
      "cooked": "<p>Is there a simple way to edit or parse the <code>inner()</code> part of an outline entry?</p>\n<p>From the docs, the default rule is:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#show outline.entry: it =&gt; link(\n  it.element.location(),\n  it.indented(it.prefix(), it.inner()),\n)\n</code></pre>\n<p>and I can access the body with <code>it.body()</code> , but it seems like it gives a complicated sequence object.</p>\n<p>In particular, I want to split the body to only get up to the first period. (e.g. <code>This is figure 1. It does something.</code> =&gt; <code>This is figure 1.</code>)</p>\n<p>I suppose I could do something with <code>it.body()</code>, but it is not clear to me how to convert a sequence to a <code>str</code> or other editable object.</p>",
      "raw": "Is there a simple way to edit or parse the `inner()` part of an outline entry?\n\nFrom the docs, the default rule is:\n\n```typst\n#show outline.entry: it => link(\n  it.element.location(),\n  it.indented(it.prefix(), it.inner()),\n)\n```\n\nand I can access the body with `it.body()` , but it seems like it gives a complicated sequence object.\n\nIn particular, I want to split the body to only get up to the first period. (e.g. `This is figure 1. It does something.` => `This is figure 1.`)\n\nI suppose I could do something with `it.body()`, but it is not clear to me how to convert a sequence to a `str` or other editable object.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 391.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 105
    },
    {
      "id": 10864,
      "post_number": 2,
      "username": "aarnent",
      "name": "",
      "created_at": "2025-04-09T21:51:41.613Z",
      "updated_at": "2025-04-09T21:51:41.613Z",
      "cooked": "<p>You can access the entry’s text with <code>it.element.body.text</code>. In your case, if you want to ignore everything after the first period, you can do</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#show outline.entry: it =&gt; link(\n  it.element.location(),\n  it.indented(it.prefix(), [\n    #it.element.body.text.split(\".\").first()\n    #box(width: 1fr, repeat(\".\", gap: 0.15em))  // styling\n    #it.page()  // styling\n  ]),\n)\n</code></pre>",
      "raw": "You can access the entry's text with `it.element.body.text`. In your case, if you want to ignore everything after the first period, you can do\n```typst\n#show outline.entry: it => link(\n  it.element.location(),\n  it.indented(it.prefix(), [\n    #it.element.body.text.split(\".\").first()\n    #box(width: 1fr, repeat(\".\", gap: 0.15em))  // styling\n    #it.page()  // styling\n  ]),\n)\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 31,
      "score": 6.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 501
    },
    {
      "id": 10866,
      "post_number": 3,
      "username": "janekfleper",
      "name": "Janek Fleper",
      "created_at": "2025-04-09T23:08:03.085Z",
      "updated_at": "2025-04-09T23:11:06.391Z",
      "cooked": "<p>I wrote a function that splits the figure caption into a “title” and the “rest” of the caption for my thesis template. Since the caption body can be more complicated than a string, you cannot always directly split the body (text) at the first period. There are probably some cases that are not covered by the function yet, but it should already handle styling with <code>text()</code>, simple functions such as <code>emph()</code>, equations and general content sequences.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// Split a figure caption into a title and the rest\n//\n// The caption of a figure is usually just a block of content.\n// In the context of a thesis the caption can get quite long\n// and it would be great if the actual \"title\" of the figure\n// could be inferred from the caption. The title can then be\n// highlighted by using a bold font. And the title can also be\n// used in the table of figures where using the entire caption\n// would just take an insane amount of space.\n//\n// The approach with this function is to infer the title from\n// the caption body based on a specific separator. The easiest\n// choice here is to use the full stop/period. A colon could\n// also be useful in some cases.\n// The separator is not included with either the title or the\n// rest since the outline should not show the separator. In\n// the regular figure caption, the separator is just appended\n// to the title.\n//\n// An alternative approach is to define a short caption and a\n// long caption. The short caption will then be used for the\n// outline, and the long caption is used for the figure. This\n// is suggested in the Typst Examples Book:\n// https://sitandr.github.io/typst-examples-book/book/snippets/chapters/outlines.html#long-and-short-captions-for-the-outline\n//\n// - body (content): The caption\n// - separator (str): The separator to infer the title\n// -&gt; (dictionary):\n//    - title (content)\n//    - rest (content)\n#let split-figure-caption(body, separator) = {\n  if \"text\" in body.fields() {\n    // the actual separation is done here\n    let position = body.text.position(separator)\n    return (\n      title: if position == none { text(body.text) } else { text(body.text.slice(0, position)) },\n      rest: if position == none { none } else { text(body.text.slice(position + 1)) },\n    )\n  } else if \"child\" in body.fields() {\n    // this takes care of `styled()` functions such as `text(red)`\n    let func = body.func()\n    let args = body.styles\n    let (title, rest) = split-figure-caption(body.child, separator)\n    return (title: func(title, args), rest: if rest == none { none } else { func(rest, args) })\n  } else if \"body\" in body.fields() {\n    // this takes care of simple functions such as `emph()`\n    let func = body.func()\n    let (title, rest) = split-figure-caption(body.body, separator)\n    return (title: func(title), rest: if rest == none { none } else { func(rest) })\n  } else if \"children\" in body.fields() {\n    // this takes care of content sequences\n    let titles = ()\n    for i in range(body.children.len()) {\n      let (title, rest) = split-figure-caption(body.children.at(i), separator)\n      titles.push(title)\n      if rest != none {\n        return (\n          title: titles.join([]),\n          rest: ((rest,) + body.children.slice(i + 1)).join([]),\n        )\n      }\n    }\n  }\n\n  return (title: body, rest: none)\n}\n</code></pre>",
      "raw": "I wrote a function that splits the figure caption into a \"title\" and the \"rest\" of the caption for my thesis template. Since the caption body can be more complicated than a string, you cannot always directly split the body (text) at the first period. There are probably some cases that are not covered by the function yet, but it should already handle styling with `text()`, simple functions such as `emph()`, equations and general content sequences.\n\n```typ\n// Split a figure caption into a title and the rest\n//\n// The caption of a figure is usually just a block of content.\n// In the context of a thesis the caption can get quite long\n// and it would be great if the actual \"title\" of the figure\n// could be inferred from the caption. The title can then be\n// highlighted by using a bold font. And the title can also be\n// used in the table of figures where using the entire caption\n// would just take an insane amount of space.\n//\n// The approach with this function is to infer the title from\n// the caption body based on a specific separator. The easiest\n// choice here is to use the full stop/period. A colon could\n// also be useful in some cases.\n// The separator is not included with either the title or the\n// rest since the outline should not show the separator. In\n// the regular figure caption, the separator is just appended\n// to the title.\n//\n// An alternative approach is to define a short caption and a\n// long caption. The short caption will then be used for the\n// outline, and the long caption is used for the figure. This\n// is suggested in the Typst Examples Book:\n// https://sitandr.github.io/typst-examples-book/book/snippets/chapters/outlines.html#long-and-short-captions-for-the-outline\n//\n// - body (content): The caption\n// - separator (str): The separator to infer the title\n// -> (dictionary):\n//    - title (content)\n//    - rest (content)\n#let split-figure-caption(body, separator) = {\n  if \"text\" in body.fields() {\n    // the actual separation is done here\n    let position = body.text.position(separator)\n    return (\n      title: if position == none { text(body.text) } else { text(body.text.slice(0, position)) },\n      rest: if position == none { none } else { text(body.text.slice(position + 1)) },\n    )\n  } else if \"child\" in body.fields() {\n    // this takes care of `styled()` functions such as `text(red)`\n    let func = body.func()\n    let args = body.styles\n    let (title, rest) = split-figure-caption(body.child, separator)\n    return (title: func(title, args), rest: if rest == none { none } else { func(rest, args) })\n  } else if \"body\" in body.fields() {\n    // this takes care of simple functions such as `emph()`\n    let func = body.func()\n    let (title, rest) = split-figure-caption(body.body, separator)\n    return (title: func(title), rest: if rest == none { none } else { func(rest) })\n  } else if \"children\" in body.fields() {\n    // this takes care of content sequences\n    let titles = ()\n    for i in range(body.children.len()) {\n      let (title, rest) = split-figure-caption(body.children.at(i), separator)\n      titles.push(title)\n      if rest != none {\n        return (\n          title: titles.join([]),\n          rest: ((rest,) + body.children.slice(i + 1)).join([]),\n        )\n      }\n    }\n  }\n\n  return (title: body, rest: none)\n}\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 31,
      "score": 6.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 69
    },
    {
      "id": 10943,
      "post_number": 4,
      "username": "Chris",
      "name": "Christopher T. Kenny",
      "created_at": "2025-04-11T16:56:23.875Z",
      "updated_at": "2025-04-11T16:56:23.875Z",
      "cooked": "<p>Thank you both for the replies. This gave me enough to figure out how to extract the right pieces. Looks like the following works:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">show outline.entry: it =&gt; link(\n  it.element.location(),\n  it.indented(it.prefix(), [\n    #to-string(it.element.caption.body.children.flatten().join()).split(\".\").first()\n    #box(width: 1fr, repeat(\".\", gap: 0.15em))\n    #it.page()\n  ])\n)\n</code></pre>\n<p>where</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">let to-string(content) = {\n  if content.has(\"text\") {\n    content.text\n  } else if content.has(\"children\") {\n    content.children.map(to-string).join(\"\")\n  } else if content.has(\"body\") {\n    to-string(content.body)\n  } else if content == [ ] {\n    \" \"\n  }\n}\n</code></pre>",
      "raw": "Thank you both for the replies. This gave me enough to figure out how to extract the right pieces. Looks like the following works:\n\n```typst\nshow outline.entry: it => link(\n  it.element.location(),\n  it.indented(it.prefix(), [\n    #to-string(it.element.caption.body.children.flatten().join()).split(\".\").first()\n    #box(width: 1fr, repeat(\".\", gap: 0.15em))\n    #it.page()\n  ])\n)\n```\n\nwhere\n\n```typst\nlet to-string(content) = {\n  if content.has(\"text\") {\n    content.text\n  } else if content.has(\"children\") {\n    content.children.map(to-string).join(\"\")\n  } else if content.has(\"body\") {\n    to-string(content.body)\n  } else if content == [ ] {\n    \" \"\n  }\n}\n```",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 9.4,
      "accepted_answer": true,
      "trust_level": 1,
      "user_id": 105
    },
    {
      "id": 11112,
      "post_number": 5,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-15T13:40:26.126Z",
      "updated_at": "2025-04-15T13:50:52.354Z",
      "cooked": "<p>Can you explain why you can’t just change the heading name, or what is the practical purpose of this?</p>\n<p>You can simply apply a text show rule to this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show outline.entry: it =&gt; {\n  let heading-name = {\n    show regex(\"\\..*\"): \".\"\n    it.body()\n  }\n  let body = [#heading-name #box(width: 1fr, it.fill) #it.page()]\n  link(it.element.location(), it.indented(it.prefix(), body))\n}\n\n#outline()\n\n= This is figure 1. It does something\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/9/98e36f75c35f42e564ce61185a4555afb7fb071b.png\" alt=\"image\" data-base62-sha1=\"lOvQVbjJiq8yiPPSsRjLYBMEfOz\" width=\"572\" height=\"97\"></p>\n<p>This is not how you’re supposed to work in Typst, this should only be used if other more common solutions don’t work. Because regexing text is not the most robust solution.</p>",
      "raw": "Can you explain why you can't just change the heading name, or what is the practical purpose of this?\n\nYou can simply apply a text show rule to this:\n\n```typ\n#show outline.entry: it => {\n  let heading-name = {\n    show regex(\"\\..*\"): \".\"\n    it.body()\n  }\n  let body = [#heading-name #box(width: 1fr, it.fill) #it.page()]\n  link(it.element.location(), it.indented(it.prefix(), body))\n}\n\n#outline()\n\n= This is figure 1. It does something\n```\n\n![image|572x97](upload://lOvQVbjJiq8yiPPSsRjLYBMEfOz.png)\n\nThis is not how you're supposed to work in Typst, this should only be used if other more common solutions don't work. Because regexing text is not the most robust solution.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 18,
      "score": 3.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11132,
      "post_number": 6,
      "username": "Chris",
      "name": "Christopher T. Kenny",
      "created_at": "2025-04-15T19:58:05.812Z",
      "updated_at": "2025-04-15T19:58:05.812Z",
      "cooked": "<p>That might work here with a bit of modification to get the figure captions. The practical purpose is for a thesis in a field where the norm is captions like:</p>\n<pre><code class=\"lang-auto\">A short title for the figure. Specific details in a few sentences that explain the figure in a lot more text. A bunch more words.\n</code></pre>\n<p>These get printed like:</p>\n<pre><code class=\"lang-auto\">Figure #. A short title for the figure. Specific details in a few sentences that explain the figure in a lot more text. A bunch more words.\n</code></pre>\n<p>The problem is that then printing to the outline, you get a very long description.</p>",
      "raw": "That might work here with a bit of modification to get the figure captions. The practical purpose is for a thesis in a field where the norm is captions like:\n\n```\nA short title for the figure. Specific details in a few sentences that explain the figure in a lot more text. A bunch more words.\n```\n\nThese get printed like:\n\n```\nFigure #. A short title for the figure. Specific details in a few sentences that explain the figure in a lot more text. A bunch more words.\n```\n\nThe problem is that then printing to the outline, you get a very long description.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 19,
      "score": 8.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 105
    },
    {
      "id": 11182,
      "post_number": 7,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T19:35:03.833Z",
      "updated_at": "2025-04-16T21:45:21.094Z",
      "cooked": "<p>Here you go:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let in-outline() = {\n  let after-start = query(selector(&lt;outline-start&gt;).before(here())).len() == 1\n  let before-end = query(selector(&lt;outline-end&gt;).after(here())).len() == 1\n  after-start and before-end\n}\n\n#let caption(short, details) = context {\n  if in-outline() { short } else { [#short #details] }\n}\n\n#show outline: it =&gt; {\n  [#metadata(none)&lt;outline-start&gt;#it#metadata(none)&lt;outline-end&gt;]\n}\n\n#show figure.where(kind: image): set figure(\n  numbering: (..n) =&gt; context {\n    if in-outline() { numbering(\"1.\", ..n) } else { numbering(\"1\", ..n) }\n  },\n)\n\n#outline(target: figure.where(kind: image), title: [Table of figures])\n\n#figure(\n  rect(),\n  caption: caption[A short title for the figure.][Specific details in a few sentences that explain the figure in a lot more text. A bunch more words.],\n)\n\n#figure(rect(), caption: caption[A short title for the figure.][#lorem(10)])\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/8/85f13259d3ee250a589817dc60c91bcbfb7ee325.png\" data-download-href=\"https://forum.typst.app/uploads/default/85f13259d3ee250a589817dc60c91bcbfb7ee325\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/8/85f13259d3ee250a589817dc60c91bcbfb7ee325_2_690x277.png\" alt=\"image\" data-base62-sha1=\"j6UgqY0ZyXXNmMtNIG6cLEZBy0R\" width=\"690\" height=\"277\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/8/85f13259d3ee250a589817dc60c91bcbfb7ee325_2_690x277.png, https://forum.typst.app/uploads/default/original/2X/8/85f13259d3ee250a589817dc60c91bcbfb7ee325.png 1.5x, https://forum.typst.app/uploads/default/original/2X/8/85f13259d3ee250a589817dc60c91bcbfb7ee325.png 2x\" data-dominant-color=\"161616\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">782×315 36.2 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "Here you go:\n\n```typ\n#let in-outline() = {\n  let after-start = query(selector(<outline-start>).before(here())).len() == 1\n  let before-end = query(selector(<outline-end>).after(here())).len() == 1\n  after-start and before-end\n}\n\n#let caption(short, details) = context {\n  if in-outline() { short } else { [#short #details] }\n}\n\n#show outline: it => {\n  [#metadata(none)<outline-start>#it#metadata(none)<outline-end>]\n}\n\n#show figure.where(kind: image): set figure(\n  numbering: (..n) => context {\n    if in-outline() { numbering(\"1.\", ..n) } else { numbering(\"1\", ..n) }\n  },\n)\n\n#outline(target: figure.where(kind: image), title: [Table of figures])\n\n#figure(\n  rect(),\n  caption: caption[A short title for the figure.][Specific details in a few sentences that explain the figure in a lot more text. A bunch more words.],\n)\n\n#figure(rect(), caption: caption[A short title for the figure.][#lorem(10)])\n```\n\n![image|690x277](upload://j6UgqY0ZyXXNmMtNIG6cLEZBy0R.png)",
      "reply_to_post_number": 6,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 16,
      "score": 8.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11185,
      "post_number": 8,
      "username": "Chris",
      "name": "Christopher T. Kenny",
      "created_at": "2025-04-16T20:14:57.399Z",
      "updated_at": "2025-04-16T20:14:57.399Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Chris\" data-post=\"4\" data-topic=\"3591\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/chris/48/2604_2.png\" class=\"avatar\"> Chris:</div>\n<blockquote>\n<pre><code class=\"lang-auto\">show outline.entry: it =&gt; link(\n  it.element.location(),\n  it.indented(it.prefix(), [\n    #to-string(it.element.caption.body.children.flatten().join()).split(\".\").first()\n    #box(width: 1fr, repeat(\".\", gap: 0.15em))\n    #it.page()\n  ])\n)\n</code></pre>\n</blockquote>\n</aside>\n<p>Thanks, but the above solution does work and is much simpler.</p>",
      "raw": "[quote=\"Chris, post:4, topic:3591\"]\n```\nshow outline.entry: it => link(\n  it.element.location(),\n  it.indented(it.prefix(), [\n    #to-string(it.element.caption.body.children.flatten().join()).split(\".\").first()\n    #box(width: 1fr, repeat(\".\", gap: 0.15em))\n    #it.page()\n  ])\n)\n```\n[/quote]\n\nThanks, but the above solution does work and is much simpler.",
      "reply_to_post_number": 7,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 0,
      "reads": 16,
      "score": 8.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 105
    },
    {
      "id": 11194,
      "post_number": 9,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T21:45:01.870Z",
      "updated_at": "2025-04-16T21:45:01.870Z",
      "cooked": "<p>This solution is brittle and takes more lines (19 vs. 16):</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let to-string(content) = {\n  if content.has(\"text\") {\n    content.text\n  } else if content.has(\"children\") {\n    content.children.map(to-string).join(\"\")\n  } else if content.has(\"body\") {\n    to-string(content.body)\n  } else if content == [ ] {\n    \" \"\n  }\n}\n#show outline.entry: it =&gt; link(\n  it.element.location(),\n  it.indented(it.prefix(), [\n    #to-string(it.element.caption.body.children.flatten().join()).split(\".\").first()\n    #box(width: 1fr, repeat(\".\", gap: 0.15em))\n    #it.page()\n  ])\n)\n</code></pre>\n<br>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let in-outline() = {\n  let after-start = query(selector(&lt;outline-start&gt;).before(here())).len() == 1\n  let before-end = query(selector(&lt;outline-end&gt;).after(here())).len() == 1\n  after-start and before-end\n}\n#let caption(short, details) = context {\n  if in-outline() { short } else { [#short #details] }\n}\n#show outline: it =&gt; {\n  [#metadata(none)&lt;outline-start&gt;#it#metadata(none)&lt;outline-end&gt;]\n}\n#show figure.where(kind: image): set figure(\n  numbering: (..n) =&gt; context {\n    if in-outline() { numbering(\"1.\", ..n) } else { numbering(\"1\", ..n) }\n  },\n)\n</code></pre>\n<p>It doesn’t work with the caption example you provided:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#outline(target: figure.where(kind: image), title: [Table of figures])\n\n#figure(\n  rect(),\n  caption: [A short title for the figure. Specific details in a few sentences that explain the figure in a lot more text. A bunch more words.],\n)\n</code></pre>\n<p>Because the content is simple text, so it’s the <code>text</code> function and not <code>sequence</code>. If I add <code>---</code>, for example, it starts to work.</p>\n<p>Also from your example, there should be a period after <code>Figure #</code> in the outline, and your solution doesn’t include it. So it’s not really much simpler, but it also does less stuff and not as robust.</p>",
      "raw": "This solution is brittle and takes more lines (19 vs. 16):\n\n```typ\n#let to-string(content) = {\n  if content.has(\"text\") {\n    content.text\n  } else if content.has(\"children\") {\n    content.children.map(to-string).join(\"\")\n  } else if content.has(\"body\") {\n    to-string(content.body)\n  } else if content == [ ] {\n    \" \"\n  }\n}\n#show outline.entry: it => link(\n  it.element.location(),\n  it.indented(it.prefix(), [\n    #to-string(it.element.caption.body.children.flatten().join()).split(\".\").first()\n    #box(width: 1fr, repeat(\".\", gap: 0.15em))\n    #it.page()\n  ])\n)\n```\n\n<br>\n\n```typ\n#let in-outline() = {\n  let after-start = query(selector(<outline-start>).before(here())).len() == 1\n  let before-end = query(selector(<outline-end>).after(here())).len() == 1\n  after-start and before-end\n}\n#let caption(short, details) = context {\n  if in-outline() { short } else { [#short #details] }\n}\n#show outline: it => {\n  [#metadata(none)<outline-start>#it#metadata(none)<outline-end>]\n}\n#show figure.where(kind: image): set figure(\n  numbering: (..n) => context {\n    if in-outline() { numbering(\"1.\", ..n) } else { numbering(\"1\", ..n) }\n  },\n)\n```\n\nIt doesn't work with the caption example you provided:\n\n```typ\n#outline(target: figure.where(kind: image), title: [Table of figures])\n\n#figure(\n  rect(),\n  caption: [A short title for the figure. Specific details in a few sentences that explain the figure in a lot more text. A bunch more words.],\n)\n```\n\nBecause the content is simple text, so it's the `text` function and not `sequence`. If I add `---`, for example, it starts to work.\n\nAlso from your example, there should be a period after `Figure #` in the outline, and your solution doesn't include it. So it's not really much simpler, but it also does less stuff and not as robust.",
      "reply_to_post_number": 8,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 16,
      "score": 3.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:49:26.058063"
}
{
  "topic_metadata": {
    "id": 3596,
    "title": "How to compare func type of content?",
    "slug": "how-to-compare-func-type-of-content",
    "posts_count": 9,
    "created_at": "2025-04-10T11:39:14.025Z",
    "last_posted_at": "2025-04-18T21:29:26.058Z",
    "views": 133,
    "like_count": 5,
    "reply_count": 6,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 4,
    "accepted_answer_username": "Ants_Aare_Alamaa",
    "tags": [
      "scripting"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 1050
  },
  "posts": [
    {
      "id": 10873,
      "post_number": 1,
      "username": "Ants_Aare_Alamaa",
      "name": "Ants Aare Alamaa",
      "created_at": "2025-04-10T11:39:14.235Z",
      "updated_at": "2025-04-19T00:02:21.876Z",
      "cooked": "<p>I’m iterating over the children of a sequence, each one can be any type, be it text, math or context. I want to switch depending on the func type like this:</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">if child.func() == text {\n  ...\n} else if child.func() == context {\n  ...\n} else if child.func() == space {\n  ...\n} else if child.func() in (footnote, box, block, strike) {\n   ...\n}\n</code></pre>\n<p>this works totally fine for text, but it doesn’t seem to be working for the rest. probably because these funcs aren’t imported by default(?) or that it’s trying to invoke the function instead of comparing the functions. comparing with string doesn’t work… how do I get these funcs?</p>\n<p>when I do <code>repr(child.func)</code> I get this:<br>\ntext<br>\nspace<br>\ntext<br>\nfrac<br>\ncontext<br>\ntext</p>",
      "raw": "I'm iterating over the children of a sequence, each one can be any type, be it text, math or context. I want to switch depending on the func type like this:\n```typc\nif child.func() == text {\n  ...\n} else if child.func() == context {\n  ...\n} else if child.func() == space {\n  ...\n} else if child.func() in (footnote, box, block, strike) {\n   ...\n}\n```\nthis works totally fine for text, but it doesn't seem to be working for the rest. probably because these funcs aren't imported by default(?) or that it's trying to invoke the function instead of comparing the functions. comparing with string doesn't work... how do I get these funcs?\n\nwhen I do `repr(child.func)` I get this:\ntext\nspace\ntext\nfrac\ncontext\ntext",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 131.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 1028
    },
    {
      "id": 10875,
      "post_number": 2,
      "username": "Mathemensch",
      "name": "Alexander Schulz",
      "created_at": "2025-04-10T11:54:17.657Z",
      "updated_at": "2025-04-10T11:54:17.657Z",
      "cooked": "<p>You should use the <code>type</code> function for this kind of comparison:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#if type(child) == text {\n  ...\n} else if type(child) == context {\n  ...\n} else if type(child) == space{\n  ...\n} else if type(child) in (footnote, box, block, strike){\n   ...\n}\n</code></pre>\n<p>See the documentation:</p><aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://typst.app/docs/reference/foundations/type/\">\n  <header class=\"source\">\n      <img src=\"https://forum.typst.app/uploads/default/original/1X/098187a593d51c4db99324614e2baeeb1bb355cc.png\" class=\"site-icon\" data-dominant-color=\"3CA8B6\" width=\"32\" height=\"32\">\n\n      <a href=\"https://typst.app/docs/reference/foundations/type/\" target=\"_blank\" rel=\"noopener\">Typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/361;\"><img src=\"https://forum.typst.app/uploads/default/optimized/1X/db1c18ed802fe6841bee62606931f352da10ed09_2_690x362.png\" class=\"thumbnail\" data-dominant-color=\"7CC2C5\" width=\"690\" height=\"362\"></div>\n\n<h3><a href=\"https://typst.app/docs/reference/foundations/type/\" target=\"_blank\" rel=\"noopener\">Type Type – Typst Documentation</a></h3>\n\n  <p>Documentation for the Type type.</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
      "raw": "You should use the `type` function for this kind of comparison:\n\n```typ\n#if type(child) == text {\n  ...\n} else if type(child) == context {\n  ...\n} else if type(child) == space{\n  ...\n} else if type(child) in (footnote, box, block, strike){\n   ...\n}\n```\n\nSee the documentation:\nhttps://typst.app/docs/reference/foundations/type/",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 28,
      "score": 40.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 307
    },
    {
      "id": 10879,
      "post_number": 3,
      "username": "Ants_Aare_Alamaa",
      "name": "Ants Aare Alamaa",
      "created_at": "2025-04-10T12:19:42.973Z",
      "updated_at": "2025-04-10T12:19:42.973Z",
      "cooked": "<p>the type of all of the above is <code>content</code> so this doesn’t work. Also the code you provided doesn’t compile, it’s giving the same errors for using context, space, etc I need to get the funcs for these types of content somehow else or compare the repr, which I think may be slow</p>",
      "raw": "the type of all of the above is ```content``` so this doesn't work. Also the code you provided doesn't compile, it's giving the same errors for using context, space, etc I need to get the funcs for these types of content somehow else or compare the repr, which I think may be slow",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 27,
      "score": 55.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 1028
    },
    {
      "id": 10880,
      "post_number": 4,
      "username": "Ants_Aare_Alamaa",
      "name": "Ants Aare Alamaa",
      "created_at": "2025-04-10T12:56:41.777Z",
      "updated_at": "2025-04-10T12:56:41.777Z",
      "cooked": "<p>I found a temporary solution:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let styled-func = [#set text(fill: red)].func()\n#let context-func = [#context{}].func()\n</code></pre>\n<p>and then just compare with the respective variables. Don’t know how performant it’s going to be in a bigger project though</p>",
      "raw": "I found a temporary solution:\n```typst\n#let styled-func = [#set text(fill: red)].func()\n#let context-func = [#context{}].func()\n```\nand then just compare with the respective variables. Don't know how performant it's going to be in a bigger project though",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 26,
      "score": 5.2,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 1028
    },
    {
      "id": 11156,
      "post_number": 5,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T13:34:26.184Z",
      "updated_at": "2025-04-16T13:37:47.720Z",
      "cooked": "<p>Usually when you want to do this, you are overcomplicating something. It is rare when you need this, only if you are parsing some user document for your package that work on raw content. So you shouldn’t work with all this unless you are sure that there is no other choice, which depending on your experience, can require another person to know for sure.</p>\n<p>There are <code>content</code> functions and basic types, for types you would use <code>type()</code> and for <code>content</code> you would use <code>.func()</code>. Some content functions are not public because you are not supposed to use them. These are <code>styled</code>, <code>context</code> and <code>sequence</code>:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let styled = text(red)[].func()\n#let context-func = (context { }).func()\n#let sequence = [].func()\n</code></pre>\n<hr>\n<p>Also, please use an appropriate language identifier for the code block. If you want to write in code mode, use <code>typc</code>, in math — use <code>typm</code>.</p>",
      "raw": "Usually when you want to do this, you are overcomplicating something. It is rare when you need this, only if you are parsing some user document for your package that work on raw content. So you shouldn't work with all this unless you are sure that there is no other choice, which depending on your experience, can require another person to know for sure.\n\nThere are `content` functions and basic types, for types you would use `type()` and for `content` you would use `.func()`. Some content functions are not public because you are not supposed to use them. These are `styled`, `context` and `sequence`:\n\n```typ\n#let styled = text(red)[].func()\n#let context-func = (context { }).func()\n#let sequence = [].func()\n```\n\n---\n\nAlso, please use an appropriate language identifier for the code block. If you want to write in code mode, use `typc`, in math --- use `typm`.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 21,
      "score": 29.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11219,
      "post_number": 6,
      "username": "Ants_Aare_Alamaa",
      "name": "Ants Aare Alamaa",
      "created_at": "2025-04-17T09:48:16.227Z",
      "updated_at": "2025-04-18T21:15:38.135Z",
      "cooked": "<p>yes, I’m making a package that parses raw content. I managed to do it exactly the way you suggested and have these three as utility variables, and it works well so far.</p>\n<p>I’ve ran into a new issue though, apparently it’s not possible to change the body of content manually, and you can’t simply reconstruct it (for example like this: my-content.with(body:my-body)) So what I’m doing right now is so incredibly hacky that it feels like I shouldn’t be doing it. basically I have a method that’s called reconstruct-content where you pass in a template and the new body, and depending on the func type it will call the func and pass in the fields like this:</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">if content.func() == highlight {\n    return template.func()(\n      body,\n      extent: template.at(\"extent\", default: 0pt),\n      fill: template.at(\"fill\", default: rgb(\"#fffd11a1\")),\n      radius: template.at(\"radius\", default: (:)),\n      stroke: template.at(\"stroke\", default: (:)),\n    )\n  } else if content.func() == ...{\n        ...\n } else if content.func() == ...{\n        ...\n }\n</code></pre>\n<p>this works reasonably well, but if I want to replace a nested content (for example <code>highlight(fill:blue)[#text(red)[test]]</code> here I’d like to replace “test”) I will need to do this recursively. show and set rules won’t easily work in my use case, I’ve tried it.</p>\n<p>All in all it feels like Typst doesn’t want to be used in the way I’m using it here</p>",
      "raw": "yes, I'm making a package that parses raw content. I managed to do it exactly the way you suggested and have these three as utility variables, and it works well so far.\n\nI've ran into a new issue though, apparently it's not possible to change the body of content manually, and you can't simply reconstruct it (for example like this: my-content.with(body:my-body)) So what I'm doing right now is so incredibly hacky that it feels like I shouldn't be doing it. basically I have a method that's called reconstruct-content where you pass in a template and the new body, and depending on the func type it will call the func and pass in the fields like this:\n```typc\nif content.func() == highlight {\n    return template.func()(\n      body,\n      extent: template.at(\"extent\", default: 0pt),\n      fill: template.at(\"fill\", default: rgb(\"#fffd11a1\")),\n      radius: template.at(\"radius\", default: (:)),\n      stroke: template.at(\"stroke\", default: (:)),\n    )\n  } else if content.func() == ...{\n        ...\n } else if content.func() == ...{\n        ...\n }\n```\nthis works reasonably well, but if I want to replace a nested content (for example `highlight(fill:blue)[#text(red)[test]]` here I'd like to replace \"test\") I will need to do this recursively. show and set rules won't easily work in my use case, I've tried it.\n\nAll in all it feels like Typst doesn't want to be used in the way I'm using it here",
      "reply_to_post_number": 5,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 19.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 1028
    },
    {
      "id": 11250,
      "post_number": 7,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-17T16:48:15.015Z",
      "updated_at": "2025-04-17T16:48:15.015Z",
      "cooked": "<p>For this code block, you need to use <code>typc</code> language identifier, not <code>typ</code> (same with <a href=\"https://forum.typst.app/t/compare-func-type-of-content/3596\">this one</a>, as <a href=\"https://forum.typst.app/t/compare-func-type-of-content/3596/5\">I’ve already said</a>). Also, when you use code in text, you should use single backticks, otherwise it’s hard to read it. Furthermore, <code>highlight(fill:blue)[text(red)[test]]</code> will output <code>text(red)[test]</code> in blue. See <a href=\"https://typst.app/docs/tutorial/formatting/#set-rules:~:text=Wait%2C%20shouldn't%20all%20arguments%20of,normal%20arguments%2C%20saving%20on%20punctuation%2e\">this</a>.</p>\n<p>What you are doing is parsing the whole Typst document inside Typst. This won’t work because styles and context do not have a public API to easily work with them and reconstruct them. You can’t do anything with <code>context</code>.</p>\n<p>You should create a new <a class=\"hashtag-cooked\" href=\"/c/questions/5\" data-type=\"category\" data-slug=\"questions\" data-id=\"5\"><span class=\"hashtag-icon-placeholder\"><svg class=\"fa d-icon d-icon-square-full svg-icon svg-node\"><use href=\"#square-full\"></use></svg></span><span>Questions</span></a> topic about what package you want to make. To painlessly (maybe) work with Typst AST, you better just make a Rust Wasm plugin, if you know Rust.</p>",
      "raw": "For this code block, you need to use `typc` language identifier, not `typ` (same with [this one](https://forum.typst.app/t/compare-func-type-of-content/3596?u=andrew), as [I've already said](https://forum.typst.app/t/compare-func-type-of-content/3596/5?u=andrew)). Also, when you use code in text, you should use single backticks, otherwise it's hard to read it. Furthermore, `highlight(fill:blue)[text(red)[test]]` will output `text(red)[test]` in blue. See [this](https://typst.app/docs/tutorial/formatting/#set-rules:~:text=Wait%2C%20shouldn't%20all%20arguments%20of,normal%20arguments%2C%20saving%20on%20punctuation%2e).\n\nWhat you are doing is parsing the whole Typst document inside Typst. This won't work because styles and context do not have a public API to easily work with them and reconstruct them. You can't do anything with `context`.\n\nYou should create a new #questions topic about what package you want to make. To painlessly (maybe) work with Typst AST, you better just make a Rust Wasm plugin, if you know Rust.",
      "reply_to_post_number": 6,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 9.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11311,
      "post_number": 8,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2025-04-18T21:01:12.718Z",
      "updated_at": "2025-04-18T21:01:12.718Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/ants_aare_alamaa\">@Ants_Aare_Alamaa</a>, I’ve formatted your code blocks as Andrew has described. I’d ask you to take make sure you format them correctly. I saw that you attempted it; note the difference between <code>typ</code> and <code>typc</code> for a code block’s language.</p>\n<hr>\n<aside class=\"quote no-group\" data-username=\"Ants_Aare_Alamaa\" data-post=\"6\" data-topic=\"3596\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/ants_aare_alamaa/48/2077_2.png\" class=\"avatar\"> Ants_Aare_Alamaa:</div>\n<blockquote>\n<p>apparently it’s not possible to change the body of content manually, and you can’t simply reconstruct it</p>\n</blockquote>\n</aside>\n<p>you may also be interested in this post:</p>\n<aside class=\"quote quote-modified\" data-post=\"2\" data-topic=\"1099\">\n  <div class=\"title\">\n    <div class=\"quote-controls\"></div>\n    <img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/sillyfreak/48/1483_2.png\" class=\"avatar\">\n    <a href=\"https://forum.typst.app/t/how-can-i-manipulate-content-values/1099/2\">How can I manipulate content values?</a> <a class=\"badge-category__wrapper \" href=\"/c/questions/5\"><span data-category-id=\"5\" style=\"--category-badge-color: #F7C000; --category-badge-text-color: #fdfdfd;\" data-drop-close=\"true\" class=\"badge-category \" title=\"Your questions about using Typst and the web app go in this category.\"><span class=\"badge-category__name\">Questions</span></span></a>\n  </div>\n  <blockquote>\n    Content is not really meant to be manipulated, usually the better way is to only create content from data that has already been processed in any way necessary. This is often the right advice for e.g. <a href=\"https://forum.typst.app/t/how-to-sum-column-values-in-a-table/937/2\">tables</a> – however, it is not really applicable to your use case because the data you have is fundamentally already formatted text. \nThe next best way, though, is not manipulating the full hierarchy of the content value you’re dealing with, but applying a rule. Your specific case can be handled by thi…\n  </blockquote>\n</aside>\n\n<p>Basically, you need the <a href=\"https://typst.app/docs/reference/foundations/content/#definitions-func\">function</a> and the <a href=\"https://typst.app/docs/reference/foundations/content/#definitions-fields\">fields</a> to reconstruct some content, but <code>fields()</code> gives you a dictionary, while the functions take some parameters positionally. That post demonstrates how to do it relatively conveniently.</p>",
      "raw": "Hi @Ants_Aare_Alamaa, I've formatted your code blocks as Andrew has described. I'd ask you to take make sure you format them correctly. I saw that you attempted it; note the difference between `typ` and `typc` for a code block's language.\n\n---\n\n[quote=\"Ants_Aare_Alamaa, post:6, topic:3596\"]\napparently it’s not possible to change the body of content manually, and you can’t simply reconstruct it\n[/quote]\n\nyou may also be interested in this post:\n\nhttps://forum.typst.app/t/how-can-i-manipulate-content-values/1099/2?u=sillyfreak\n\nBasically, you need the [function](https://typst.app/docs/reference/foundations/content/#definitions-func) and the [fields](https://typst.app/docs/reference/foundations/content/#definitions-fields) to reconstruct some content, but `fields()` gives you a dictionary, while the functions take some parameters positionally. That post demonstrates how to do it relatively conveniently.",
      "reply_to_post_number": 6,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 1,
      "reads": 21,
      "score": 29.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 11316,
      "post_number": 9,
      "username": "Ants_Aare_Alamaa",
      "name": "Ants Aare Alamaa",
      "created_at": "2025-04-18T21:29:26.058Z",
      "updated_at": "2025-04-18T21:29:26.058Z",
      "cooked": "<p>ah, sorry about the formatting issue, and I meant to add a “#” before the <code>text(red)</code>. I was trying to show that I had issues with nested content. And yeah I’m kind of trying to work with the AST inside the package, however smart that may be. I barely got it to work which made me hopeful that there’s an actual way to achieve this. I’ll rethink the current approach though.</p>",
      "raw": "ah, sorry about the formatting issue, and I meant to add a \"#\" before the `text(red)`. I was trying to show that I had issues with nested content. And yeah I'm kind of trying to work with the AST inside the package, however smart that may be. I barely got it to work which made me hopeful that there's an actual way to achieve this. I'll rethink the current approach though.",
      "reply_to_post_number": 7,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 20,
      "score": 4.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 1028
    }
  ],
  "scraped_at": "2025-06-10T09:49:25.327381"
}
{
  "topic_metadata": {
    "id": 3598,
    "title": "Is there an easy way to create edge between edges on fletcher?",
    "slug": "is-there-an-easy-way-to-create-edge-between-edges-on-fletcher",
    "posts_count": 2,
    "created_at": "2025-04-10T14:36:26.356Z",
    "last_posted_at": "2025-04-10T15:15:59.041Z",
    "views": 71,
    "like_count": 1,
    "reply_count": 0,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Jollywatt",
    "tags": [
      "packages",
      "fletcher"
    ],
    "category_id": 5,
    "participant_count": 2,
    "word_count": 162
  },
  "posts": [
    {
      "id": 10884,
      "post_number": 1,
      "username": "Kass",
      "name": "",
      "created_at": "2025-04-10T14:36:26.496Z",
      "updated_at": "2025-04-18T15:25:36.907Z",
      "cooked": "<p>I’ve checked the manual, and it seems the only way to create an edge between edges is by doing it manually.</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#diagram(spacing: 2cm, {\nlet (A, B) = ((0,0), (1,0))\nnode(A, $cal(A)$)\nnode(B, $cal(B)$)\nedge(A, B, $F$, \"-&gt;\", bend: +35deg)\nedge(A, B, $G$, \"-&gt;\", bend: -35deg)\nlet h = 0.2\nedge((.5,-h), (.5,+h), $alpha$, \"=&gt;\")\n})\n</code></pre>\n<p>Is there a way to get the coordinates of the midpoint of an edge? Or maybe a trick to pass an edge as an argument to another edge?</p>",
      "raw": "I've checked the manual, and it seems the only way to create an edge between edges is by doing it manually.\n```typst\n#diagram(spacing: 2cm, {\nlet (A, B) = ((0,0), (1,0))\nnode(A, $cal(A)$)\nnode(B, $cal(B)$)\nedge(A, B, $F$, \"->\", bend: +35deg)\nedge(A, B, $G$, \"->\", bend: -35deg)\nlet h = 0.2\nedge((.5,-h), (.5,+h), $alpha$, \"=>\")\n})\n```\nIs there a way to get the coordinates of the midpoint of an edge? Or maybe a trick to pass an edge as an argument to another edge?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 27,
      "score": 170.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1391
    },
    {
      "id": 10888,
      "post_number": 2,
      "username": "Jollywatt",
      "name": "Joseph Wilson",
      "created_at": "2025-04-10T15:15:59.041Z",
      "updated_at": "2025-04-10T15:16:13.285Z",
      "cooked": "<p>Currently not, sadly. However, now that fletcher has support for cetz anchors, this could be easily added by allowing edges to be named and giving them path anchors, like in cetz:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#cetz.canvas({\n\timport cetz.draw\n\tdraw.line((0,0), (1,2), (3,1), stroke: 1pt, name: \"hi\")\n\tdraw.content(\"hi.75%\", $ circle $)\n})\n</code></pre>\n<p>I’ve just made a feature request for it: <a href=\"https://github.com/Jollywatt/typst-fletcher/issues/96\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Edge names and anchors · Issue #96 · Jollywatt/typst-fletcher · GitHub</a></p>",
      "raw": "Currently not, sadly. However, now that fletcher has support for cetz anchors, this could be easily added by allowing edges to be named and giving them path anchors, like in cetz:\n```typ\n#cetz.canvas({\n\timport cetz.draw\n\tdraw.line((0,0), (1,2), (3,1), stroke: 1pt, name: \"hi\")\n\tdraw.content(\"hi.75%\", $ circle $)\n})\n``` \nI've just made a feature request for it: https://github.com/Jollywatt/typst-fletcher/issues/96",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 24,
      "score": 19.6,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 713
    }
  ],
  "scraped_at": "2025-06-10T09:49:24.586864"
}
{
  "topic_metadata": {
    "id": 3605,
    "title": "How can I use different bullet list markers for items in a single a list?",
    "slug": "how-can-i-use-different-bullet-list-markers-for-items-in-a-single-a-list",
    "posts_count": 8,
    "created_at": "2025-04-10T17:27:26.782Z",
    "last_posted_at": "2025-04-16T14:22:56.989Z",
    "views": 113,
    "like_count": 1,
    "reply_count": 4,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 4,
    "accepted_answer_username": "bluss",
    "tags": [
      "scripting",
      "lists"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 575
  },
  "posts": [
    {
      "id": 10897,
      "post_number": 1,
      "username": "chair",
      "name": "",
      "created_at": "2025-04-10T17:27:26.937Z",
      "updated_at": "2025-04-18T16:26:24.861Z",
      "cooked": "<p>When I write proofs to some theorems, I use</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set list(marker: [$subset.eq$:])\n- Proof that $A subset.eq B$\n#set list(marker: [$supset.eq$:])\n- Proof that $A supset.eq B$\n</code></pre>\n<p>I wonder if I can do the same using one list or function .</p>",
      "raw": "When I write proofs to some theorems, I use\n```typ \n#set list(marker: [$subset.eq$:])\n- Proof that $A subset.eq B$\n#set list(marker: [$supset.eq$:])\n- Proof that $A supset.eq B$\n```\nI wonder if I can do the same using one list or function .",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 235.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1442
    },
    {
      "id": 10903,
      "post_number": 2,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-10T17:57:09.635Z",
      "updated_at": "2025-04-10T17:57:09.635Z",
      "cooked": "<p>You can try this syntax and see if you like it:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#list(marker: $subset.eq: $)[Proof of 1]\n#list(marker: $supset.eq: $)[Proof of 2]\n</code></pre>\n<p>There is the term list/definition list syntax, maybe that fits, which doesn’t show a colon by default but can have one like this. It could also have its style changed.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">/ $subset.eq$\\:: Proof of 1\n/ $supset.eq$\\:: Proof of 2\n</code></pre>",
      "raw": "You can try this syntax and see if you like it:\n\n```typ\n#list(marker: $subset.eq: $)[Proof of 1]\n#list(marker: $supset.eq: $)[Proof of 2]\n```\n\nThere is the term list/definition list syntax, maybe that fits, which doesn't show a colon by default but can have one like this. It could also have its style changed.\n\n```typ\n/ $subset.eq$\\:: Proof of 1\n/ $supset.eq$\\:: Proof of 2\n```",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 24,
      "score": 9.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 10905,
      "post_number": 3,
      "username": "chair",
      "name": "",
      "created_at": "2025-04-10T18:04:10.006Z",
      "updated_at": "2025-04-10T18:04:28.984Z",
      "cooked": "<p>Thank you for your reply. These are good ways, but I meant something like this</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let CoolFunction={ there is something }\n\n#CoolFunction\n- Proof of 1\n- Proof of 2\n</code></pre>",
      "raw": "Thank you for your reply. These are good ways, but I meant something like this\n```typ \n#let CoolFunction={ there is something }\n\n#CoolFunction\n- Proof of 1\n- Proof of 2\n```",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 5.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1442
    },
    {
      "id": 10906,
      "post_number": 4,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-10T18:09:49.034Z",
      "updated_at": "2025-04-10T18:19:28.110Z",
      "cooked": "<p>A function cannot use “set” and have it take effect outside itself, but we can get close to the required contract like this.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let CoolFunction(it) = {\n  // This function will fail with list items other than 1 and 2..\n  let symbols = (\"1\": $subset.eq$, \"2\": $supset.eq$)\n  set enum(numbering: x =&gt; symbols.at(str(x)) + \":\")\n  it\n}\n\n#show: CoolFunction\n+ Proof of 1\n+ Proof of 2\n</code></pre>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// alternative calling mode which only affects one numbered list\n#CoolFunction[\n+ Proof of 1\n+ Proof of 2\n]\n</code></pre>\n<p>Note that the function must get access to the list itself to be able to change it. With a show rule, or passed as an explicit parameter.</p>\n<p>If you want to do this with <code>list</code> instead of <code>enum</code> I think it’s possible but more complicated, you’ll have to reimplement a little bit of list layout and item placement to change the marker per item, which just seems unnecessary.</p>",
      "raw": "A function cannot use \"set\" and have it take effect outside itself, but we can get close to the required contract like this.\n\n```typ\n#let CoolFunction(it) = {\n  // This function will fail with list items other than 1 and 2..\n  let symbols = (\"1\": $subset.eq$, \"2\": $supset.eq$)\n  set enum(numbering: x => symbols.at(str(x)) + \":\")\n  it\n}\n\n#show: CoolFunction\n+ Proof of 1\n+ Proof of 2\n```\n\n```typ\n// alternative calling mode which only affects one numbered list\n#CoolFunction[\n+ Proof of 1\n+ Proof of 2\n]\n```\n\nNote that the function must get access to the list itself to be able to change it. With a show rule, or passed as an explicit parameter.\n\nIf you want to do this with `list` instead of `enum` I think it's possible but more complicated, you'll have to reimplement a little bit of list layout and item placement to change the marker per item, which just seems unnecessary.",
      "reply_to_post_number": null,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 1,
      "reads": 25,
      "score": 55.0,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 10911,
      "post_number": 5,
      "username": "chair",
      "name": "",
      "created_at": "2025-04-10T18:23:15.056Z",
      "updated_at": "2025-04-10T18:23:15.056Z",
      "cooked": "<p>Thanks a lot. I actually forgot about the power of numbered lists</p>",
      "raw": "Thanks a lot. I actually forgot about the power of numbered lists",
      "reply_to_post_number": 4,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 5.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1442
    },
    {
      "id": 10912,
      "post_number": 6,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-10T18:23:22.332Z",
      "updated_at": "2025-04-10T18:23:22.332Z",
      "cooked": "<p>See also <a href=\"https://forum.typst.app/t/how-can-i-set-the-marker-per-item-in-a-bullet-point-list/2271\" class=\"inline-onebox\">How can I set the marker per item in a bullet point list?</a>  which seems cool, and they do reimplement placing markers for the default list. But it doesn’t hit your use case even if it can solve it, I think.</p>",
      "raw": "See also https://forum.typst.app/t/how-can-i-set-the-marker-per-item-in-a-bullet-point-list/2271  which seems cool, and they do reimplement placing markers for the default list. But it doesn't hit your use case even if it can solve it, I think.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 5.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11160,
      "post_number": 7,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T13:58:08.126Z",
      "updated_at": "2025-04-16T14:07:02.963Z",
      "cooked": "<p>Assuming lists are unique, using it as a global show rule will result in undesired behavior.</p>\n<p>Also, you don’t have to create a dictionary if you use index, just use array instead:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let custom-list-markers(body) = {\n  // This function will fail with list items other than 1 and 2.\n  let symbols = ($subset.eq$, $supset.eq$)\n  set enum(numbering: n =&gt; symbols.at(n - 1) + \":\")\n  body\n}\n\n#custom-list-markers[\n  + Proof of 1\n  + Proof of 2\n]\n</code></pre>\n<p>There is however a quirk that Typst support negative index access for arrays, but I don’t think anyone has negative numbered list in their documents.</p>\n<p>To make it customizable and not error on long lists:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let custom-list-markers(body, markers: ($subset.eq:$, $supset.eq:$)) = {\n  set enum(numbering: n =&gt; markers.at(calc.rem-euclid(n - 1, markers.len())))\n  body\n}\n\n#custom-list-markers[\n  + Proof of 1\n  + Proof of 2\n  + Proof of 3\n  + Proof of 4\n]\n\n#custom-list-markers(markers: ([•], [‣], [–]))[\n  + Proof of 1\n  + Proof of 2\n  + Proof of 3\n  + Proof of 4\n]\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/9/9faa5e2d265985ea48c372adf262737b5106f6b6.png\" alt=\"image\" data-base62-sha1=\"mMsVCcB8qztrM9LoyxcwB81NpLE\" width=\"142\" height=\"254\"></p>",
      "raw": "Assuming lists are unique, using it as a global show rule will result in undesired behavior.\n\nAlso, you don't have to create a dictionary if you use index, just use array instead:\n\n```typ\n#let custom-list-markers(body) = {\n  // This function will fail with list items other than 1 and 2.\n  let symbols = ($subset.eq$, $supset.eq$)\n  set enum(numbering: n => symbols.at(n - 1) + \":\")\n  body\n}\n\n#custom-list-markers[\n  + Proof of 1\n  + Proof of 2\n]\n```\n\nThere is however a quirk that Typst support negative index access for arrays, but I don't think anyone has negative numbered list in their documents.\n\nTo make it customizable and not error on long lists:\n\n```typ\n#let custom-list-markers(body, markers: ($subset.eq:$, $supset.eq:$)) = {\n  set enum(numbering: n => markers.at(calc.rem-euclid(n - 1, markers.len())))\n  body\n}\n\n#custom-list-markers[\n  + Proof of 1\n  + Proof of 2\n  + Proof of 3\n  + Proof of 4\n]\n\n#custom-list-markers(markers: ([•], [‣], [–]))[\n  + Proof of 1\n  + Proof of 2\n  + Proof of 3\n  + Proof of 4\n]\n```\n\n![image|142x254](upload://mMsVCcB8qztrM9LoyxcwB81NpLE.png)",
      "reply_to_post_number": 4,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 17,
      "score": 23.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11162,
      "post_number": 8,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-16T14:22:56.989Z",
      "updated_at": "2025-04-16T14:22:56.989Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Andrew\" data-post=\"7\" data-topic=\"3605\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/andrew/48/62_2.png\" class=\"avatar\"> Andrew:</div>\n<blockquote>\n<p>Assuming lists are unique, using it as a global show rule will result in undesired behavior.</p>\n</blockquote>\n</aside>\n<p>I contributed a solution or a part of a solution, and then the each person will know how to best apply it in their context.</p>",
      "raw": "[quote=\"Andrew, post:7, topic:3605\"]\nAssuming lists are unique, using it as a global show rule will result in undesired behavior.\n[/quote]\n\nI contributed a solution or a part of a solution, and then the each person will know how to best apply it in their context.",
      "reply_to_post_number": 7,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 0,
      "reads": 15,
      "score": 3.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    }
  ],
  "scraped_at": "2025-06-10T09:49:23.866712"
}
{
  "topic_metadata": {
    "id": 3612,
    "title": "What is the best way to embed custom data in content?",
    "slug": "what-is-the-best-way-to-embed-custom-data-in-content",
    "posts_count": 3,
    "created_at": "2025-04-11T01:43:13.813Z",
    "last_posted_at": "2025-04-11T21:20:58.522Z",
    "views": 53,
    "like_count": 1,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "bluss",
    "tags": [
      "scripting",
      "metadata"
    ],
    "category_id": 5,
    "participant_count": 2,
    "word_count": 278
  },
  "posts": [
    {
      "id": 10921,
      "post_number": 1,
      "username": "Bolt",
      "name": "",
      "created_at": "2025-04-11T01:43:13.970Z",
      "updated_at": "2025-04-11T01:43:13.970Z",
      "cooked": "<p>I’m rewriting my syntax-tree package, with syntax that looks like this (whitespace insensitive):</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#tree[\n[*Head*\n  [Child \n    [Leaf]\n  ]\n  [_Italicized Child_]\n]\n]\n</code></pre>\n<p>But for each node, I’d like the user to be able to provide custom data and styling. Currently I have a very hacky aproach that looks like this.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#tree[\n[*Head* %(align: left)%\n  [Child \n    [Leaf %(name: \"leaf-node\")%]\n  ]\n  [_Italicized Child_]\n]\n]\n</code></pre>\n<p>This is ugly to parse (<code>%</code> is an arbitrary delimiter for now, and that part can be made nicer). But more importantly it uses <code>eval</code> to get at the data. I’d like to avoid that if possible, since it’s a last resort and relies on content-to-string parsing which might be brittle. I considered something like <code>#node(name: \"leaf-node\")[Leaf]</code>, but at the end of the day that function needs to return content, and I could not find a way to embed data into content.</p>\n<p>Is there a way to embed data into content, or a different way to go about this? Crucially without compromising the ability to use the simple <code>[node]</code> syntax when styling is not needed.</p>",
      "raw": "I'm rewriting my syntax-tree package, with syntax that looks like this (whitespace insensitive):\n```typ\n#tree[\n[*Head*\n  [Child \n    [Leaf]\n  ]\n  [_Italicized Child_]\n]\n]\n```\nBut for each node, I'd like the user to be able to provide custom data and styling. Currently I have a very hacky aproach that looks like this.\n```typ\n#tree[\n[*Head* %(align: left)%\n  [Child \n    [Leaf %(name: \"leaf-node\")%]\n  ]\n  [_Italicized Child_]\n]\n]\n```\nThis is ugly to parse (`%` is an arbitrary delimiter for now, and that part can be made nicer). But more importantly it uses `eval` to get at the data. I'd like to avoid that if possible, since it's a last resort and relies on content-to-string parsing which might be brittle. I considered something like `#node(name: \"leaf-node\")[Leaf]`, but at the end of the day that function needs to return content, and I could not find a way to embed data into content.\n\nIs there a way to embed data into content, or a different way to go about this? Crucially without compromising the ability to use the simple `[node]` syntax when styling is not needed.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 29.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 737
    },
    {
      "id": 10929,
      "post_number": 2,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-11T09:57:50.444Z",
      "updated_at": "2025-04-11T09:57:50.444Z",
      "cooked": "<p>Look at metadata, it embeds values in content, sounds like it fits the use case.</p>\n<p>Possibly it’s even more fluent with a wrapper like this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let attr(..args) = metadata(args.named())\n#[My node #attr(align: left)]\n</code></pre>\n<p>but more idiomatic for typst would probably be to use just a function</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#node(align: left)[My node]\n</code></pre>",
      "raw": "Look at metadata, it embeds values in content, sounds like it fits the use case.\n\nPossibly it's even more fluent with a wrapper like this:\n\n```typ\n#let attr(..args) = metadata(args.named())\n#[My node #attr(align: left)]\n```\n\nbut more idiomatic for typst would probably be to use just a function\n\n```typ\n#node(align: left)[My node]\n```",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 20,
      "score": 24.0,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 10950,
      "post_number": 3,
      "username": "Bolt",
      "name": "",
      "created_at": "2025-04-11T21:20:58.522Z",
      "updated_at": "2025-04-11T21:20:58.522Z",
      "cooked": "<p>Thank you a ton! I don’t know how I managed to attach the tag of the same name to this post without searching it in the documentation. Yes, this is exactly what I was looking for.</p>",
      "raw": "Thank you a ton! I don't know how I managed to attach the tag of the same name to this post without searching it in the documentation. Yes, this is exactly what I was looking for.",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 15,
      "score": 3.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 737
    }
  ],
  "scraped_at": "2025-06-10T09:49:23.146474"
}
{
  "topic_metadata": {
    "id": 3620,
    "title": "How to change page supplement in bibliography?",
    "slug": "how-to-change-page-supplement-in-bibliography",
    "posts_count": 4,
    "created_at": "2025-04-11T13:01:39.056Z",
    "last_posted_at": "2025-04-18T16:36:58.873Z",
    "views": 76,
    "like_count": 2,
    "reply_count": 0,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "xkevio",
    "tags": [],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 629
  },
  "posts": [
    {
      "id": 10936,
      "post_number": 1,
      "username": "nyekitka",
      "name": "",
      "created_at": "2025-04-11T13:01:39.335Z",
      "updated_at": "2025-04-12T17:46:52.768Z",
      "cooked": "<p>I use bibliography with <code>\"gost-r-705-2008-numeric\"</code> style. The only problem is that every citation uses “P.” symbol for pages instead of russian “с.”. How to change it?</p>\n<pre><code class=\"lang-auto\">#bibliography(\n  \"biblio.bib\",\n  title: \"Источники литературы\",\n  full: true,\n  style: \"gost-r-705-2008-numeric\"\n)\n</code></pre>\n<p>Citation:</p>\n<pre><code class=\"lang-auto\">@book{sevastyanov,\n  title = \"Курс теории вероятностей и математической статистики\",\n  author = \"Б.А. Севастьянов\",\n  pages = \"272\",\n  publisher = \"Институт компьютерных исследований\",\n  year = \"2019\"\n}\n</code></pre>\n<p>Result:</p>\n<blockquote>\n<p>Севастьянов Б. Курс теории вероятностей и математической<br>\nстатистики. Институт компьютерных исследований, 2019. P. 272.</p>\n</blockquote>\n<p>Wanted (at least):</p>\n<blockquote>\n<p>Севастьянов Б. Курс теории вероятностей и математической<br>\nстатистики. Институт компьютерных исследований, 2019. с. 272.</p>\n</blockquote>\n<p>In general, <code>\"gost-r-705-2008-numeric\"</code> poorly represents the real gost style and I want it to be like:</p>\n<blockquote>\n<p><em>Курс теории вероятностей и математической статистики</em> / Севастьянов Б. // Институт компьютерных исследований – 2019. – с. 272.</p>\n</blockquote>",
      "raw": "I use bibliography with `\"gost-r-705-2008-numeric\"` style. The only problem is that every citation uses \"P.\" symbol for pages instead of russian \"с.\". How to change it?\n\n```\n#bibliography(\n  \"biblio.bib\",\n  title: \"Источники литературы\",\n  full: true,\n  style: \"gost-r-705-2008-numeric\"\n)\n```\nCitation:\n```\n@book{sevastyanov,\n  title = \"Курс теории вероятностей и математической статистики\",\n  author = \"Б.А. Севастьянов\",\n  pages = \"272\",\n  publisher = \"Институт компьютерных исследований\",\n  year = \"2019\"\n}\n```\nResult:\n> Севастьянов Б. Курс теории вероятностей и математической\n> статистики. Институт компьютерных исследований, 2019. P. 272.\n\nWanted (at least):\n> Севастьянов Б. Курс теории вероятностей и математической\n> статистики. Институт компьютерных исследований, 2019. с. 272.\n\nIn general, `\"gost-r-705-2008-numeric\"` poorly represents the real gost style and I want it to be like:\n> *Курс теории вероятностей и математической статистики* / Севастьянов Б. // Институт компьютерных исследований -- 2019. -- с. 272.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 23,
      "score": 99.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1186
    },
    {
      "id": 10937,
      "post_number": 2,
      "username": "xkevio",
      "name": "Kevio",
      "created_at": "2025-04-11T13:29:48.932Z",
      "updated_at": "2025-04-11T13:29:48.932Z",
      "cooked": "<p>The bibliography styles work through something called CSL (Citation Style Language) and they can adapt to your document language. However, you do have to set your text language first in Typst with <code>#set text(lang: \"ru\")</code>. This also enables correct hyphenation and, if possible, spell check. As for customizing the citation style, maybe <a class=\"mention\" href=\"/u/andrew\">@Andrew</a> knows more.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set text(lang: \"ru\")\n\n#bibliography(\n  bytes(\n    ```\n    @book{sevastyanov,\n      title = \"Курс теории вероятностей и математической статистики\",\n      author = \"Б.А. Севастьянов\",\n      pages = \"272\",\n      publisher = \"Институт компьютерных исследований\",\n      year = \"2019\"\n    }\n    ```.text\n  ),\n  title: \"Источники литературы\",\n  full: true,\n  style: \"gost-r-705-2008-numeric\"\n)\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/5/5614e970277a02c9d78836c0445b21cffd454aa9.png\" data-download-href=\"https://forum.typst.app/uploads/default/5614e970277a02c9d78836c0445b21cffd454aa9\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/5/5614e970277a02c9d78836c0445b21cffd454aa9_2_690x118.png\" alt=\"image\" data-base62-sha1=\"chvRGCXpsi9l6Tr87DQWKzo9Z9L\" width=\"690\" height=\"118\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/5/5614e970277a02c9d78836c0445b21cffd454aa9_2_690x118.png, https://forum.typst.app/uploads/default/optimized/2X/5/5614e970277a02c9d78836c0445b21cffd454aa9_2_1035x177.png 1.5x, https://forum.typst.app/uploads/default/original/2X/5/5614e970277a02c9d78836c0445b21cffd454aa9.png 2x\" data-dominant-color=\"F1F1F1\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">1082×186 44.3 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "The bibliography styles work through something called CSL (Citation Style Language) and they can adapt to your document language. However, you do have to set your text language first in Typst with `#set text(lang: \"ru\")`. This also enables correct hyphenation and, if possible, spell check. As for customizing the citation style, maybe @Andrew knows more.\n\n```typ\n#set text(lang: \"ru\")\n\n#bibliography(\n  bytes(\n    ```\n    @book{sevastyanov,\n      title = \"Курс теории вероятностей и математической статистики\",\n      author = \"Б.А. Севастьянов\",\n      pages = \"272\",\n      publisher = \"Институт компьютерных исследований\",\n      year = \"2019\"\n    }\n    ```.text\n  ),\n  title: \"Источники литературы\",\n  full: true,\n  style: \"gost-r-705-2008-numeric\"\n)\n```\n\n![image|690x118](upload://chvRGCXpsi9l6Tr87DQWKzo9Z9L.png)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 21,
      "score": 34.2,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 21
    },
    {
      "id": 11168,
      "post_number": 3,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T15:21:30.616Z",
      "updated_at": "2025-04-16T15:25:31.058Z",
      "cooked": "<p>To change the supplement to the Russian variant, you do have to change the document language to Russian. If you want to change it in some other way, then you have to create your own CSL style.</p>\n<aside class=\"quote no-group quote-modified\" data-username=\"nyekitka\" data-post=\"1\" data-topic=\"3620\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/n/220F66/48.png\" class=\"avatar\"> nyekitka:</div>\n<blockquote>\n<p>In general, <code>\"gost-r-705-2008-numeric\"</code> poorly represents the real gost style and I want it to be like:</p>\n<blockquote>\n<p><em>Курс теории вероятностей и математической статистики</em> / Севастьянов Б. // Институт компьютерных исследований – 2019. – с. 272.</p>\n</blockquote>\n</blockquote>\n</aside>\n<p>In general, GOST is poorly documented, and not just GOST R 7.0.5—2008. So poorly that it’s just impossible to make a perfect CSL style (most likely). It just lists a bunch of examples and describes a few general things here and there, but doesn’t actually go over the exact syntax for each use case. I saw so many “GOST” bibliographies and even in themselves there are discrepancies. It’s all just said and unbearable to work with. Which is why I gave up on total correctness, and some/many people (who check this stuff) don’t care about perfect formatting either, so maybe you don’t have to worry about this as much.</p>\n<p>So in my case, I hand-roll CSL style when I see that the output doesn’t match what it should be. Here is an example from the standard:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/3/39b6a953abac63c1de4b1962dd9127c3dc7b2b10.png\" data-download-href=\"https://forum.typst.app/uploads/default/39b6a953abac63c1de4b1962dd9127c3dc7b2b10\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/original/2X/3/39b6a953abac63c1de4b1962dd9127c3dc7b2b10.png\" alt=\"image\" data-base62-sha1=\"8eyz6cPlwUOAyFxYpmcziUt16hi\" width=\"690\" height=\"71\" data-dominant-color=\"1D1D1D\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">808×84 7.03 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>As you can see, yours and its formatting for the same parts do not match. Also, there is a slightly up-to-date version in the official CSL repo: <a href=\"https://github.com/citation-style-language/styles\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">GitHub - citation-style-language/styles: Official repository for Citation Style Language (CSL) citation styles.</a>.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/0/002b280ee86e122dc5dedd70ca932caadcb0d5d4.png\" data-download-href=\"https://forum.typst.app/uploads/default/002b280ee86e122dc5dedd70ca932caadcb0d5d4\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/original/2X/0/002b280ee86e122dc5dedd70ca932caadcb0d5d4.png\" alt=\"image\" data-base62-sha1=\"1usFbmDbUFkmRy46PNo8jsH6vO\" width=\"690\" height=\"113\" data-dominant-color=\"0E0E0E\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">749×123 9.96 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>One thing I know is that journal name starts with <code>//</code>:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/c/cd687ef5a2c4a54c4adf407953afcef86399f47d.png\" data-download-href=\"https://forum.typst.app/uploads/default/cd687ef5a2c4a54c4adf407953afcef86399f47d\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/c/cd687ef5a2c4a54c4adf407953afcef86399f47d_2_690x134.png\" alt=\"image\" data-base62-sha1=\"tj7LiMIADyn3MIuuB3m6lEdFrKB\" width=\"690\" height=\"134\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/c/cd687ef5a2c4a54c4adf407953afcef86399f47d_2_690x134.png, https://forum.typst.app/uploads/default/original/2X/c/cd687ef5a2c4a54c4adf407953afcef86399f47d.png 1.5x, https://forum.typst.app/uploads/default/original/2X/c/cd687ef5a2c4a54c4adf407953afcef86399f47d.png 2x\" data-dominant-color=\"181818\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">929×181 25.6 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>But there are still too many variables that play a role in how text should be formatted.</p>\n<p>This is why people just format stuff manually (that is probably because no one knows how to format automatically in the first place, or the tool doesn’t support it).</p>\n<p>So, good luck making your own style. You can open an issue in that repository about formatting for this standard, if you want.</p>",
      "raw": "To change the supplement to the Russian variant, you do have to change the document language to Russian. If you want to change it in some other way, then you have to create your own CSL style.\n\n[quote=\"nyekitka, post:1, topic:3620\"]\nIn general, `\"gost-r-705-2008-numeric\"` poorly represents the real gost style and I want it to be like:\n\n> *Курс теории вероятностей и математической статистики* / Севастьянов Б. // Институт компьютерных исследований – 2019. – с. 272.\n[/quote]\n\n\nIn general, GOST is poorly documented, and not just GOST R 7.0.5—2008. So poorly that it's just impossible to make a perfect CSL style (most likely). It just lists a bunch of examples and describes a few general things here and there, but doesn't actually go over the exact syntax for each use case. I saw so many \"GOST\" bibliographies and even in themselves there are discrepancies. It's all just said and unbearable to work with. Which is why I gave up on total correctness, and some/many people (who check this stuff) don't care about perfect formatting either, so maybe you don't have to worry about this as much.\n\nSo in my case, I hand-roll CSL style when I see that the output doesn't match what it should be. Here is an example from the standard:\n\n![image|690x71](upload://8eyz6cPlwUOAyFxYpmcziUt16hi.png)\n\nAs you can see, yours and its formatting for the same parts do not match. Also, there is a slightly up-to-date version in the official CSL repo: https://github.com/citation-style-language/styles.\n\n![image|690x113](upload://1usFbmDbUFkmRy46PNo8jsH6vO.png)\n\nOne thing I know is that journal name starts with ` // `:\n\n![image|690x134](upload://tj7LiMIADyn3MIuuB3m6lEdFrKB.png)\n\nBut there are still too many variables that play a role in how text should be formatted.\n\nThis is why people just format stuff manually (that is probably because no one knows how to format automatically in the first place, or the tool doesn't support it).\n\nSo, good luck making your own style. You can open an issue in that repository about formatting for this standard, if you want.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 0,
      "reads": 17,
      "score": 43.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11293,
      "post_number": 4,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2025-04-18T16:36:58.873Z",
      "updated_at": "2025-04-18T16:36:58.873Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/nyekitka\">@nyekitka</a>, don’t forget to tick <img src=\"https://forum.typst.app/images/emoji/apple/ballot_box_with_check.png?v=12\" title=\":ballot_box_with_check:\" class=\"emoji\" alt=\":ballot_box_with_check:\" loading=\"lazy\" width=\"20\" height=\"20\"> one of the responses if you got a satisfying answer. The answer you choose should usually be the response that you found most correct/helpful/comprehensive for the question you asked. Thanks!</p>",
      "raw": "Hi @nyekitka, don’t forget to tick :ballot_box_with_check: one of the responses if you got a satisfying answer. The answer you choose should usually be the response that you found most correct/helpful/comprehensive for the question you asked. Thanks!",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 17,
      "score": 3.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    }
  ],
  "scraped_at": "2025-06-10T09:49:22.417475"
}
{
  "topic_metadata": {
    "id": 3626,
    "title": "Why does incollection write the booktitle twice in the bibliography using the APA style?",
    "slug": "why-does-incollection-write-the-booktitle-twice-in-the-bibliography-using-the-apa-style",
    "posts_count": 4,
    "created_at": "2025-04-12T16:38:57.498Z",
    "last_posted_at": "2025-04-16T15:46:55.952Z",
    "views": 52,
    "like_count": 1,
    "reply_count": 2,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Eric",
    "tags": [
      "bibtex"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 420
  },
  "posts": [
    {
      "id": 10964,
      "post_number": 1,
      "username": "Racso",
      "name": "Racso",
      "created_at": "2025-04-12T16:38:57.664Z",
      "updated_at": "2025-04-12T17:52:40.220Z",
      "cooked": "<p>I’ve tried several citation styles but this is the only one with the problem. This is the bib file:</p>\n<pre data-code-wrap=\"tex\"><code class=\"lang-tex\">@incollection{silva18,\n  author={Silva, Fabio Laurindo and Pinho, Luiz Carlos and Wiedenbrug, Sofia},\n  title     = {Chironomidae},\n  booktitle = {Freshwater Invertebrates},\n  editor    = {Neusa Hamada and James H. Thorp},\n  pages     = {661--700},\n  year      = {2018},\n  publisher = {Academic Press},\n}\n</code></pre>\n<p>And this is the minimal working example on typst:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">cita @silva18. \n\n#bibliography(\"refs.bib\", style: \"apa\")\n</code></pre>\n<p>The output file produces double booktitle (Freshwater Invertebrates):</p>\n<p>cita (Silva et al., 2018).<br>\nBibliography<br>\nSilva, F. L., Pinho, L. C., &amp; Wiedenbrug, S. (2018). Chironomidae. In N. Hamada &amp; J. H. Thorp (Eds.), Freshwater Invertebrates: Freshwater Invertebrates (pp. 661–700). Academic Press.</p>\n<p>Would you recomend to download another CSL file for APA style? maybe I can use APA6 instead of 7 or something like that to fix this problem</p>",
      "raw": "I've tried several citation styles but this is the only one with the problem. This is the bib file:\n```tex\n@incollection{silva18,\n  author={Silva, Fabio Laurindo and Pinho, Luiz Carlos and Wiedenbrug, Sofia},\n  title     = {Chironomidae},\n  booktitle = {Freshwater Invertebrates},\n  editor    = {Neusa Hamada and James H. Thorp},\n  pages     = {661--700},\n  year      = {2018},\n  publisher = {Academic Press},\n}\n```\n\nAnd this is the minimal working example on typst:\n\n```typ\ncita @silva18. \n\n#bibliography(\"refs.bib\", style: \"apa\")\n```\nThe output file produces double booktitle (Freshwater Invertebrates):\n\ncita (Silva et al., 2018).\n Bibliography\n Silva, F. L., Pinho, L. C., & Wiedenbrug, S. (2018). Chironomidae. In N. Hamada & J. H. Thorp (Eds.), Freshwater Invertebrates: Freshwater Invertebrates (pp. 661–700). Academic Press.\n\n\nWould you recomend to download another CSL file for APA style? maybe I can use APA6 instead of 7 or something like that to fix this problem",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 20,
      "score": 34.0,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 833
    },
    {
      "id": 10968,
      "post_number": 2,
      "username": "Eric",
      "name": "Eric Biedert",
      "created_at": "2025-04-12T18:41:06.271Z",
      "updated_at": "2025-04-12T18:41:06.271Z",
      "cooked": "<p>The simplest fix would be to change <code>@incollection</code> to <code>@inbook</code>.</p>\n<p><strong>Some context as to what’s happening here:</strong><br>\nWhen using the <code>@incollection</code> type, Typst converts it to a hayagriva entry of type <code>anthos</code> with a parent of type <code>anthology</code>, but when using the <code>@inbook</code> type, Typst converts to it an entry of type <code>chapter</code> with a parent of type <code>book</code> <em>(read more about hayagriva types <a href=\"https://github.com/typst/hayagriva/blob/main/docs/file-format.md#entry-type\" rel=\"noopener nofollow ugc\">here</a></em>).</p>\n<p>The APA CSL style defines that the title of a “book-like container” should be displayed as</p>\n<blockquote>\n<p><code>{container-title}: {volume-title}</code></p>\n</blockquote>\n<p>where Typst substitutes the corresponding values. The <code>container-title</code> variable is in both cases correctly set to the book or collection’s title. However, for the anthos-in-anthology case, the <code>volume-title</code> variable is <a href=\"https://github.com/typst/hayagriva/blob/0b32dca41966f267cbd4efbfe42fbf8da3e5e7a3/src/csl/taxonomy.rs#L371\" rel=\"noopener nofollow ugc\">also set to that value</a>, while for the chapter-in-book case, it is left empty.</p>\n<p>Now, I’m not well versed in the terminology of anthology, book, volume, and so on, so I can’t tell whether the conversions are working as intended or if there is something that can be improved.</p>",
      "raw": "The simplest fix would be to change `@incollection` to `@inbook`.\n\n**Some context as to what's happening here:**\nWhen using the `@incollection` type, Typst converts it to a hayagriva entry of type `anthos` with a parent of type `anthology`, but when using the `@inbook` type, Typst converts to it an entry of type `chapter` with a parent of type `book` _(read more about hayagriva types [here](https://github.com/typst/hayagriva/blob/main/docs/file-format.md#entry-type)_).\n\nThe APA CSL style defines that the title of a \"book-like container\" should be displayed as\n> `{container-title}: {volume-title}`\n\nwhere Typst substitutes the corresponding values. The `container-title` variable is in both cases correctly set to the book or collection's title. However, for the anthos-in-anthology case, the `volume-title` variable is [also set to that value](https://github.com/typst/hayagriva/blob/0b32dca41966f267cbd4efbfe42fbf8da3e5e7a3/src/csl/taxonomy.rs#L371), while for the chapter-in-book case, it is left empty.\n\nNow, I'm not well versed in the terminology of anthology, book, volume, and so on, so I can't tell whether the conversions are working as intended or if there is something that can be improved.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 19,
      "score": 58.8,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 88
    },
    {
      "id": 10983,
      "post_number": 3,
      "username": "Racso",
      "name": "Racso",
      "created_at": "2025-04-13T12:57:08.583Z",
      "updated_at": "2025-04-13T12:57:08.583Z",
      "cooked": "<p>thank you! it works just fine.<br>\nCan I add Container Title and volume title through bibtex?  This book from the example happens to have a title for the Volume as well. But is is not necessary.</p>",
      "raw": "thank you! it works just fine. \nCan I add Container Title and volume title through bibtex?  This book from the example happens to have a title for the Volume as well. But is is not necessary.",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 19,
      "score": 8.8,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 833
    },
    {
      "id": 11172,
      "post_number": 4,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T15:46:55.952Z",
      "updated_at": "2025-04-16T15:47:47.950Z",
      "cooked": "<p>You should ask this in <a href=\"https://github.com/typst/hayagriva\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">GitHub - typst/hayagriva: Rusty bibliography management.</a>, since this is what Typst uses. For BibLaTeX that project uses <a href=\"https://github.com/typst/citationberg\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">GitHub - typst/citationberg: A library for parsing CSL styles.</a>.</p>\n<p>Also, all up-to-date CSL styles can be found at <a href=\"https://github.com/citation-style-language/styles\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">GitHub - citation-style-language/styles: Official repository for Citation Style Language (CSL) citation styles.</a>.</p>",
      "raw": "You should ask this in https://github.com/typst/hayagriva, since this is what Typst uses. For BibLaTeX that project uses https://github.com/typst/citationberg.\n\nAlso, all up-to-date CSL styles can be found at https://github.com/citation-style-language/styles.",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 14,
      "score": 2.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:49:21.706598"
}
{
  "topic_metadata": {
    "id": 3628,
    "title": "How to create colored pills that span multiple lines? (multiline boxes)",
    "slug": "how-to-create-colored-pills-that-span-multiple-lines-multiline-boxes",
    "posts_count": 16,
    "created_at": "2025-04-12T20:55:05.160Z",
    "last_posted_at": "2025-05-01T10:14:20.003Z",
    "views": 290,
    "like_count": 18,
    "reply_count": 8,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 5,
    "accepted_answer_username": "Mc-Zen",
    "tags": [
      "layout",
      "layout-containers"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 1030
  },
  "posts": [
    {
      "id": 10974,
      "post_number": 1,
      "username": "adriano",
      "name": "Adriano Fantini",
      "created_at": "2025-04-12T20:55:05.417Z",
      "updated_at": "2025-04-13T07:39:26.671Z",
      "cooked": "<p>I want to create bi-colored pills like those used by e.g. gitlab <a href=\"https://docs.gitlab.com/user/project/labels/#scoped-labels\" rel=\"noopener nofollow ugc\">scoped labels</a>.</p>\n<p>This can be done in the following way (heavily based on <a href=\"https://typst.app/universe/package/tidy/\">tidy</a> implementation) from <a class=\"mention\" href=\"/u/mc-zen\">@Mc-Zen</a> : <a href=\"https://typst.app/project/rl81JICnSUJPIhDv5Pe3Hf\" class=\"inline-onebox\">Typst</a></p>\n<p>However, as shown in the document, such pills do not like to be very long, and they mess up line breaks if they are.</p>\n<p>Basically, I need a way to split a horizontal <code>box</code> over multiple lines.<br>\nI tried to find a simple solution that would not require complex context calculations, but I failed.<br>\nAny idea?</p>",
      "raw": "I want to create bi-colored pills like those used by e.g. gitlab [scoped labels](https://docs.gitlab.com/user/project/labels/#scoped-labels).\n\nThis can be done in the following way (heavily based on [tidy](https://typst.app/universe/package/tidy/) implementation) from @Mc-Zen : https://typst.app/project/rl81JICnSUJPIhDv5Pe3Hf\n\nHowever, as shown in the document, such pills do not like to be very long, and they mess up line breaks if they are.\n\nBasically, I need a way to split a horizontal `box` over multiple lines.\nI tried to find a simple solution that would not require complex context calculations, but I failed.\nAny idea?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 60,
      "score": 142.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 669
    },
    {
      "id": 11059,
      "post_number": 2,
      "username": "Mc-Zen",
      "name": "Mc-Zen",
      "created_at": "2025-04-14T08:00:02.986Z",
      "updated_at": "2025-04-14T08:00:02.986Z",
      "cooked": "<p>Maybe you could achieve what you want with <code>highlight</code>. A nice solution would be</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let pill(a, b, fill: red) = {\n  highlight(\n    fill: fill, \n    stroke: fill, \n    radius: (left: 100pt),\n    text(white, [~#a~])\n  )\n  highlight(\n    fill: white, \n    stroke: fill, \n    radius: (right: 100%),\n    text(fill, [~#b~])\n  )\n}\n</code></pre>\n<p>Unfortunately, after a linebreak, the rounded corners are repeated<br>\n<img src=\"https://forum.typst.app/uploads/default/original/2X/f/fbf028cb1f1b147f8a0031eb3c296536e161c3d0.png\" alt=\"image\" data-base62-sha1=\"zWKnOxxm1BDup25gHRV9N8xBLyM\" width=\"360\" height=\"178\"></p>\n<p>At least it’s already much better than using boxes. You could trick around a bit by adding the rounded beginning (and also end but here I did only the beginning) separately:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let pill(a, b, fill: red) = {\n  highlight(\n    fill: fill, \n    stroke: fill, \n    radius: (left: 100pt),\n    [~~~~~]\n  )\n  h(-.7em)\n  highlight(\n    fill: fill, \n    stroke: fill, \n    text(white, [#a~])\n  )\n  highlight(\n    fill: white, \n    stroke: fill, \n    radius: (right: 100%),\n    text(fill, [~#b~])\n  )\n}\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/4/462edd9033967cce3d27f7eca0e80a7e2467c51c.png\" alt=\"image\" data-base62-sha1=\"a0RPzikxYE8roFxmFjdjs3thhms\" width=\"345\" height=\"148\"><br>\nThis is something you might be able to tune until it looks good.</p>",
      "raw": "Maybe you could achieve what you want with `highlight`. A nice solution would be \n```typ\n#let pill(a, b, fill: red) = {\n  highlight(\n    fill: fill, \n    stroke: fill, \n    radius: (left: 100pt),\n    text(white, [~#a~])\n  )\n  highlight(\n    fill: white, \n    stroke: fill, \n    radius: (right: 100%),\n    text(fill, [~#b~])\n  )\n}\n```\nUnfortunately, after a linebreak, the rounded corners are repeated\n![image|360x178](upload://zWKnOxxm1BDup25gHRV9N8xBLyM.png)\n\nAt least it's already much better than using boxes. You could trick around a bit by adding the rounded beginning (and also end but here I did only the beginning) separately:\n```typ\n#let pill(a, b, fill: red) = {\n  highlight(\n    fill: fill, \n    stroke: fill, \n    radius: (left: 100pt),\n    [~~~~~]\n  )\n  h(-.7em)\n  highlight(\n    fill: fill, \n    stroke: fill, \n    text(white, [#a~])\n  )\n  highlight(\n    fill: white, \n    stroke: fill, \n    radius: (right: 100%),\n    text(fill, [~#b~])\n  )\n}\n```\n![image|345x148](upload://a0RPzikxYE8roFxmFjdjs3thhms.png)\nThis is something you might be able to tune until it looks good.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 4,
      "reads": 56,
      "score": 76.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 9
    },
    {
      "id": 11082,
      "post_number": 3,
      "username": "adriano",
      "name": "Adriano Fantini",
      "created_at": "2025-04-14T20:07:20.439Z",
      "updated_at": "2025-04-14T20:07:20.439Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Mc-Zen\" data-post=\"2\" data-topic=\"3628\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/mc-zen/48/234_2.png\" class=\"avatar\"> Mc-Zen:</div>\n<blockquote>\n<pre><code class=\"lang-auto\">#let pill(a, b, fill: red) = {\n  highlight(\n    fill: fill, \n    stroke: fill, \n    radius: (left: 100pt),\n    [~~~~~]\n  )\n  h(-.7em)\n  highlight(\n    fill: fill, \n    stroke: fill, \n    text(white, [#a~])\n  )\n  highlight(\n    fill: white, \n    stroke: fill, \n    radius: (right: 100%),\n    text(fill, [~#b~])\n  )\n}\n</code></pre>\n</blockquote>\n</aside>\n<p>Thanks for that!<br>\nHowever it still breaks if it’s the rightmost part to go to a new line:<br>\n<img src=\"https://forum.typst.app/uploads/default/original/2X/0/0838f41997732360bb540c516c3981d62d7c9c4b.png\" alt=\"image\" data-base62-sha1=\"1aJQd3RyraKgzsIBfiS8iMscDQT\" width=\"347\" height=\"136\"></p>\n<p>But I’ll surely find some more time to play around it and see if I can find a possible solution based on <code>highlight</code> instead of <code>box</code></p>",
      "raw": "[quote=\"Mc-Zen, post:2, topic:3628\"]\n```\n#let pill(a, b, fill: red) = {\n  highlight(\n    fill: fill, \n    stroke: fill, \n    radius: (left: 100pt),\n    [~~~~~]\n  )\n  h(-.7em)\n  highlight(\n    fill: fill, \n    stroke: fill, \n    text(white, [#a~])\n  )\n  highlight(\n    fill: white, \n    stroke: fill, \n    radius: (right: 100%),\n    text(fill, [~#b~])\n  )\n}\n```\n[/quote]\n\nThanks for that!\nHowever it still breaks if it's the rightmost part to go to a new line:\n![image|347x136](upload://1aJQd3RyraKgzsIBfiS8iMscDQT.png)\n\nBut I'll surely find some more time to play around it and see if I can find a possible solution based on `highlight` instead of `box`",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 0,
      "reads": 50,
      "score": 15.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 669
    },
    {
      "id": 11084,
      "post_number": 4,
      "username": "Mc-Zen",
      "name": "Mc-Zen",
      "created_at": "2025-04-14T20:54:05.191Z",
      "updated_at": "2025-04-14T20:54:05.191Z",
      "cooked": "<p>I know, I was just giving the idea based on the left part but you can do the same with the right one, I think.</p>",
      "raw": "I know, I was just giving the idea based on the left part but you can do the same with the right one, I think.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 46,
      "score": 9.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 9
    },
    {
      "id": 11092,
      "post_number": 5,
      "username": "Mc-Zen",
      "name": "Mc-Zen",
      "created_at": "2025-04-14T22:13:30.045Z",
      "updated_at": "2025-04-14T22:13:30.045Z",
      "cooked": "<p>Note that <code>highlight.stroke</code> accepts a dictionary which you can use like this</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let pill(a, b, fill: red) = {\n  highlight(\n    fill: fill, \n    stroke: fill, \n    radius: (left: 100%),\n    [~~~~~]\n  )\n  h(-.7em)\n  highlight(\n    fill: fill, \n    stroke: fill, \n    text(white, [#a~])\n  )\n  highlight(\n    fill: none, \n    stroke: (y: fill), \n    text(fill, [~#b])\n  )\n  h(-.7em)\n  highlight(\n    fill: none, \n    stroke: (y: fill, right: fill), \n    radius: (right: 100%),\n    text(fill, [~~~~~])\n  )\n}\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/d/d0e4e3d3a6f4b57af8955df36ffa69541cd6dad3.png\" alt=\"image\" data-base62-sha1=\"tNXHUJ93fDJQrCMJP8TBy7s2I9B\" width=\"548\" height=\"229\"></p>\n<p>Still not perfect maybe but betterer.</p>",
      "raw": "Note that `highlight.stroke` accepts a dictionary which you can use like this\n```typ\n#let pill(a, b, fill: red) = {\n  highlight(\n    fill: fill, \n    stroke: fill, \n    radius: (left: 100%),\n    [~~~~~]\n  )\n  h(-.7em)\n  highlight(\n    fill: fill, \n    stroke: fill, \n    text(white, [#a~])\n  )\n  highlight(\n    fill: none, \n    stroke: (y: fill), \n    text(fill, [~#b])\n  )\n  h(-.7em)\n  highlight(\n    fill: none, \n    stroke: (y: fill, right: fill), \n    radius: (right: 100%),\n    text(fill, [~~~~~])\n  )\n}\n```\n\n![image|548x229](upload://tNXHUJ93fDJQrCMJP8TBy7s2I9B.png)\n\nStill not perfect maybe but betterer.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 5,
      "reads": 47,
      "score": 94.4,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 9
    },
    {
      "id": 11129,
      "post_number": 6,
      "username": "adriano",
      "name": "Adriano Fantini",
      "created_at": "2025-04-15T19:07:22.111Z",
      "updated_at": "2025-04-15T19:07:22.111Z",
      "cooked": "<p>Getting there!</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let pill(a, b, fill: gray, radius: 100%) = {\n  highlight(\n    fill: fill, \n    stroke: fill, \n    radius: (left: radius),\n    [~~~~~#sym.zws]\n  )\n  h(-.7em)\n  highlight(\n    fill: fill, \n    stroke: fill, \n    text(white, hyphenate: true, [#a~#sym.zws])\n  )\n  highlight(\n    fill: none, \n    stroke: (y: fill), \n    text(hyphenate: true)[#sym.zws~#b]\n  )\n  h(-.7em)\n  highlight(\n    fill: none, \n    stroke: (y: fill, right: fill), \n    radius: (right: radius),\n    text(fill, [~~~~~])\n  )\n}\n\n#box(width: 9em)[\n  #pill(\"definitely good even when\")[it goes to new line!]\n]\n\n#box(width: 9em)[\n  #pill(\"first\")[line!]\\\n  #pill(\"second\")[line! All good!]\n  \n  #pill(\"thirddddddddddddd\")[line! All good!]\n  #pill(\"fourth\")[line! Less good!]\n]\n</code></pre>\n<p>I had to also add a few <code>sym.zws</code> to force it to go to new lines and not mess it up trying to connect different highlights.</p>\n<p>It produces:<br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/5/5ee64bf90151af91bb881b9f7af5a401b5c0d138.png\" data-download-href=\"https://forum.typst.app/uploads/default/5ee64bf90151af91bb881b9f7af5a401b5c0d138\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/5/5ee64bf90151af91bb881b9f7af5a401b5c0d138_2_371x500.png\" alt=\"image\" data-base62-sha1=\"dxwi1JgkWGzJO03zjqP8P48rt7G\" width=\"371\" height=\"500\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/5/5ee64bf90151af91bb881b9f7af5a401b5c0d138_2_371x500.png, https://forum.typst.app/uploads/default/original/2X/5/5ee64bf90151af91bb881b9f7af5a401b5c0d138.png 1.5x, https://forum.typst.app/uploads/default/original/2X/5/5ee64bf90151af91bb881b9f7af5a401b5c0d138.png 2x\" data-dominant-color=\"E3E3E3\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">484×652 57.9 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>As you can see the last <code>pill</code> is not great, but it is <em>almost</em> there. Any brilliant idea on that one?</p>",
      "raw": "Getting there!\n```typst\n#let pill(a, b, fill: gray, radius: 100%) = {\n  highlight(\n    fill: fill, \n    stroke: fill, \n    radius: (left: radius),\n    [~~~~~#sym.zws]\n  )\n  h(-.7em)\n  highlight(\n    fill: fill, \n    stroke: fill, \n    text(white, hyphenate: true, [#a~#sym.zws])\n  )\n  highlight(\n    fill: none, \n    stroke: (y: fill), \n    text(hyphenate: true)[#sym.zws~#b]\n  )\n  h(-.7em)\n  highlight(\n    fill: none, \n    stroke: (y: fill, right: fill), \n    radius: (right: radius),\n    text(fill, [~~~~~])\n  )\n}\n\n#box(width: 9em)[\n  #pill(\"definitely good even when\")[it goes to new line!]\n]\n\n#box(width: 9em)[\n  #pill(\"first\")[line!]\\\n  #pill(\"second\")[line! All good!]\n  \n  #pill(\"thirddddddddddddd\")[line! All good!]\n  #pill(\"fourth\")[line! Less good!]\n]\n```\nI had to also add a few `sym.zws` to force it to go to new lines and not mess it up trying to connect different highlights.\n\nIt produces:\n![image|371x500](upload://dxwi1JgkWGzJO03zjqP8P48rt7G.png)\n\nAs you can see the last `pill` is not great, but it is *almost* there. Any brilliant idea on that one?",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 45,
      "score": 14.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 669
    },
    {
      "id": 11130,
      "post_number": 7,
      "username": "flokl",
      "name": "",
      "created_at": "2025-04-15T19:28:38.948Z",
      "updated_at": "2025-04-15T19:28:38.948Z",
      "cooked": "<p>For the last one you could add a word joiner <code>sym.wj</code> between the <code>h</code> and the last <code>highlight</code> to force the last word to stick to the rounded ending.</p>",
      "raw": "For the last one you could add a word joiner `sym.wj` between the `h` and the last `highlight` to force the last word to stick to the rounded ending.",
      "reply_to_post_number": 6,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 3,
      "reads": 40,
      "score": 63.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 8
    },
    {
      "id": 11135,
      "post_number": 8,
      "username": "adriano",
      "name": "Adriano Fantini",
      "created_at": "2025-04-15T21:08:29.132Z",
      "updated_at": "2025-04-15T21:08:29.132Z",
      "cooked": "<p>Indeed that works well!</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let pill(a, b, fill: gray, radius: 100%) = {\n  highlight(\n    fill: fill, \n    stroke: fill, \n    radius: (left: radius),\n    [#sym.zws~~~~~#sym.wj]\n  )\n  h(-.7em)\n  highlight(\n    fill: fill, \n    stroke: fill, \n    text(white, hyphenate: true, [#sym.wj#a~#sym.zws])\n  )\n  highlight(\n    fill: none, \n    stroke: (y: fill), \n    text(hyphenate: true)[#sym.zws~#b#sym.wj]\n  )\n  h(-.7em)\n  highlight(\n    fill: none, \n    stroke: (y: fill, right: fill), \n    radius: (right: radius),\n    text(fill, [#sym.wj~~~~~#sym.zws])\n  )\n}\n\n#box(width: 9em)[\n  #pill(\"definitely good even when\")[it goes to new line!]\n]\n\n#box(width: 9em)[\n  #pill(\"first\")[line!]\\\n  #pill(\"second\")[line! All good!]\n  \n  #pill(\"thirddddddddddddd\")[line! All good!]\n  #pill(\"fourth\")[line! Also good!]\n  #pill(\"fifthhhhhhhhhhhhhhh\")[line! Indeed also good!]\n]\n</code></pre>\n<p>Results in:<br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/7/778eebe9290b6c45721391da55132247b12ec87a.png\" data-download-href=\"https://forum.typst.app/uploads/default/778eebe9290b6c45721391da55132247b12ec87a\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/7/778eebe9290b6c45721391da55132247b12ec87a_2_281x500.png\" alt=\"image\" data-base62-sha1=\"h3F1FyY8kOXXhJqfPvbow8p8kZk\" width=\"281\" height=\"500\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/7/778eebe9290b6c45721391da55132247b12ec87a_2_281x500.png, https://forum.typst.app/uploads/default/optimized/2X/7/778eebe9290b6c45721391da55132247b12ec87a_2_421x750.png 1.5x, https://forum.typst.app/uploads/default/original/2X/7/778eebe9290b6c45721391da55132247b12ec87a.png 2x\" data-dominant-color=\"DDDDDD\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">431×766 73.8 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>To me this is <em>almost</em> perfect!</p>",
      "raw": "Indeed that works well!\n\n```typst\n#let pill(a, b, fill: gray, radius: 100%) = {\n  highlight(\n    fill: fill, \n    stroke: fill, \n    radius: (left: radius),\n    [#sym.zws~~~~~#sym.wj]\n  )\n  h(-.7em)\n  highlight(\n    fill: fill, \n    stroke: fill, \n    text(white, hyphenate: true, [#sym.wj#a~#sym.zws])\n  )\n  highlight(\n    fill: none, \n    stroke: (y: fill), \n    text(hyphenate: true)[#sym.zws~#b#sym.wj]\n  )\n  h(-.7em)\n  highlight(\n    fill: none, \n    stroke: (y: fill, right: fill), \n    radius: (right: radius),\n    text(fill, [#sym.wj~~~~~#sym.zws])\n  )\n}\n\n#box(width: 9em)[\n  #pill(\"definitely good even when\")[it goes to new line!]\n]\n\n#box(width: 9em)[\n  #pill(\"first\")[line!]\\\n  #pill(\"second\")[line! All good!]\n  \n  #pill(\"thirddddddddddddd\")[line! All good!]\n  #pill(\"fourth\")[line! Also good!]\n  #pill(\"fifthhhhhhhhhhhhhhh\")[line! Indeed also good!]\n]\n```\n\nResults in:\n![image|281x500](upload://h3F1FyY8kOXXhJqfPvbow8p8kZk.png)\n\nTo me this is *almost* perfect!",
      "reply_to_post_number": 7,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 3,
      "reads": 41,
      "score": 63.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 669
    },
    {
      "id": 11155,
      "post_number": 9,
      "username": "Mc-Zen",
      "name": "Mc-Zen",
      "created_at": "2025-04-16T12:40:46.238Z",
      "updated_at": "2025-04-16T12:40:46.238Z",
      "cooked": "<p>Good one! The word-joiner was what I was looking for but I didn’t find it because I had forgotten the name.</p>",
      "raw": "Good one! The word-joiner was what I was looking for but I didn't find it because I had forgotten the name.",
      "reply_to_post_number": 7,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 6.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 9
    },
    {
      "id": 11173,
      "post_number": 10,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T15:58:48.510Z",
      "updated_at": "2025-04-16T21:52:32.992Z",
      "cooked": "<p>This sounds related: <a href=\"https://github.com/typst/typst/issues/5624\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Add documentation about ways to customize breaking of words · Issue #5624 · typst/typst · GitHub</a>.</p>",
      "raw": "This sounds related: https://github.com/typst/typst/issues/5624.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 33,
      "score": 21.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11183,
      "post_number": 11,
      "username": "adriano",
      "name": "Adriano Fantini",
      "created_at": "2025-04-16T20:00:23.934Z",
      "updated_at": "2025-04-16T20:00:23.934Z",
      "cooked": "<p>I’m still playing around with this to improve the final look and make it more generic. I’ll post here when I have a final version.</p>\n<p>But, a question to the wise… this seems hackish at best.<br>\nIs there no other way to do this?<br>\nI mean, if someone were to write a package to do this, which route would one take?</p>",
      "raw": "I'm still playing around with this to improve the final look and make it more generic. I'll post here when I have a final version.\n\nBut, a question to the wise... this seems hackish at best.\nIs there no other way to do this?\nI mean, if someone were to write a package to do this, which route would one take?",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 33,
      "score": 11.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 669
    },
    {
      "id": 11195,
      "post_number": 12,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T21:51:49.432Z",
      "updated_at": "2025-04-17T15:22:47.762Z",
      "cooked": "<p>I don’t understand what is missing in <a href=\"https://forum.typst.app/t/how-to-create-colored-pills-that-span-multiple-lines-multiline-boxes/3628/8\" class=\"inline-onebox\">How to create colored pills that span multiple lines? (multiline boxes) - #8 by adriano</a>. Is it too complex? You can open a new <a class=\"hashtag-cooked\" href=\"/c/questions/5\" data-type=\"category\" data-slug=\"questions\" data-id=\"5\"><span class=\"hashtag-icon-placeholder\"><svg class=\"fa d-icon d-icon-square-full svg-icon svg-node\"><use href=\"#square-full\"></use></svg></span><span>Questions</span></a> topic for a different question.</p>\n<p>This also sounds something like <a href=\"https://github.com/typst/typst/issues/735\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Allow adding content / configuring breakpoints of broken blocks · Issue #735 · typst/typst · GitHub</a>, but horizontally.</p>",
      "raw": "I don't understand what is missing in https://forum.typst.app/t/how-to-create-colored-pills-that-span-multiple-lines-multiline-boxes/3628/8?u=andrew. Is it too complex? You can open a new #questions topic for a different question.\n\nThis also sounds something like https://github.com/typst/typst/issues/735, but horizontally.",
      "reply_to_post_number": 11,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 11.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11345,
      "post_number": 13,
      "username": "adriano",
      "name": "Adriano Fantini",
      "created_at": "2025-04-19T18:41:52.803Z",
      "updated_at": "2025-04-19T18:49:22.725Z",
      "cooked": "<p>It is… hackish.<br>\nIn fact if you start applying it it shows several limitations:</p>\n<ul>\n<li>different radiuses, fonts and font sizes require manual tuning of the spacing to look decent</li>\n<li>there are weird artifacts. Look at what happens if I use modified text for the left side of a pill:</li>\n</ul>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/1/129cdfa80340c2bb312ea0ac8d5a61cd8d734241.png\" alt=\"image\" data-base62-sha1=\"2EEH4xnymfX45CpVAAv8mox8u1X\" width=\"374\" height=\"301\"></p>\n<p>Even modifying the highlight’s edges did not seem to fix this.</p>",
      "raw": "It is... hackish.\nIn fact if you start applying it it shows several limitations:\n- different radiuses, fonts and font sizes require manual tuning of the spacing to look decent\n- there are weird artifacts. Look at what happens if I use modified text for the left side of a pill:\n\n![image|374x301](upload://2EEH4xnymfX45CpVAAv8mox8u1X.png)\n\nEven modifying the highlight's edges did not seem to fix this.",
      "reply_to_post_number": 12,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 28,
      "score": 10.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 669
    },
    {
      "id": 11348,
      "post_number": 14,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-19T20:32:44.640Z",
      "updated_at": "2025-04-19T20:32:44.640Z",
      "cooked": "<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#pill[text текст テキスト][next]\n\n#highlight(stroke: 1pt)[text текст テキスト]\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/7/700147f541e59a2b206bfeeafd194528721732b6.png\" alt=\"image\" data-base62-sha1=\"fYQdJ4Uen3aJsD15LY40MwxpX26\" width=\"324\" height=\"110\"></p>\n<p>Looks like</p>\n<aside class=\"onebox githubissue\" data-onebox-src=\"https://github.com/typst/typst/issues/5324\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/typst/typst/issues/5324\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com/typst/typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"github-row\">\n  <div class=\"github-icon-container\" title=\"Issue\" data-github-private-repo=\"false\">\n\t  <svg width=\"60\" height=\"60\" class=\"github-icon\" viewBox=\"0 0 14 16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg>\n  </div>\n\n  <div class=\"github-info-container\">\n    <h4>\n      <a href=\"https://github.com/typst/typst/issues/5324\" target=\"_blank\" rel=\"noopener nofollow ugc\">`highlight.stroke` is split into parts if different scripts/languages are used</a>\n    </h4>\n\n    <div class=\"github-info\">\n      <div class=\"date\">\n        opened <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2024-10-30\" data-time=\"00:36:17\" data-timezone=\"UTC\">12:36AM - 30 Oct 24 UTC</span>\n      </div>\n\n\n      <div class=\"user\">\n        <a href=\"https://github.com/Andrew15-5\" target=\"_blank\" rel=\"noopener nofollow ugc\">\n          <img alt=\"Andrew15-5\" src=\"https://forum.typst.app/uploads/default/original/1X/8c66fc8b1c207ba90488266df18b206a61b1fc49.png\" class=\"onebox-avatar-inline\" width=\"20\" height=\"20\" data-dominant-color=\"707C3A\">\n          Andrew15-5\n        </a>\n      </div>\n    </div>\n\n    <div class=\"labels\">\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          bug\n        </span>\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          text\n        </span>\n    </div>\n  </div>\n</div>\n\n  <div class=\"github-row\">\n    <p class=\"github-body-container\">### Description\n\nI used the highlighting for some stuff, but when I thought of a<span class=\"show-more-container\"><a href=\"\" rel=\"noopener\" class=\"show-more\">…</a></span><span class=\"excerpt hidden\">dding a stroke, this happened:\n\n```typ\n#let hl = highlight.with(stroke: red)\n- #hl[package manager/some other text/here]\n- #hl[package manager/менеджер пакетов/包管理器]\n```\n\n![image](https://github.com/user-attachments/assets/5f4a050b-cb60-4f2d-baa3-05031b5e0ef0)\n\nI guess it's hard with glyphs which background fill is different in size, but for glyphs with the monotone background size I think it's definitely not the desired effect.\n\nInstead of 3 stroked boxes, there should be 1, or at least 2 instead.\n\n### Reproduction URL\n\n_No response_\n\n### Operating system\n\nLinux\n\n### Typst version\n\n- [X] I am using the latest version of Typst</span></p>\n  </div>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
      "raw": "```typ\n#pill[text текст テキスト][next]\n\n#highlight(stroke: 1pt)[text текст テキスト]\n```\n\n![image|433x147, 75%](upload://fYQdJ4Uen3aJsD15LY40MwxpX26.png)\n\nLooks like\n\nhttps://github.com/typst/typst/issues/5324",
      "reply_to_post_number": 13,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 28,
      "score": 25.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11359,
      "post_number": 15,
      "username": "adriano",
      "name": "Adriano Fantini",
      "created_at": "2025-04-20T08:27:33.921Z",
      "updated_at": "2025-04-20T08:27:49.044Z",
      "cooked": "<p>indeed, that’s probably what it is! Watching the issue, thanks!</p>",
      "raw": "indeed, that's probably what it is! Watching the issue, thanks!",
      "reply_to_post_number": 14,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 27,
      "score": 20.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 669
    },
    {
      "id": 11853,
      "post_number": 16,
      "username": "adriano",
      "name": "Adriano Fantini",
      "created_at": "2025-05-01T10:14:20.003Z",
      "updated_at": "2025-05-01T10:14:20.003Z",
      "cooked": "<p>Unfortunately I did not find any better way to do this in Typst, so I am still looking for an alternative <img src=\"https://forum.typst.app/images/emoji/apple/frowning.png?v=12\" title=\":frowning:\" class=\"emoji\" alt=\":frowning:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Unfortunately I did not find any better way to do this in Typst, so I am still looking for an alternative :frowning:",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 23,
      "score": 4.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 669
    }
  ],
  "scraped_at": "2025-06-10T09:49:16.927919"
}
{
  "topic_metadata": {
    "id": 3632,
    "title": "How to use function to automatically calculate in table?",
    "slug": "how-to-use-function-to-automatically-calculate-in-table",
    "posts_count": 4,
    "created_at": "2025-04-13T11:44:19.992Z",
    "last_posted_at": "2025-04-13T14:57:27.669Z",
    "views": 78,
    "like_count": 4,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "bluss",
    "tags": [
      "tables"
    ],
    "category_id": 5,
    "participant_count": 2,
    "word_count": 302
  },
  "posts": [
    {
      "id": 10980,
      "post_number": 1,
      "username": "Kasmir",
      "name": "Chen Chen",
      "created_at": "2025-04-13T11:44:20.163Z",
      "updated_at": "2025-04-13T11:45:00.357Z",
      "cooked": "<p>I want a command to automatically add the first and second columns, and put the result into the third column.</p>\n<p>Someting wrong as below:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let mytable(data) = table(\n  columns: 3,\n  stroke: 1pt black,\n  [X value], [Y value], [X+Y],\n  ..data.map((x, y) =&gt; [x, y, x + y])\n)\n\n#mytable((\n  (1, 2),\n  (3, 4),\n  (5, 6)\n))\n</code></pre>\n<p>Maybe I misunderstand the <code>map</code> or something else… How can I do? Thanks!</p>",
      "raw": "I want a command to automatically add the first and second columns, and put the result into the third column.\n\nSometing wrong as below:\n```typst\n#let mytable(data) = table(\n  columns: 3,\n  stroke: 1pt black,\n  [X value], [Y value], [X+Y],\n  ..data.map((x, y) => [x, y, x + y])\n)\n\n#mytable((\n  (1, 2),\n  (3, 4),\n  (5, 6)\n))\n```\n\nMaybe I misunderstand the `map` or something else.... How can I do? Thanks!",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 101.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1450
    },
    {
      "id": 10984,
      "post_number": 2,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-13T13:19:18.573Z",
      "updated_at": "2025-04-13T13:20:45.146Z",
      "cooked": "<p>Fixing the function calling syntax like this is the first step:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let mytable(data) = table(\n  columns: 3,\n  stroke: 1pt + black,\n  [X value], [Y value], [X+Y],\n  ..data.map(((x, y)) =&gt; [x, y, x + y])\n)\n</code></pre>\n<p>That makes</p>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/f/ffcbd375017144028ed52ce5e7bb7bc098f7b9b5.png\" alt=\"image\" data-base62-sha1=\"AuSrUqL3aM3gXPaSEFMroFwplQN\" width=\"288\" height=\"78\"></p>\n<p>Need to use <code>#x</code> to use a variable inside content, and also need to give one content value per table cell. The complete fix:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let mytable(data) = table(\n  columns: 3,\n  stroke: 1pt + black,\n  [X value], [Y value], [X+Y],\n  ..data.map(((x, y)) =&gt; ([#x], [#y], [#(x + y)])).flatten()\n)\n\n#mytable((\n  (1, 2),\n  (3, 4),\n  (5, 6),\n))\n</code></pre>\n<p>Every call to the <code>map(f)</code> function <code>f</code> creates one table row, but in the end the table wants all cells in a single array, so we <code>.flatten()</code> the result.</p>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/9/9c833ee80676d79b662d2ea2840d31f76a83b348.png\" alt=\"image\" data-base62-sha1=\"mkzG2tWsrrbIUip6NCa6CwHFD3a\" width=\"219\" height=\"140\"></p>",
      "raw": "Fixing the function calling syntax like this is the first step:\n\n```typ\n#let mytable(data) = table(\n  columns: 3,\n  stroke: 1pt + black,\n  [X value], [Y value], [X+Y],\n  ..data.map(((x, y)) => [x, y, x + y])\n)\n```\n\nThat makes\n\n![image|288x78](upload://AuSrUqL3aM3gXPaSEFMroFwplQN.png)\n\n\nNeed to use `#x` to use a variable inside content, and also need to give one content value per table cell. The complete fix:\n\n```typ\n#let mytable(data) = table(\n  columns: 3,\n  stroke: 1pt + black,\n  [X value], [Y value], [X+Y],\n  ..data.map(((x, y)) => ([#x], [#y], [#(x + y)])).flatten()\n)\n\n#mytable((\n  (1, 2),\n  (3, 4),\n  (5, 6),\n))\n```\n\nEvery call to the `map(f)` function `f` creates one table row, but in the end the table wants all cells in a single array, so we `.flatten()` the result.\n\n![image|219x140](upload://mkzG2tWsrrbIUip6NCa6CwHFD3a.png)",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 31,
      "score": 51.2,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 10987,
      "post_number": 3,
      "username": "Kasmir",
      "name": "Chen Chen",
      "created_at": "2025-04-13T14:33:50.144Z",
      "updated_at": "2025-04-13T14:33:50.144Z",
      "cooked": "<p>Thanks! But I am still a little currious about why there need two <code>((x,y))</code> here? the <strong>inner stand</strong> for the input <code>(1,2)</code>, and the <strong>outer one</strong> stand for the parameter of this anonymous function?</p>",
      "raw": "Thanks! But I am still a little currious about why there need two `((x,y))` here? the **inner stand** for the input `(1,2)`, and the **outer one** stand for the parameter of this anonymous function?",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 27,
      "score": 5.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1450
    },
    {
      "id": 10992,
      "post_number": 4,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-13T14:57:27.669Z",
      "updated_at": "2025-04-13T14:57:27.669Z",
      "cooked": "<p>Each element in the data array is itself an array <code>(1, 2)</code> and so on. I guess it’s like this</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">data.map( ( (x, y) ) =&gt; none)\n             \\_ Unpack first argument into two values.\n           \\_ The function arguments (of anonymous function)\n</code></pre>\n<p>Without the extra layer of <code>()</code> it would be ambiguous if the unnamed function takes 2 parameters or if it takes 1 and unpacks it.</p>",
      "raw": "Each element in the data array is itself an array `(1, 2)` and so on. I guess it's like this\n\n```typ\ndata.map( ( (x, y) ) => none)\n             \\_ Unpack first argument into two values.\n           \\_ The function arguments (of anonymous function)\n```\n\nWithout the extra layer of `()` it would be ambiguous if the unnamed function takes 2 parameters or if it takes 1 and unpacks it.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 28,
      "score": 35.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    }
  ],
  "scraped_at": "2025-06-10T09:49:15.416427"
}
{
  "topic_metadata": {
    "id": 3640,
    "title": "Is there an equivalent `\\input{file.tex}` command (from LaTeX) in Typst?",
    "slug": "is-there-an-equivalent-input-file-tex-command-from-latex-in-typst",
    "posts_count": 5,
    "created_at": "2025-04-14T02:41:38.090Z",
    "last_posted_at": "2025-04-14T22:12:28.472Z",
    "views": 126,
    "like_count": 2,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "quachpas",
    "tags": [
      "scripting"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 360
  },
  "posts": [
    {
      "id": 10998,
      "post_number": 1,
      "username": "ruiantunes",
      "name": "Rui Antunes",
      "created_at": "2025-04-14T02:41:38.184Z",
      "updated_at": "2025-04-14T02:41:38.184Z",
      "cooked": "<p>Consider the following two Typst files.</p>\n<p><strong>config.typ</strong>:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set page(paper: \"a4\")\nThis is the *config.typ* file.\n</code></pre>\n<p><strong>main.typ</strong>:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#include \"config.typ\"\nThis is the *main.typ* file.\n</code></pre>\n<p>I noticed that when previewing the <strong>main.typ</strong> file there’s a page break after the contents of the <strong>config.typ</strong> file. Why? How can this be avoided?</p>\n<p>This is likely not the best way to configure the layout of a document in Typst, however I still think an <code>#input(file.typ)</code> function could be helpful in some scenarios as also suggested in <a href=\"https://github.com/typst/typst/issues/754\" rel=\"noopener nofollow ugc\">this GitHub issue</a>.</p>\n<p>My objective with this functionality (if it exists) would be to split a very long <strong>main.typ</strong> file into several smaller Typst files so that the project could be “organized better”. Is that possible? Any help is appreciated!</p>",
      "raw": "Consider the following two Typst files.\n\n**config.typ**:\n```typ\n#set page(paper: \"a4\")\nThis is the *config.typ* file.\n```\n\n**main.typ**:\n```typ\n#include \"config.typ\"\nThis is the *main.typ* file.\n```\n\nI noticed that when previewing the **main.typ** file there's a page break after the contents of the **config.typ** file. Why? How can this be avoided?\n\nThis is likely not the best way to configure the layout of a document in Typst, however I still think an `#input(file.typ)` function could be helpful in some scenarios as also suggested in [this GitHub issue](https://github.com/typst/typst/issues/754).\n\nMy objective with this functionality (if it exists) would be to split a very long **main.typ** file into several smaller Typst files so that the project could be \"organized better\". Is that possible? Any help is appreciated!",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 34,
      "score": 191.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1454
    },
    {
      "id": 11053,
      "post_number": 2,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2025-04-14T06:49:27.872Z",
      "updated_at": "2025-04-14T06:49:27.872Z",
      "cooked": "<p>The correct function is <code>include</code>, but you are setting the <code>page</code> element.</p>\n<p>This behaviour is not very well documented, but you can read at the page setup guide</p>\n<blockquote>\n<p><a href=\"https://typst.app/docs/guides/page-setup-guide/#:~:text=If%20you%20make%20changes%20with%20this%20set%20rule%2C%20Typst%20will%20ensure%20that%20there%20is%20a%20new%20and%20conforming%20empty%20page%20afterward%2C%20so%20it%20may%20insert%20a%20page%20break\">If you make changes with this set rule, Typst will ensure that there is a new and conforming empty page afterward, so it may insert a page break</a>.</p>\n</blockquote>\n<p>A crucial difference to remember is that <code>include</code> evaluates the file and returns <strong><code>content</code></strong>, whereas <code>import</code> will return a <code>module</code> (from which you can select functions, etc.). See <a href=\"https://typst.app/docs/reference/scripting/#modules\" class=\"inline-onebox\">Scripting – Typst Documentation</a>.</p>",
      "raw": "The correct function is `include`, but you are setting the `page` element. \n\nThis behaviour is not very well documented, but you can read at the page setup guide\n\n> [If you make changes with this set rule, Typst will ensure that there is a new and conforming empty page afterward, so it may insert a page break](https://typst.app/docs/guides/page-setup-guide/#:~:text=If%20you%20make%20changes%20with%20this%20set%20rule%2C%20Typst%20will%20ensure%20that%20there%20is%20a%20new%20and%20conforming%20empty%20page%20afterward%2C%20so%20it%20may%20insert%20a%20page%20break).\n\nA crucial difference to remember is that `include` evaluates the file and returns **`content`**, whereas `import` will return a `module` (from which you can select functions, etc.). See https://typst.app/docs/reference/scripting/#modules.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 33,
      "score": 36.6,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 258
    },
    {
      "id": 11064,
      "post_number": 3,
      "username": "ruiantunes",
      "name": "Rui Antunes",
      "created_at": "2025-04-14T13:47:10.114Z",
      "updated_at": "2025-04-14T13:47:10.114Z",
      "cooked": "<p>Thank you for the explanation! Though I still find it a bit “confusing” that a page break is blindly inserted even though the page layout is already conforming.</p>",
      "raw": "Thank you for the explanation! Though I still find it a bit \"confusing\" that a page break is blindly inserted even though the page layout is already conforming.",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 29,
      "score": 5.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1454
    },
    {
      "id": 11075,
      "post_number": 4,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-14T17:19:15.959Z",
      "updated_at": "2025-04-14T17:19:15.959Z",
      "cooked": "<p>Are you maybe looking for how to make a template? Page setup could be part of a template, that you define in the template but import and apply in the document.</p>\n<p>See <a href=\"https://typst.app/docs/tutorial/making-a-template/\" class=\"inline-onebox\">Making a Template – Typst Documentation</a></p>",
      "raw": "Are you maybe looking for how to make a template? Page setup could be part of a template, that you define in the template but import and apply in the document.\n\nSee https://typst.app/docs/tutorial/making-a-template/",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 26,
      "score": 20.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11091,
      "post_number": 5,
      "username": "ruiantunes",
      "name": "Rui Antunes",
      "created_at": "2025-04-14T22:12:28.472Z",
      "updated_at": "2025-04-14T22:12:28.472Z",
      "cooked": "<p>Yes, thank you for the clarification! I’ll look into making a template and how to use the <code>#import</code> function.</p>",
      "raw": "Yes, thank you for the clarification! I'll look into making a template and how to use the `#import` function.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 23,
      "score": 4.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1454
    }
  ],
  "scraped_at": "2025-06-10T09:49:14.497977"
}
{
  "topic_metadata": {
    "id": 3642,
    "title": "How can I enumerate every element function in Typst?",
    "slug": "how-can-i-enumerate-every-element-function-in-typst",
    "posts_count": 3,
    "created_at": "2025-04-14T05:15:47.987Z",
    "last_posted_at": "2025-04-14T06:46:10.497Z",
    "views": 57,
    "like_count": 1,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "quachpas",
    "tags": [
      "scripting"
    ],
    "category_id": 5,
    "participant_count": 2,
    "word_count": 114
  },
  "posts": [
    {
      "id": 11026,
      "post_number": 1,
      "username": "OrthoPole",
      "name": "OrthoPole",
      "created_at": "2025-04-14T05:15:48.114Z",
      "updated_at": "2025-04-14T05:15:48.114Z",
      "cooked": "<p>I want to list all element functions in Typst.</p>\n<p>There seems to be no details about the full list.</p>\n<p>Can anyone give me such a list or help me find one?</p>",
      "raw": "I want to list all element functions in Typst.\n\nThere seems to be no details about the full list.\n\nCan anyone give me such a list or help me find one?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 26,
      "score": 135.0,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 889
    },
    {
      "id": 11051,
      "post_number": 2,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2025-04-14T06:43:26.776Z",
      "updated_at": "2025-04-14T06:43:58.899Z",
      "cooked": "<p>Hello,<br>\nI think give or take all “elements” are listed in files like <a href=\"https://github.com/typst/typst/blob/c21c1c391b48f843c8671993a28eaf1fe0d40b89/crates/typst-library/src/model/mod.rs\">mod.rs</a>. Technically speaking, you can search for occurences of <code>define_elem</code> <a href=\"https://github.com/search?q=repo%3Atypst%2Ftypst+define_elem%3A%3A&amp;type=code\">like so</a> to find all elements.</p>",
      "raw": "Hello,\nI think give or take all \"elements\" are listed in files like [mod.rs](https://github.com/typst/typst/blob/c21c1c391b48f843c8671993a28eaf1fe0d40b89/crates/typst-library/src/model/mod.rs). Technically speaking, you can search for occurences of `define_elem` [like so](https://github.com/search?q=repo%3Atypst%2Ftypst+define_elem%3A%3A&type=code) to find all elements.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 24,
      "score": 19.6,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 258
    },
    {
      "id": 11052,
      "post_number": 3,
      "username": "OrthoPole",
      "name": "OrthoPole",
      "created_at": "2025-04-14T06:46:10.497Z",
      "updated_at": "2025-04-14T06:46:10.497Z",
      "cooked": "<p>Thank you. I found a <code>NativeElement</code> trait in the source code. So elements are structs that implement that trait. There is 129 element functions in total.</p>",
      "raw": "Thank you. I found a `NativeElement` trait in the source code. So elements are structs that implement that trait. There is 129 element functions in total.",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 24,
      "score": 19.6,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 889
    }
  ],
  "scraped_at": "2025-06-10T09:49:13.786281"
}
{
  "topic_metadata": {
    "id": 3650,
    "title": "How to allow reusing of labels in different sections?",
    "slug": "how-to-allow-reusing-of-labels-in-different-sections",
    "posts_count": 8,
    "created_at": "2025-04-14T15:32:38.998Z",
    "last_posted_at": "2025-04-22T19:50:48.222Z",
    "views": 90,
    "like_count": 5,
    "reply_count": 5,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "bluss",
    "tags": [
      "scripting",
      "referencing"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 933
  },
  "posts": [
    {
      "id": 11069,
      "post_number": 1,
      "username": "Regodin",
      "name": "",
      "created_at": "2025-04-14T15:32:39.237Z",
      "updated_at": "2025-04-26T19:57:46.517Z",
      "cooked": "<p>I want to create a template that allows to reuse labels between sections, but having difficulty working with queries and not have them cause issues due to not being able to converge.</p>\n<p>The goal of my template is to have multiple sections with the same subsections, and be able to use label and references to jump between the subsections.</p>\n<p>For example:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">= Section 1\n== Sub 1&lt;sub1&gt;\n== Sub 2&lt;sub2&gt;\nGo to @sub1\n\n= Section 2\n== Sub 1&lt;sub1&gt;\nGo to @sub2\n== Sub 2&lt;sub2&gt;\n</code></pre>\n<p>Is there a way to limit reference or query scopes to within a single section?</p>",
      "raw": "I want to create a template that allows to reuse labels between sections, but having difficulty working with queries and not have them cause issues due to not being able to converge.\n\nThe goal of my template is to have multiple sections with the same subsections, and be able to use label and references to jump between the subsections.\n\nFor example:\n```typst\n= Section 1\n== Sub 1<sub1>\n== Sub 2<sub2>\nGo to @sub1\n\n= Section 2\n== Sub 1<sub1>\nGo to @sub2\n== Sub 2<sub2>\n```\n\nIs there a way to limit reference or query scopes to within a single section?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 31,
      "score": 71.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1161
    },
    {
      "id": 11070,
      "post_number": 2,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-14T15:47:56.694Z",
      "updated_at": "2025-04-14T15:47:56.694Z",
      "cooked": "<p>You can do it like this. In this case - find the top level headings and decide a “bounding box” - only look locally inside the current top level heading. Then place a custom link to that (not using ref)</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let maybelast(x) = {\n  if x.len() &gt; 0 { return x.last() }\n}\n#let maybefirst(x) = {\n  if x.len() &gt; 0 { return x.first() }\n}\n\n#let localref(lab) = context {\n  let mysections = query(heading.where(level: 1).before(here()))\n  let nextsections = query(heading.where(level: 1).after(here()))\n  let mysection = maybelast(mysections)\n  let nextsection = maybefirst(nextsections)\n  let sel = selector(lab)\n  if mysection != none {\n    sel = sel.after(mysection.location())\n  }\n  if nextsection != none {\n    sel = sel.before(nextsection.location())\n  }\n  let locations = query(sel)\n  for loc in locations {\n    link(loc.location())[Section #loc.body]\n    break\n  }\n}\n\n= Section 1\n== Sub 1&lt;sub1&gt;\n== Sub 2&lt;sub2&gt;\nGo to #localref(&lt;sub1&gt;)\n\n= Section 2\n== Sub 1&lt;sub1&gt;\nGo to #localref(&lt;sub2&gt;)\n== Sub 2&lt;sub2&gt;\n</code></pre>\n<p>We can do this because labels don’t need to be unique. But labels used with <code>ref</code> seem to need to be unique, so then we can’t do this with ref.</p>",
      "raw": "You can do it like this. In this case - find the top level headings and decide a \"bounding box\" - only look locally inside the current top level heading. Then place a custom link to that (not using ref)\n\n\n```typ\n#let maybelast(x) = {\n  if x.len() > 0 { return x.last() }\n}\n#let maybefirst(x) = {\n  if x.len() > 0 { return x.first() }\n}\n\n#let localref(lab) = context {\n  let mysections = query(heading.where(level: 1).before(here()))\n  let nextsections = query(heading.where(level: 1).after(here()))\n  let mysection = maybelast(mysections)\n  let nextsection = maybefirst(nextsections)\n  let sel = selector(lab)\n  if mysection != none {\n    sel = sel.after(mysection.location())\n  }\n  if nextsection != none {\n    sel = sel.before(nextsection.location())\n  }\n  let locations = query(sel)\n  for loc in locations {\n    link(loc.location())[Section #loc.body]\n    break\n  }\n}\n\n= Section 1\n== Sub 1<sub1>\n== Sub 2<sub2>\nGo to #localref(<sub1>)\n\n= Section 2\n== Sub 1<sub1>\nGo to #localref(<sub2>)\n== Sub 2<sub2>\n```\n\nWe can do this because labels don't need to be unique. But labels used with `ref` seem to need to be unique, so then we can't do this with ref.",
      "reply_to_post_number": null,
      "reply_count": 3,
      "quote_count": 0,
      "like_count": 2,
      "reads": 30,
      "score": 51.0,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11073,
      "post_number": 3,
      "username": "Regodin",
      "name": "",
      "created_at": "2025-04-14T16:16:08.071Z",
      "updated_at": "2025-04-14T16:16:08.071Z",
      "cooked": "<p>Ahh I see! I was considering going this way at first, but, wanted to make sure there wasn’t an easier way to modify the <span class=\"mention\">@ref</span> behavior to do it. And your code looks a lot simpler and clean than what I would have done lol! I was trying to loop over queries and compare heading levels and stuff…</p>\n<p>Thanks for your help! I appreciate it <img src=\"https://forum.typst.app/images/emoji/apple/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Ahh I see! I was considering going this way at first, but, wanted to make sure there wasn't an easier way to modify the @ref behavior to do it. And your code looks a lot simpler and clean than what I would have done lol! I was trying to loop over queries and compare heading levels and stuff..\n\nThanks for your help! I appreciate it :slight_smile:",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 26,
      "score": 5.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1161
    },
    {
      "id": 11181,
      "post_number": 4,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T18:39:42.202Z",
      "updated_at": "2025-04-16T18:39:42.202Z",
      "cooked": "<p>I don’t understand why for loop is used if each subsection has a unique name, and you want to reference one at a time. There should be either <code>query(sel).first()</code> or an additional assertion before this.</p>",
      "raw": "I don't understand why for loop is used if each subsection has a unique name, and you want to reference one at a time. There should be either `query(sel).first()` or an additional assertion before this.",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 21,
      "score": 4.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11442,
      "post_number": 5,
      "username": "Regodin",
      "name": "",
      "created_at": "2025-04-22T18:23:41.894Z",
      "updated_at": "2025-04-22T18:43:43.979Z",
      "cooked": "<p>Hey bluss,</p>\n<p>I just noticed that if used in a heading, it is blank when viewed in an outline. Is there a way to circumvent that issue? I’d be satisfied with just printing out the <code>lab</code> variable if the full name at location is not an option. Do you have any clue if this can be achieved?</p>\n<p>I’m having difficulty figuring out a solution; when I return the localref result directly, I get my full title wherever localref is called, but if I try to look at the fields, I get <code>(:)</code>.</p>",
      "raw": "Hey bluss,\n\nI just noticed that if used in a heading, it is blank when viewed in an outline. Is there a way to circumvent that issue? I'd be satisfied with just printing out the `lab` variable if the full name at location is not an option. Do you have any clue if this can be achieved?\n\nI'm having difficulty figuring out a solution; when I return the localref result directly, I get my full title wherever localref is called, but if I try to look at the fields, I get `(:)`.",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 17,
      "score": 3.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1161
    },
    {
      "id": 11444,
      "post_number": 6,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-22T18:46:32.997Z",
      "updated_at": "2025-04-22T19:02:19.852Z",
      "cooked": "<p>I think you mean this situation: you use the <code>localref</code> function inside a heading title? Two things you can detect - that the current section in localref resolution is Contents. Or that you can’t find any “local match” for the label. Both are true in that case.</p>\n<p>I don’t know if we can do correct resolution of the “local reference” in the outline, without redefining how the outline is drawn.</p>\n<details>\n<summary>code for handling missing reference</summary>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let maybelast(x) = {\n  if x.len() &gt; 0 { return x.last() }\n}\n#let maybefirst(x) = {\n  if x.len() &gt; 0 { return x.first() }\n}\n\n#let localref(lab) = context {\n  let mysection = maybelast(query(heading.where(level: 1).before(here())))\n  let nextsection = maybefirst(query(heading.where(level: 1).after(here())))\n  let sel = selector(lab)\n  if mysection != none {\n    sel = sel.after(mysection.location())\n  }\n  if nextsection != none {\n    sel = sel.before(nextsection.location())\n  }\n  let locations = query(sel)\n  if locations.len() &gt; 0 {\n    let loc = locations.at(0)\n    link(loc.location())[Section #loc.body]\n  } else {\n    ['#str(lab)' (My current section is called #mysection.body)]\n  }\n}\n\n#outline()\n\n= Section 1\n== Sub 1&lt;sub1&gt;\n== Sub 2&lt;sub2&gt;\nGo to #localref(&lt;sub1&gt;)\n\n= Section 2\n== Sub 1&lt;sub1&gt;\nGo to #localref(&lt;sub2&gt;)\n== Sub 2&lt;sub2&gt;\n== See also #localref(&lt;sub2&gt;)\n</code></pre>\n</details>",
      "raw": "I think you mean this situation: you use the `localref` function inside a heading title? Two things you can detect - that the current section in localref resolution is Contents. Or that you can't find any \"local match\" for the label. Both are true in that case.\n\nI don't know if we can do correct resolution of the \"local reference\" in the outline, without redefining how the outline is drawn. \n<details>\n<summary>code for handling missing reference</summary>\n\n```typ\n#let maybelast(x) = {\n  if x.len() > 0 { return x.last() }\n}\n#let maybefirst(x) = {\n  if x.len() > 0 { return x.first() }\n}\n\n#let localref(lab) = context {\n  let mysection = maybelast(query(heading.where(level: 1).before(here())))\n  let nextsection = maybefirst(query(heading.where(level: 1).after(here())))\n  let sel = selector(lab)\n  if mysection != none {\n    sel = sel.after(mysection.location())\n  }\n  if nextsection != none {\n    sel = sel.before(nextsection.location())\n  }\n  let locations = query(sel)\n  if locations.len() > 0 {\n    let loc = locations.at(0)\n    link(loc.location())[Section #loc.body]\n  } else {\n    ['#str(lab)' (My current section is called #mysection.body)]\n  }\n}\n\n#outline()\n\n= Section 1\n== Sub 1<sub1>\n== Sub 2<sub2>\nGo to #localref(<sub1>)\n\n= Section 2\n== Sub 1<sub1>\nGo to #localref(<sub2>)\n== Sub 2<sub2>\n== See also #localref(<sub2>)\n```\n\n</details>",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 16,
      "score": 18.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11447,
      "post_number": 7,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-22T19:01:56.311Z",
      "updated_at": "2025-04-22T19:01:56.311Z",
      "cooked": "<p>This is how we can hack the outline so that we can resolve <code>localref</code> inside the outline. We (unfortunately) use show rules for outline entries so that we can track “where we are” in the outline hierarchy.</p>\n<details>\n<summary>the code</summary>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let maybelast(x) = {\n  if x.len() &gt; 0 { return x.last() }\n}\n#let maybefirst(x) = {\n  if x.len() &gt; 0 { return x.first() }\n}\n\n#let currently-outlining = state(\"currentoutline\", none)\n\n#show outline.entry.where(level: 1): it =&gt; {\n  currently-outlining.update(_ =&gt; it.element)\n  it\n}\n#show outline: it =&gt; {\n  it\n  currently-outlining.update(_ =&gt; none)\n}\n\n#let localref(lab) = context {\n  let co = currently-outlining.get()\n  let mysection\n  let here-i-am = here()\n  if co != none {\n    // we are drawing the outline right now\n    mysection = co\n    here-i-am = co.location()\n  } else {\n    mysection = maybelast(query(heading.where(level: 1).before(here-i-am)))\n  }\n  let nextsection = maybefirst(query(heading.where(level: 1).after(here-i-am, inclusive: false)))\n  let sel = selector(lab)\n  if mysection != none {\n    sel = sel.after(mysection.location())\n  }\n  if nextsection != none {\n    sel = sel.before(nextsection.location())\n  }\n  let locations = query(sel)\n  if locations.len() &gt; 0 {\n    let loc = locations.at(0)\n    link(loc.location())[Section #loc.body]\n  } else {\n    // Fallback case if the local reference is not found. Could also be panic()\n    ['#str(lab)']\n  }\n}\n\n#outline()\n\n= Section 1\n== Sub 1&lt;sub1&gt;\n== Sub 2&lt;sub2&gt;\nGo to #localref(&lt;sub1&gt;)\n\n= Section 2\n== Sub 1&lt;sub1&gt;\nGo to #localref(&lt;sub2&gt;)\n== Sub 2&lt;sub2&gt;\n== See also #localref(&lt;sub2&gt;)\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/b/b5e1fcc0c49d73b44240d637c72772ee2c12ff89.png\" alt=\"bild\" data-base62-sha1=\"pX0B3J3xR4Y7cynzVaQCVNZOcoF\" width=\"487\" height=\"418\"></p>\n</details>",
      "raw": "This is how we can hack the outline so that we can resolve `localref` inside the outline. We (unfortunately) use show rules for outline entries so that we can track \"where we are\" in the outline hierarchy.\n\n<details>\n<summary>the code</summary>\n\n```typ\n#let maybelast(x) = {\n  if x.len() > 0 { return x.last() }\n}\n#let maybefirst(x) = {\n  if x.len() > 0 { return x.first() }\n}\n\n#let currently-outlining = state(\"currentoutline\", none)\n\n#show outline.entry.where(level: 1): it => {\n  currently-outlining.update(_ => it.element)\n  it\n}\n#show outline: it => {\n  it\n  currently-outlining.update(_ => none)\n}\n\n#let localref(lab) = context {\n  let co = currently-outlining.get()\n  let mysection\n  let here-i-am = here()\n  if co != none {\n    // we are drawing the outline right now\n    mysection = co\n    here-i-am = co.location()\n  } else {\n    mysection = maybelast(query(heading.where(level: 1).before(here-i-am)))\n  }\n  let nextsection = maybefirst(query(heading.where(level: 1).after(here-i-am, inclusive: false)))\n  let sel = selector(lab)\n  if mysection != none {\n    sel = sel.after(mysection.location())\n  }\n  if nextsection != none {\n    sel = sel.before(nextsection.location())\n  }\n  let locations = query(sel)\n  if locations.len() > 0 {\n    let loc = locations.at(0)\n    link(loc.location())[Section #loc.body]\n  } else {\n    // Fallback case if the local reference is not found. Could also be panic()\n    ['#str(lab)']\n  }\n}\n\n#outline()\n\n= Section 1\n== Sub 1<sub1>\n== Sub 2<sub2>\nGo to #localref(<sub1>)\n\n= Section 2\n== Sub 1<sub1>\nGo to #localref(<sub2>)\n== Sub 2<sub2>\n== See also #localref(<sub2>)\n```\n\n![bild|487x418](upload://pX0B3J3xR4Y7cynzVaQCVNZOcoF.png)\n\n</details>",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 16,
      "score": 28.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11448,
      "post_number": 8,
      "username": "Regodin",
      "name": "",
      "created_at": "2025-04-22T19:50:48.222Z",
      "updated_at": "2025-04-22T19:50:48.222Z",
      "cooked": "<p>This solution worked great!</p>\n<p>Thanks for helping me out, I appreciate it!</p>",
      "raw": "This solution worked great! \n\nThanks for helping me out, I appreciate it!",
      "reply_to_post_number": 7,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 17,
      "score": 28.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1161
    }
  ],
  "scraped_at": "2025-06-10T09:49:13.067021"
}
{
  "topic_metadata": {
    "id": 3652,
    "title": "How to plot histograms?",
    "slug": "how-to-plot-histograms",
    "posts_count": 8,
    "created_at": "2025-04-14T18:21:28.261Z",
    "last_posted_at": "2025-04-15T00:18:25.030Z",
    "views": 121,
    "like_count": 4,
    "reply_count": 2,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "vmartel08",
    "tags": [
      "graphics"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 753
  },
  "posts": [
    {
      "id": 11079,
      "post_number": 1,
      "username": "Paul744",
      "name": "Paul",
      "created_at": "2025-04-14T18:21:28.369Z",
      "updated_at": "2025-04-15T00:18:08.814Z",
      "cooked": "<p>I am trying to figure out the best way to do plots for CSV files. I don’t like matplotlib/Python for all the dependency issues, but I ran across:</p>\n<aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://huijzer.xyz/posts/cetz-plot-csv/\">\n  <header class=\"source\">\n      <img src=\"https://forum.typst.app/uploads/default/original/2X/5/5279fb6b160a506f539478f00c826e54c258ce20.png\" class=\"site-icon\" data-dominant-color=\"4D65AF\" width=\"48\" height=\"48\">\n\n      <a href=\"https://huijzer.xyz/posts/cetz-plot-csv/\" target=\"_blank\" rel=\"noopener nofollow ugc\">huijzer.xyz</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    \n\n<h3><a href=\"https://huijzer.xyz/posts/cetz-plot-csv/\" target=\"_blank\" rel=\"noopener nofollow ugc\">Plotting a CSV file with Typst and CeTZ-Plot</a></h3>\n\n  <p>A fast and reliable way to plot data similar to gnuplot.</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<p>This looks very nice, but I cannot find documentation for histograms. I also ran across:</p>\n<aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://typst.app/universe/package/plotst/\">\n  <header class=\"source\">\n      <img src=\"https://forum.typst.app/uploads/default/original/1X/098187a593d51c4db99324614e2baeeb1bb355cc.png\" class=\"site-icon\" data-dominant-color=\"3CA8B6\" width=\"32\" height=\"32\">\n\n      <a href=\"https://typst.app/universe/package/plotst/\" target=\"_blank\" rel=\"noopener\">Typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/361;\"><img src=\"https://forum.typst.app/uploads/default/optimized/1X/db1c18ed802fe6841bee62606931f352da10ed09_2_690x362.png\" class=\"thumbnail\" data-dominant-color=\"7CC2C5\" width=\"690\" height=\"362\"></div>\n\n<h3><a href=\"https://typst.app/universe/package/plotst/\" target=\"_blank\" rel=\"noopener\">plotst – Typst Universe</a></h3>\n\n  <p>A library to draw a variety of graphs and plots to use in your papers</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<p>but its last update was over a year ago and the axis keyword doesn’t seem to work anymore (that or I am doing it wrong, but I’m mostly copy/pasting.</p>\n<p>Importantly, the types of histograms i need to draw are multiplicity plots, basically binning entries based on whether column entries fall within certain areas. Also, I am unsure if the scale of data will be an issue, as my first dataset will be 44 x 200,000, but that’s a trial run for much larger datasets. If plotst still worked, it would fulfill all my needed conditions, but otherwise, does anyone have any recommendations?</p>",
      "raw": "I am trying to figure out the best way to do plots for CSV files. I don't like matplotlib/Python for all the dependency issues, but I ran across:\n\nhttps://huijzer.xyz/posts/cetz-plot-csv/\n\nThis looks very nice, but I cannot find documentation for histograms. I also ran across:\n\nhttps://typst.app/universe/package/plotst/\n\nbut its last update was over a year ago and the axis keyword doesn't seem to work anymore (that or I am doing it wrong, but I'm mostly copy/pasting.\n\nImportantly, the types of histograms i need to draw are multiplicity plots, basically binning entries based on whether column entries fall within certain areas. Also, I am unsure if the scale of data will be an issue, as my first dataset will be 44 x 200,000, but that's a trial run for much larger datasets. If plotst still worked, it would fulfill all my needed conditions, but otherwise, does anyone have any recommendations?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 33,
      "score": 416.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 788
    },
    {
      "id": 11080,
      "post_number": 2,
      "username": "vmartel08",
      "name": "Vincent Martel",
      "created_at": "2025-04-14T19:41:45.059Z",
      "updated_at": "2025-04-14T19:41:45.059Z",
      "cooked": "<p>Have you tried Lilaq?</p>\n<aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://lilaq.org/docs/examples/plot-data-from-csv\">\n  <header class=\"source\">\n      <img src=\"https://forum.typst.app/uploads/default/original/2X/d/de40fe8687e6074c6be36e427570d6e2e3960c1b.png\" class=\"site-icon\" data-dominant-color=\"724A93\" width=\"16\" height=\"16\">\n\n      <a href=\"https://lilaq.org/docs/examples/plot-data-from-csv\" target=\"_blank\" rel=\"noopener nofollow ugc\">lilaq.org</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/388;\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/0/0a180e3a2c5896dc676770ee7ae28dd1810115e4_2_690x388.jpeg\" class=\"thumbnail\" data-dominant-color=\"6055BC\" width=\"690\" height=\"388\"></div>\n\n<h3><a href=\"https://lilaq.org/docs/examples/plot-data-from-csv\" target=\"_blank\" rel=\"noopener nofollow ugc\">Plot data from CSV file − Lilaq</a></h3>\n\n  <p>Using load-txt to make loading data from a file easier.</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
      "raw": "Have you tried Lilaq? \n\nhttps://lilaq.org/docs/examples/plot-data-from-csv",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 30,
      "score": 56.0,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 936
    },
    {
      "id": 11081,
      "post_number": 3,
      "username": "Paul744",
      "name": "Paul",
      "created_at": "2025-04-14T19:48:25.369Z",
      "updated_at": "2025-04-14T19:51:37.962Z",
      "cooked": "<p>I literally ran across this before in a different context, but it refused to reappear in my latest searches. That’ll do. However, I think for bin counting, I’m going to have to do the data preprocessing manually. Thanks.</p>",
      "raw": "I literally ran across this before in a different context, but it refused to reappear in my latest searches. That'll do. However, I think for bin counting, I'm going to have to do the data preprocessing manually. Thanks.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 29,
      "score": 5.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 788
    },
    {
      "id": 11083,
      "post_number": 4,
      "username": "Paul744",
      "name": "Paul",
      "created_at": "2025-04-14T20:20:41.496Z",
      "updated_at": "2025-04-14T20:20:41.496Z",
      "cooked": "<p><a class=\"mention\" href=\"/u/vmartel08\">@vmartel08</a> Actually, looking at it more, I’m not sure if it’ll precisely match with what I am looking for. I am looking at the bar plot, and while it can work, it’d be ideal if the bars could sit right next to each other rather than being gapped, as each bar needs to represent how many entries in the CSV file with column (say A) have values ranging between e.g. 0.5 &lt; 1 and 1 &lt; 1.5 as two bins. I see the width parameter, but I am unsure as to whether or not the plot is going to try and autoscale to prevent bars from sitting side-by-side.</p>",
      "raw": "@vmartel08 Actually, looking at it more, I'm not sure if it'll precisely match with what I am looking for. I am looking at the bar plot, and while it can work, it'd be ideal if the bars could sit right next to each other rather than being gapped, as each bar needs to represent how many entries in the CSV file with column (say A) have values ranging between e.g. 0.5 < 1 and 1 < 1.5 as two bins. I see the width parameter, but I am unsure as to whether or not the plot is going to try and autoscale to prevent bars from sitting side-by-side.",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 28,
      "score": 5.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 788
    },
    {
      "id": 11087,
      "post_number": 5,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-14T21:31:08.955Z",
      "updated_at": "2025-04-14T22:06:10.154Z",
      "cooked": "<p>Yeah. If you want to plot with typsts, do the heavy lifting w.r.t computation with tools outside, for example computing the histogram bins.</p>\n<p>I think histograms are perfectly doable with the existing bar plots, but I think you’re welcome to open issues in their github repo as well if you want to.</p>\n<p><a href=\"https://lilaq.org/docs/examples/bar-plot-with-numbers\" rel=\"noopener nofollow ugc\">Their example</a> plus the right offset and width setting and it looks like a histogram already</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/lilaq:0.2.0\" as lq\n\n#let xs = range(9)\n#let ys = (12, 51, 23, 36, 38, 15, 10, 22, 86)\n\n#lq.diagram(\n  width: 9cm,\n  xaxis: (subticks: none),\n\n  lq.bar(\n    xs, ys, width: 1.0, offset: +0.5, stroke: 0.5pt + black,\n  ),\n\n  ..xs.zip(ys).map(((x, y)) =&gt; {\n    let align = if y &gt; 12 { top } else { bottom }\n    lq.place(x + 0.5, y, pad(0.2em)[#y], align: align)\n  })\n)\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/3/3afadc86e65e70bcf350c0c6c6c943bd7202c60f.png\" alt=\"image\" data-base62-sha1=\"8pLa0wTuDANdzdVgp4XBG4VZDST\" width=\"653\" height=\"324\"></p>",
      "raw": "Yeah. If you want to plot with typsts, do the heavy lifting w.r.t computation with tools outside, for example computing the histogram bins.\n\nI think histograms are perfectly doable with the existing bar plots, but I think you're welcome to open issues in their github repo as well if you want to.\n\n[Their example](https://lilaq.org/docs/examples/bar-plot-with-numbers) plus the right offset and width setting and it looks like a histogram already\n\n```typ\n#import \"@preview/lilaq:0.2.0\" as lq\n\n#let xs = range(9)\n#let ys = (12, 51, 23, 36, 38, 15, 10, 22, 86)\n\n#lq.diagram(\n  width: 9cm,\n  xaxis: (subticks: none),\n\n  lq.bar(\n    xs, ys, width: 1.0, offset: +0.5, stroke: 0.5pt + black,\n  ),\n\n  ..xs.zip(ys).map(((x, y)) => {\n    let align = if y > 12 { top } else { bottom }\n    lq.place(x + 0.5, y, pad(0.2em)[#y], align: align)\n  })\n)\n```\n![image|653x324](upload://8pLa0wTuDANdzdVgp4XBG4VZDST.png)",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 28,
      "score": 40.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11089,
      "post_number": 6,
      "username": "Paul744",
      "name": "Paul",
      "created_at": "2025-04-14T22:05:17.824Z",
      "updated_at": "2025-04-14T22:08:21.403Z",
      "cooked": "<p>That looks pretty good! And yeah, I guess that makes sense. I was just enticed by stuff like plotst since it seemed to imply that, once I had the .csv file, I could do all the remaining tasks entirely within Typst. No need for external toolkits. That’s the reason I was trying to find an alternative to Python, since getting its LaTeX functionality for labels was proving to be hellish in terms of getting my Python venv to find my LaTeX installation. I thought that, since Typst’s backend is written in Rust, one might be able to invoke polars manipulations directly.</p>",
      "raw": "That looks pretty good! And yeah, I guess that makes sense. I was just enticed by stuff like plotst since it seemed to imply that, once I had the .csv file, I could do all the remaining tasks entirely within Typst. No need for external toolkits. That's the reason I was trying to find an alternative to Python, since getting its LaTeX functionality for labels was proving to be hellish in terms of getting my Python venv to find my LaTeX installation. I thought that, since Typst's backend is written in Rust, one might be able to invoke polars manipulations directly.",
      "reply_to_post_number": 5,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 27,
      "score": 5.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 788
    },
    {
      "id": 11090,
      "post_number": 7,
      "username": "bluss",
      "name": "Ulrik",
      "created_at": "2025-04-14T22:10:38.126Z",
      "updated_at": "2025-04-14T22:12:31.901Z",
      "cooked": "<p>You don’t know unless you try, but I would guess with that scale of the data typst would not be a good environment to run computations in.</p>\n<p>Typst doesn’t have any dense numerical arrays that I know of, so it would be the equivalent of using python lists in terms of efficiency (instead of using numpy or arrow), in a dynamic language. If you’re in Python instead you can use appropriate data analysis libraries.</p>\n<p>You can still make the final plots in typst, once the number crunching is done <img src=\"https://forum.typst.app/images/emoji/apple/slightly_smiling_face.png?v=12\" title=\":slightly_smiling_face:\" class=\"emoji\" alt=\":slightly_smiling_face:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<p>Ok, if any of the typst packages incorporate polars it starts sounding interesting, I don’t know what’s possible there…</p>",
      "raw": "You don't know unless you try, but I would guess with that scale of the data typst would not be a good environment to run computations in.\n\nTypst doesn't have any dense numerical arrays that I know of, so it would be the equivalent of using python lists in terms of efficiency (instead of using numpy or arrow), in a dynamic language. If you're in Python instead you can use appropriate data analysis libraries.\n\nYou can still make the final plots in typst, once the number crunching is done :slightly_smiling_face:\n\nOk, if any of the typst packages incorporate polars it starts sounding interesting, I don't know what's possible there..",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 26,
      "score": 15.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 1272
    },
    {
      "id": 11093,
      "post_number": 8,
      "username": "PgBiel",
      "name": "",
      "created_at": "2025-04-15T00:18:25.030Z",
      "updated_at": "2025-04-15T00:18:25.030Z",
      "cooked": "<p>Hey <a class=\"mention\" href=\"/u/paul744\">@Paul744</a>, welcome to the forum! I’ve changed your question post’s title to better fit our guidelines: <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\" class=\"inline-onebox\">How to post in the Questions category</a></p>\n<p>Make sure your title is a question you’d ask to a friend about Typst. <img src=\"https://forum.typst.app/images/emoji/apple/wink.png?v=12\" title=\":wink:\" class=\"emoji\" alt=\":wink:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Hey @Paul744, welcome to the forum! I’ve changed your question post’s title to better fit our guidelines: https://forum.typst.app/t/how-to-post-in-the-questions-category/11\n\nMake sure your title is a question you’d ask to a friend about Typst. :wink:",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 5.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    }
  ],
  "scraped_at": "2025-06-10T09:49:12.341360"
}
{
  "topic_metadata": {
    "id": 3653,
    "title": "Make bottom/top stroke invisible on block break?",
    "slug": "make-bottom-top-stroke-invisible-on-block-break",
    "posts_count": 5,
    "created_at": "2025-04-14T21:02:05.884Z",
    "last_posted_at": "2025-04-18T19:26:58.916Z",
    "views": 68,
    "like_count": 5,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Eric",
    "tags": [
      "layout"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 303
  },
  "posts": [
    {
      "id": 11085,
      "post_number": 1,
      "username": "Regodin",
      "name": "",
      "created_at": "2025-04-14T21:02:05.983Z",
      "updated_at": "2025-04-15T00:32:30.076Z",
      "cooked": "<p>Is there a way to have a the stroke of a breakable block change based on the breaking point? A bit like so:<br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/f/f9536f905f9a5d23e1bea7bd3cc5d2d668ceb94a.png\" data-download-href=\"https://forum.typst.app/uploads/default/f9536f905f9a5d23e1bea7bd3cc5d2d668ceb94a\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/f/f9536f905f9a5d23e1bea7bd3cc5d2d668ceb94a_2_690x414.png\" alt=\"image\" data-base62-sha1=\"zzDEkzbwaWsx2lwOt0Z6ATQoVIu\" width=\"690\" height=\"414\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/f/f9536f905f9a5d23e1bea7bd3cc5d2d668ceb94a_2_690x414.png, https://forum.typst.app/uploads/default/original/2X/f/f9536f905f9a5d23e1bea7bd3cc5d2d668ceb94a.png 1.5x, https://forum.typst.app/uploads/default/original/2X/f/f9536f905f9a5d23e1bea7bd3cc5d2d668ceb94a.png 2x\" data-dominant-color=\"DCE6EF\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">877×527 131 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div><br>\nFor reference, I manually split the block and set the strokes here to show an example of what I meant.</p>",
      "raw": "Is there a way to have a the stroke of a breakable block change based on the breaking point? A bit like so:\n![image|690x414](upload://zzDEkzbwaWsx2lwOt0Z6ATQoVIu.png)\nFor reference, I manually split the block and set the strokes here to show an example of what I meant.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 21,
      "score": 69.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1161
    },
    {
      "id": 11088,
      "post_number": 2,
      "username": "Eric",
      "name": "Eric Biedert",
      "created_at": "2025-04-14T21:46:28.740Z",
      "updated_at": "2025-04-14T21:47:25.184Z",
      "cooked": "<p>There is no standard inbuilt way to configure strokes on block breaks, but you can work around it by only applying the stroke on the left and right side of the block, and placing the top and bottom strokes as separate elements. This of course has limitations, especially when using rounded corners, but it should work in simple cases:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let broken-block(..args) = layout(bounds =&gt; {\n  let stroke = stroke(args.at(\"stroke\", default: 0pt))\n  let width = measure(..bounds, block(..args)).width\n\n  // I'm using a block here instead of a line so that a\n  // possible `show line: set block(spacing: ..)` rule\n  // doesn't interfere with the spacing set to this block.\n  let line = block.with(\n    outset: (x: stroke.thickness / 2),\n    width: width,\n    stroke: stroke,\n  )\n\n  line(below: stroke.thickness / 2)\n  block(..args, stroke: (x: stroke))\n  line(above: stroke.thickness / 2)\n})\n\n// Use it just like a regular block.\n#broken-block(\n  fill: blue.lighten(80%),\n  stroke: 1pt,\n  inset: 1em,\n  lorem(35)\n)\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/d/db1771df2034d3d68b9a40602a2e038a006c1977.png\" alt=\"image\" data-base62-sha1=\"vgaNmZxlRQ6MsMV8naNrKwEUKJp\" width=\"324\" height=\"339\"></p>\n<hr>\n<p>Also, please try to keep questions in the <a class=\"hashtag-cooked\" href=\"/c/questions/5\" data-type=\"category\" data-slug=\"questions\" data-id=\"5\"><span class=\"hashtag-icon-placeholder\"><svg class=\"fa d-icon d-icon-square-full svg-icon svg-node\"><use href=\"#square-full\"></use></svg></span><span>Questions</span></a> category, so they are easier to find for other users!</p>",
      "raw": "There is no standard inbuilt way to configure strokes on block breaks, but you can work around it by only applying the stroke on the left and right side of the block, and placing the top and bottom strokes as separate elements. This of course has limitations, especially when using rounded corners, but it should work in simple cases:\n\n```typ\n#let broken-block(..args) = layout(bounds => {\n  let stroke = stroke(args.at(\"stroke\", default: 0pt))\n  let width = measure(..bounds, block(..args)).width\n\n  // I'm using a block here instead of a line so that a\n  // possible `show line: set block(spacing: ..)` rule\n  // doesn't interfere with the spacing set to this block.\n  let line = block.with(\n    outset: (x: stroke.thickness / 2),\n    width: width,\n    stroke: stroke,\n  )\n\n  line(below: stroke.thickness / 2)\n  block(..args, stroke: (x: stroke))\n  line(above: stroke.thickness / 2)\n})\n\n// Use it just like a regular block.\n#broken-block(\n  fill: blue.lighten(80%),\n  stroke: 1pt,\n  inset: 1em,\n  lorem(35)\n)\n```\n![image|433x453, 75%](upload://vgaNmZxlRQ6MsMV8naNrKwEUKJp.png)\n\n---\n\nAlso, please try to keep questions in the #questions category, so they are easier to find for other users!",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 21,
      "score": 39.2,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 88
    },
    {
      "id": 11099,
      "post_number": 3,
      "username": "Regodin",
      "name": "",
      "created_at": "2025-04-15T02:36:28.648Z",
      "updated_at": "2025-04-15T02:36:28.648Z",
      "cooked": "<p>Thanks for the tip!</p>\n<p>And sorry about that, I’ll make sure to properly tag my post next time.</p>",
      "raw": "Thanks for the tip! \n\nAnd sorry about that, I'll make sure to properly tag my post next time.",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 17,
      "score": 3.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1161
    },
    {
      "id": 11186,
      "post_number": 4,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T20:16:57.575Z",
      "updated_at": "2025-04-16T20:17:51.587Z",
      "cooked": "<p>There are some hacks listed in</p>\n<aside class=\"onebox githubissue\" data-onebox-src=\"https://github.com/typst/typst/issues/735\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/typst/typst/issues/735\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com/typst/typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"github-row\">\n  <div class=\"github-icon-container\" title=\"Issue\" data-github-private-repo=\"false\">\n\t  <svg width=\"60\" height=\"60\" class=\"github-icon\" viewBox=\"0 0 14 16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg>\n  </div>\n\n  <div class=\"github-info-container\">\n    <h4>\n      <a href=\"https://github.com/typst/typst/issues/735\" target=\"_blank\" rel=\"noopener nofollow ugc\">Allow adding content / configuring breakpoints of broken blocks</a>\n    </h4>\n\n    <div class=\"github-info\">\n      <div class=\"date\">\n        opened <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2023-04-11\" data-time=\"17:06:27\" data-timezone=\"UTC\">05:06PM - 11 Apr 23 UTC</span>\n      </div>\n\n\n      <div class=\"user\">\n        <a href=\"https://github.com/jeyj0\" target=\"_blank\" rel=\"noopener nofollow ugc\">\n          <img alt=\"jeyj0\" src=\"https://forum.typst.app/uploads/default/original/2X/9/97c2bde787dfeb7d59a2bae42246ed48f7523f64.jpeg\" class=\"onebox-avatar-inline\" width=\"20\" height=\"20\" data-dominant-color=\"C0B3AE\">\n          jeyj0\n        </a>\n      </div>\n    </div>\n\n    <div class=\"labels\">\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          feature request\n        </span>\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          layout\n        </span>\n    </div>\n  </div>\n</div>\n\n  <div class=\"github-row\">\n    <p class=\"github-body-container\">When a block breaks due to a column or pagebreak, it's currently styled like two<span class=\"show-more-container\"><a href=\"\" rel=\"noopener\" class=\"show-more\">…</a></span><span class=\"excerpt hidden\"> individual blocks.\n\nIt'd be great to be able to add content to the points of the block where the break was inserted, so it can be styled differently.\n\nHere's a real-life example that illustrates the idea (not generated with Typst):\n\n![image](https://user-images.githubusercontent.com/12881718/231237037-c48bcc28-bc41-4d10-bd5f-5c35d3b316dd.png)\n\nThe block has a border at the top and bottom, but where it's broken across columns the border changes to a dashed style.\n\nBut a solution should ideally not (just) allow changing borders, but doing any number of complex/arbitrary things, like inserting graphics for example (example: insert an image at those places that makes it look like the block was ripped apart).</span></p>\n  </div>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
      "raw": "There are some hacks listed in\n\nhttps://github.com/typst/typst/issues/735",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 15,
      "score": 18.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11298,
      "post_number": 5,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2025-04-18T19:26:58.916Z",
      "updated_at": "2025-04-18T19:26:58.916Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/regodin\">@Regodin</a>, don’t forget to tick <img src=\"https://forum.typst.app/images/emoji/apple/ballot_box_with_check.png?v=12\" title=\":ballot_box_with_check:\" class=\"emoji\" alt=\":ballot_box_with_check:\" loading=\"lazy\" width=\"20\" height=\"20\"> one of the responses if you got a satisfying answer. The answer you choose should usually be the response that you found most correct/helpful/comprehensive for the question you asked. Thanks!</p>",
      "raw": "Hi @Regodin, don’t forget to tick :ballot_box_with_check: one of the responses if you got a satisfying answer. The answer you choose should usually be the response that you found most correct/helpful/comprehensive for the question you asked. Thanks!",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 15,
      "score": 18.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    }
  ],
  "scraped_at": "2025-06-10T09:49:11.608319"
}
{
  "topic_metadata": {
    "id": 3659,
    "title": "What is the correct way to use a for loop plotting within a lilaq diagram?",
    "slug": "what-is-the-correct-way-to-use-a-for-loop-plotting-within-a-lilaq-diagram",
    "posts_count": 2,
    "created_at": "2025-04-15T08:38:39.731Z",
    "last_posted_at": "2025-04-15T09:30:53.970Z",
    "views": 89,
    "like_count": 3,
    "reply_count": 0,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Mc-Zen",
    "tags": [
      "lilaq"
    ],
    "category_id": 5,
    "participant_count": 2,
    "word_count": 238
  },
  "posts": [
    {
      "id": 11107,
      "post_number": 1,
      "username": "Christopher_Marcotte",
      "name": "Christopher Marcotte",
      "created_at": "2025-04-15T08:38:39.999Z",
      "updated_at": "2025-04-15T08:38:39.999Z",
      "cooked": "<p>The documentation demonstrates multiple plots in a diagram by listing the <code>lq.plot(...),</code> calls as arguments to <code>lq.diagram</code> (i.e. separated by commas). If one wants to plot multiple lines in a loop, is there a way to do so? For example, consider the code below:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">\n#let loop_lq(A) = {\n  \n  import \"@preview/lilaq:0.2.0\" as lq\n  let xs = lq.linspace(0, 1, num: 11)\n  let fn(x, a: 0.0) = calc.sin(a * x)\n\n  lq.diagram(\n    width: 10cm, \n    height: 5cm,\n    ylim: (0, auto),\n    xlim: (0, 1),\n    legend:(position: left+top),\n\n    for a in A {\n      lq.plot(\n        xs, mark: none, \n        xs.map(t =&gt; fn(t, a:a)), \n        stroke: (paint: colors.tertiary.lighten(25%).rotate(calc.log(a)*40deg), thickness: 3pt),\n        //tip: tiptoe.stealth,\n        //toe: tiptoe.bar,\n        label: [$a = #a$],\n      )\n    }\n  )\n}\n\n#loop_lq((0.1, 1.0))\n</code></pre>\n<p>This produces an output which is missing all but the last iteration.<br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/b/b73b2d01cee710cf6d5e841bde43d45e2c474b63.png\" data-download-href=\"https://forum.typst.app/uploads/default/b73b2d01cee710cf6d5e841bde43d45e2c474b63\" title=\"loop-plot\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/b/b73b2d01cee710cf6d5e841bde43d45e2c474b63_2_690x459.png\" alt=\"loop-plot\" data-base62-sha1=\"q8W9XE2CPX1t1thdCIgIuQf5ntV\" width=\"690\" height=\"459\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/b/b73b2d01cee710cf6d5e841bde43d45e2c474b63_2_690x459.png, https://forum.typst.app/uploads/default/original/2X/b/b73b2d01cee710cf6d5e841bde43d45e2c474b63.png 1.5x, https://forum.typst.app/uploads/default/original/2X/b/b73b2d01cee710cf6d5e841bde43d45e2c474b63.png 2x\" data-dominant-color=\"FBFAFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">loop-plot</span><span class=\"informations\">930×619 22.2 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "The documentation demonstrates multiple plots in a diagram by listing the `lq.plot(...),` calls as arguments to `lq.diagram` (i.e. separated by commas). If one wants to plot multiple lines in a loop, is there a way to do so? For example, consider the code below:\n```typ\n\n#let loop_lq(A) = {\n  \n  import \"@preview/lilaq:0.2.0\" as lq\n  let xs = lq.linspace(0, 1, num: 11)\n  let fn(x, a: 0.0) = calc.sin(a * x)\n\n  lq.diagram(\n    width: 10cm, \n    height: 5cm,\n    ylim: (0, auto),\n    xlim: (0, 1),\n    legend:(position: left+top),\n\n    for a in A {\n      lq.plot(\n        xs, mark: none, \n        xs.map(t => fn(t, a:a)), \n        stroke: (paint: colors.tertiary.lighten(25%).rotate(calc.log(a)*40deg), thickness: 3pt),\n        //tip: tiptoe.stealth,\n        //toe: tiptoe.bar,\n        label: [$a = #a$],\n      )\n    }\n  )\n}\n\n#loop_lq((0.1, 1.0))\n```\nThis produces an output which is missing all but the last iteration.\n![loop-plot|690x459](upload://q8W9XE2CPX1t1thdCIgIuQf5ntV.png)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 33,
      "score": 161.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 270
    },
    {
      "id": 11109,
      "post_number": 2,
      "username": "Mc-Zen",
      "name": "Mc-Zen",
      "created_at": "2025-04-15T09:30:53.970Z",
      "updated_at": "2025-04-15T09:30:53.970Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/christopher_marcotte\">@Christopher_Marcotte</a> ,</p>\n<p>you can achieve this with unpacking of arrays, like</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/lilaq:0.2.0\" as lq\n\n#let x = lq.linspace(0, 10)\n#lq.diagram(\n  ..range(6).map(i =&gt; lq.plot(x, x.map(x =&gt; x + i)))\n)\n</code></pre>\n<p>In your example, you would replace <code>range(6)</code> with your array <code>A</code>. Each element is mapped to a <code>lq.plot</code> instance which results in an array of plots.</p>\n<p>With the <code>..</code> unpacking syntax, you can pass the array items as individual arguments to <code>lq.diagram</code>.</p>",
      "raw": "Hi @Christopher_Marcotte ,\n\nyou can achieve this with unpacking of arrays, like \n```typ\n#import \"@preview/lilaq:0.2.0\" as lq\n\n#let x = lq.linspace(0, 10)\n#lq.diagram(\n  ..range(6).map(i => lq.plot(x, x.map(x => x + i)))\n)\n```\nIn your example, you would replace `range(6)` with your array `A`. Each element is mapped to a `lq.plot` instance which results in an array of plots. \n\nWith the `..` unpacking syntax, you can pass the array items as individual arguments to `lq.diagram`.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 3,
      "reads": 29,
      "score": 50.8,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 9
    }
  ],
  "scraped_at": "2025-06-10T09:49:10.806415"
}
{
  "topic_metadata": {
    "id": 3664,
    "title": "How to cleanly declare arguments to document?",
    "slug": "how-to-cleanly-declare-arguments-to-document",
    "posts_count": 5,
    "created_at": "2025-04-15T16:02:33.722Z",
    "last_posted_at": "2025-04-16T21:09:37.373Z",
    "views": 109,
    "like_count": 6,
    "reply_count": 2,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "quachpas",
    "tags": [
      "scripting",
      "data-loading"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 757
  },
  "posts": [
    {
      "id": 11119,
      "post_number": 1,
      "username": "Nicholas",
      "name": "Nicholas",
      "created_at": "2025-04-15T16:02:33.875Z",
      "updated_at": "2025-04-18T19:25:55.385Z",
      "cooked": "<p>I’m experimenting with writing a document in a way that exposes arguments for query. This is per-se not that complicated, but I struggle with doing it cleanly. My ideal result would look something like this:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#import \"some-package\": declare_args\n#let args = declare_args((sender: \"Alice\", receiver: \"Bob\"))\n\nHi #args.receiver, this is #args.sender\n</code></pre>\n<p>where the <code>declare_args</code> function:</p>\n<ul>\n<li>inserts a <code>metadata</code> content block with the args, such that we can query for it from an external program</li>\n<li>replaces the values of <code>sender</code> and <code>receiver</code> by values from <code>sys.inputs</code> (if provided)</li>\n<li>colors all values of keys that were not provided via <code>sys.inputs</code> red to show they need to be provided (but not stopping the compilation)</li>\n</ul>\n<p>This is as such not possible, since typst cannot return a value and insert a block at the same time.</p>\n<p>I was able to get the following variants of this, but am not happy with them:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let args =(sender: \"Alice\",receiver: \"Bob\")\n#declare_args(args) // basically #metadata(args) &lt;args&gt;\n#let args = mark_required(args) // Merge sys.inputs and color them\n// needs two calls and reassigns the args\n</code></pre>\n<p>.</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let (args, meta) =declare_and_mark((sender: \"Alice\",receiver: \"Bob\")) // just the other two functions combined returning an array\n#meta\n// You need to insert that meta variable and don't really notice if your forget\n</code></pre>\n<p>.</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">// Using state and a regex rule, collect all occurrences of ARG_*, replace them with sys.inputs.at(*) or text(red, *) and insert a metadata tag of state.final()\n#show: regex_spam\nHi ARGS_sender, this is ARGS_receiver\n// Using a variable gives better hints and autocompletion. (and regex rules are scary)\n</code></pre>\n<p>.</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let arg_func(key) =&gt; [\n  #metadata(key) &lt;arg&gt;\n  #sys.inputs.at(key,default: text(red, args.at(key)))\n]\nHi arg_func(\"receiver\"), this is arg_func(\"sender\")\n// Again, the variable with fields just has better support\n</code></pre>\n<p>What I tried but didn’t get to work:</p>\n<ul>\n<li>A show rule that somehow injects a variable into the document (not possible due to scoping)</li>\n<li>Returning a variable and inserting a content block by the same function (not possible)</li>\n</ul>\n<p>Any ideas how I could get closer to my ideal result?</p>",
      "raw": "I'm experimenting with writing a document in a way that exposes arguments for query. This is per-se not that complicated, but I struggle with doing it cleanly. My ideal result would look something like this:\n```typst\n#import \"some-package\": declare_args\n#let args = declare_args((sender: \"Alice\", receiver: \"Bob\"))\n\nHi #args.receiver, this is #args.sender\n```\nwhere the `declare_args` function:\n - inserts a `metadata` content block with the args, such that we can query for it from an external program\n - replaces the values of `sender` and `receiver` by values from `sys.inputs` (if provided)\n - colors all values of keys that were not provided via `sys.inputs` red to show they need to be provided (but not stopping the compilation)\n\nThis is as such not possible, since typst cannot return a value and insert a block at the same time. \n\nI was able to get the following variants of this, but am not happy with them:\n```typst\n#let args =(sender: \"Alice\",receiver: \"Bob\")\n#declare_args(args) // basically #metadata(args) <args>\n#let args = mark_required(args) // Merge sys.inputs and color them\n// needs two calls and reassigns the args\n```\n.\n```typst\n#let (args, meta) =declare_and_mark((sender: \"Alice\",receiver: \"Bob\")) // just the other two functions combined returning an array\n#meta\n// You need to insert that meta variable and don't really notice if your forget\n```\n.\n```typst\n// Using state and a regex rule, collect all occurrences of ARG_*, replace them with sys.inputs.at(*) or text(red, *) and insert a metadata tag of state.final()\n#show: regex_spam\nHi ARGS_sender, this is ARGS_receiver\n// Using a variable gives better hints and autocompletion. (and regex rules are scary)\n```\n.\n```typst\n#let arg_func(key) => [\n  #metadata(key) <arg>\n  #sys.inputs.at(key,default: text(red, args.at(key)))\n]\nHi arg_func(\"receiver\"), this is arg_func(\"sender\")\n// Again, the variable with fields just has better support\n```\n\n\nWhat I tried but didn't get to work:\n - A show rule that somehow injects a variable into the document (not possible due to scoping)\n - Returning a variable and inserting a content block by the same function (not possible)\n\nAny ideas how I could get closer to my ideal result?",
      "reply_to_post_number": null,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 0,
      "reads": 37,
      "score": 57.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1462
    },
    {
      "id": 11144,
      "post_number": 2,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2025-04-16T06:49:49.830Z",
      "updated_at": "2025-04-16T06:49:49.830Z",
      "cooked": "<p>Hello!<br>\nI think this should be achievable with the following code, you were nearly there!</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let declare_args(it) = {\n  let inputs = sys.inputs\n  for (k,v) in it {\n    (str(k): [#inputs.at(k, default: text(red, v))#metadata(v)#label(str(k))]) \n  }\n}\n#let args = declare_args((sender: \"Alice\", receiver: \"Bob\"))\n\nHi #args.sender, this is #args.receiver.\n</code></pre>\n<p>If I compile with input <code>sender=Steve</code>, I get<br>\n<img src=\"https://forum.typst.app/uploads/default/original/2X/d/d5ad9787d5a171978db2300bbcf88518d6cab8bd.png\" alt=\"image\" data-base62-sha1=\"uuhCrWbAVluhWLCs2ZEj7lCjIDP\" width=\"167\" height=\"42\"></p>\n<p>and you can query either a label or metadata directly to get</p>\n<pre data-code-wrap=\"shell\"><code class=\"lang-shell\">❯ typst query test.typ \"&lt;sender&gt;\"\n[{\"func\":\"metadata\",\"value\":\"Alice\",\"label\":\"&lt;sender&gt;\"}]\n❯ typst query test.typ \"&lt;receiver&gt;\"\n[{\"func\":\"metadata\",\"value\":\"Bob\",\"label\":\"&lt;receiver&gt;\"}]\n❯ typst query test.typ \"metadata\"\n[{\"func\":\"metadata\",\"value\":\"Alice\",\"label\":\"&lt;sender&gt;\"},{\"func\":\"metadata\",\"value\":\"Bob\",\"label\":\"&lt;receiver&gt;\"}]\n</code></pre>\n<aside class=\"quote no-group\" data-username=\"Nicholas\" data-post=\"1\" data-topic=\"3664\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/nicholas/48/2575_2.png\" class=\"avatar\"> Nicholas:</div>\n<blockquote>\n<p>This is as such not possible, since typst cannot return a value and insert a block at the same time.</p>\n</blockquote>\n</aside>\n<p>I am not sure what you mean here, but I think you forgot that you can just return a dictionary with content values!</p>",
      "raw": "Hello!\nI think this should be achievable with the following code, you were nearly there!\n\n```typ\n#let declare_args(it) = {\n  let inputs = sys.inputs\n  for (k,v) in it {\n    (str(k): [#inputs.at(k, default: text(red, v))#metadata(v)#label(str(k))]) \n  }\n}\n#let args = declare_args((sender: \"Alice\", receiver: \"Bob\"))\n\nHi #args.sender, this is #args.receiver.\n```\n\nIf I compile with input `sender=Steve`, I get\n![image|167x42](upload://uuhCrWbAVluhWLCs2ZEj7lCjIDP.png)\n\nand you can query either a label or metadata directly to get\n```shell\n❯ typst query test.typ \"<sender>\"\n[{\"func\":\"metadata\",\"value\":\"Alice\",\"label\":\"<sender>\"}]\n❯ typst query test.typ \"<receiver>\"\n[{\"func\":\"metadata\",\"value\":\"Bob\",\"label\":\"<receiver>\"}]\n❯ typst query test.typ \"metadata\"\n[{\"func\":\"metadata\",\"value\":\"Alice\",\"label\":\"<sender>\"},{\"func\":\"metadata\",\"value\":\"Bob\",\"label\":\"<receiver>\"}]\n```\n\n[quote=\"Nicholas, post:1, topic:3664\"]\nThis is as such not possible, since typst cannot return a value and insert a block at the same time.\n[/quote]\nI am not sure what you mean here, but I think you forgot that you can just return a dictionary with content values!",
      "reply_to_post_number": null,
      "reply_count": 2,
      "quote_count": 1,
      "like_count": 2,
      "reads": 26,
      "score": 60.2,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 258
    },
    {
      "id": 11148,
      "post_number": 3,
      "username": "Nicholas",
      "name": "Nicholas",
      "created_at": "2025-04-16T10:50:11.180Z",
      "updated_at": "2025-04-16T10:50:11.180Z",
      "cooked": "<p>Thanks! That’s exactly what I wanted.</p>\n<aside class=\"quote no-group quote-modified\" data-username=\"quachpas\" data-post=\"2\" data-topic=\"3664\" data-full=\"true\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/q/662200/48.png\" class=\"avatar\"> quachpas:</div>\n<blockquote>\n<aside class=\"quote no-group\" data-username=\"Nicholas\" data-post=\"1\" data-topic=\"3664\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/nicholas/48/2575_2.png\" class=\"avatar\"> Nicholas:</div>\n<blockquote>\n<p>This is as such not possible, since typst cannot return a value and insert a block at the same time.</p>\n</blockquote>\n</aside>\n<p>I am not sure what you mean here, but I think you forgot that you can just return a dictionary with content values!</p>\n</blockquote>\n</aside>\n<p>Just for your information, I tried to do something like this</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let declare_args(args) = {\n  [#metadata(args) &lt;args&gt;]\n  args.map(/* replace the values */)\n}\n</code></pre>\n<p>Which will fail, because it wants to join the resulting content and dictionary (which is perfectly reasonable, I just wanted to have it insert the content and return the args^^)</p>",
      "raw": "Thanks! That's exactly what I wanted.\n\n\n[quote=\"quachpas, post:2, topic:3664, full:true\"]\n[quote=\"Nicholas, post:1, topic:3664\"]\nThis is as such not possible, since typst cannot return a value and insert a block at the same time.\n[/quote]\nI am not sure what you mean here, but I think you forgot that you can just return a dictionary with content values!\n[/quote]\n\nJust for your information, I tried to do something like this\n```typst\n#let declare_args(args) = {\n  [#metadata(args) <args>]\n  args.map(/* replace the values */)\n}\n```\nWhich will fail, because it wants to join the resulting content and dictionary (which is perfectly reasonable, I just wanted to have it insert the content and return the args^^)",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 2,
      "like_count": 1,
      "reads": 21,
      "score": 19.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1462
    },
    {
      "id": 11190,
      "post_number": 4,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T21:07:37.601Z",
      "updated_at": "2025-04-16T21:07:37.601Z",
      "cooked": "<p>Keys in dictionary must be of type <code>str</code>, so you don’t need to convert them:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let declare-args(dictionary) = for (k, v) in dictionary {\n  ((k): [#sys.inputs.at(k, default: text(red, v))#metadata(v)#label(k)])\n}\n\n#let args = declare-args((sender: \"Alice\", receiver: \"Bob\"))\n\nHi #args.sender, this is #args.receiver.\n</code></pre>",
      "raw": "Keys in dictionary must be of type `str`, so you don't need to convert them:\n\n```typ\n#let declare-args(dictionary) = for (k, v) in dictionary {\n  ((k): [#sys.inputs.at(k, default: text(red, v))#metadata(v)#label(k)])\n}\n\n#let args = declare-args((sender: \"Alice\", receiver: \"Bob\"))\n\nHi #args.sender, this is #args.receiver.\n```",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 17,
      "score": 18.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 11191,
      "post_number": 5,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-04-16T21:09:37.373Z",
      "updated_at": "2025-04-16T21:09:37.373Z",
      "cooked": "<p>The for loop works the same way as this map-join call chain:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let declare-args(dictionary) = {\n  dictionary\n    .pairs()\n    .map(((k, v)) =&gt; (\n      (k): [#sys.inputs.at(k, default: text(red, v))#metadata(v)#label(k)],\n    ))\n    .join()\n}\n</code></pre>\n<p>But sometimes for loop is just cleaner, as in this case. But I saw a lot of cases where it’s the other way around.</p>",
      "raw": "The for loop works the same way as this map-join call chain:\n\n```typ\n#let declare-args(dictionary) = {\n  dictionary\n    .pairs()\n    .map(((k, v)) => (\n      (k): [#sys.inputs.at(k, default: text(red, v))#metadata(v)#label(k)],\n    ))\n    .join()\n}\n```\n\nBut sometimes for loop is just cleaner, as in this case. But I saw a lot of cases where it's the other way around.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 16,
      "score": 33.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:49:10.097899"
}
